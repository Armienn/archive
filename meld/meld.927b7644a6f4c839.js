!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var s in i)("object"==typeof exports?exports:t)[s]=i[s]}}(self,(()=>(()=>{"use strict";var t,e,i={"./libs/age/src/age.ts":(t,e,i)=>{i.r(e),i.d(e,{AgEngine:()=>s});class s{constructor(t,e,i){this.logics=t,this.validators=e,this.state=i}update(...t){return this.validate(t)||(this.performLogic(t),{isValid:!0,problems:[]})}validate(t){for(const e of this.validators){const i=e.validate(t);if(!i.isValid)return i}}performLogic(t){this.state.tick++;for(const e of this.logics)e.update(t);this.state.finishUpdate?.()}}},"./libs/age/src/base-display.ts":(t,e,i)=>{i.r(e)},"./libs/age/src/base-game.ts":(t,e,i)=>{i.r(e),i.d(e,{BaseGame:()=>s});class s{constructor(t=[],e=[]){this.logics=t,this.validators=e}update(...t){const e=this.validate(t);if(e)return e;for(const e of this.logics)e.update(t);return{isValid:!0,problems:[]}}validate(t){for(const e of this.validators){const i=e.validate(t);if(!i.isValid)return i}}}},"./libs/age/src/display/base-input-parser.ts":(t,e,i)=>{i.r(e),i.d(e,{BaseInputParser:()=>s});class s{constructor(t,e,i=new Map,s=new Map){this.displayProvider=t,this.inputs=e,this.actionStates=i,this.previousStates=s}updateActionStates(){this.previousStates=this.actionStates,this.actionStates=new Map;for(const[t,e]of this.inputs)this.actionStates.set(t,this.stateFor(...e))}stateFor(...t){return 0===t.length?0:t.map((t=>this.displayProvider.getInputState(t))).max()}floatStateFor(t){return this.actionStates.get(t)}boolStateFor(t){return this.actionStates.get(t)>.5}hasJustBeenPressed(t){return this.actionStates.get(t)>.5&&this.previousStates.get(t)<=.5}hasJustBeenReleased(t){return this.actionStates.get(t)<=.5&&this.previousStates.get(t)>.5}}},"./libs/age/src/display/html-display-provider.ts":(t,e,i)=>{i.r(e),i.d(e,{HtmlDisplayProvider:()=>o});var s=i("./libs/utility/src/index.ts"),a=i("./libs/web-gl-display/src/index.ts"),r=i("./libs/age/src/display/screen-size.ts");class o{constructor(t,e){this.hostElement=t,this.config=e,this.textElements={},this.keyStates=new s.KeyStates,this.size=new r.ScreenSize(e.RenderToVirtualSize,e.VirtualPixelsPerTile,100,100,e.VirtualHeight,e.VirtualHeight),this.initialiseCanvas(),this.initialiseDisplay()}get sortByDepth(){return this.display.sortByDepth}set sortByDepth(t){this.display.sortByDepth=t}initialiseCanvas(){this.hostElement.style.position="relative",this.hostElement.style.backgroundColor="black",this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.config.RenderToVirtualSize&&(this.canvas.style.width="100%",this.canvas.style.imageRendering="pixelated"),this.hostElement.appendChild(this.canvas)}initialiseDisplay(){const t=this.display?.sortByDepth??!1;this.display=new a.WebGl2Display(this.canvas,this.config.VirtualPixelsPerTile,this.config.VirtualHeight,this.config.RenderToVirtualSize),this.display.sortByDepth=t;for(const[t,e]of Object.entries(this.config.Sprites))this.display.addSprite(t,this.config.AssetFolder+e.path+".png",e.width,e.height,e.centerX,e.centerY)}startFrame(){this.display.startFrame(),this.updateTextElements()}updateTextElements(){for(const t in this.textElements)"none"===this.textElements[t].style.display?this.removeElement(t):this.textElements[t].style.display="none"}removeElement(t){const e=this.textElements[t];this.hostElement.removeChild(e),delete this.textElements[t]}draw(t,e,i,s,a,r=1){this.display.isLoading()||this.display.draw(t,e,i,s,a,r)}endFrame(){this.display.endFrame()}drawString(t,e,i,s,a,r="white"){const o=this.getTextElement(e,i,s,r,a);o.innerText=t,o.style.display="block"}getTextElement(t,e,i,s,a){const r=t+","+e+i+s+a;return this.textElements[r]||(this.textElements[r]=this.createTextElement(t,e,i,s,a)),this.textElements[r]}createTextElement(t,e,i,s,a){const r=document.createElement("div");return r.style.position="absolute",r.style.fontFamily=`'${i}', Courier, monospace`,r.style.fontWeight="bold",r.style.display="none",r.style.backgroundColor="rgba(0,0,0,0.5)",r.style.textAlign="center",r.style.color=s,r.style.left=this.size.hostPixelsPerTile*(t-3)+"px",r.style.top=this.size.hostPixelsPerTile*e+"px",r.style.fontSize=this.size.hostPixelsPerTile*a+"px",r.style.width=6*this.size.hostPixelsPerTile+"px",r.style.lineHeight=this.size.hostPixelsPerTile*a*2+"px",this.hostElement.appendChild(r),r}getInputState(t){t=this.translateInputString(t);const e=this.keyStates.getInputState(t);switch(t){case"MouseX":return this.modifyMouseX(e);case"MouseY":return this.modifyMouseY(e);default:return e}}endInputFrame(){this.keyStates.endInputFrame()}modifyMouseX(t){const e=this.hostElement.getBoundingClientRect();return(t-e.x)/e.width}modifyMouseY(t){const e=this.hostElement.getBoundingClientRect();return(t-e.y)/e.height}translateInputString(t){if(1===t.length)return"Key"+t;switch(t){case"Up":return"ArrowUp";case"Down":return"ArrowDown";case"Left":return"ArrowLeft";case"Right":return"ArrowRight";case"LeftShift":return"ShiftLeft"}return t}setSize(t,e){this.size.updateHostSize(t,e),this.canvas.width=this.size.canvasWidth,this.canvas.height=this.size.canvasHeight,this.initialiseDisplay()}}},"./libs/age/src/display/screen-size.ts":(t,e,i)=>{i.r(e),i.d(e,{ScreenSize:()=>s});class s{constructor(t,e,i,s,a,r){this.renderToVirtualSize=t,this.virtualPixelsPerTile=e,this.hostWidth=i,this.hostHeight=s,this.virtualWidth=a,this.virtualHeight=r}get hostPixelsPerTile(){return this.hostHeight/this.virtualHeight*this.virtualPixelsPerTile}get canvasWidth(){return this.renderToVirtualSize?this.virtualWidth:this.hostWidth}get canvasHeight(){return this.renderToVirtualSize?this.virtualHeight:this.hostHeight}get widthInTiles(){return this.virtualWidth/this.virtualPixelsPerTile}get heightInTiles(){return this.virtualHeight/this.virtualPixelsPerTile}updateHostSize(t,e){this.hostWidth=t,this.hostHeight=e,this.virtualWidth=this.hostWidth*(this.virtualHeight/this.hostHeight)}}},"./libs/age/src/game-runner.ts":(t,e,i)=>{i.r(e),i.d(e,{GameRunner:()=>a});var s=i("./libs/age/src/services/performance.ts");class a{constructor(t,e,i=30){this.display=t,this.game=e,this.updatesPerSecond=i,this.lastUpdate=Date.now(),this.stop=!1,this.actions=[],this.updateGame=()=>{(0,s.startTiming)("gameUpdate"),this.game.update(...this.actions.splice(0),...this.display.getNewActions()),this.afterGameUpdate(),(0,s.finishTiming)("gameUpdate"),this.lastUpdate=Date.now()},this.afterGameUpdate=()=>{},this.startDisplayLoop=()=>{this.updateDisplay(),this.stop||requestAnimationFrame(this.startDisplayLoop)}}startGameLoop(){this.stopInterval(),this.timerId=window.setInterval(this.updateGame,1e3/this.updatesPerSecond)}stopInterval(){this.timerId&&window.clearInterval(this.timerId),this.timerId=null}updateDisplay(){const t=Date.now(),e=1e3/this.updatesPerSecond,i=(t-this.lastUpdate)/e;this.display.show(i)}onDestroy(){this.stop=!0,window.clearInterval(this.timerId),this.display.onDestroy?.()}}},"./libs/age/src/index.ts":(t,e,i)=>{i.r(e),i.d(e,{AgEngine:()=>s.AgEngine,BaseGame:()=>a.BaseGame,BaseInputParser:()=>o.BaseInputParser,BaseValues:()=>y.BaseValues,BlockChunk:()=>g.BlockChunk,Box:()=>T.Box,Box2d:()=>v.Box2d,CircularSize:()=>b.CircularSize,EntityManager:()=>m.EntityManager,EntityTypeMask:()=>u.EntityTypeMask,EntityTypeOf:()=>u.EntityTypeOf,EntityTypeOffset:()=>u.EntityTypeOffset,GameGrid:()=>p.GameGrid,GameRunner:()=>r.GameRunner,HtmlDisplayProvider:()=>l.HtmlDisplayProvider,Random:()=>d.Random,RandomAi:()=>h.RandomAi,RectangularSize:()=>x.RectangularSize,ScreenSize:()=>n.ScreenSize,StandardValueGetter:()=>w.StandardValueGetter,TerrainManager:()=>f.TerrainManager,TypeMap:()=>S.TypeMap,ValueAccessBuilder:()=>w.ValueAccessBuilder,ValueAccessor:()=>w.ValueAccessor,ValueSetter:()=>w.ValueSetter,finishTiming:()=>c.finishTiming,startTiming:()=>c.startTiming});var s=i("./libs/age/src/age.ts"),a=(i("./libs/age/src/base-display.ts"),i("./libs/age/src/base-game.ts")),r=i("./libs/age/src/game-runner.ts"),o=i("./libs/age/src/display/base-input-parser.ts"),l=i("./libs/age/src/display/html-display-provider.ts"),n=i("./libs/age/src/display/screen-size.ts"),h=i("./libs/age/src/interfaces/game-ai.ts"),c=(i("./libs/age/src/interfaces/game-logic.ts"),i("./libs/age/src/interfaces/game-state.ts"),i("./libs/age/src/interfaces/game-validator.ts"),i("./libs/age/src/services/performance.ts")),d=i("./libs/age/src/services/random.ts"),u=i("./libs/age/src/values/entity.ts"),y=i("./libs/age/src/state/base-values.ts"),g=i("./libs/age/src/state/block-chunk.ts"),m=i("./libs/age/src/state/entity-manager.ts"),p=i("./libs/age/src/state/game-grid.ts"),f=i("./libs/age/src/state/terrain-manager.ts"),S=i("./libs/age/src/state/type-map.ts"),w=i("./libs/age/src/state/value-accessor.ts"),T=i("./libs/age/src/values/box.ts"),v=i("./libs/age/src/values/box2d.ts"),x=i("./libs/age/src/values/rectangular-size.ts"),b=i("./libs/age/src/values/circular-size.ts")},"./libs/age/src/interfaces/game-ai.ts":(t,e,i)=>{i.r(e),i.d(e,{RandomAi:()=>s});class s{constructor(t){this.possibleActionsFor=t}requestActions(t){const e=this.possibleActionsFor(t);return[e[Math.floor(Math.random()*e.length)]]}}},"./libs/age/src/interfaces/game-logic.ts":(t,e,i)=>{i.r(e)},"./libs/age/src/interfaces/game-state.ts":(t,e,i)=>{i.r(e)},"./libs/age/src/interfaces/game-validator.ts":(t,e,i)=>{i.r(e)},"./libs/age/src/services/performance.ts":(t,e,i)=>{i.r(e),i.d(e,{finishTiming:()=>o,startTiming:()=>r});class s{constructor(t,e,i){this.lastStarted=t,this.lastTime=e,this.recentTimes=i}average(){return this.recentTimes.sum()/this.recentTimes.length}max(){return this.recentTimes.max()}}const a=new class{constructor(){this.intervalId=0,this.element=null,this.timings={}}showPerformance(t){this.element=document.createElement("div"),this.element.style.position="absolute",this.element.style.top="0",this.element.style.whiteSpace="pre",this.element.style.fontFamily="monospace",this.element.style.color="white",this.element.style.backgroundColor="rgba(0,0,0,0.5)",this.element.style.pointerEvents="none",document.body.appendChild(this.element),this.intervalId=setInterval((()=>{let t="";for(const e in this.timings)t+=e+`:\n  average: ${this.timings[e].average().toFixed(2)}\n  max:     ${this.timings[e].max().toFixed(2)}\n`;this.element.innerText=t}),1e3*t)}hidePerformance(){clearInterval(this.intervalId),document.body.removeChild(this.element),this.element=null}};function r(t){a.timings[t]||(a.timings[t]=new s(0,0,[])),a.timings[t].lastStarted=performance.now()}function o(t){a.timings[t].lastTime=performance.now()-a.timings[t].lastStarted,a.timings[t].recentTimes.push(a.timings[t].lastTime),a.timings[t].recentTimes.length>100&&a.timings[t].recentTimes.shift()}window.agePerformance=a},"./libs/age/src/services/random.ts":(t,e,i)=>{i.r(e),i.d(e,{Random:()=>s});class s{constructor(t,e=-1,i=new a(-1)){this.getSeed=t,this.previousSeed=e,this.generator=i}get get(){const t=this.getSeed();return this.previousSeed===t||(this.previousSeed=t,this.generator=new a(t)),this.generator}}class a{constructor(t){this.seed=t}int(t){return Math.floor(Math.random()*t)}float(t){return Math.random()*t}in(t){return t[this.int(t.length)]}}},"./libs/age/src/state/base-values.ts":(t,e,i)=>{i.r(e),i.d(e,{BaseValues:()=>s});class s{constructor(t=new Map){this.Entities=t,this.allValueMaps=[]}register(t){return this.allValueMaps.push(t),t}ClearValues(){for(const t of this.allValueMaps)t.clear()}RemoveValuesFor(t){for(const e of this.allValueMaps)e.delete(t)}AddValuesFromOther(t){for(let e=0;e<this.allValueMaps.length;e++)for(const[i,s]of t.allValueMaps[e])this.allValueMaps[e].set(i,s)}}},"./libs/age/src/state/block-chunk.ts":(t,e,i)=>{i.r(e),i.d(e,{BlockChunk:()=>a});var s=i("./libs/utility/src/index.ts");class a{constructor(t,e=new s.Vector3(10,10,1),i=new s.Vector3(0,0,0)){this.Blocks=t,this.ChunkSize=e,this.Offset=i}Get(t,e,i){return this.Blocks[this.chunkIndexFor(t-this.Offset.x,e-this.Offset.y,i-this.Offset.z)]}Set(t,e,i,s){return this.Blocks[this.chunkIndexFor(t-this.Offset.x,e-this.Offset.y,i-this.Offset.z)]=s}chunkIndexFor(t,e,i){return t+e*this.ChunkSize.x+i*this.ChunkSize.x*this.ChunkSize.y}}},"./libs/age/src/state/entity-manager.ts":(t,e,i)=>{i.r(e),i.d(e,{EntityManager:()=>s});class s{constructor(t,e,i){this.entityValues=t,this.updatedEntityValues=e,this.idProvider=i,this.valueAccessors=[]}get With(){return this.entityValues}Create(t){const e=this.idProvider.GetNewId()|t;this.updatedEntityValues.Entities.set(e,!0);for(const t of this.valueAccessors)t.InitialiseValueFor(e);return e}Remove(...t){for(const e of t)this.updatedEntityValues.Entities.set(e,!1)}ApplyUpdatedValues(){this.entityValues.AddValuesFromOther(this.updatedEntityValues),this.updatedEntityValues.ClearValues();for(const[t,e]of this.updatedEntityValues.Entities)e?this.add(t):this.fullyRemove(t);this.updatedEntityValues.Entities.clear(),this.updatedEntityValues.Entities.clear()}add(t){this.entityValues.Entities.set(t,!0)}fullyRemove(t){this.entityValues.Entities.delete(t),this.updatedEntityValues.Entities.delete(t),this.entityValues.RemoveValuesFor(t),this.updatedEntityValues.RemoveValuesFor(t)}*[Symbol.iterator](){for(const[t]of this.entityValues.Entities)yield t}}},"./libs/age/src/state/game-grid.ts":(t,e,i)=>{i.r(e),i.d(e,{GameGrid:()=>a});var s=i("./libs/utility/src/index.ts");class a{constructor(t,e,i=(()=>null)){this.width=t,this.height=e,this.setAll(i)}setAll(t){this.grid=[];for(const{x:e,y:i}of this.allFields())this.grid.push(t(e,i))}*allFields(){for(const t of(0,s.range)(0,this.height))for(const e of(0,s.range)(0,this.width))yield{x:e,y:t,field:this.get(e,t)}}*fieldsAround(t,e,i=1){for(const a of(0,s.range)(t-i,t+i+1))for(const t of(0,s.range)(e-i,e+i+1))this.isWithinBounds(a,t)&&(yield{i:a,j:t,field:this.get(a,t)})}get(t,e){return this.grid[this.indexFor(t,e)]}set(t,e,i){this.grid[this.indexFor(t,e)]=i}isWithinBounds(t,e){return 0<=t&&t<this.width&&0<=e&&e<this.height}indexFor(t,e){return t+e*this.width}}},"./libs/age/src/state/terrain-manager.ts":(t,e,i)=>{i.r(e),i.d(e,{TerrainManager:()=>r});var s=i("./libs/utility/src/index.ts"),a=i("./libs/age/src/state/block-chunk.ts");class r{constructor(t=new s.Vector3(10,10,1),e,i=new Map){this.chunkSize=t,this.chunks=e,this.updatedBlocks=i}AddChunk(t,e,i){const r=new s.Vector3(this.chunkSize.x*t,this.chunkSize.y*e,this.chunkSize.z*i);this.chunks.set(s.Vector3.stringify(t,e,i),new a.BlockChunk([],this.chunkSize,r))}Get(t,e,i=0){return t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),this.chunks.get(this.getChunkCoords(t,e,i))?.Get(t,e,i)}GetAt(t){return this.Get(t.x,t.y,t.z)}getChunkCoords(t,e,i){return s.Vector3.stringify(this.chunkCoord(t,this.chunkSize.x),this.chunkCoord(e,this.chunkSize.y),this.chunkCoord(i,this.chunkSize.z))}chunkCoord(t,e){return Math.floor(t/e)}chunkIndexFor(t,e,i){return t+e*this.chunkSize.x+i*this.chunkSize.x*this.chunkSize.y}GetCurrent(t,e,i=0){return t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),this.updatedBlocks.get(s.Vector3.stringify(t,e,i))??this.Get(t,e,i)}*AllFields(){for(const[t,e]of this.chunks){const[i,a,r]=t.split(",").map((t=>+t));for(const t of(0,s.range)(0,this.chunkSize.z))for(const o of(0,s.range)(0,this.chunkSize.y))for(const l of(0,s.range)(0,this.chunkSize.x))yield{position:this.getGlobalPosition(l,o,t,i,a,r),field:e[this.chunkIndexFor(l,o,t)]}}}*AllFieldsInChunk(t=0,e=0,i=0){const a=this.chunks.get(s.Vector3.stringify(t,e,i));if(a)for(const r of(0,s.range)(0,this.chunkSize.z))for(const o of(0,s.range)(0,this.chunkSize.y))for(const l of(0,s.range)(0,this.chunkSize.x))yield{global:this.getGlobalPosition(l,o,r,t,e,i),x:l,y:o,z:r,field:a[this.chunkIndexFor(l,o,r)]}}FieldsAround(t,e,i=0){return this.FieldsWithinRadius(t,e,i,1,1,0)}*FieldsWithinRadius(t,e,i,a=1,r=1,o=1){for(const l of(0,s.range)(t-a,t+a+1))for(const t of(0,s.range)(e-r,e+r+1))for(const e of(0,s.range)(i-o,i+o+1))yield{i:l,j:t,k:e,field:this.Get(l,t,e)}}getGlobalPosition(t,e,i,a,r,o=0){return new s.Vector3(t+a*this.chunkSize.x,e+r*this.chunkSize.y,i+o*this.chunkSize.z)}Set(t,e,i,a=0){e=Math.floor(e),i=Math.floor(i),a=Math.floor(a),this.updatedBlocks.set(s.Vector3.stringify(e,i,a),t)}SetAt(t,e){const i=s.Vector3.stringify(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z));this.updatedBlocks.set(i,e)}ApplyUpdatedValues(){for(const[t,e]of this.updatedBlocks)this.setField(s.Vector3.parse(t),e);this.updatedBlocks.clear()}setField(t,e){const i=this.chunks.get(this.getChunkCoords(t.x,t.y,t.z));i?i.Set(t.x,t.y,t.z,e):console.error(`Can't set field outside chunks at (${t.x}, ${t.y}, ${t.z})`)}}},"./libs/age/src/state/type-map.ts":(t,e,i)=>{i.r(e),i.d(e,{TypeMap:()=>s});class s{constructor(t=new Map){this.Types=t}static From(t,e){const i=new s;for(const[s,a]of e.entries())i.Types.set(a,s<<t);return i}TypeFor(t){for(const[e,i]of this.Types.entries())if(t===i)return e}TypeIdFor(t){return this.Types.get(t)}}},"./libs/age/src/state/value-accessor.ts":(t,e,i)=>{i.r(e),i.d(e,{StandardValueGetter:()=>r,ValueAccessBuilder:()=>l,ValueAccessor:()=>a,ValueSetter:()=>o});var s=i("./libs/age/src/values/entity.ts");class a{constructor(t,e){this.Get=t,this.Set=e}InitialiseValueFor(t){const e=this.Get.DefaultOf(t);null!=e&&this.Set.For(t,e)}}class r{constructor(t,e,i,s,a){this.typeValues=t,this.entityValue=e,this.updatedEntityValue=i,this.getTypeValue=s,this.defaultValue=a}CurrentlyOf(t){return this.updatedEntityValue.get(t)??this.Of(t)}Of(t){return this.entityValue.get(t)}DefaultOf(t){const e=(0,s.EntityTypeOf)(t);return this.getTypeValue(this.typeValues.get(e))??this.defaultValue}}class o{constructor(t){this.updatedEntityValue=t}For(t,e){this.updatedEntityValue.set(t,e)}}class l{constructor(t,e,i){this.typeValues=t,this.entityValues=e,this.updatedEntityValues=i}For(t,e,i){return new a(new r(this.typeValues,t(this.entityValues),t(this.updatedEntityValues),e,i),new o(t(this.updatedEntityValues)))}}},"./libs/age/src/values/box.ts":(t,e,i)=>{i.r(e),i.d(e,{Box:()=>s});class s{constructor(t,e,i,s,a,r){this.minX=t,this.maxX=e,this.minY=i,this.maxY=s,this.minZ=a,this.maxZ=r}static from(t){return new s(t.x,t.x,t.y,t.y,t.z,t.z)}translateBy(t){return new s(this.minX+t.x,this.maxX+t.x,this.minY+t.y,this.maxY+t.y,this.minZ+t.z,this.maxZ+t.z)}static occupiedArea(t,e){return new s(t.x-e.radius,t.x+e.radius,t.y-e.radius,t.y+e.radius,t.z,t.z+e.height)}contains(t){return this.minX<=t.x&&t.x<=this.maxX&&this.minY<=t.y&&t.y<=this.maxY&&this.minZ<=t.z&&t.z<=this.maxZ}}},"./libs/age/src/values/box2d.ts":(t,e,i)=>{i.r(e),i.d(e,{Box2d:()=>s});class s{constructor(t,e,i,s){this.minX=t,this.maxX=e,this.minY=i,this.maxY=s}static from(t,e){return new s(t.x-e.width/2,t.x+e.width/2,t.y-e.height/2,t.y+e.height/2)}translateBy(t){return new s(this.minX+t.x,this.maxX+t.x,this.minY+t.y,this.maxY+t.y)}contains(t){return this.minX<=t.x&&t.x<=this.maxX&&this.minY<=t.y&&t.y<=this.maxY}}},"./libs/age/src/values/circular-size.ts":(t,e,i)=>{i.r(e),i.d(e,{CircularSize:()=>s});class s{constructor(t,e){this.radius=t,this.height=e}}},"./libs/age/src/values/entity.ts":(t,e,i)=>{i.r(e),i.d(e,{EntityTypeMask:()=>s,EntityTypeOf:()=>r,EntityTypeOffset:()=>a});const s=4278190080,a=24;function r(t){return t&s}},"./libs/age/src/values/rectangular-size.ts":(t,e,i)=>{i.r(e),i.d(e,{RectangularSize:()=>s});class s{constructor(t,e){this.width=t,this.height=e}}},"./libs/meld/src/config/constants.ts":(t,e,i)=>{i.r(e),i.d(e,{Constants:()=>s});class s{constructor(t,e,i,s,a,r,o,l,n,h,c,d,u,y,g,m){this.PlayerType=t,this.ChunkSize=e,this.ChunkLoadingRadius=i,this.CollisionAreaWidth=s,this.GravityAcceleration=a,this.TerminalVerticalVelocity=r,this.MaxMoveSpeed=o,this.Acceleration=l,this.InitialDashCharge=n,this.MaxDashCharge=h,this.DashChargeSpeed=c,this.DashDuration=d,this.DashCooldown=u,this.DashQuickChargeWindowStart=y,this.DashQuickChargeWindowEnd=g,this.DashQuickChargeMinimumAngle=m}}},"./libs/meld/src/config/game-config.ts":(t,e,i)=>{i.r(e),i.d(e,{GameConfig:()=>s});class s{constructor(t,e,i,s,a,r,o){this.Constants=t,this.EntityTypeMap=e,this.EntityTypeValues=i,this.SolidTypeMap=s,this.SolidTypeValues=a,this.NonSolidTypeMap=r,this.NonSolidTypeValues=o}}},"./libs/meld/src/display/camera.ts":(t,e,i)=>{i.r(e),i.d(e,{Camera:()=>r,DisplayArea:()=>o,Layer:()=>l});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/display/display-state.ts");class r{constructor(t,e,i,a,r=[]){this.Game=t,this.DisplayProvider=e,this.Config=i,this.State=a,this.ShownLayers=r,this.BaseTopTile=new s.Vector3(0,-1,0),this.BaseTopRightTile=new s.Vector3(1,-1,0),this.BaseRightTile=new s.Vector3(1,0,0),this.BaseBottomRightTile=new s.Vector3(1,1,0),this.BaseBottomTile=new s.Vector3(0,1,0),this.BaseBottomLeftTile=new s.Vector3(-1,1,0),this.BaseLeftTile=new s.Vector3(-1,0,0),this.BaseTopLeftTile=new s.Vector3(-1,-1,0),this.TopTile=new s.Vector3(0,-1,0),this.TopRightTile=new s.Vector3(1,-1,0),this.RightTile=new s.Vector3(1,0,0),this.BottomRightTile=new s.Vector3(1,1,0),this.BottomTile=new s.Vector3(0,1,0),this.BottomLeftTile=new s.Vector3(-1,1,0),this.LeftTile=new s.Vector3(-1,0,0),this.TopLeftTile=new s.Vector3(-1,-1,0),this.Adjustable=new s.Vector3(0,0,0),this._adjustableCurrentPosition=new s.Vector3(0,0,0)}FocusOn(t){this.SetCurrentPositionWith(this.State.FocusPoint,this.Game.Entities.Position.Get.Of(t)??new s.Vector3(0,0,0),this.Game.Entities.Velocity.Get.Of(t)),this.UpdateShownLayers()}UpdateShownLayers(){this.ShownLayers.clear();for(let t=-this.Config.DisplayDepth;t<=this.Config.DisplayDepth;t++)this.ShownLayers.push({layer:t+Math.floor(this.State.FocusPoint.z),area:this.displayAreaFor(t)})}displayAreaFor(t){const e=[this.TilePositionFor(0,0),this.TilePositionFor(1,0),this.TilePositionFor(0,1),this.TilePositionFor(1,1)];let i=Number.MAX_VALUE,s=Number.MIN_VALUE,a=Number.MAX_VALUE,r=Number.MIN_VALUE;for(const t of e)t.y<i&&(i=t.y),t.y>s&&(s=t.y),t.x<a&&(a=t.x),t.x>r&&(r=t.x);const l=this.BottomTile.multiply(t*this.Config.WallDisplayHeight);return new o(i+l.y-2,s+l.y+2,a+l.x-2,r+l.x+2)}SetCurrentPositionWith(t,e,i=null){return i?t.setFrom(e).addFrom(this._adjustableCurrentPosition.setFrom(i).multiplyFrom(this.State.FractionOfTick)):t.setFrom(e)}DrawAnimated(t,e,i,s=null,a=0){const r=this.Config.Sprites[t],o=this.AnimationFrame(r.frameInterval,r.framesX,r.framesY,a);this.Draw(t,e,i,s,o)}AnimationFrame(t,e,i,s){if(!t)return 0;const a=e*i,r=this.Game.State.Globals.Tick-s;return Math.floor(r/t)%a}Draw(t,e,i,s=null,a=0){const r=this.SetCurrentPositionWith(this.Adjustable,i,s);this.AdjustForFocusAndCamera(r);const o=this.ScreenXFor(r),l=this.ScreenYFor(r);r.z=i.z;const n=this.Config.Sprites[t],h=a%n.framesX,c=Math.floor(a/n.framesX)%n.framesY;this.DisplayProvider.draw(t,o,l,h,c,this.sortingNumberFor(r,e))}AdjustForFocusAndCamera(t){const e=.75,i=t.subtractFrom(this.State.FocusPoint);switch(this.State.ViewDirection){case a.ViewDirection.NorthEast:return t.set((i.x+i.y)*e,(-i.x+i.y)*e,i.z);case a.ViewDirection.East:return t.set(i.y,-i.x,i.z);case a.ViewDirection.SouthEast:return t.set((-i.x+i.y)*e,(-i.x-i.y)*e,i.z);case a.ViewDirection.South:return t.set(-i.x,-i.y,i.z);case a.ViewDirection.SouthWest:return t.set((-i.x-i.y)*e,(i.x-i.y)*e,i.z);case a.ViewDirection.West:return t.set(-i.y,i.x,i.z);case a.ViewDirection.NorthWest:return t.set((i.x-i.y)*e,(i.x+i.y)*e,i.z);default:return i}}RevertFocusAndCameraAdjustment(t){return this.RevertBla(t,1.33333).addFrom(this.State.FocusPoint)}RevertBla(t,e){switch(this.State.ViewDirection){case a.ViewDirection.NorthWest:return t.set((t.x+t.y)*e,(-t.x+t.y)*e,t.z);case a.ViewDirection.West:return t.set(t.y,-t.x,t.z);case a.ViewDirection.SouthWest:return t.set((-t.x+t.y)*e,(-t.x-t.y)*e,t.z);case a.ViewDirection.South:return t.set(-t.x,-t.y,t.z);case a.ViewDirection.SouthEast:return t.set((-t.x-t.y)*e,(t.x-t.y)*e,t.z);case a.ViewDirection.East:return t.set(-t.y,t.x,t.z);case a.ViewDirection.NorthEast:return t.set((t.x-t.y)*e,(t.x+t.y)*e,t.z);default:return t}}ScreenPositionFor(t){return new s.Vector2(t.x+this.State.Size.widthInTiles/2,t.y+this.State.Size.heightInTiles/2-this.Config.WallDisplayHeight*t.z)}ScreenXFor(t){return t.x+this.State.Size.widthInTiles/2}ScreenYFor(t){return t.y+this.State.Size.heightInTiles/2-this.Config.WallDisplayHeight*t.z}sortingNumberFor(t,e){const i=Math.floor(t.z)+e,s=2*this.Config.DisplayDepth+3,a=(i-(this.State.FocusPoint.z-s/2))/s,r=this.State.Size.heightInTiles+(2*this.Config.DisplayDepth+1)*this.Config.WallDisplayHeight,o=-r/2;return a+(t.y-o)/r/l.NumberOfLayers/s}TilePositionFor(t,e){let i=new s.Vector3(t*this.State.Size.widthInTiles-this.State.Size.widthInTiles/2,e*this.State.Size.heightInTiles-this.State.Size.heightInTiles/2,0);return this.IsDiagonalView()&&(i=i.multiply(.5)),this.RevertFocusAndCameraAdjustment(i)}RotateCamera(t){this.State.ViewDirection+=t,this.State.ViewDirection>a.ViewDirection.NorthWest&&(this.State.ViewDirection=a.ViewDirection.North),this.State.ViewDirection<a.ViewDirection.North&&(this.State.ViewDirection=a.ViewDirection.NorthWest),this.UpdateDirections()}UpdateDirections(){this.RotateAndRound(this.TopTile,this.BaseTopTile),this.RotateAndRound(this.TopRightTile,this.BaseTopRightTile),this.RotateAndRound(this.RightTile,this.BaseRightTile),this.RotateAndRound(this.BottomRightTile,this.BaseBottomRightTile),this.RotateAndRound(this.BottomTile,this.BaseBottomTile),this.RotateAndRound(this.BottomLeftTile,this.BaseBottomLeftTile),this.RotateAndRound(this.LeftTile,this.BaseLeftTile),this.RotateAndRound(this.TopLeftTile,this.BaseTopLeftTile)}RotateAndRound(t,e){return t.setFrom(e).rotateFrom((0,a.AngleOf)(this.State.ViewDirection)),t.x=Math.round(t.x),t.y=Math.round(t.y),t.z=Math.round(t.z),t}IsDiagonalView(){return this.State.ViewDirection%2==1}}class o{constructor(t,e,i,s){this.top=t,this.bottom=e,this.left=i,this.right=s}}class l{}l.NumberOfLayers=4,l.Bottom=0,l.Floor=1/l.NumberOfLayers,l.Middle=2/l.NumberOfLayers,l.Top=3/l.NumberOfLayers,l.ZFightingAdjustment=1e-4,l.OverlayNorthAdjustment=1*l.ZFightingAdjustment,l.OverlayEastAdjustment=2*l.ZFightingAdjustment,l.OverlayWestAdjustment=3*l.ZFightingAdjustment,l.OverlaySouthAdjustment=4*l.ZFightingAdjustment},"./libs/meld/src/display/display-config.ts":(t,e,i)=>{i.r(e),i.d(e,{BlockSprites:()=>a,BlockTileOverlays:()=>r,BlockWallOverlays:()=>o});var s=i("./libs/meld/src/display/display-state.ts");class a{constructor(t,e,i,s,a,r,o,l,n,h,c,d,u,y,g,m,p,f,S,w,T,v,x,b){this.TileNorth=t,this.TileNorthEast=e,this.TileEast=i,this.TileSouthEast=s,this.TileSouth=a,this.TileSouthWest=r,this.TileWest=o,this.TileNorthWest=l,this.FullWallNorth=n,this.FullWallNorthEast=h,this.FullWallEast=c,this.FullWallSouthEast=d,this.FullWallSouth=u,this.FullWallSouthWest=y,this.FullWallWest=g,this.FullWallNorthWest=m,this.HalfWallNorth=p,this.HalfWallNorthEast=f,this.HalfWallEast=S,this.HalfWallSouthEast=w,this.HalfWallSouth=T,this.HalfWallSouthWest=v,this.HalfWallWest=x,this.HalfWallNorthWest=b}TileFor(t){switch(t){case s.ViewDirection.North:return this.TileNorth;case s.ViewDirection.NorthEast:return this.TileNorthEast;case s.ViewDirection.East:return this.TileEast;case s.ViewDirection.SouthEast:return this.TileSouthEast;case s.ViewDirection.South:return this.TileSouth;case s.ViewDirection.SouthWest:return this.TileSouthWest;case s.ViewDirection.West:return this.TileWest;case s.ViewDirection.NorthWest:return this.TileNorthWest}}FullWallFor(t){switch(t){case s.ViewDirection.North:return this.FullWallNorth;case s.ViewDirection.NorthEast:return this.FullWallNorthEast;case s.ViewDirection.East:return this.FullWallEast;case s.ViewDirection.SouthEast:return this.FullWallSouthEast;case s.ViewDirection.South:return this.FullWallSouth;case s.ViewDirection.SouthWest:return this.FullWallSouthWest;case s.ViewDirection.West:return this.FullWallWest;case s.ViewDirection.NorthWest:return this.FullWallNorthWest}}HalfWallFor(t){switch(t){case s.ViewDirection.North:return this.HalfWallNorth;case s.ViewDirection.NorthEast:return this.HalfWallNorthEast;case s.ViewDirection.East:return this.HalfWallEast;case s.ViewDirection.SouthEast:return this.HalfWallSouthEast;case s.ViewDirection.South:return this.HalfWallSouth;case s.ViewDirection.SouthWest:return this.HalfWallSouthWest;case s.ViewDirection.West:return this.HalfWallWest;case s.ViewDirection.NorthWest:return this.HalfWallNorthWest}}}class r{constructor(t="default-tile-top",e="default-tile-bottom",i="default-tile-left",s="default-tile-right",a="default-tile-top-left",r="default-tile-top-right",o="default-tile-bottom-left",l="default-tile-bottom-right"){this.tileOverlayTop=t,this.tileOverlayBottom=e,this.tileOverlayLeft=i,this.tileOverlayRight=s,this.tileOverlayTopLeft=a,this.tileOverlayTopRight=r,this.tileOverlayBottomLeft=o,this.tileOverlayBottomRight=l}}class o{constructor(t="default-straight-half-wall-left",e="default-straight-half-wall-right",i="default-diagonal-half-wall-left",s="default-diagonal-half-wall-right",a="default-straight-full-wall-left",r="default-straight-full-wall-right",o="default-diagonal-full-wall-left",l="default-diagonal-full-wall-right"){this.straightHalfWallOverlayLeft=t,this.straightHalfWallOverlayRight=e,this.diagonalHalfWallOverlayLeft=i,this.diagonalHalfWallOverlayRight=s,this.straightFullWallOverlayLeft=a,this.straightFullWallOverlayRight=r,this.diagonalFullWallOverlayLeft=o,this.diagonalFullWallOverlayRight=l}}},"./libs/meld/src/display/display-state.ts":(t,e,i)=>{i.r(e),i.d(e,{AngleOf:()=>l,DisplayState:()=>o,ViewDirection:()=>s});var s,a=i("./libs/age/src/index.ts"),r=i("./libs/utility/src/index.ts");class o{constructor(t,e="",i=0,s=new r.Vector3(0,0,0),a=0,o=[]){this.Size=t,this.PlayerName=e,this.FractionOfTick=i,this.FocusPoint=s,this.ViewDirection=a,this.DisplayEntities=o}static from(t,e){return new o(new a.ScreenSize(t.RenderToVirtualSize,t.VirtualPixelsPerTile,100,100,t.VirtualHeight,t.VirtualHeight),e)}}function l(t){return.25*Math.PI*t}!function(t){t[t.North=0]="North",t[t.NorthEast=1]="NorthEast",t[t.East=2]="East",t[t.SouthEast=3]="SouthEast",t[t.South=4]="South",t[t.SouthWest=5]="SouthWest",t[t.West=6]="West",t[t.NorthWest=7]="NorthWest"}(s||(s={}))},"./libs/meld/src/display/entity-drawer.ts":(t,e,i)=>{i.r(e),i.d(e,{EntityDrawer:()=>r});var s=i("./libs/age/src/index.ts"),a=i("./libs/meld/src/display/camera.ts");class r{constructor(t,e){this.Game=t,this.Camera=e}Draw(t){(0,s.EntityTypeOf)(t)===this.Game.Config.Constants.PlayerType?this.drawPlayer(t):this.drawGeneralEntity(t)}drawGeneralEntity(t){const e=this.Game.Entities.Position.Get.Of(t),i=this.Game.Entities.Velocity.Get.Of(t),r=this.Game.Config.EntityTypeMap.TypeFor((0,s.EntityTypeOf)(t));this.Camera.DrawAnimated(r,a.Layer.Middle,e,i)}drawPlayer(t){const e=this.Game.Entities.Position.Get.Of(t),i=this.Game.Entities.Velocity.Get.Of(t),r=this.Game.Config.EntityTypeMap.TypeFor((0,s.EntityTypeOf)(t));this.Camera.DrawAnimated(r,a.Layer.Middle,e,i)}}},"./libs/meld/src/display/hud-drawer.ts":(t,e,i)=>{i.r(e),i.d(e,{HudDrawer:()=>a});var s=i("./libs/utility/src/index.ts");class a{constructor(t,e,i,s){this.Game=t,this.Config=e,this.State=i,this.DisplayProvider=s}Draw(){const t=this.Game.State.Players.get(this.State.PlayerName);if(!(t>-1))return;this.DrawHud();const e=this.Game.Entities.SelectedBlock.Get.Of(t);e>-1&&this.DrawSelectedBlock(e)}DrawHud(){this.DisplayProvider.draw("hud-life-energy",0,0,0,0,a.BottomLayer),this.DisplayProvider.draw("hud-tool-items",this.State.Size.widthInTiles,0,0,0,a.BottomLayer)}DrawSelectedBlock(t){const e=new s.Vector2(this.State.Size.widthInTiles-1,1),i=this.Config.BlockSprites.get(t)[0].TileFor(this.State.ViewDirection);this.DisplayProvider.draw(i,e.x,e.y,0,0,a.TopLayer)}}a.BottomLayer=.9998,a.TopLayer=.9999},"./libs/meld/src/display/input-parser.ts":(t,e,i)=>{i.r(e),i.d(e,{Input:()=>s,InputParser:()=>n});var s,a=i("./libs/age/src/index.ts"),r=i("./libs/utility/src/index.ts"),o=i("./libs/meld/src/state/game-update.ts"),l=i("./libs/meld/src/display/display-state.ts");class n extends a.BaseInputParser{constructor(t,e,i,s,a){super(s,a),this.Game=t,this.State=e,this.Camera=i,this.DisplayProvider=s,this.PreviousMovement=new r.Vector2(0,0)}ParseInputs(){this.UpdateCamera(),this.updateActionStates();const t=this.Game.State.Players.get(this.State.PlayerName);return[this.ParseGenerate(),this.ParseDash(t),this.ParseMovement(t),this.ParsePlaceBlock(),this.ParseSelectNextItem()].filter((t=>t))}UpdateCamera(){this.hasJustBeenPressed(s.RotateCameraRight)&&this.Camera.RotateCamera(1),this.hasJustBeenPressed(s.RotateCameraLeft)&&this.Camera.RotateCamera(-1)}ParseMovement(t){const e=this.boolStateFor(s.HoldWalk)?.5:1,i=this.floatStateFor(s.MoveUp)??0,a=this.floatStateFor(s.MoveDown)??0,n=this.floatStateFor(s.MoveLeft)??0,h=this.floatStateFor(s.MoveRight)??0,c=new r.Vector2(h-n,a-i).rotate((0,l.AngleOf)(this.State.ViewDirection)),d=c.lengthSquared()>1?c.unitVector().multiply(e):c.multiply(e);return d.x===this.PreviousMovement.x&&d.y===this.PreviousMovement.y?null:(this.PreviousMovement=d,new o.MovementAction(t,d))}ParseDash(t){const e=this.GetVectorToMouse(t).getAngle();return this.hasJustBeenReleased(s.Action)?new o.ReleaseDashAction(t,e):this.boolStateFor(s.Action)?new o.ChargeDashAction(t,e):null}GetVectorToMouse(t){const e=this.Camera.TilePositionFor(this.DisplayProvider.getInputState("MouseX"),this.DisplayProvider.getInputState("MouseY")).subtract(this.Game.Entities.Position.Get.Of(t)??new r.Vector3(0,0,0));return new r.Vector2(e.x,e.y)}ParseGenerate(){if(this.hasJustBeenPressed(s.Generate))return new o.GenerateAction}ParsePlaceBlock(){const t=this.Camera.TilePositionFor(this.displayProvider.getInputState("MouseX"),this.displayProvider.getInputState("MouseY"));if(this.hasJustBeenPressed(s.UseItem))return new o.PlaceBlockAction(this.Game.State.Players.get(this.State.PlayerName),t)}ParseSelectNextItem(){if(this.hasJustBeenPressed(s.SelectNextItem))return new o.SelectNextItemAction(this.Game.State.Players.get(this.State.PlayerName))}}!function(t){t[t.Generate=0]="Generate",t[t.ToggleInventory=1]="ToggleInventory",t[t.ToggleMenu=2]="ToggleMenu",t[t.ToggleChat=3]="ToggleChat",t[t.MoveUp=4]="MoveUp",t[t.MoveDown=5]="MoveDown",t[t.MoveLeft=6]="MoveLeft",t[t.MoveRight=7]="MoveRight",t[t.UseItem=8]="UseItem",t[t.ToolA=9]="ToolA",t[t.ToolB=10]="ToolB",t[t.Action=11]="Action",t[t.SelectTopItem=12]="SelectTopItem",t[t.SelectBottomItem=13]="SelectBottomItem",t[t.SelectLeftItem=14]="SelectLeftItem",t[t.SelectRightItem=15]="SelectRightItem",t[t.SelectTopItemSet=16]="SelectTopItemSet",t[t.SelectBottomItemSet=17]="SelectBottomItemSet",t[t.SelectLeftItemSet=18]="SelectLeftItemSet",t[t.SelectRightItemSet=19]="SelectRightItemSet",t[t.SelectTopTool=20]="SelectTopTool",t[t.SelectBottomTool=21]="SelectBottomTool",t[t.SelectLeftTool=22]="SelectLeftTool",t[t.SelectRightTool=23]="SelectRightTool",t[t.MoveCameraUp=24]="MoveCameraUp",t[t.MoveCameraDown=25]="MoveCameraDown",t[t.MoveCameraLeft=26]="MoveCameraLeft",t[t.MoveCameraRight=27]="MoveCameraRight",t[t.LookUp=28]="LookUp",t[t.LookDown=29]="LookDown",t[t.RotateCameraLeft=30]="RotateCameraLeft",t[t.RotateCameraRight=31]="RotateCameraRight",t[t.ToggleSelection=32]="ToggleSelection",t[t.HoldSelection=33]="HoldSelection",t[t.SelectionModeSelectTopItem=34]="SelectionModeSelectTopItem",t[t.SelectionModeSelectBottomItem=35]="SelectionModeSelectBottomItem",t[t.SelectionModeSelectLeftItem=36]="SelectionModeSelectLeftItem",t[t.SelectionModeSelectRightItem=37]="SelectionModeSelectRightItem",t[t.SelectionModeSelectTopTool=38]="SelectionModeSelectTopTool",t[t.SelectionModeSelectBottomTool=39]="SelectionModeSelectBottomTool",t[t.SelectionModeSelectLeftTool=40]="SelectionModeSelectLeftTool",t[t.SelectionModeSelectRightTool=41]="SelectionModeSelectRightTool",t[t.ToggleCamera=42]="ToggleCamera",t[t.HoldCamera=43]="HoldCamera",t[t.CameraModeMoveCameraUp=44]="CameraModeMoveCameraUp",t[t.CameraModeMoveCameraDown=45]="CameraModeMoveCameraDown",t[t.CameraModeMoveCameraLeft=46]="CameraModeMoveCameraLeft",t[t.CameraModeMoveCameraRight=47]="CameraModeMoveCameraRight",t[t.CameraModeLookUp=48]="CameraModeLookUp",t[t.CameraModeLookDown=49]="CameraModeLookDown",t[t.CameraModeRotateCameraLeft=50]="CameraModeRotateCameraLeft",t[t.CameraModeRotateCameraRight=51]="CameraModeRotateCameraRight",t[t.SelectNextItem=52]="SelectNextItem",t[t.SelectPreviousItem=53]="SelectPreviousItem",t[t.HoldWalk=54]="HoldWalk",t[t.ToggleWalk=55]="ToggleWalk"}(s||(s={}))},"./libs/meld/src/display/terrain-drawer.ts":(t,e,i)=>{i.r(e),i.d(e,{TerrainDrawer:()=>l});var s,a=i("./libs/utility/src/index.ts"),r=i("./libs/meld/src/state/block.ts"),o=i("./libs/meld/src/display/camera.ts");class l{constructor(t,e,i,s){this.Game=t,this.Config=e,this.State=i,this.Camera=s,this.Position=new a.Vector3(0,0,0),this.TopPosition=new a.Vector3(0,0,0),this.TopRightPosition=new a.Vector3(0,0,0),this.RightPosition=new a.Vector3(0,0,0),this.BottomRightPosition=new a.Vector3(0,0,0),this.BottomPosition=new a.Vector3(0,0,0),this.BottomLeftPosition=new a.Vector3(0,0,0),this.LeftPosition=new a.Vector3(0,0,0),this.TopLeftPosition=new a.Vector3(0,0,0),this.Below=new a.Vector3(0,0,-1),this.Adjustable=new a.Vector3(0,0,0)}DrawBlockContent(t,e,i){const s=this.Game.Terrain.Get(t,e,i);s&&(this.Position.set(t,e,i),this.updateDirections(),this.DrawBlockTile(s,this.Position),this.DrawBlockWall(s,this.Position),this.Camera.IsDiagonalView()?this.DrawDiagonalTileOverlays(s,this.Position):this.DrawTileOverlays(s,this.Position),this.DrawWallOverlays(s,this.Position),this.DrawWallShadows(s,this.Position))}updateDirections(){this.TopPosition.setFrom(this.Position).addFrom(this.Camera.TopTile),this.TopRightPosition.setFrom(this.Position).addFrom(this.Camera.TopRightTile),this.RightPosition.setFrom(this.Position).addFrom(this.Camera.RightTile),this.BottomRightPosition.setFrom(this.Position).addFrom(this.Camera.BottomRightTile),this.BottomPosition.setFrom(this.Position).addFrom(this.Camera.BottomTile),this.BottomLeftPosition.setFrom(this.Position).addFrom(this.Camera.BottomLeftTile),this.LeftPosition.setFrom(this.Position).addFrom(this.Camera.LeftTile),this.TopLeftPosition.setFrom(this.Position).addFrom(this.Camera.TopLeftTile)}DrawBlockTile(t,e){if(r.Blocks.TypeOf(t)===r.BlockType.Empty)return;const i=this.layerFor(r.Blocks.TypeOf(t)),s=this.heightFor(r.Blocks.TypeOf(t)),a=this.Adjustable.setFrom(e).addFrom(s).addFrom(l.BlockCenter);this.Camera.DrawAnimated(this.TileSpriteFor(t),i,a,null,this.AnimationStartFor(e))}layerFor(t){switch(t){case r.BlockType.Floor:return o.Layer.Floor;case r.BlockType.Half:return o.Layer.Middle;case r.BlockType.Full:return o.Layer.Top;default:throw new Error("Invalid argument: No layer for empty blocks")}}heightFor(t){switch(t){case r.BlockType.Floor:return l.FloorHeight;case r.BlockType.Half:return l.HalfHeight;case r.BlockType.Full:return l.FullHeight;default:throw new Error("Invalid argument: No layer for empty blocks")}}DrawBlockWall(t,e){const i=this.Adjustable.setFrom(e).addFrom(l.BlockCenter);r.Blocks.TypeOf(t)===r.BlockType.Half&&this.Camera.DrawAnimated(this.HalfWallSpriteFor(t),o.Layer.Middle-o.Layer.ZFightingAdjustment,i,null,this.AnimationStartFor(e)),r.Blocks.TypeOf(t)===r.BlockType.Full&&this.Camera.DrawAnimated(this.FullWallSpriteFor(t),o.Layer.Middle,i,null,this.AnimationStartFor(e))}DrawDiagonalTileOverlays(t,e){const i=this.Game.Terrain.GetAt(this.BottomRightPosition);null!==i&&null!=i&&this.DrawNeighbourTileOverlay(t,e,s.TopLeft,i,this.BottomRightPosition,s.BottomRight);const a=this.Game.Terrain.GetAt(this.BottomLeftPosition);null!==a&&null!=a&&this.DrawNeighbourTileOverlay(t,e,s.TopRight,a,this.BottomLeftPosition,s.BottomLeft)}DrawTileOverlays(t,e){const i=this.Game.Terrain.GetAt(this.RightPosition);null!==i&&null!=i&&this.DrawNeighbourTileOverlay(t,e,s.Left,i,this.RightPosition,s.Right);const a=this.Game.Terrain.GetAt(this.BottomPosition);null!==a&&null!=a&&this.DrawNeighbourTileOverlay(t,e,s.Top,a,this.BottomPosition,s.Bottom)}DrawNeighbourTileOverlay(t,e,i,s,a,o){r.Blocks.TypeOf(t)!=r.Blocks.TypeOf(s)&&(r.Blocks.TypeOf(t)<r.Blocks.TypeOf(s)?this.DrawTileOverlay(s,i,a):this.ShouldSkipOverlay(o,r.Blocks.TypeOf(t))||this.DrawTileOverlay(t,o,e))}ShouldSkipOverlay(t,e){return e!=r.BlockType.Floor&&(t==s.BottomRight||t==s.Bottom||t==s.BottomLeft)}DrawTileOverlay(t,e,i){const s=this.TileLayerFor(r.Blocks.TypeOf(t)),a=this.LayerForSide(e),o=this.TileOverlayFor(r.Blocks.SolidOf(t),e),n=this.Adjustable.setFrom(i).addFrom(this.heightFor(r.Blocks.TypeOf(t))).addFrom(l.BlockCenter);this.Camera.Draw(o,s+a,n)}TileLayerFor(t){switch(t){case r.BlockType.Floor:return o.Layer.Floor;case r.BlockType.Half:return o.Layer.Middle;case r.BlockType.Full:default:return o.Layer.Bottom}}LayerForSide(t){switch(t){case s.Bottom:case s.BottomLeft:return o.Layer.OverlayNorthAdjustment;case s.Top:case s.TopRight:return o.Layer.OverlaySouthAdjustment;case s.Left:case s.TopLeft:return o.Layer.OverlayEastAdjustment;default:return o.Layer.OverlayWestAdjustment}}DrawWallOverlays(t,e){if(r.Blocks.TypeOf(t)==r.BlockType.Empty||r.Blocks.TypeOf(t)==r.BlockType.Floor)return;const i=this.Camera.IsDiagonalView()?this.HighestBlockAmong(this.TopRightPosition,this.RightPosition,this.BottomRightPosition):r.Blocks.TypeOf(this.Game.Terrain.GetAt(e.add(this.Camera.RightTile)))??r.BlockType.Empty;i!=r.BlockType.Full&&this.DrawWallOverlaysFor(t,e,i,s.Right);const a=this.Camera.IsDiagonalView()?this.HighestBlockAmong(this.TopLeftPosition,this.LeftPosition,this.BottomLeftPosition):r.Blocks.TypeOf(this.Game.Terrain.GetAt(e.add(this.Camera.LeftTile)))??r.BlockType.Empty;a!=r.BlockType.Full&&this.DrawWallOverlaysFor(t,e,a,s.Left)}DrawWallOverlaysFor(t,e,i,s){const a=this.Adjustable.setFrom(e).addFrom(l.BlockCenter);r.Blocks.TypeOf(t)!=r.BlockType.Full||i!=r.BlockType.Empty&&i!=r.BlockType.Floor?r.Blocks.TypeOf(t)==r.BlockType.Full&&i==r.BlockType.Half?this.Camera.Draw(this.HalfWallOverlayFor(r.Blocks.SolidOf(t),s),o.Layer.Middle+o.Layer.OverlayWestAdjustment,a.addFrom(l.HalfHeight)):r.Blocks.TypeOf(t)!=r.BlockType.Half||i!=r.BlockType.Empty&&i!=r.BlockType.Floor||this.Camera.Draw(this.HalfWallOverlayFor(r.Blocks.SolidOf(t),s),o.Layer.Middle+o.Layer.OverlayWestAdjustment,a):this.Camera.Draw(this.FullWallOverlayFor(r.Blocks.SolidOf(t),s),o.Layer.Middle+o.Layer.OverlayWestAdjustment,a)}HighestBlockAmong(t,e,i){let s=r.Blocks.TypeOf(this.Game.Terrain.GetAt(t))??r.BlockType.Empty;const a=this.Game.Terrain.GetAt(e);null!=a&&r.Blocks.TypeOf(a)>s&&(s=r.Blocks.TypeOf(a));const o=this.Game.Terrain.GetAt(i);return null!=o&&r.Blocks.TypeOf(o)>s&&(s=r.Blocks.TypeOf(o)),s}DrawWallShadows(t,e){const i=this.Game.Terrain.GetAt(this.RightPosition);i&&(r.Blocks.TypeOf(t)==r.BlockType.Full?r.Blocks.TypeOf(i)==r.BlockType.Empty&&r.Blocks.TypeOf(this.Game.Terrain.GetAt(this.Adjustable.setFrom(this.RightPosition).addFrom(this.Below)))==r.BlockType.Full?this.Camera.Draw("default-wall-shadow-full-right",o.Layer.Bottom+o.Layer.OverlayWestAdjustment,this.getCenter(e)):r.Blocks.TypeOf(i)==r.BlockType.Floor?this.Camera.Draw("default-wall-shadow-full-right",o.Layer.Floor+o.Layer.OverlayWestAdjustment,this.getCenter(e).addFrom(l.FloorHeight)):r.Blocks.TypeOf(i)==r.BlockType.Half&&this.Camera.Draw("default-wall-shadow-half-right",o.Layer.Middle+o.Layer.OverlayWestAdjustment,this.getCenter(e).addFrom(l.HalfHeight)):r.Blocks.TypeOf(t)==r.BlockType.Half?r.Blocks.TypeOf(i)==r.BlockType.Empty&&r.Blocks.TypeOf(this.Game.Terrain.GetAt(this.Adjustable.setFrom(this.RightPosition).addFrom(this.Below)))==r.BlockType.Full?this.Camera.Draw("default-wall-shadow-half-right",o.Layer.Bottom+o.Layer.OverlayWestAdjustment,this.getCenter(e)):r.Blocks.TypeOf(i)==r.BlockType.Floor?this.Camera.Draw("default-wall-shadow-half-right",o.Layer.Floor+o.Layer.OverlayWestAdjustment,this.getCenter(e).addFrom(l.FloorHeight)):r.Blocks.TypeOf(i)==r.BlockType.Full&&this.Camera.Draw("default-wall-shadow-half-left",o.Layer.Middle+o.Layer.OverlayEastAdjustment,this.getCenter(e).addFrom(l.HalfHeight)):r.Blocks.TypeOf(t)==r.BlockType.Floor?r.Blocks.TypeOf(i)==r.BlockType.Full?this.Camera.Draw("default-wall-shadow-full-left",o.Layer.Floor+o.Layer.OverlayEastAdjustment,this.getCenter(this.RightPosition).addFrom(l.FloorHeight)):r.Blocks.TypeOf(i)==r.BlockType.Half&&this.Camera.Draw("default-wall-shadow-half-left",o.Layer.Floor+o.Layer.OverlayEastAdjustment,this.getCenter(this.RightPosition).addFrom(l.FloorHeight)):r.Blocks.TypeOf(t)==r.BlockType.Empty&&r.Blocks.TypeOf(this.Game.Terrain.GetAt(this.Adjustable.setFrom(e).addFrom(this.Below)))==r.BlockType.Full&&(r.Blocks.TypeOf(i)==r.BlockType.Full?this.Camera.Draw("default-wall-shadow-full-left",o.Layer.Bottom+o.Layer.OverlayEastAdjustment,this.getCenter(this.RightPosition)):r.Blocks.TypeOf(i)==r.BlockType.Half&&this.Camera.Draw("default-wall-shadow-half-left",o.Layer.Bottom+o.Layer.OverlayEastAdjustment,this.getCenter(this.RightPosition))))}getCenter(t){return this.Adjustable.setFrom(t).addFrom(l.BlockCenter)}TileSpriteFor(t){return this.Config.BlockSprites.get(r.Blocks.SolidOf(t))[r.Blocks.VariantOf(t)].TileFor(this.State.ViewDirection)}FullWallSpriteFor(t){return this.Config.BlockSprites.get(r.Blocks.SolidOf(t))[r.Blocks.VariantOf(t)].FullWallFor(this.State.ViewDirection)}HalfWallSpriteFor(t){return this.Config.BlockSprites.get(r.Blocks.SolidOf(t))[r.Blocks.VariantOf(t)].HalfWallFor(this.State.ViewDirection)}TileOverlayFor(t,e){const i=this.Config.BlockTileOverlays.has(t)?this.Config.BlockTileOverlays.get(t):this.Config.DefaultTileOverlays;switch(e){case s.Bottom:return i.tileOverlayBottom;case s.Top:return i.tileOverlayTop;case s.Left:return i.tileOverlayLeft;case s.Right:return i.tileOverlayRight;case s.TopLeft:return i.tileOverlayTopLeft;case s.TopRight:return i.tileOverlayTopRight;case s.BottomLeft:return i.tileOverlayBottomLeft;case s.BottomRight:return i.tileOverlayBottomRight}}HalfWallOverlayFor(t,e){const i=this.Config.BlockWallOverlays.has(t)?this.Config.BlockWallOverlays.get(t):this.Config.DefaultWallOverlays;switch(e){case s.Left:return this.Camera.IsDiagonalView()?i.diagonalHalfWallOverlayLeft:i.straightHalfWallOverlayLeft;case s.Right:return this.Camera.IsDiagonalView()?i.diagonalHalfWallOverlayRight:i.straightHalfWallOverlayRight}}FullWallOverlayFor(t,e){const i=this.Config.BlockWallOverlays.has(t)?this.Config.BlockWallOverlays.get(t):this.Config.DefaultWallOverlays;switch(e){case s.Left:return this.Camera.IsDiagonalView()?i.diagonalFullWallOverlayLeft:i.straightFullWallOverlayLeft;case s.Right:return this.Camera.IsDiagonalView()?i.diagonalFullWallOverlayRight:i.straightFullWallOverlayRight}}AnimationStartFor(t){let e=t.x,i=t.y,s=t.z;0==e&&(e=1234),0==i&&(i=1234),0==s&&(s=1234);const a=345*(e/13+i/31+s/71);return Math.floor(1e4*(a-Math.floor(a)))}}l.BlockCenter=new a.Vector3(.5,.5,0),l.FloorHeight=new a.Vector3(0,0,1/32),l.HalfHeight=new a.Vector3(0,0,.5),l.FullHeight=new a.Vector3(0,0,1),function(t){t[t.Bottom=0]="Bottom",t[t.Top=1]="Top",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.TopLeft=4]="TopLeft",t[t.TopRight=5]="TopRight",t[t.BottomLeft=6]="BottomLeft",t[t.BottomRight=7]="BottomRight"}(s||(s={}))},"./libs/meld/src/display/world-drawer.ts":(t,e,i)=>{i.r(e),i.d(e,{WorldDrawer:()=>s});class s{constructor(t,e,i,s,a){this.Game=t,this.Config=e,this.Camera=i,this.TerrainDrawer=s,this.EntityDrawer=a}DrawWorld(){for(const{layer:t,area:e}of this.Camera.ShownLayers)this.drawLayer(t,e)}drawLayer(t,e){const i=this.entitiesInArea(t,e),s=Math.floor(e.top-this.Config.WallDisplayHeight),a=Math.floor(e.bottom+this.Config.WallDisplayHeight);for(let i=s;i<=a;i++)for(let s=Math.floor(e.left-1);s<=Math.floor(e.right+1);s++)this.TerrainDrawer.DrawBlockContent(s,i,t);for(const t of i)this.EntityDrawer.Draw(t)}entitiesInArea(t,e){return[...this.Game.Entities.With.Position].filter((([,i])=>this.isInArea(t,e,i))).map((t=>t[0]))}isInArea(t,e,i){return e.left<=i.x&&i.x<e.right&&e.top<=i.y&&i.y<e.bottom&&Math.floor(i.z)==t}}},"./libs/meld/src/logic/block-collision-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{BlockCollisionLogic:()=>o});var s=i("./libs/age/src/index.ts"),a=i("./libs/utility/src/index.ts"),r=i("./libs/meld/src/state/block.ts");class o{constructor(t,e,i,s,a,r,o){this.Constants=t,this.Entities=e,this.Terrain=i,this.CircularSize=s,this.Position=a,this.Velocity=r,this.SetVelocity=o}update(){for(const[t]of this.Entities.With.BlockCollisionBehaviour)this.updateEntity(t)}updateEntity(t){const e=this.Velocity.CurrentlyOf(t);if(e?.isZero()??1)return;const i=this.CollisionVelocityChange(t,e);i&&this.SetVelocity.For(t,i)}CollisionVelocityChange(t,e){const i=this.Position.CurrentlyOf(t)??new a.Vector3(0,0,0),r=this.CircularSize.CurrentlyOf(t),o=r?s.Box.occupiedArea(i,r):s.Box.from(i),l=this.relativeDistanceToCollisionX(o,e.x),n=this.relativeDistanceToCollisionY(o,e.y),h=this.relativeDistanceToCollisionZ(o,e.z);return l>=1&&n>=1&&h>=1||(e=this.updateVelocitiesInOrder(l,n,h,o,e))==this.Velocity.CurrentlyOf(t)?null:e}relativeDistanceToCollisionX(t,e){const i=e>0?t.maxX:t.minX;return this.relativeDistanceToCollision(i,e,1)}relativeDistanceToCollisionY(t,e){const i=e>0?t.maxY:t.minY;return this.relativeDistanceToCollision(i,e,1)}relativeDistanceToCollisionZ(t,e){const i=e>0?t.maxZ:t.minZ;return this.relativeDistanceToCollision(i,e,.5)}relativeDistanceToCollision(t,e,i){const s=t<0?i+t%i:t%i;return(e<0?s:i-s)/Math.abs(e)}updateVelocitiesInOrder(t,e,i,s,a){return t<=e&&t<=i?(a=this.updateVelocityX(t,s,a),e<=i?(a=this.updateVelocityY(e,s,a),a=this.updateVelocityZ(i,s,a)):(a=this.updateVelocityZ(i,s,a),a=this.updateVelocityY(e,s,a))):e<=t&&e<=i?(a=this.updateVelocityY(e,s,a),t<=i?(a=this.updateVelocityX(t,s,a),a=this.updateVelocityZ(i,s,a)):(a=this.updateVelocityZ(i,s,a),a=this.updateVelocityX(t,s,a))):(a=this.updateVelocityZ(i,s,a),t<=e?(a=this.updateVelocityX(t,s,a),a=this.updateVelocityY(e,s,a)):(a=this.updateVelocityY(e,s,a),a=this.updateVelocityX(t,s,a))),a}updateVelocityX(t,e,i){if(t>=1)return i;const s=e.translateBy(i.multiply(t));return this.collisionAtX(s,i.x)?i.withX(this.truncatedDistance(i.x*t)):i}updateVelocityY(t,e,i){if(t>=1)return i;const s=e.translateBy(i.multiply(t));return this.collisionAtY(s,i.y)?i.withY(this.truncatedDistance(i.y*t)):i}updateVelocityZ(t,e,i){if(t>=1)return i;const s=e.translateBy(i.multiply(t));return this.collisionAtZ(s,i.z)?i.withZ(this.truncatedDistance(i.z*t)):i}truncatedDistance(t){return t>this.Constants.CollisionAreaWidth?t-this.Constants.CollisionAreaWidth/8:t>-this.Constants.CollisionAreaWidth?0:t+this.Constants.CollisionAreaWidth/8}collisionAtX(t,e){const i=e>0?t.maxX+.5:t.minX-.5;for(const e of this.blockPositionsY(t)){if(this.isSolidAtPoint(i,e,t.minZ))return!0;for(const s of this.blockPositionAboveBottom(t))if(this.isSolidInBlock(i,e,s))return!0}return!1}collisionAtY(t,e){const i=e>0?t.maxY+.5:t.minY-.5;for(const e of this.blockPositionsX(t)){if(this.isSolidAtPoint(e,i,t.minZ))return!0;for(const s of this.blockPositionAboveBottom(t))if(this.isSolidInBlock(e,i,s))return!0}return!1}collisionAtZ(t,e){const i=e>0?t.maxZ+.5:t.minZ+this.Constants.CollisionAreaWidth/8;for(const s of this.blockPositionsX(t))for(const a of this.blockPositionsY(t))if(e>0?this.isSolidInBlock(s,a,i):this.isSolidGoingDown(s,a,i))return!0;return!1}isSolidGoingDown(t,e,i){const s=r.Blocks.TypeOf(this.Terrain.Get(t,e,i))??r.BlockType.Empty,a=i<0?1+i%1:i%1;return.5<a&&a<.5+this.Constants.CollisionAreaWidth?s==r.BlockType.Half:0<a&&a<this.Constants.CollisionAreaWidth&&(s==r.BlockType.Floor||r.Blocks.TypeOf(this.Terrain.Get(t,e,i-1))==r.BlockType.Full)}*blockPositionsX(t){for(let e=t.minX;e<t.maxX;e++)yield e;yield t.maxX}*blockPositionsY(t){for(let e=t.minY;e<t.maxY;e++)yield e;yield t.maxY}*blockPositionAboveBottom(t){for(let e=t.minZ+1;e<t.maxZ;e++)yield e;t.minZ<Math.floor(t.maxZ)&&(yield t.maxZ)}isSolidAtPoint(t,e,i){const s=i<0?1-i%1:i%1;switch(r.Blocks.TypeOf(this.Terrain.Get(t,e,i))??r.BlockType.Empty){case r.BlockType.Empty:case r.BlockType.Floor:return!1;case r.BlockType.Half:return s<.5;case r.BlockType.Full:return!0}}isSolidInBlock(t,e,i){return r.Blocks.HasSolid(this.Terrain.Get(t,e,i))??!1}}},"./libs/meld/src/logic/dash-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{DashLogic:()=>o});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/state/game-update.ts"),r=i("./libs/meld/src/values/dash-state.ts");class o{constructor(t,e,i,s,a,r,o,l,n){this.Constants=t,this.Globals=e,this.Entities=i,this.DashState=s,this.SetDashState=a,this.GravityBehaviour=r,this.SetGravityBehaviour=o,this.Velocity=l,this.SetVelocity=n}update(t){for(const[t,e]of this.Entities.With.DashState)e.IsCharging?this.ChargeDash(t,e):this.DashEffectShouldEnd(e)&&this.EndDashEffect(t);for(const e of t)e instanceof a.ChargeDashAction?this.UpdateCharge(e.Entity,e.Angle):e instanceof a.ReleaseDashAction&&this.ReleaseDash(e.Entity,e.Angle)}ChargeDash(t,e){this.SetDashState.For(t,new r.DashState(e.TimeOfLastDash,e.IsCharging,e.Charge+this.Constants.DashChargeSpeed,e.Angle))}DashEffectShouldEnd(t){return this.Globals.Tick-t.TimeOfLastDash==this.Constants.DashDuration}EndDashEffect(t){this.SetGravityBehaviour.For(t,this.GravityBehaviour.DefaultOf(t)??!0)}UpdateCharge(t,e){const i=this.DashState.CurrentlyOf(t)??new r.DashState,s=this.Globals.Tick-i.TimeOfLastDash;(this.CooldownHasPassed(s)||this.CanQuickCharge(s,e,i.Angle))&&this.SetDashState.For(t,new r.DashState(i.TimeOfLastDash,!0,i.Charge+this.Constants.DashChargeSpeed,e))}CooldownHasPassed(t){return t>this.Constants.DashCooldown}CanQuickCharge(t,e,i){return this.Constants.DashQuickChargeWindowStart<t&&t<this.Constants.DashQuickChargeWindowEnd&&Math.abs(e-i)>this.Constants.DashQuickChargeMinimumAngle}ReleaseDash(t,e){const i=this.DashState.CurrentlyOf(t)??new r.DashState;if(!i.IsCharging)return;const a=Math.min(i.Charge+this.Constants.InitialDashCharge,this.Constants.MaxDashCharge);this.SetDashState.For(t,new r.DashState(this.Globals.Tick,!1,0,e));const o=this.Velocity.Of(t)??new s.Vector3(0,0,0),l=new s.Vector3(a,0,0).rotate(e).add(o);this.SetVelocity.For(t,l),this.SetGravityBehaviour.For(t,!1)}}},"./libs/meld/src/logic/gravity-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{GravityLogic:()=>r});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/state/block.ts");class r{constructor(t,e,i,s,a,r){this.Constants=t,this.Entities=e,this.Terrain=i,this.Position=s,this.Velocity=a,this.SetVelocity=r}update(){for(const[t]of this.Entities.With.GravityBehaviour)this.updateEntity(t)}updateEntity(t){const e=this.Position.CurrentlyOf(t)??new s.Vector3(0,0,0);if(this.hasGroundAt(e))return;const i=this.Velocity.CurrentlyOf(t)??new s.Vector3(0,0,0),a=i.withZ(i.z-this.Constants.GravityAcceleration);this.SetVelocity.For(t,a)}hasGroundAt(t){return t.z<Math.floor(t.z)+this.Constants.CollisionAreaWidth?this.isInOrAboveSolidBlock(t):t.z<Math.floor(t.z)+.5+this.Constants.CollisionAreaWidth?this.isInHalfOrFullBlock(t):a.Blocks.TypeOf(this.Terrain.GetAt(t))==a.BlockType.Full}isInOrAboveSolidBlock(t){return a.Blocks.TypeOf(this.Terrain.GetAt(t))!=a.BlockType.Empty||a.Blocks.TypeOf(this.Terrain.Get(t.x,t.y,t.z-1))==a.BlockType.Full}isInHalfOrFullBlock(t){switch(a.Blocks.TypeOf(this.Terrain.GetAt(t))){case a.BlockType.Half:case a.BlockType.Full:return!0;default:return!1}}}},"./libs/meld/src/logic/load-state-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{LoadStateLogic:()=>a});var s=i("./libs/meld/src/state/game-update.ts");class a{constructor(t){this.State=t}update(t){const e=t.find((t=>t instanceof s.LoadState));e&&this.State.LoadFrom(e.State)}}},"./libs/meld/src/logic/movement-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{MovementLogic:()=>r});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/state/game-update.ts");class r{constructor(t,e,i,s,a,r,o){this.Constants=t,this.Entities=e,this.SetOrientation=i,this.TargetVelocity=s,this.SetTargetVelocity=a,this.Velocity=r,this.SetVelocity=o}update(t){for(const e of t)e instanceof a.MovementAction&&this.HandleMovement(e.Entity,e.Velocity);for(const[t]of this.Entities.With.TargetVelocity)this.UpdateVelocity(t)}HandleMovement(t,e){const i=this.GetMovementVelocity(e),a=new s.Vector3(i.x,i.y,0);this.SetTargetVelocity.For(t,a),0==a.x&&0==a.y||this.SetOrientation.For(t,a.getAngle())}GetMovementVelocity(t){return t.lengthSquared()>1?t.unitVector().multiply(this.Constants.MaxMoveSpeed):t.multiply(this.Constants.MaxMoveSpeed)}UpdateVelocity(t){const e=this.TargetVelocity.CurrentlyOf(t)??new s.Vector3(0,0,0),i=this.Velocity.Of(t)??new s.Vector3(0,0,0);if(e.x===i.x&&e.y===i.y)return;const a=e.subtract(i.withZ(0)),r=a.lengthSquared()<this.Constants.Acceleration*this.Constants.Acceleration?a:a.unitVector().multiply(this.Constants.Acceleration);this.SetVelocity.For(t,i.add(r))}}},"./libs/meld/src/logic/place-block-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{PlaceBlockLogic:()=>r});var s=i("./libs/meld/src/state/block.ts"),a=i("./libs/meld/src/state/game-update.ts");class r{constructor(t,e){this.Terrain=t,this.SelectedItem=e}update(t){for(const e of t)e instanceof a.PlaceBlockAction&&this.placeBlock(e.Entity,e.Position)}placeBlock(t,e){const i=this.SelectedItem.Of(t);if(!(i>-1))return;const a=this.Terrain.GetAt(e)??s.Blocks.NewEmpty(0);s.Blocks.SolidOf(a)!=i||s.Blocks.TypeOf(a)==s.BlockType.Empty?this.Terrain.SetAt(e,s.Blocks.NewFloor(i,0)):s.Blocks.TypeOf(a)==s.BlockType.Floor?this.Terrain.SetAt(e,s.Blocks.NewHalf(i,0)):s.Blocks.TypeOf(a)==s.BlockType.Half?this.Terrain.SetAt(e,s.Blocks.NewFull(i)):s.Blocks.TypeOf(a)==s.BlockType.Full&&this.Terrain.SetAt(e,s.Blocks.NewFloor(i,0))}}},"./libs/meld/src/logic/selected-item-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{SelectedItemLogic:()=>a});var s=i("./libs/meld/src/state/game-update.ts");class a{constructor(t,e,i){this.Config=t,this.SelectedBlock=e,this.SetSelectedBlock=i}update(t){for(const e of t)e instanceof s.SelectNextItemAction&&this.incrementSelectedItemFor(e.Entity)}incrementSelectedItemFor(t){const e=[...this.Config.SolidTypeMap.Types.values()],i=this.SelectedBlock.Of(t),s=e.indexOf(i),a=s+1<e.length?s+1:0;this.SetSelectedBlock.For(t,e[a])}}},"./libs/meld/src/logic/start-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{StartLogic:()=>o});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/state/block.ts"),r=i("./libs/meld/src/state/game-update.ts");class o{constructor(t,e,i,s,a,r,o){this.Config=t,this.State=e,this.Changes=i,this.Entities=s,this.Terrain=a,this.SetPosition=r,this.Random=o}update(t){t.some((t=>t instanceof r.GenerateAction))&&this.initialiseGame()}initialiseGame(){this.generateRandomTerrain(),this.clearEntities(),this.spawnPlayer()}generateRandomTerrain(){const t=[...this.Config.SolidTypeMap.Types.values()];this.Terrain.AddChunk(0,0,0),this.Terrain.AddChunk(0,-1,0),this.Terrain.AddChunk(-1,0,0),this.Terrain.AddChunk(-1,-1,0);for(const{position:e}of this.Terrain.AllFields())0===e.z&&(Math.random()<.9?this.Terrain.Set(a.Blocks.NewFloor(this.Random.get.in(t),0),e.x,e.y,e.z):this.Terrain.Set(a.Blocks.NewFull(this.Random.get.in(t)),e.x,e.y,e.z))}clearEntities(){for(const[t,e]of this.Changes.UpdatedEntityValues.Entities)e&&this.Entities.Remove(t);this.Entities.Remove(...this.Entities),this.State.Players.clear()}spawnPlayer(){const t=this.Entities.Create(this.Config.Constants.PlayerType);this.SetPosition.For(t,new s.Vector3(5,5,0)),this.State.Players.set("insertPlayerName",t)}}},"./libs/meld/src/logic/update-state-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{UpdateStateLogic:()=>s});class s{constructor(t,e,i){this.State=t,this.Entities=e,this.Terrain=i}update(){this.State.Globals.Tick++,this.Entities.ApplyUpdatedValues(),this.Terrain.ApplyUpdatedValues()}}},"./libs/meld/src/logic/velocity-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{VelocityLogic:()=>a});var s=i("./libs/utility/src/index.ts");class a{constructor(t,e,i,s,a,r){this.Constants=t,this.Entities=e,this.Position=i,this.SetPosition=s,this.Velocity=a,this.SetVelocity=r}update(){for(const[t,e]of this.Entities.With.Velocity)this.updateEntity(t)}updateEntity(t){const e=this.Velocity.CurrentlyOf(t);if(!e||e.isZero())return;const i=this.cappedVelocity(e),s=this.Position.CurrentlyOf(t);this.SetPosition.For(t,s.add(i)),this.SetVelocity.For(t,i)}cappedVelocity(t){return this.Constants.TerminalVerticalVelocity>=Math.abs(t.z)?t:new s.Vector3(t.x,t.y,t.z=Math.sign(t.z)*this.Constants.TerminalVerticalVelocity)}}},"./libs/meld/src/meld-display.ts":(t,e,i)=>{i.r(e),i.d(e,{MeldDisplay:()=>d});var s=i("./libs/age/src/index.ts"),a=i("./libs/meld/src/display/camera.ts"),r=i("./libs/meld/src/display/display-state.ts"),o=i("./libs/meld/src/display/entity-drawer.ts"),l=i("./libs/meld/src/display/hud-drawer.ts"),n=i("./libs/meld/src/display/input-parser.ts"),h=i("./libs/meld/src/display/terrain-drawer.ts"),c=i("./libs/meld/src/display/world-drawer.ts");class d{constructor(t,e,i,s,d=r.DisplayState.from(t,s),u=new a.Camera(e,i,t,d),y=new n.InputParser(e,d,u,i,t.Inputs),g=new h.TerrainDrawer(e,t,d,u),m=new o.EntityDrawer(e,u),p=new c.WorldDrawer(e,t,u,g,m),f=new l.HudDrawer(e,t,d,i)){this.Config=t,this.Game=e,this.Display=i,this.State=d,this.camera=u,this.inputParser=y,this.terrainDrawer=g,this.entityDrawer=m,this.worldDrawer=p,this.hudDrawer=f,i.sortByDepth=!0}setSize(t,e){this.State.Size.updateHostSize(t,e)}show(t=0){this.State.FractionOfTick=t;const e=[...this.Game.Entities.With.Position.keys()][0];null!=e&&this.camera.FocusOn(e),this.Display.startFrame(),(0,s.startTiming)("displayUpdate"),this.worldDrawer.DrawWorld(),this.hudDrawer.Draw(),(0,s.finishTiming)("displayUpdate"),this.Display.endFrame()}getNewActions(){return this.inputParser.ParseInputs()}}},"./libs/meld/src/meld-game.ts":(t,e,i)=>{var s,a;i.r(e),i.d(e,{MeldGame:()=>m,updatesPerSecond:()=>g});var r=i("./libs/age/src/index.ts"),o=i("./libs/meld/src/display-config.json"),l=i("./libs/meld/src/game-config.json"),n=i("./libs/meld/src/meld.ts"),h=i("./libs/meld/src/meld-display.ts"),c=i("./libs/meld/src/serialisation/serialisation-display-config.ts"),d=i("./libs/meld/src/serialisation/serialisation-game-config.ts"),u=i("./libs/meld/src/serialisation/serialisation-game-state.ts"),y=i("./libs/meld/src/state/game-update.ts");const g=30;class m extends r.GameRunner{constructor(t,e,i,s,a=new ResizeObserver((()=>this.setSize(t.clientWidth,t.clientHeight)))){super(e,s,g),this.meldDisplay=e,this.displayProvider=i,this.meld=s,this.resizeObserver=a,this.onUnload=()=>{this.saveGame()},this.resizeObserver.observe(t);const r=localStorage["meld-save-0.3"];r?this.actions.push(new y.LoadState((0,u.readGameState)(s.Config,JSON.parse(r)))):this.actions.push(new y.GenerateAction),window.addEventListener("unload",this.onUnload),this.afterGameUpdate=()=>this.displayProvider.endInputFrame()}saveGame(){const t=(0,u.createGameState)(this.meld.Config,this.meld.State);localStorage["meld-save-0.3"]=JSON.stringify(t)}static createAt(t,e){const u=new n.Meld((0,d.readGameConfig)(s||(s=i.t(l,2))));e={...(0,c.readDisplayConfig)(u.Config,a||(a=i.t(o,2))),...e};const y=new r.HtmlDisplayProvider(t,e),g=new h.MeldDisplay(e,u,y,"insertPlayerName");return new m(t,g,y,u)}setSize(t,e){this.meldDisplay.setSize(t,e),this.displayProvider.setSize(t,e)}onDestroy(){super.onDestroy(),this.resizeObserver.disconnect(),window.removeEventListener("visibilitychanged",this.onUnload),this.saveGame()}}},"./libs/meld/src/meld.ts":(t,e,i)=>{i.r(e),i.d(e,{Meld:()=>w});var s=i("./libs/age/src/index.ts"),a=i("./libs/meld/src/logic/movement-logic.ts"),r=i("./libs/meld/src/logic/place-block-logic.ts"),o=i("./libs/meld/src/logic/selected-item-logic.ts"),l=i("./libs/meld/src/logic/start-logic.ts"),n=i("./libs/meld/src/logic/update-state-logic.ts"),h=i("./libs/meld/src/logic/velocity-logic.ts"),c=i("./libs/meld/src/state/entity-values.ts"),d=i("./libs/meld/src/state/globals.ts"),u=i("./libs/meld/src/state/changes.ts"),y=i("./libs/meld/src/state/meld-entities.ts"),g=i("./libs/meld/src/state/game-state.ts"),m=i("./libs/meld/src/logic/load-state-logic.ts"),p=i("./libs/meld/src/logic/block-collision-logic.ts"),f=i("./libs/meld/src/logic/gravity-logic.ts"),S=i("./libs/meld/src/logic/dash-logic.ts");class w extends s.BaseGame{constructor(t,e=new g.GameState(new d.Globals,new c.EntityValues),i=new u.Changes(new c.EntityValues),w=new s.TerrainManager(t.Constants.ChunkSize,e.Chunks,i.UpdatedBlocks),T=new y.MeldEntities(t.EntityTypeValues,e.EntityValues,i.UpdatedEntityValues,e),v=new s.Random((()=>e.Globals.Seed+e.Globals.Tick)),x=new p.BlockCollisionLogic(t.Constants,T,w,T.CircularSize.Get,T.Position.Get,T.Velocity.Get,T.Velocity.Set),b=new S.DashLogic(t.Constants,e.Globals,T,T.DashState.Get,T.DashState.Set,T.GravityBehaviour.Get,T.GravityBehaviour.Set,T.Velocity.Get,T.Velocity.Set),B=new f.GravityLogic(t.Constants,T,w,T.Position.Get,T.Velocity.Get,T.Velocity.Set),k=new m.LoadStateLogic(e),C=new a.MovementLogic(t.Constants,T,T.Orientation.Set,T.TargetVelocity.Get,T.TargetVelocity.Set,T.Velocity.Get,T.Velocity.Set),F=new r.PlaceBlockLogic(w,T.SelectedBlock.Get),D=new o.SelectedItemLogic(t,T.SelectedBlock.Get,T.SelectedBlock.Set),P=new l.StartLogic(t,e,i,T,w,T.Position.Set,v),V=new n.UpdateStateLogic(e,T,w),M=new h.VelocityLogic(t.Constants,T,T.Position.Get,T.Position.Set,T.Velocity.Get,T.Velocity.Set)){super([C,b,B,x,M,F,D,P,V,k]),this.Config=t,this.State=e,this.changes=i,this.Terrain=w,this.Entities=T,this.random=v,this.blockCollisionLogic=x,this.dashLogic=b,this.gravityLogic=B,this.loadStateLogic=k,this.movementLogic=C,this.placeBlockLogic=F,this.selectedItemLogic=D,this.startLogic=P,this.updateStateLogic=V,this.velocityLogic=M}}},"./libs/meld/src/serialisation/serialisation-display-config.ts":(t,e,i)=>{i.r(e),i.d(e,{readDisplayConfig:()=>o});var s=i("./libs/meld/src/display/display-config.ts"),a=i("./libs/meld/src/display/input-parser.ts"),r=i("./libs/meld/src/meld-game.ts");function o(t,e){const i=new Map;for(const s in e.blockSprites)i.set(t.SolidTypeMap.TypeIdFor(s),e.blockSprites[s].map((t=>n(t))));const r=new Map;for(const i in e.blockTileOverlays)r.set(t.SolidTypeMap.TypeIdFor(i),Object.assign(new s.BlockTileOverlays,e.blockTileOverlays[i]));const o=new Map;for(const i in e.blockWallOverlays)o.set(t.SolidTypeMap.TypeIdFor(i),Object.assign(new s.BlockWallOverlays,e.blockWallOverlays[i]));const h=new Map;for(const t in e.inputs)h.set(a.Input[t],e.inputs[t]);const c=e.defaultSpriteTypes??{},d={};for(const t in e.sprites)d[t]=l(t,e.sprites[t],c);return{RenderToVirtualSize:e.renderToVirtualSize??!0,VirtualPixelsPerTile:e.virtualPixelsPerTile??16,VirtualHeight:e.virtualHeight??360,WallDisplayHeight:e.wallDisplayHeight??2,DisplayDepth:e.displayDepth??4,AssetFolder:e.assetFolder??"assets/",Inputs:h,DefaultTileOverlays:Object.assign(new s.BlockTileOverlays,e.defaultTileOverlays??{}),DefaultWallOverlays:Object.assign(new s.BlockWallOverlays,e.defaultTileOverlays??{}),BlockSprites:i,BlockTileOverlays:r,BlockWallOverlays:o,Sprites:d}}function l(t,e,i){const s=i[e.type],a=e.frameInterval??s?.frameInterval??0;return{path:e.path??t,width:e.width??s?.width??16,height:e.height??s?.height??16,centerX:e.centerX??s?.centerX??0,centerY:e.centerY??s?.centerY??0,framesX:e.framesX??s?.framesX??1,framesY:e.framesY??s?.framesY??1,frameInterval:Math.floor(a*r.updatesPerSecond)}}function n(t){return new s.BlockSprites(t.tileNorth??t.straightTile??"missing-sprite",t.tileNorthEast??t.diagonalTile??"missing-sprite",t.tileEast??t.straightTile??"missing-sprite",t.tileSouthEast??t.diagonalTile??"missing-sprite",t.tileSouth??t.straightTile??"missing-sprite",t.tileSouthWest??t.diagonalTile??"missing-sprite",t.tileWest??t.straightTile??"missing-sprite",t.tileNorthWest??t.diagonalTile??"missing-sprite",t.fullWallNorth??t.straightFullWall??"missing-sprite",t.fullWallNorthEast??t.diagonalFullWall??"missing-sprite",t.fullWallEast??t.straightFullWall??"missing-sprite",t.fullWallSouthEast??t.diagonalFullWall??"missing-sprite",t.fullWallSouth??t.straightFullWall??"missing-sprite",t.fullWallSouthWest??t.diagonalFullWall??"missing-sprite",t.fullWallWest??t.straightFullWall??"missing-sprite",t.fullWallNorthWest??t.diagonalFullWall??"missing-sprite",t.halfWallNorth??t.straightHalfWall??t.straightFullWall??"missing-sprite",t.halfWallNorthEast??t.diagonalHalfWall??t.diagonalFullWall??"missing-sprite",t.halfWallEast??t.straightHalfWall??t.straightFullWall??"missing-sprite",t.halfWallSouthEast??t.diagonalHalfWall??t.diagonalFullWall??"missing-sprite",t.halfWallSouth??t.straightHalfWall??t.straightFullWall??"missing-sprite",t.halfWallSouthWest??t.diagonalHalfWall??t.diagonalFullWall??"missing-sprite",t.halfWallWest??t.straightHalfWall??t.straightFullWall??"missing-sprite",t.halfWallNorthWest??t.diagonalHalfWall??t.diagonalFullWall??"missing-sprite")}},"./libs/meld/src/serialisation/serialisation-game-config.ts":(t,e,i)=>{i.r(e),i.d(e,{readGameConfig:()=>h});var s=i("./libs/age/src/index.ts"),a=i("./libs/utility/src/index.ts"),r=i("./libs/meld/src/config/constants.ts"),o=i("./libs/meld/src/config/game-config.ts"),l=i("./libs/meld/src/meld-game.ts"),n=i("./libs/meld/src/state/block.ts");function h(t){const e=Object.keys(t.entityTypes),i=s.TypeMap.From(s.EntityTypeOffset,e),h=Object.keys(t.solidTypes),c=s.TypeMap.From(n.SolidOffset,h),d=Object.keys(t.nonSolidTypes),u=s.TypeMap.From(n.NonSolidOffset,d);return new o.GameConfig(function(t,e){return new r.Constants(e.TypeIdFor(t.playerType),Object.assign(new a.Vector3(50,50,5),t.chunkSize??{}),t.chunkLoadingRadius??1,t.collisionAreaWidth??1/1024,(t.gravityAcceleration??.5)/l.updatesPerSecond,(t.terminalVerticalVelocity??10)/l.updatesPerSecond,(t.maxMoveSpeed??10)/l.updatesPerSecond,(t.acceleration??3)/l.updatesPerSecond,(t.initialDashCharge??24)/l.updatesPerSecond,(t.maxDashCharge??60)/l.updatesPerSecond,(t.dashChargeSpeed??1.2)/l.updatesPerSecond,Math.floor((t.dashDuration??10/60)*l.updatesPerSecond),Math.floor((t.dashCooldown??1)*l.updatesPerSecond),Math.floor((t.dashQuickChargeWindowStart??8/60)*l.updatesPerSecond),Math.floor((t.dashQuickChargeWindowEnd??.5)*l.updatesPerSecond),t.dashQuickChargeMinimumAngle??Math.PI/3)}(t.constants,i),i,new Map(e.map((e=>{return[i.TypeIdFor(e),(r=t.entityTypes[e],o=c,{Health:r.health,Orientation:r.orientation,Position:r.position?Object.assign(new a.Vector3(0,0,0),r.position):null,CircularSize:r.circularSize?Object.assign(new s.CircularSize(0,0),r.circularSize):null,SelectedBlock:r.selectedBlock?o.TypeIdFor(r.selectedBlock):null,Velocity:r.velocity?Object.assign(new a.Vector3(0,0,0),r.velocity):null,BlockCollisionBehaviour:r.blockCollisionBehaviour,GravityBehaviour:r.gravityBehaviour})];var r,o}))),c,new Map(h.map((t=>[c.TypeIdFor(t),{hardness:0}]))),u,new Map(d.map((t=>[u.TypeIdFor(t),{hardness:0}]))))}},"./libs/meld/src/serialisation/serialisation-game-state.ts":(t,e,i)=>{i.r(e),i.d(e,{createGameState:()=>n,readGameState:()=>h});var s=i("./libs/age/src/index.ts"),a=i("./libs/utility/src/index.ts"),r=i("./libs/meld/src/state/block.ts"),o=i("./libs/meld/src/state/entity-values.ts"),l=i("./libs/meld/src/state/game-state.ts");function n(t,e){return function(t,e=null){const i=[];for(const[e,o]of t.Chunks)i.push((s=o,r=a.Vector3.parse(e),{size:s.ChunkSize,coords:r,blocks:s.Blocks}));var s,r;const o={};for(const[e]of t.EntityValues.Entities)o[e]=t.EntityValues.GroupFor(e);return{EntityTypeMap:[...e?.EntityTypeMap.Types.entries()??[]],SolidTypeMap:[...e?.SolidTypeMap.Types.entries()??[]],NonSolidTypeMap:[...e?.NonSolidTypeMap.Types.entries()??[]],Globals:t.Globals,EntityValues:o,Chunks:i,Players:Object.fromEntries(t.Players.entries())}}(e,t)}function h(t,e){return function(t,e){const i=new s.TypeMap(new Map(e.EntityTypeMap)),r=new s.TypeMap(new Map(e.SolidTypeMap)),n=new s.TypeMap(new Map(e.NonSolidTypeMap));if(function(t,e,i,s){if(e.Types.size!=t.EntityTypeMap.Types.size)return!1;if(i.Types.size!=t.SolidTypeMap.Types.size)return!1;if(s.Types.size!=t.NonSolidTypeMap.Types.size)return!1;for(const[i,s]of e.Types)if(!t.EntityTypeMap.Types.has(i)||t.EntityTypeMap.TypeIdFor(i)!=s)return!1;for(const[e,s]of i.Types)if(!t.SolidTypeMap.Types.has(e)||t.SolidTypeMap.TypeIdFor(e)!=s)return!1;for(const[e,i]of s.Types)if(!t.NonSolidTypeMap.Types.has(e)||t.NonSolidTypeMap.TypeIdFor(e)!=i)return!1;return!0}(t,i,r,n))return function(t){const e=new o.EntityValues;for(const i in t.EntityValues)e.AddValuesFrom(+i,u(t.EntityValues[i]));const i=new Map;for(const e of t.Chunks)i.set(a.Vector3.stringify(e.coords.x,e.coords.y,e.coords.z),(r=e,new s.BlockChunk(r.blocks,new a.Vector3(r.size.x,r.size.y,r.size.z),new a.Vector3(r.size.x*r.coords.x,r.size.y*r.coords.y,r.size.z*r.coords.z))));var r;const n=new Map;for(const e in t.Players)n.set(e,t.Players[e]);return new l.GameState(t.Globals,e,i,n)}(e);const h=c(r,t.SolidTypeMap),y=c(n,t.NonSolidTypeMap),g=new o.EntityValues;for(const t in e.EntityValues)g.AddValuesFrom(+t,(m=h,null!==(p=u(e.EntityValues[t])).SelectedBlock&&void 0!==p.SelectedBlock&&(p.SelectedBlock=m.get(p.SelectedBlock)),p));var m,p;const f=new Map;for(const t of e.Chunks)f.set(a.Vector3.stringify(t.coords.x,t.coords.y,t.coords.z),d(h,y,t));const S=new Map;for(const t in e.Players)S.set(t,e.Players[t]);return new l.GameState(e.Globals,g,f,S)}(t,e)}function c(t,e){const i=new Map;for(const[s,a]of t.Types)e.Types.has(s)?i.set(a,e.TypeIdFor(s)):i.set(a,a);return i}function d(t,e,i){return new s.BlockChunk(i.blocks.map((i=>function(t,e,i){return r.Blocks.New(r.Blocks.TypeOf(t),e.get(r.Blocks.SolidOf(t)),i.get(r.Blocks.NonSolidOf(t)),r.Blocks.VariantOf(t))}(i,t,e))),new a.Vector3(i.size.x,i.size.y,i.size.z),new a.Vector3(i.size.x*i.coords.x,i.size.y*i.coords.y,i.size.z*i.coords.z))}function u(t){const e={...t};return t.Position&&(e.Position=Object.assign(new a.Vector3(0,0,0),t.Position)),t.CircularSize&&(e.CircularSize=Object.assign(new s.CircularSize(0,0),t.CircularSize)),t.Velocity&&(e.Velocity=Object.assign(new a.Vector3(0,0,0),t.Velocity)),e}},"./libs/meld/src/state/block.ts":(t,e,i)=>{i.r(e),i.d(e,{BlockType:()=>c,Blocks:()=>h,NonSolidMask:()=>l,NonSolidOffset:()=>n,SolidMask:()=>r,SolidOffset:()=>o,VariantMask:()=>s,VariantOffset:()=>a});const s=252,a=2,r=16776960,o=8,l=4278190080,n=24;class h{static New(t,e,i,s=0){return i|e|s<<a|t}static NewEmpty(t,e=0){return h.New(c.Empty,0,t,e)}static NewFloor(t,e,i=0){return h.New(c.Floor,t,e,i)}static NewHalf(t,e,i=0){return h.New(c.Half,t,e,i)}static NewFull(t,e=0){return h.New(c.Full,t,0,e)}static TypeOf(t){return null===t?null:3&t}static VariantOf(t){return null===t?null:(t&s)>>a}static SolidOf(t){return null===t?null:t&r}static NonSolidOf(t){return null===t?null:t&l}static HasSolid(t){return null===t?null:h.TypeOf(t)!=c.Empty}static HasNonSolid(t){return null===t?null:h.TypeOf(t)!=c.Full}}var c;!function(t){t[t.Empty=0]="Empty",t[t.Floor=1]="Floor",t[t.Half=2]="Half",t[t.Full=3]="Full"}(c||(c={}))},"./libs/meld/src/state/changes.ts":(t,e,i)=>{i.r(e),i.d(e,{Changes:()=>s});class s{constructor(t,e=new Map){this.UpdatedEntityValues=t,this.UpdatedBlocks=e}}},"./libs/meld/src/state/entity-values.ts":(t,e,i)=>{i.r(e),i.d(e,{EntityValues:()=>a});var s=i("./libs/age/src/index.ts");class a extends s.BaseValues{constructor(t=new Map,e=new Map,i=new Map,s=new Map,a=new Map,r=new Map,o=new Map,l=new Map,n=new Map,h=new Map,c=new Map){super(c),this.CircularSize=t,this.DashState=e,this.Health=i,this.Orientation=s,this.Position=a,this.SelectedBlock=r,this.TargetVelocity=o,this.Velocity=l,this.BlockCollisionBehaviour=n,this.GravityBehaviour=h,this.register(t),this.register(e),this.register(i),this.register(s),this.register(a),this.register(r),this.register(o),this.register(l),this.register(n),this.register(h)}static From(t){const e=new a;for(const[i,s]of t)e.AddValuesFrom(i,s);return e}AddValuesFrom(t,e){this.Entities.set(t,!0),void 0!==e.CircularSize&&this.CircularSize.set(t,e.CircularSize),void 0!==e.DashState&&this.DashState.set(t,e.DashState),void 0!==e.Health&&this.Health.set(t,e.Health),void 0!==e.Orientation&&this.Orientation.set(t,e.Orientation),void 0!==e.Position&&this.Position.set(t,e.Position),void 0!==e.SelectedBlock&&this.SelectedBlock.set(t,e.SelectedBlock),void 0!==e.TargetVelocity&&this.TargetVelocity.set(t,e.TargetVelocity),void 0!==e.Velocity&&this.Velocity.set(t,e.Velocity),void 0!==e.BlockCollisionBehaviour&&this.BlockCollisionBehaviour.set(t,e.BlockCollisionBehaviour),void 0!==e.GravityBehaviour&&this.GravityBehaviour.set(t,e.GravityBehaviour)}GroupFor(t){return{CircularSize:this.CircularSize.get(t),DashState:this.DashState.get(t),Health:this.Health.get(t),Orientation:this.Orientation.get(t),Position:this.Position.get(t),SelectedBlock:this.SelectedBlock.get(t),TargetVelocity:this.TargetVelocity.get(t),Velocity:this.Velocity.get(t),BlockCollisionBehaviour:this.BlockCollisionBehaviour.get(t),GravityBehaviour:this.GravityBehaviour.get(t)}}}},"./libs/meld/src/state/game-state.ts":(t,e,i)=>{i.r(e),i.d(e,{GameState:()=>s});class s{constructor(t,e,i=new Map,s=new Map){this.Globals=t,this.EntityValues=e,this.Chunks=i,this.Players=s}GetNewId(){return this.Globals.NextId++}LoadFrom(t){this.Globals.Tick=t.Globals.Tick,this.Globals.Seed=t.Globals.Seed,this.Globals.NextId=t.Globals.NextId,this.EntityValues.ClearValues(),this.EntityValues.Entities.clear();for(const[e,i]of t.EntityValues.Entities)this.EntityValues.Entities.set(e,i);this.EntityValues.AddValuesFromOther(t.EntityValues),this.Chunks.clear();for(const[e,i]of t.Chunks)this.Chunks.set(e,i);this.Players.clear();for(const[e,i]of t.Players)this.Players.set(e,i)}}},"./libs/meld/src/state/game-update.ts":(t,e,i)=>{i.r(e),i.d(e,{ChargeDashAction:()=>r,GameUpdate:()=>s,GenerateAction:()=>a,LoadState:()=>l,MovementAction:()=>n,PlaceBlockAction:()=>h,ReleaseDashAction:()=>o,SelectNextItemAction:()=>c});class s{}class a extends s{}class r extends s{constructor(t,e){super(),this.Entity=t,this.Angle=e}}class o extends s{constructor(t,e){super(),this.Entity=t,this.Angle=e}}class l extends s{constructor(t){super(),this.State=t}}class n extends s{constructor(t,e){super(),this.Entity=t,this.Velocity=e}}class h extends s{constructor(t,e){super(),this.Entity=t,this.Position=e}}class c extends s{constructor(t){super(),this.Entity=t}}},"./libs/meld/src/state/globals.ts":(t,e,i)=>{i.r(e),i.d(e,{Globals:()=>s});class s{constructor(t=0,e=1,i=1){this.Tick=t,this.NextId=e,this.Seed=i}}},"./libs/meld/src/state/meld-entities.ts":(t,e,i)=>{i.r(e),i.d(e,{MeldEntities:()=>a});var s=i("./libs/age/src/index.ts");class a extends s.EntityManager{constructor(t,e,i,a,r=new s.ValueAccessBuilder(t,e,i),o=r.For((t=>t.CircularSize),(t=>t.CircularSize)),l=r.For((t=>t.DashState),(t=>t.DashState)),n=r.For((t=>t.Health),(t=>t.Health)),h=r.For((t=>t.Orientation),(t=>t.Orientation),0),c=r.For((t=>t.Position),(t=>t.Position)),d=r.For((t=>t.SelectedBlock),(t=>t.SelectedBlock)),u=r.For((t=>t.TargetVelocity),(t=>t.TargetVelocity)),y=r.For((t=>t.Velocity),(t=>t.Velocity)),g=r.For((t=>t.BlockCollisionBehaviour),(t=>t.BlockCollisionBehaviour)),m=r.For((t=>t.GravityBehaviour),(t=>t.GravityBehaviour))){super(e,i,a),this.CircularSize=o,this.DashState=l,this.Health=n,this.Orientation=h,this.Position=c,this.SelectedBlock=d,this.TargetVelocity=u,this.Velocity=y,this.BlockCollisionBehaviour=g,this.GravityBehaviour=m,this.valueAccessors.push(o,l,n,h,c,d,u,y,g,m)}}},"./libs/meld/src/values/dash-state.ts":(t,e,i)=>{i.r(e),i.d(e,{DashState:()=>s});class s{constructor(t=0,e=!1,i=0,s=0){this.TimeOfLastDash=t,this.IsCharging=e,this.Charge=i,this.Angle=s}}},"./libs/utility/src/array-extensions.ts":(t,e,i)=>{i.r(e),Object.defineProperty(Array.prototype,"sum",{value:function(){return this.reduce(((t,e)=>t+ +e),0)}}),Object.defineProperty(Array.prototype,"max",{value:function(){if(!this.length)throw new Error("Cannot find the max value in an empty array");return this.reduce(((t,e)=>t>e?t:e))}}),Object.defineProperty(Array.prototype,"min",{value:function(){if(!this.length)throw new Error("Cannot find the min value in an empty array");return this.reduce(((t,e)=>t<e?t:e))}}),Object.defineProperty(Array.prototype,"clear",{value:function(){return this.splice(0,this.length)}}),Object.defineProperty(Array.prototype,"first",{value:function(){return this[0]}}),Object.defineProperty(Array.prototype,"last",{value:function(){return this[this.length-1]}}),Object.defineProperty(Array.prototype,"distinct",{value:function(){return this.filter(((t,e)=>this.indexOf(t)===e))}}),Object.defineProperty(Array.prototype,"distinctBy",{value:function(t){return this.filter(((e,i)=>{const s=t(e);return this.findIndex((e=>t(e)===s))===i}))}}),Object.defineProperty(Array.prototype,"sortBy",{value:function(t,e=!0){return this.sort(((i,s)=>{let a=t(i);"string"==typeof a&&(a=a.toLowerCase());let r=t(s);return"string"==typeof r&&(r=r.toLowerCase()),a>r?e?1:-1:a<r?e?-1:1:0}))}}),Object.defineProperty(Array.prototype,"includesAny",{value:function(t){return this.some((e=>t.includes(e)))}}),Object.defineProperty(Array.prototype,"groupBy",{value:function(t){const e=[];for(const i of this){const s=t(i);let a=e.find((t=>t.group===s));a||(a={group:s,entries:[]},e.push(a)),a.entries.push(i)}return e}}),Object.defineProperty(Array.prototype,"remove",{value:function(t){const e=this.indexOf(t);return e>=0&&(this.splice(e,1),!0)}}),Object.defineProperty(Array.prototype,"findAndRemove",{value:function(t){const e=this.findIndex(t);return e>=0&&(this.splice(e,1),!0)}}),Object.defineProperty(Array.prototype,"removeBy",{value:function(t){const e=[];for(let i=0;i<this.length;i++)t(this[i])&&(e.push(...this.splice(i,1)),i--);return e}})},"./libs/utility/src/index.ts":(t,e,i)=>{i.r(e),i.d(e,{KeyStates:()=>s.KeyStates,Vector2:()=>r.Vector2,Vector3:()=>o.Vector3,clip:()=>a.clip,hexEastOf:()=>a.hexEastOf,hexNorthEastOf:()=>a.hexNorthEastOf,hexNorthWestOf:()=>a.hexNorthWestOf,hexSouthEastOf:()=>a.hexSouthEastOf,hexSouthWestOf:()=>a.hexSouthWestOf,hexWestOf:()=>a.hexWestOf,hexesAdjacentTo:()=>a.hexesAdjacentTo,randomInt:()=>a.randomInt,randomIntBelow:()=>a.randomIntBelow,randomNumber:()=>a.randomNumber,randomNumberBelow:()=>a.randomNumberBelow,range:()=>a.range}),i("./libs/utility/src/array-extensions.ts");var s=i("./libs/utility/src/key-states.ts"),a=i("./libs/utility/src/utility.ts"),r=i("./libs/utility/src/vector2.ts"),o=i("./libs/utility/src/vector3.ts")},"./libs/utility/src/key-states.ts":(t,e,i)=>{i.r(e),i.d(e,{KeyStates:()=>s});class s{constructor(t={},e={},i={},s={}){this.onDown=t,this.onUp=e,this.states=i,this.eventStates=s,this.onKeyDown=t=>{this.states[t.code]||(this.states[t.code]=1,this.eventStates[t.code]=a.JustPressed,this.onDown[t.code]?.(t.code))},this.onKeyUp=t=>{this.states[t.code]&&(this.onUp[t.code]?.(t.code),this.eventStates[t.code]===a.JustPressed?this.eventStates[t.code]=a.ShouldBeReset:this.states[t.code]=0)},this.onMouseMove=t=>{this.states.MouseX=t.clientX,this.states.MouseY=t.clientY},this.onMouseDown=t=>{const e=this.getMouseButtonCode(t);this.states[e]||(this.states[e]=1,this.eventStates[e]=a.JustPressed,this.onDown[e]?.(e))},this.onMouseUp=t=>{const e=this.getMouseButtonCode(t);this.states[e]&&(this.onUp[e]?.(e),this.eventStates[e]===a.JustPressed?this.eventStates[e]=a.ShouldBeReset:this.states[e]=0)},this.onScroll=t=>{t.deltaY>0?(this.states.MouseScrollDown=1,this.eventStates.MouseScrollDown=a.ShouldBeReset):t.deltaY<0&&(this.states.MouseScrollUp=1,this.eventStates.MouseScrollUp=a.ShouldBeReset)},window.addEventListener("keydown",this.onKeyDown,{capture:!0}),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("wheel",this.onScroll)}onDestroy(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("wheel",this.onScroll)}getMouseButtonCode(t){switch(t.button){case 0:return"MouseLeft";case 1:return"MouseMiddle";case 2:return"MouseRight"}}endInputFrame(){for(const t in this.eventStates)this.eventStates[t]===a.ShouldBeReset&&(this.states[t]=0);this.eventStates={}}getInputState(t){return this.states[t]??this.getFirstGamepadState(t)}getFirstGamepadState(t){const e=(navigator.getGamepads?.()??[]).filter((t=>t));if(0===e.length)return 0;const i=e.first();return"standard"===i?.mapping?this.getStandardGamepadState(t,i):this.getNonStandardGamepadState(t,i)}getStandardGamepadState(t,e){return this.getStandardButtonState(t,e)??this.getStandardAnalogStickState(t,e)}getStandardButtonState(t,e){switch(t){case"PadA":return e.buttons[0].pressed?1:0;case"PadB":return e.buttons[1].pressed?1:0;case"PadX":return e.buttons[2].pressed?1:0;case"PadY":return e.buttons[3].pressed?1:0;case"PadLeftShoulder":return e.buttons[4].pressed?1:0;case"PadRightShoulder":return e.buttons[5].pressed?1:0;case"PadSelect":return e.buttons[8].pressed?1:0;case"PadStart":return e.buttons[9].pressed?1:0;case"PadUp":return e.buttons[12].pressed?1:0;case"PadDown":return e.buttons[13].pressed?1:0;case"PadLeft":return e.buttons[14].pressed?1:0;case"PadRight":return e.buttons[15].pressed?1:0}}getStandardAnalogStickState(t,e){switch(t){case"PadLeftStickUp":return 1.2*Math.max(0,-e.axes[1])-.2;case"PadLeftStickDown":return 1.2*Math.max(0,e.axes[1])-.2;case"PadLeftStickLeft":return 1.2*Math.max(0,-e.axes[0])-.2;case"PadLeftStickRight":return 1.2*Math.max(0,e.axes[0])-.2}}getNonStandardGamepadState(t,e){return this.getNonStandardDpadState(t,e)??this.getStandardButtonState(t,e)??this.getNonStandardEmulatedLeftAnalogState(t,e)}getNonStandardDpadState(t,e){switch(t){case"PadUp":return e.axes[9]<-.7||.8<e.axes[9]&&e.axes[9]<1.1?1:0;case"PadDown":return-.2<e.axes[9]&&e.axes[9]<.5?1:0;case"PadLeft":return.4<e.axes[9]&&e.axes[9]<1.1?1:0;case"PadRight":return-.8<e.axes[9]&&e.axes[9]<0?1:0}}getNonStandardEmulatedLeftAnalogState(t,e){switch(t){case"PadLeftStickUp":return e.axes[9]<-.7||.8<e.axes[9]&&e.axes[9]<1.1?1:0;case"PadLeftStickDown":return-.2<e.axes[9]&&e.axes[9]<.5?1:0;case"PadLeftStickLeft":return.4<e.axes[9]&&e.axes[9]<1.1?1:0;case"PadLeftStickRight":return-.8<e.axes[9]&&e.axes[9]<0?1:0}}}var a;!function(t){t[t.JustPressed=0]="JustPressed",t[t.ShouldBeReset=1]="ShouldBeReset"}(a||(a={}))},"./libs/utility/src/utility.ts":(t,e,i)=>{function*s(t,e){for(let i=t;i<e;i++)yield i}function a(t,e,i,s=!1){if(i<=e)throw"Error";if(!s)return t<e?t=e:i<=t&&(t=i),t;for(;t<e;)t+=i-e;for(;i<=t;)t-=i-e;return t}function r(t,e){return[o(t,e),l(t,e),n(t,e),h(t,e),c(t,e),d(t,e)]}function o(t,e,i=1){const s=(e+i)%2==0?-1:0;return{x:t-Math.floor(i/2)+s,y:e-i}}function l(t,e,i=1){const s=(e+i)%2==0?0:1;return{x:t+Math.floor(i/2)+s,y:e-i}}function n(t,e,i=1){return{x:t-i,y:e}}function h(t,e,i=1){return{x:t+i,y:e}}function c(t,e,i=1){const s=(e+i)%2==0?-1:0;return{x:t-Math.floor(i/2)+s,y:e+i}}function d(t,e,i=1){const s=(e+i)%2==0?0:1;return{x:t+Math.floor(i/2)+s,y:e+i}}function u(t,e){return Math.floor(Math.random()*(e-t)+t)}function y(t){return Math.floor(Math.random()*t)}function g(t,e){return Math.random()*(e-t)+t}function m(t){return Math.random()*t}i.r(e),i.d(e,{clip:()=>a,hexEastOf:()=>h,hexNorthEastOf:()=>l,hexNorthWestOf:()=>o,hexSouthEastOf:()=>d,hexSouthWestOf:()=>c,hexWestOf:()=>n,hexesAdjacentTo:()=>r,randomInt:()=>u,randomIntBelow:()=>y,randomNumber:()=>g,randomNumberBelow:()=>m,range:()=>s})},"./libs/utility/src/vector2.ts":(t,e,i)=>{i.r(e),i.d(e,{Vector2:()=>a});var s=i("./libs/utility/src/utility.ts");class a{constructor(t,e){this.x=t,this.y=e}static fromAngle(t){return new a(1,0).rotate(t)}add(t){return new a(this.x+t.x,this.y+t.y)}subtract(t){return new a(this.x-t.x,this.y-t.y)}multiply(t){return new a(this.x*t,this.y*t)}rotate(t){return new a(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t))}getAngle(){const t=Math.atan2(this.y,this.x);return t<0?t+2*Math.PI:t}angle(){return Math.atan2(this.y,this.x)}lengthSquared(){return this.x*this.x+this.y*this.y}unitVector(){const t=this.length();return 0===t?new a(0,0):new a(this.x/t,this.y/t)}length(){return 0===this.x||0===this.y?Math.abs(this.x)+Math.abs(this.y):Math.sqrt(this.lengthSquared())}copy(){return new a(this.x,this.y)}clip(t,e,i,r,o=!1){return new a((0,s.clip)(this.x,t,i,o),(0,s.clip)(this.y,e,r,o))}set(t,e){this.x=t,this.y=e}isZero(){return 0===this.x&&0===this.y}}},"./libs/utility/src/vector3.ts":(t,e,i)=>{i.r(e),i.d(e,{Vector3:()=>s});class s{constructor(t,e,i){this.x=t,this.y=e,this.z=i}add(t){return new s(this.x+t.x,this.y+t.y,this.z+t.z)}subtract(t){return new s(this.x-t.x,this.y-t.y,this.z-t.z)}multiply(t){return new s(this.x*t,this.y*t,this.z*t)}rotate(t){return new s(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t),0)}getAngle(){const t=Math.atan2(this.y,this.x);return t<0?t+2*Math.PI:t}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}unitVector(){const t=this.length();return 0===t?new s(0,0,0):new s(this.x/t,this.y/t,this.z/t)}length(){return Math.sqrt(this.lengthSquared())}isZero(){return 0===this.x&&0===this.y&&0===this.z}static copy(t){return new s(t.x,t.y,t.z)}stringify(){return this.x+","+this.y+","+this.z}static parse(t){const[e,i,a]=t.split(",");return new s(+e,+i,+a)}static stringify(t,e,i){return t+","+e+","+i}withX(t){return new s(t,this.y,this.z)}withY(t){return new s(this.x,t,this.z)}withZ(t){return new s(this.x,this.y,t)}set(t,e,i){return this.x=t,this.y=e,this.z=i,this}setFrom(t){return this.set(t.x,t.y,t.z),this}addFrom(t){return this.set(this.x+t.x,this.y+t.y,this.z+t.z)}subtractFrom(t){return this.set(this.x-t.x,this.y-t.y,this.z-t.z)}multiplyFrom(t){return this.set(this.x*t,this.y*t,this.z*t)}rotateFrom(t){return this.set(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t),0)}}},"./libs/web-gl-display/src/generic-shader.ts":(t,e,i)=>{i.r(e),i.d(e,{GenericShader:()=>s});class s{constructor(t,e,i){this.gl=t;const s=this.getShader(e,t.VERTEX_SHADER),a=this.getShader(i,t.FRAGMENT_SHADER);this.program=this.createProgram(s,a),t.deleteShader(s),t.deleteShader(a)}getShader(t,e){const i=this.gl.createShader(e);if(this.gl.shaderSource(i,t),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))throw new Error("Shader error: "+this.gl.getShaderInfoLog(i));return i}createProgram(t,e){const i=this.gl.createProgram();if(this.gl.attachShader(i,t),this.gl.attachShader(i,e),this.gl.linkProgram(i),!this.gl.getProgramParameter(i,this.gl.LINK_STATUS))throw new Error("Shader program error: "+this.gl.getProgramInfoLog(i));return this.gl.detachShader(i,t),this.gl.detachShader(i,e),this.gl.useProgram(null),i}}},"./libs/web-gl-display/src/index.ts":(t,e,i)=>{i.r(e),i.d(e,{WebGl2Display:()=>s.WebGl2Display});var s=i("./libs/web-gl-display/src/web-gl-display.ts")},"./libs/web-gl-display/src/m3x3.ts":(t,e,i)=>{i.r(e),i.d(e,{M3x3:()=>s});class s{constructor(t=[1,0,0,0,1,0,0,0,1]){this.matrix=t}multiply(t){const e=new s;return e.matrix=[this.matrix[0]*t.matrix[0]+this.matrix[3]*t.matrix[1]+this.matrix[6]*t.matrix[2],this.matrix[1]*t.matrix[0]+this.matrix[4]*t.matrix[1]+this.matrix[7]*t.matrix[2],this.matrix[2]*t.matrix[0]+this.matrix[5]*t.matrix[1]+this.matrix[8]*t.matrix[2],this.matrix[0]*t.matrix[3]+this.matrix[3]*t.matrix[4]+this.matrix[6]*t.matrix[5],this.matrix[1]*t.matrix[3]+this.matrix[4]*t.matrix[4]+this.matrix[7]*t.matrix[5],this.matrix[2]*t.matrix[3]+this.matrix[5]*t.matrix[4]+this.matrix[8]*t.matrix[5],this.matrix[0]*t.matrix[6]+this.matrix[3]*t.matrix[7]+this.matrix[6]*t.matrix[8],this.matrix[1]*t.matrix[6]+this.matrix[4]*t.matrix[7]+this.matrix[7]*t.matrix[8],this.matrix[2]*t.matrix[6]+this.matrix[5]*t.matrix[7]+this.matrix[8]*t.matrix[8]],e}transition(t,e){const i=new s;return i.matrix=[this.matrix[0],this.matrix[1],this.matrix[2],this.matrix[3],this.matrix[4],this.matrix[5],t*this.matrix[0]+e*this.matrix[3]+this.matrix[6],t*this.matrix[1]+e*this.matrix[4]+this.matrix[7],t*this.matrix[2]+e*this.matrix[5]+this.matrix[8]],i}scale(t,e){const i=new s;return i.matrix=[this.matrix[0]*t,this.matrix[1]*t,this.matrix[2]*t,this.matrix[3]*e,this.matrix[4]*e,this.matrix[5]*e,this.matrix[6],this.matrix[7],this.matrix[8]],i}getFloatArray(){return new Float32Array(this.matrix)}}},"./libs/web-gl-display/src/sprite-factory.ts":(t,e,i)=>{i.r(e),i.d(e,{SpriteFactory:()=>a});var s=i("./libs/web-gl-display/src/sprite.ts");class a{constructor(t,e,i,s){this.gl=t,this.shader=e,this.tileSize=i,this.worldSpaceMatrix=s}async createSprite(t,e,i,a,r){const o=await this.loadImage(t),l=e/o.width,n=i/o.height;this.gl.useProgram(this.shader.program);const h=this.createTexture(o),c=this.createTextureBuffer(l,n),d=this.createGeometryBuffer(e,i);return this.gl.useProgram(null),new s.Sprite(this.gl,this.shader,this.tileSize,this.worldSpaceMatrix,h,c,d,a,r,l,n)}loadImage(t){return new Promise((e=>{const i=new Image;i.onload=()=>e(i),i.src=t}))}createTexture(t){const e=this.gl,i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.bindTexture(e.TEXTURE_2D,null),i}createTextureBuffer(t,e){const i=this.gl,s=i.createBuffer();return i.bindBuffer(i.ARRAY_BUFFER,s),i.bufferData(i.ARRAY_BUFFER,this.createRectArray(0,0,t,e),i.STATIC_DRAW),s}createGeometryBuffer(t,e){const i=this.gl,s=i.createBuffer();return i.bindBuffer(i.ARRAY_BUFFER,s),i.bufferData(i.ARRAY_BUFFER,this.createRectArray(0,0,t,e),i.STATIC_DRAW),s}createRectArray(t=0,e=0,i=1,s=1){return new Float32Array([t,e,t+i,e,t,e+s,t,e+s,t+i,e,t+i,e+s])}}},"./libs/web-gl-display/src/sprite.ts":(t,e,i)=>{i.r(e),i.d(e,{Sprite:()=>a});var s=i("./libs/web-gl-display/src/m3x3.ts");class a{constructor(t,e,i,s,a,r,o,l,n,h,c){this.gl=t,this.shader=e,this.tileSize=i,this.worldSpaceMatrix=s,this.texture=a,this.textureBuffer=r,this.geometryBuffer=o,this.centerX=l,this.centerY=n,this.uvX=h,this.uvY=c}render(t,e,i=0,a=0){const r=this.gl;r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(this.shader.uImageLocation,0),r.bindBuffer(r.ARRAY_BUFFER,this.textureBuffer),r.enableVertexAttribArray(this.shader.aTexCoordLocation),r.vertexAttribPointer(this.shader.aTexCoordLocation,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.geometryBuffer),r.enableVertexAttribArray(this.shader.aPositionLocation),r.vertexAttribPointer(this.shader.aPositionLocation,2,r.FLOAT,!1,0,0);const o=i*this.uvX,l=a*this.uvY,n=(new s.M3x3).transition(t*this.tileSize-this.centerX,e*this.tileSize-this.centerY);r.uniform2f(this.shader.uFrameLocation,o,l),r.uniformMatrix3fv(this.shader.uWorldLocation,!1,this.worldSpaceMatrix.getFloatArray()),r.uniformMatrix3fv(this.shader.uObjectLocation,!1,n.getFloatArray()),r.drawArrays(r.TRIANGLE_STRIP,0,6)}}},"./libs/web-gl-display/src/standard-shader.ts":(t,e,i)=>{i.r(e),i.d(e,{StandardShader:()=>a});var s=i("./libs/web-gl-display/src/generic-shader.ts");class a extends s.GenericShader{constructor(t,e,i,s,a,r,o){super(t,"\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nuniform mat3 uWorld;\nuniform mat3 uObject;\nuniform vec2 uFrame;\nvoid main(void) {\ngl_Position = vec4(uWorld * uObject * vec3(aPosition, 1), 1);\nvTexCoord = aTexCoord + uFrame;\n}","\nprecision mediump float;\nuniform sampler2D uImage;\nvarying vec2 vTexCoord;\nvoid main(void) {\ngl_FragColor = texture2D(uImage, vTexCoord);\n}"),this.aPositionLocation=e,this.aTexCoordLocation=i,this.uImageLocation=s,this.uWorldLocation=a,this.uObjectLocation=r,this.uFrameLocation=o,this.aPositionLocation=t.getAttribLocation(this.program,"aPosition"),this.aTexCoordLocation=t.getAttribLocation(this.program,"aTexCoord"),this.uImageLocation=t.getUniformLocation(this.program,"uImage"),this.uWorldLocation=t.getUniformLocation(this.program,"uWorld"),this.uObjectLocation=t.getUniformLocation(this.program,"uObject"),this.uFrameLocation=t.getUniformLocation(this.program,"uFrame")}}},"./libs/web-gl-display/src/web-gl-display.ts":(t,e,i)=>{i.r(e),i.d(e,{WebGl2Display:()=>o});var s=i("./libs/web-gl-display/src/m3x3.ts"),a=i("./libs/web-gl-display/src/sprite-factory.ts"),r=i("./libs/web-gl-display/src/standard-shader.ts");class o{constructor(t,e,i,s=!1,o=t.getContext("webgl2"),n=new r.StandardShader(o),h=null,c=l(t.width,t.height,i),d=new a.SpriteFactory(o,n,e,c),u={},y=[],g=!1,m=[]){this.canvas=t,this.tileSize=e,this.virtualScreenHeight=i,this.alignToPixelGrid=s,this.gl=o,this.standardShader=n,this.previousProgram=h,this.worldSpaceMatrix=c,this.spriteFactory=d,this.sprites=u,this.loadingSprites=y,this.sortByDepth=g,this.spritesToDraw=m,this.gl.enable(this.gl.BLEND)}startFrame(){this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)}draw(t,e,i,s,a,r=1){this.sortByDepth?this.spritesToDraw.push(new n(t,e,i,s,a,r)):this.drawSprite(t,e,i,s,a)}endFrame(){if(this.sortByDepth){this.spritesToDraw.sort(((t,e)=>t.depth-e.depth));for(const t of this.spritesToDraw)this.drawSprite(t.sprite,t.x,t.y,t.frameX,t.frameY);this.spritesToDraw=[]}this.previousProgram=null,this.gl.useProgram(null),this.gl.flush()}drawSprite(t,e,i,s,a){const r=this.sprites[t];if(!r)return console.warn("Could not load sprite {0}",t);this.previousProgram!=r.shader.program&&(this.gl.useProgram(r.shader.program),this.previousProgram=r.shader.program),this.alignToPixelGrid&&(e=Math.floor(e*this.tileSize)/this.tileSize,i=Math.floor(i*this.tileSize)/this.tileSize),r.render(e,i,s,a)}resize(t,e){this.canvas.width=t,this.canvas.height=e,this.worldSpaceMatrix=l(t,e,this.virtualScreenHeight),this.spriteFactory=new a.SpriteFactory(this.gl,this.standardShader,this.tileSize,this.worldSpaceMatrix)}async addSprite(t,e,i=16,s=16,a=0,r=0){this.loadingSprites.push(t),this.sprites[t]=await this.spriteFactory.createSprite(e,i,s,a,r),this.loadingSprites.splice(this.loadingSprites.indexOf(t),1)}isLoading(){return this.loadingSprites.length>0}}function l(t,e,i){const a=t/(e/i);return(new s.M3x3).transition(-1,1).scale(2/a,-2/i)}class n{constructor(t,e,i,s,a,r){this.sprite=t,this.x=e,this.y=i,this.frameX=s,this.frameY=a,this.depth=r}}},"./libs/meld/src/display-config.json":t=>{t.exports=JSON.parse('{"renderToVirtualSize":false,"virtualPixelsPerTile":16,"virtualHeight":360,"wallDisplayHeight":2,"assetFolder":"assets/","inputs":{"Generate":["Escape","Enter","PadStart"],"ToggleInventory":["Tab","Start"],"ToggleMenu":["Escape","Select"],"ToggleChat":["Enter"],"MoveUp":["W","Up","PadUp","PadLeftStickUp"],"MoveDown":["S","Down","PadDown","PadLeftStickDown"],"MoveLeft":["A","Left","PadLeft","PadLeftStickLeft"],"MoveRight":["D","Right","PadRight","PadLeftStickRight"],"UseItem":["F","PadY"],"ToolA":["MouseLeft","PadA","PadRightTrigger"],"ToolB":["MouseRight","PadX","PadLeftTrigger"],"Action":["Space","PadB"],"SelectTopItem":["2","PadUp"],"SelectBottomItem":["4","PadDown"],"SelectLeftItem":["1","PadLeft"],"SelectRightItem":["3","PadRight"],"SelectTopItemSet":[],"SelectBottomItemSet":[],"SelectLeftItemSet":[],"SelectRightItemSet":[],"SelectTopTool":[],"SelectBottomTool":[],"SelectLeftTool":[],"SelectRightTool":[],"MoveCameraUp":[],"MoveCameraDown":[],"MoveCameraLeft":[],"MoveCameraRight":[],"LookUp":[],"LookDown":[],"RotateCameraLeft":["E"],"RotateCameraRight":["Q"],"ToggleSelection":[],"HoldSelection":["PadLeftShoulder"],"SelectionModeSelectTopItem":["PadLeftStickUp"],"SelectionModeSelectBottomItem":["PadLeftStickDown"],"SelectionModeSelectLeftItem":["PadLeftStickLeft"],"SelectionModeSelectRightItem":["PadLeftStickRight"],"SelectionModeSelectTopTool":["PadY"],"SelectionModeSelectBottomTool":["PadA"],"SelectionModeSelectLeftTool":["PadX"],"SelectionModeSelectRightTool":["PadB"],"ToggleCamera":[],"HoldCamera":["PadRightShoulder"],"CameraModeMoveCameraUp":["PadLeftStickUp"],"CameraModeMoveCameraDown":["PadLeftStickDown"],"CameraModeMoveCameraLeft":["PadLeftStickLeft"],"CameraModeMoveCameraRight":["PadLeftStickRight"],"CameraModeLookUp":["PadY"],"CameraModeLookDown":["PadA"],"CameraModeRotateCameraLeft":["PadX"],"CameraModeRotateCameraRight":["PadB"],"SelectNextItem":["MouseScrollUp"],"SelectPreviousItem":["MouseScrollDown"],"HoldWalk":["LeftControl"],"ToggleWalk":[]},"defaultSpriteTypes":{"defaultTile":{"width":16,"height":16,"centerX":8,"centerY":8},"defaultDiagonalTile":{"width":24,"height":24,"centerX":12,"centerY":12},"defaultFullWall":{"width":16,"height":32,"centerX":8,"centerY":24},"defaultDiagonalFullWall":{"width":24,"height":44,"centerX":12,"centerY":32},"defaultHalfWall":{"width":16,"height":16,"centerX":8,"centerY":8}},"blockSprites":{"grass":[{"straightTile":"grass-tile","straightFullWall":"grass-wall","diagonalTile":"grass-tile-diagonal","diagonalFullWall":"grass-wall-diagonal"}],"dirt":[{"straightTile":"dirt-tile","straightFullWall":"dirt-wall","diagonalTile":"dirt-tile-diagonal","diagonalFullWall":"dirt-wall-diagonal"}],"earth":[{"straightTile":"earth-tile","straightFullWall":"earth-wall","diagonalTile":"earth-tile-diagonal","diagonalFullWall":"earth-wall-diagonal"}],"stone":[{"straightTile":"stone-tile","straightFullWall":"stone-wall","diagonalTile":"stone-tile-diagonal","diagonalFullWall":"stone-wall-diagonal"}],"slab":[{"straightTile":"slab-tile","straightFullWall":"slab-wall","diagonalTile":"slab-tile-diagonal","diagonalFullWall":"slab-wall-diagonal"}],"wooden":[{"straightTile":"wood-tile","straightFullWall":"wood-wall","diagonalTile":"wood-tile-diagonal","diagonalFullWall":"wood-wall-diagonal"}]},"blockTileOverlays":{"grass":{"tileOverlayTop":"grass-tile-top","tileOverlayBottom":"grass-tile-bottom","tileOverlayLeft":"grass-tile-left","tileOverlayRight":"grass-tile-right","tileOverlayTopLeft":"grass-tile-left","tileOverlayTopRight":"grass-tile-top","tileOverlayBottomLeft":"grass-tile-bottom","tileOverlayBottomRight":"grass-tile-right"}},"sprites":{"missing-sprite":{"width":16,"height":16,"centerX":8,"centerY":8},"player":{"path":"character-box-x32","width":20,"height":48,"centerX":10,"centerY":40},"default-tile-left":{"width":16,"height":16,"centerX":24,"centerY":8},"default-tile-right":{"width":16,"height":16,"centerX":-8,"centerY":8},"default-tile-top":{"width":16,"height":16,"centerX":8,"centerY":24},"default-tile-bottom":{"width":16,"height":16,"centerX":8,"centerY":-8},"default-tile-top-left":{"width":24,"height":24,"centerX":24,"centerY":24},"default-tile-top-right":{"width":24,"height":24,"centerX":0,"centerY":24},"default-tile-bottom-left":{"width":24,"height":24,"centerX":24,"centerY":0},"default-tile-bottom-right":{"width":24,"height":24,"centerX":0,"centerY":0},"default-straight-full-wall-left":{"path":"default-wall-full-left","width":16,"height":32,"centerX":24,"centerY":24},"default-straight-full-wall-right":{"path":"default-wall-full-right","width":16,"height":32,"centerX":-8,"centerY":24},"default-straight-half-wall-left":{"path":"default-wall-half-left","width":16,"height":16,"centerX":24,"centerY":8},"default-straight-half-wall-right":{"path":"default-wall-half-right","width":16,"height":16,"centerX":-8,"centerY":8},"default-diagonal-full-wall-left":{"path":"default-wall-full-left","width":16,"height":32,"centerX":28,"centerY":32},"default-diagonal-full-wall-right":{"path":"default-wall-full-right","width":16,"height":32,"centerX":-12,"centerY":32},"default-diagonal-half-wall-left":{"path":"default-wall-half-left","width":16,"height":16,"centerX":28,"centerY":16},"default-diagonal-half-wall-right":{"path":"default-wall-half-right","width":16,"height":16,"centerX":-12,"centerY":16},"default-wall-shadow-full-left":{"width":16,"height":16,"centerX":24,"centerY":8},"default-wall-shadow-full-right":{"width":16,"height":16,"centerX":-8,"centerY":8},"default-wall-shadow-half-left":{"width":16,"height":16,"centerX":24,"centerY":8},"default-wall-shadow-half-right":{"width":16,"height":16,"centerX":-8,"centerY":8},"dirt-tile":{"type":"defaultTile"},"dirt-tile-diagonal":{"type":"defaultDiagonalTile"},"dirt-wall":{"type":"defaultFullWall"},"dirt-wall-diagonal":{"type":"defaultDiagonalFullWall"},"earth-tile":{"type":"defaultTile"},"earth-tile-diagonal":{"type":"defaultDiagonalTile"},"earth-wall":{"type":"defaultFullWall"},"earth-wall-diagonal":{"type":"defaultDiagonalFullWall"},"grass-tile":{"type":"defaultTile","framesX":4,"framesY":3,"frameInterval":20},"grass-tile-diagonal":{"type":"defaultDiagonalTile","framesX":2,"framesY":2},"grass-wall":{"type":"defaultFullWall"},"grass-wall-diagonal":{"type":"defaultDiagonalFullWall"},"grass-tile-left":{"width":16,"height":16,"centerX":24,"centerY":8},"grass-tile-right":{"width":16,"height":16,"centerX":-8,"centerY":8},"grass-tile-top":{"width":16,"height":16,"centerX":8,"centerY":24},"grass-tile-bottom":{"width":16,"height":16,"centerX":8,"centerY":-8},"slab-tile":{"type":"defaultTile"},"slab-tile-diagonal":{"type":"defaultDiagonalTile"},"slab-wall":{"type":"defaultFullWall"},"slab-wall-diagonal":{"type":"defaultDiagonalFullWall"},"stone-tile":{"type":"defaultTile"},"stone-tile-diagonal":{"type":"defaultDiagonalTile"},"stone-wall":{"type":"defaultFullWall"},"stone-wall-diagonal":{"type":"defaultDiagonalFullWall"},"wood-tile":{"type":"defaultTile"},"wood-tile-diagonal":{"type":"defaultDiagonalTile"},"wood-wall":{"type":"defaultFullWall"},"wood-wall-diagonal":{"type":"defaultDiagonalFullWall"},"hud-life-energy":{"width":26,"height":173},"hud-tool-items":{"width":46,"height":166,"centerX":46}}}')},"./libs/meld/src/game-config.json":t=>{t.exports=JSON.parse('{"constants":{"playerType":"player","initialDashCharge":20,"maxDashCharge":40},"entityTypes":{"player":{"blockCollisionBehaviour":true,"circularSize":{"radius":0.625,"height":0.875},"gravityBehaviour":true,"selectedBlock":"grass"}},"solidTypes":{"dirt":{},"earth":{},"grass":{},"slab":{},"stone":{},"wooden":{}},"nonSolidTypes":{"air":{}}}')}},s={};function a(t){var e=s[t];if(void 0!==e)return e.exports;var r=s[t]={exports:{}};return i[t](r,r.exports,a),r.exports}e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,a.t=function(i,s){if(1&s&&(i=this(i)),8&s)return i;if("object"==typeof i&&i){if(4&s&&i.__esModule)return i;if(16&s&&"function"==typeof i.then)return i}var r=Object.create(null);a.r(r);var o={};t=t||[null,e({}),e([]),e(e)];for(var l=2&s&&i;"object"==typeof l&&!~t.indexOf(l);l=e(l))Object.getOwnPropertyNames(l).forEach((t=>o[t]=()=>i[t]));return o.default=()=>i,a.d(r,o),r},a.d=(t,e)=>{for(var i in e)a.o(e,i)&&!a.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return(()=>{a.r(r),a.d(r,{ChargeDashAction:()=>s.ChargeDashAction,GameUpdate:()=>s.GameUpdate,GenerateAction:()=>s.GenerateAction,LoadState:()=>s.LoadState,Meld:()=>t.Meld,MeldDisplay:()=>e.MeldDisplay,MeldGame:()=>i.MeldGame,MovementAction:()=>s.MovementAction,PlaceBlockAction:()=>s.PlaceBlockAction,ReleaseDashAction:()=>s.ReleaseDashAction,SelectNextItemAction:()=>s.SelectNextItemAction,updatesPerSecond:()=>i.updatesPerSecond});var t=a("./libs/meld/src/meld.ts"),e=a("./libs/meld/src/meld-display.ts"),i=a("./libs/meld/src/meld-game.ts"),s=a("./libs/meld/src/state/game-update.ts")})(),r})()));