!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var s=e();for(var i in s)("object"==typeof exports?exports:t)[i]=s[i]}}(self,(()=>(()=>{"use strict";var t={"./libs/age/src/age.ts":(t,e,s)=>{s.r(e),s.d(e,{AgEngine:()=>i});class i{constructor(t,e,s){this.logics=t,this.validators=e,this.state=s}update(...t){return this.validate(t)||(this.performLogic(t),{isValid:!0,problems:[]})}validate(t){for(const e of this.validators){const s=e.validate(t);if(!s.isValid)return s}}performLogic(t){var e,s;this.state.tick++;for(const e of this.logics)e.update(t);null===(s=(e=this.state).finishUpdate)||void 0===s||s.call(e)}}},"./libs/age/src/base-display.ts":(t,e,s)=>{s.r(e)},"./libs/age/src/base-game.ts":(t,e,s)=>{s.r(e),s.d(e,{BaseGame:()=>i});class i{constructor(t=[],e=[]){this.logics=t,this.validators=e}update(...t){const e=this.validate(t);if(e)return e;for(const e of this.logics)e.update(t);return{isValid:!0,problems:[]}}validate(t){for(const e of this.validators){const s=e.validate(t);if(!s.isValid)return s}}}},"./libs/age/src/base-input.ts":(t,e,s)=>{s.r(e),s.d(e,{BaseInput:()=>r});var i=s("./libs/utility/src/index.ts");class r{constructor(){this.nextActions=[],this.keyStates=new i.KeyStates}getNewActions(){const t=[...this.nextActions,...this.parseInputs(this.keyStates.getInputState())];return this.nextActions=[],t}stateFor(t,...e){var s;for(const i of e)if(null===(s=t[i])||void 0===s?void 0:s.state)return!0;return!1}}},"./libs/age/src/game-runner.ts":(t,e,s)=>{s.r(e),s.d(e,{GameRunner:()=>i});class i{constructor(t,e,s){this.display=t,this.inputs=e,this.game=s,this.updateInterval=30,this.lastUpdate=Date.now(),this.stop=!1,this.updateGame=()=>{this.game.update(...this.inputs.getNewActions()),this.lastUpdate=Date.now()},this.startDisplayLoop=()=>{this.updateDisplay(),this.stop||requestAnimationFrame(this.startDisplayLoop)}}startGameLoop(){this.stopInterval(),this.timerId=window.setInterval(this.updateGame,this.updateInterval)}stopInterval(){this.timerId&&window.clearInterval(this.timerId),this.timerId=null}updateDisplay(){const t=(Date.now()-this.lastUpdate)/30;this.display.show(t)}setSize(t,e){var s;null===(s=this.display)||void 0===s||s.setSize(t,e)}onDestroy(){this.stop=!0,window.clearInterval(this.timerId)}}},"./libs/age/src/index.ts":(t,e,s)=>{s.r(e),s.d(e,{AgEngine:()=>i.AgEngine,BaseGame:()=>r.BaseGame,BaseInput:()=>a.BaseInput,BaseValues:()=>c.BaseValues,Box:()=>y.Box,EntityManager:()=>d.EntityManager,GameGrid:()=>u.GameGrid,GameRunner:()=>n.GameRunner,Random:()=>l.Random,RandomAi:()=>o.RandomAi,RectangularSize:()=>m.RectangularSize,StandardValueGetter:()=>f.StandardValueGetter,TerrainManager:()=>g.TerrainManager,TypeMap:()=>p.TypeMap,ValueAccessBuilder:()=>f.ValueAccessBuilder,ValueAccessor:()=>f.ValueAccessor,ValueSetter:()=>f.ValueSetter,typeMask:()=>h.typeMask,typeOf:()=>h.typeOf,typeOffset:()=>h.typeOffset});var i=s("./libs/age/src/age.ts"),r=(s("./libs/age/src/base-display.ts"),s("./libs/age/src/base-game.ts")),a=s("./libs/age/src/base-input.ts"),n=s("./libs/age/src/game-runner.ts"),o=s("./libs/age/src/interfaces/game-ai.ts"),l=(s("./libs/age/src/interfaces/game-logic.ts"),s("./libs/age/src/interfaces/game-state.ts"),s("./libs/age/src/interfaces/game-validator.ts"),s("./libs/age/src/services/random.ts")),h=s("./libs/age/src/state/id.ts"),c=s("./libs/age/src/state/base-values.ts"),d=s("./libs/age/src/state/entity-manager.ts"),u=s("./libs/age/src/state/game-grid.ts"),g=s("./libs/age/src/state/terrain-manager.ts"),p=s("./libs/age/src/state/type-map.ts"),f=s("./libs/age/src/state/value-accessor.ts"),y=s("./libs/age/src/values/box.ts"),m=s("./libs/age/src/values/rectangular-size.ts")},"./libs/age/src/interfaces/game-ai.ts":(t,e,s)=>{s.r(e),s.d(e,{RandomAi:()=>i});class i{constructor(t){this.possibleActionsFor=t}requestActions(t){const e=this.possibleActionsFor(t);return[e[Math.floor(Math.random()*e.length)]]}}},"./libs/age/src/interfaces/game-logic.ts":(t,e,s)=>{s.r(e)},"./libs/age/src/interfaces/game-state.ts":(t,e,s)=>{s.r(e)},"./libs/age/src/interfaces/game-validator.ts":(t,e,s)=>{s.r(e)},"./libs/age/src/services/random.ts":(t,e,s)=>{s.r(e),s.d(e,{Random:()=>i});class i{constructor(t,e=-1,s=new r(-1)){this.getSeed=t,this.previousSeed=e,this.generator=s}get get(){const t=this.getSeed();return this.previousSeed===t||(this.previousSeed=t,this.generator=new r(t)),this.generator}}class r{constructor(t){this.seed=t}int(t){return Math.floor(Math.random()*t)}float(t){return Math.random()*t}in(t){return t[this.int(t.length)]}}},"./libs/age/src/state/base-values.ts":(t,e,s)=>{s.r(e),s.d(e,{BaseValues:()=>i});class i{constructor(t=new Map){this.entities=t,this.allValueMaps=[]}register(t){return this.allValueMaps.push(t),t}clear(){for(const t of this.allValueMaps)t.clear()}removeValuesFor(t){for(const e of this.allValueMaps)e.delete(t)}addValuesFromOther(t){for(let e=0;e<this.allValueMaps.length;e++)for(const[s,i]of t.allValueMaps[e])this.allValueMaps[e].set(s,i)}}},"./libs/age/src/state/entity-manager.ts":(t,e,s)=>{s.r(e),s.d(e,{EntityManager:()=>i});class i{constructor(t,e,s){this.entityValues=t,this.updatedEntityValues=e,this.idProvider=s,this.valueAccessors=[]}get with(){return this.entityValues}create(t){const e=this.idProvider.getNewId()|t;this.updatedEntityValues.entities.set(e,!0);for(const t of this.valueAccessors)t.initialiseValueFor(e);return e}remove(...t){for(const e of t)this.updatedEntityValues.entities.set(e,!1)}applyUpdatedValues(){this.entityValues.addValuesFromOther(this.updatedEntityValues),this.updatedEntityValues.clear();for(const[t,e]of this.updatedEntityValues.entities)e?this.add(t):this.fullyRemove(t);this.updatedEntityValues.entities.clear(),this.updatedEntityValues.entities.clear()}add(t){this.entityValues.entities.set(t,!0)}fullyRemove(t){this.entityValues.entities.delete(t),this.updatedEntityValues.entities.delete(t),this.entityValues.removeValuesFor(t),this.updatedEntityValues.removeValuesFor(t)}*[Symbol.iterator](){for(const[t]of this.entityValues.entities)yield t}}},"./libs/age/src/state/game-grid.ts":(t,e,s)=>{s.r(e),s.d(e,{GameGrid:()=>r});var i=s("./libs/utility/src/index.ts");class r{constructor(t,e,s=(()=>null)){this.width=t,this.height=e,this.setAll(s)}setAll(t){this.grid=[];for(const{x:e,y:s}of this.allFields())this.grid.push(t(e,s))}*allFields(){for(const t of(0,i.range)(0,this.height))for(const e of(0,i.range)(0,this.width))yield{x:e,y:t,field:this.get(e,t)}}*fieldsAround(t,e,s=1){for(const r of(0,i.range)(t-s,t+s+1))for(const t of(0,i.range)(e-s,e+s+1))this.isWithinBounds(r,t)&&(yield{i:r,j:t,field:this.get(r,t)})}get(t,e){return this.grid[this.indexFor(t,e)]}set(t,e,s){this.grid[this.indexFor(t,e)]=s}isWithinBounds(t,e){return 0<=t&&t<this.width&&0<=e&&e<this.height}indexFor(t,e){return t+e*this.width}}},"./libs/age/src/state/id.ts":(t,e,s)=>{s.r(e),s.d(e,{typeMask:()=>i,typeOf:()=>a,typeOffset:()=>r});const i=4278190080,r=24;function a(t){return t&i}},"./libs/age/src/state/terrain-manager.ts":(t,e,s)=>{s.r(e),s.d(e,{TerrainManager:()=>r});var i=s("./libs/utility/src/index.ts");class r{constructor(t={x:10,y:10,z:1},e,s=new Map){this.chunkSize=t,this.chunks=e,this.updatedBlocks=s}addChunk(t,e,s,i=0){this.chunks.set(this.convertChunkCoords(e,s,i),t)}get(t,e,s=0){t=Math.floor(t),e=Math.floor(e),s=Math.floor(s);const{chunkCoords:i,index:r}=this.getChunkPositionFor(t,e,s),a=this.chunks.get(i);return a||console.warn("Trying to access outside any chunk"),null==a?void 0:a[r]}getChunkPositionFor(t,e,s){const i=this.getChunkCoords(t,e,s);return{chunkCoords:this.convertChunkCoords(i.x,i.y,i.z),index:this.chunkIndexFor(t-i.x*this.chunkSize.x,e-i.y*this.chunkSize.y,s-i.z*this.chunkSize.z)}}getChunkCoords(t,e,s){return{x:this.chunkCoord(t,this.chunkSize.x),y:this.chunkCoord(e,this.chunkSize.y),z:this.chunkCoord(s,this.chunkSize.z)}}chunkCoord(t,e){return Math.floor(t/e)}convertChunkCoords(t,e,s){return t+","+e+","+s}chunkIndexFor(t,e,s){return t+e*this.chunkSize.x+s*this.chunkSize.x*this.chunkSize.y}getCurrent(t,e,s=0){var i;return t=Math.floor(t),e=Math.floor(e),s=Math.floor(s),null!==(i=this.updatedBlocks.get({x:t,y:e,z:s}))&&void 0!==i?i:this.get(t,e,s)}*allFields(t=0,e=0,s=0){const r=this.chunks.get(this.convertChunkCoords(t,e,s));for(const t of(0,i.range)(0,this.chunkSize.z))for(const e of(0,i.range)(0,this.chunkSize.y))for(const s of(0,i.range)(0,this.chunkSize.x))yield{x:s,y:e,z:t,field:r[this.chunkIndexFor(s,e,t)]}}fieldsAround(t,e,s=0){return this.fieldsWithinRadius(t,e,s,1,1,0)}*fieldsWithinRadius(t,e,s,r=1,a=1,n=1){for(const o of(0,i.range)(t-r,t+r+1))for(const t of(0,i.range)(e-a,e+a+1))for(const e of(0,i.range)(s-n,s+n+1))yield{i:o,j:t,k:e,field:this.get(o,t,e)}}set(t,e,s,i=0){e=Math.floor(e),s=Math.floor(s),i=Math.floor(i),this.updatedBlocks.set({x:e,y:s,z:i},t)}applyUpdatedValues(){for(const[{x:t,y:e,z:s},i]of this.updatedBlocks)this.setField(t,e,s,i);this.updatedBlocks.clear()}setField(t,e,s,i){const{chunkCoords:r,index:a}=this.getChunkPositionFor(t,e,s),n=this.chunks.get(r);n?n[a]=i:console.error("Can't set field outside chunks at ({0}, {1}, {2})",t,e,s)}}},"./libs/age/src/state/type-map.ts":(t,e,s)=>{s.r(e),s.d(e,{TypeMap:()=>r});var i=s("./libs/age/src/state/id.ts");class r{constructor(t=new Map){this.types=t}static from(t){const e=new r;for(const[s,r]of t.entries())e.types.set(r,s<<i.typeOffset);return e}typeFor(t){for(const[e,s]of this.types.entries())if(t===s)return e}typeIdFor(t){return this.types.get(t)}}},"./libs/age/src/state/value-accessor.ts":(t,e,s)=>{s.r(e),s.d(e,{StandardValueGetter:()=>a,ValueAccessBuilder:()=>o,ValueAccessor:()=>r,ValueSetter:()=>n});var i=s("./libs/age/src/state/id.ts");class r{constructor(t,e){this.get=t,this.set=e}initialiseValueFor(t){const e=this.get.defaultOf(t);null!=e&&this.set.for(t,e)}}class a{constructor(t,e,s,i,r){this.typeValues=t,this.entityValue=e,this.updatedEntityValue=s,this.getTypeValue=i,this.defaultValue=r}currentlyOf(t){var e;return null!==(e=this.updatedEntityValue.get(t))&&void 0!==e?e:this.of(t)}of(t){return this.entityValue.get(t)}defaultOf(t){var e;const s=(0,i.typeOf)(t);return null!==(e=this.getTypeValue(this.typeValues.get(s)))&&void 0!==e?e:this.defaultValue}}class n{constructor(t){this.updatedEntityValue=t}for(t,e){this.updatedEntityValue.set(t,e)}}class o{constructor(t,e,s){this.typeValues=t,this.entityValues=e,this.updatedEntityValues=s}for(t,e,s){return new r(new a(this.typeValues,t(this.entityValues),t(this.updatedEntityValues),e,s),new n(t(this.updatedEntityValues)))}}},"./libs/age/src/values/box.ts":(t,e,s)=>{s.r(e),s.d(e,{Box:()=>i});class i{constructor(t,e,s,i){this.minX=t,this.maxX=e,this.minY=s,this.maxY=i}static from(t,e){return new i(t.x-e.width/2,t.x+e.width/2,t.y-e.height/2,t.y+e.height/2)}translateBy(t){return new i(this.minX+t.x,this.maxX+t.x,this.minY+t.y,this.maxY+t.y)}contains(t){return this.minX<=t.x&&t.x<=this.maxX&&this.minY<=t.y&&t.y<=this.maxY}}},"./libs/age/src/values/rectangular-size.ts":(t,e,s)=>{s.r(e),s.d(e,{RectangularSize:()=>i});class i{constructor(t,e){this.width=t,this.height=e}}},"./libs/renderend/src/defaults.ts":(t,e,s)=>{s.r(e),s.d(e,{defaultConstants:()=>r,defaultDisplayConfig:()=>n,defaultValues:()=>a});var i=s("./libs/age/src/index.ts");const r={shipType:"ship",wallType:"wall",obstacleTypes:["obstacle","obstacle","obstacle","obstacle","obstacle","obstacle","big-obstacle"]},a={ship:{shipBehaviour:!0,dieOnCollisionBehaviour:!0,health:3,damage:1},wall:{rectangularSize:new i.RectangularSize(1,1),obstacleBehaviour:!0,damage:3},obstacle:{rectangularSize:new i.RectangularSize(1,1),obstacleBehaviour:!0,health:1,damage:1},"big-obstacle":{rectangularSize:new i.RectangularSize(2,2),obstacleBehaviour:!0,damage:3}},n={font:"Vt323",assetFolder:"assets/",sprites:{"full-shield":{url:"full-shield.png",width:20,height:20,framesX:4,framesY:1,frameInterval:5},"half-shield":{url:"half-shield.png",width:20,height:20,framesX:4,framesY:1,frameInterval:5},ship:{url:"ship.png",width:20,height:20,framesX:4,framesY:2,frameInterval:3},wall:{url:"wall.png",width:16,height:16},obstacle:{url:"obstacle.png",width:16,height:16},"obstacle-explosion":{url:"obstacle-explosion.png",width:16,height:16,framesX:4,framesY:1,frameInterval:5},"big-obstacle":{url:"big-obstacle.png",width:32,height:32},background:{url:"starry-background.png",width:450,height:160,centerX:0,centerY:0}}}},"./libs/renderend/src/logic/collision-logic.ts":(t,e,s)=>{s.r(e),s.d(e,{CollisionLogic:()=>r});var i=s("./libs/age/src/index.ts");class r{constructor(t,e,s,i){this.entities=t,this.position=e,this.rectangularSize=s,this.listeners=i}update(){for(const t of this.entities)for(const[e]of this.entities.with.rectangularSize)this.collides(t,e)&&this.notify(t,e)}collides(t,e){return t!==e&&i.Box.from(this.position.of(e),this.rectangularSize.of(e)).contains(this.position.of(t))}notify(t,e){for(const s of this.listeners)s.onCollision(t,e),s.onCollision(e,t)}}},"./libs/renderend/src/logic/damage-logic.ts":(t,e,s)=>{s.r(e),s.d(e,{DamageLogic:()=>i});class i{constructor(t,e,s){this.damage=t,this.health=e,this.setHealth=s}onCollision(t,e){var s,i;const r=null!==(s=this.damage.of(t))&&void 0!==s?s:0;if(0===r)return;const a=null!==(i=this.health.of(e))&&void 0!==i?i:null;null===a||a<0||this.setHealth.for(e,a-r)}}},"./libs/renderend/src/logic/death-logic.ts":(t,e,s)=>{s.r(e),s.d(e,{DeathLogic:()=>i});class i{constructor(t,e,s){this.entities=t,this.health=e,this.listeners=s}update(){for(const[t]of this.entities.with.health)this.health.currentlyOf(t)<=0&&this.kill(t)}kill(t){for(const e of this.listeners)e.onDeath(t);this.entities.remove(t)}}},"./libs/renderend/src/logic/difficulty-logic.ts":(t,e,s)=>{s.r(e),s.d(e,{DifficultyLogic:()=>i});class i{constructor(t){this.globals=t}update(){this.globals.isAlive&&(this.globals.speed+=2e-4)}}},"./libs/renderend/src/logic/game-over-logic.ts":(t,e,s)=>{s.r(e),s.d(e,{GameOverLogic:()=>i});class i{constructor(t,e){this.globals=t,this.shipBehaviour=e}onDeath(t){this.shipBehaviour.of(t)&&(this.globals.speed=0,this.globals.isAlive=!1)}}},"./libs/renderend/src/logic/move-ship-logic.ts":(t,e,s)=>{s.r(e),s.d(e,{MoveShipLogic:()=>a});var i=s("./libs/utility/src/index.ts"),r=s("./libs/renderend/src/state/renderend-action.ts");class a{constructor(t,e,s,i,r){this.constants=t,this.globals=e,this.entities=s,this.position=i,this.setVelocity=r}update(t){if(!this.globals.isAlive)return;this.globals.distanceTravelled+=this.globals.speed;const e=t.find((t=>t instanceof r.MoveShipAction));e?this.changeVelocity(e.velocity):this.changeVelocity(new i.Vector2(0,0))}changeVelocity(t){const e=t.lengthSquared()>1?t.unitVector().multiply(this.constants.maxVerticalSpeed):t.multiply(this.constants.maxVerticalSpeed);for(const[t]of this.entities.with.shipBehaviour){const s=this.position.of(t);s.x<1&&e.x<0&&e.set(0,e.y),s.x>10&&e.x>0&&e.set(0,e.y),this.setVelocity.for(t,e)}}}},"./libs/renderend/src/logic/obstacle-logic.ts":(t,e,s)=>{s.r(e),s.d(e,{ObstacleLogic:()=>r});var i=s("./libs/utility/src/index.ts");class r{constructor(t,e,s,i,r,a,n,o){this.constants=t,this.globals=e,this.entities=s,this.position=i,this.rectangularSize=r,this.setPosition=a,this.setVelocity=n,this.random=o}update(){for(const[t]of this.entities.with.obstacleBehaviour)this.shouldDespawn(t)?this.despawnObstacle(t):this.updateSpeed(t);for(;this.shouldSpawnWalls();)this.spawnNextWallSegment();this.shouldSpawnObstacle()&&this.spawnObstacle(),this.shouldSpawnAnnoyingObstacle()&&this.spawnAnnoyingObstacle()}shouldDespawn(t){return this.position.of(t).x<-1}despawnObstacle(t){this.entities.remove(t)}updateSpeed(t){this.setVelocity.for(t,new i.Vector2(-this.globals.speed,0))}shouldSpawnWalls(){return this.globals.lastWall<this.globals.distanceTravelled+20}spawnNextWallSegment(){this.globals.lastWall+=1;const t=this.globals.lastWall-this.globals.distanceTravelled;this.spawnWallsAt(t)}spawnWallsAt(t){const e=this.rectangularSize.defaultOf(this.constants.wallType);this.spawnWallAt(t,0,e),this.spawnWallAt(t,9,e),this.random.get.int(2)||(this.random.get.int(2)?this.spawnWallAt(t,1,e):this.spawnWallAt(t,8,e))}spawnWallAt(t,e,s){const r=this.entities.create(this.constants.wallType);this.setPosition.for(r,new i.Vector2(t+s.width/2,e+s.height/2)),this.setVelocity.for(r,new i.Vector2(-this.globals.speed,0))}shouldSpawnObstacle(){return!(!this.globals.isAlive||this.globals.lastWall<10||(this.globals.lastWall<100?this.globals.tick%20!=0:this.globals.lastWall<500?this.globals.tick%10!=0:this.globals.tick%7!=0))}spawnObstacle(){const t=this.random.get.in(this.constants.obstacleTypes),e=this.rectangularSize.defaultOf(t).height,s=this.entities.create(t);this.setPosition.for(s,new i.Vector2(20+this.random.get.float(2),1+this.random.get.float(7-e)+e)),this.setVelocity.for(s,new i.Vector2(-this.globals.speed,0))}shouldSpawnAnnoyingObstacle(){return this.globals.tick%105==0}spawnAnnoyingObstacle(){const t=this.random.get.in(this.constants.obstacleTypes),e=this.entities.create(t);this.setPosition.for(e,new i.Vector2(20+this.random.get.float(2),this.getShipHeight())),this.setVelocity.for(e,new i.Vector2(-this.globals.speed,0))}getShipHeight(){for(const[t]of this.entities.with.shipBehaviour)return this.position.of(t).y}}},"./libs/renderend/src/logic/start-logic.ts":(t,e,s)=>{s.r(e),s.d(e,{StartLogic:()=>a});var i=s("./libs/utility/src/index.ts"),r=s("./libs/renderend/src/state/renderend-action.ts");class a{constructor(t,e,s,i,r){this.constants=t,this.changes=e,this.globals=s,this.entities=i,this.setPosition=r}update(t){t.some((t=>t instanceof r.StartGameAction))&&this.initialiseGame()}initialiseGame(){this.clearMap(),this.resetGlobals(),this.spawnPlayerShip()}clearMap(){for(const[t,e]of this.changes.updatedEntityValues.entities)e&&this.entities.remove(t);this.entities.remove(...this.entities)}resetGlobals(){this.globals.isAlive=!0,this.globals.speed=.1,this.globals.distanceTravelled=0,this.globals.lastWall=-1}spawnPlayerShip(){const t=this.entities.create(this.constants.shipType);this.setPosition.for(t,new i.Vector2(1,5))}}},"./libs/renderend/src/logic/update-state-logic.ts":(t,e,s)=>{s.r(e),s.d(e,{UpdateStateLogic:()=>i});class i{constructor(t,e){this.state=t,this.entities=e}update(){this.state.globals.tick++,this.entities.applyUpdatedValues()}}},"./libs/renderend/src/logic/velocity-logic.ts":(t,e,s)=>{s.r(e),s.d(e,{VelocityLogic:()=>i});class i{constructor(t,e,s){this.entities=t,this.position=e,this.setPosition=s}update(){for(const[t,e]of this.entities.with.velocity)this.updateEntity(t,e)}updateEntity(t,e){if(e.isZero())return;const s=this.position.of(t);this.setPosition.for(t,s.add(e))}}},"./libs/renderend/src/renderend-config.ts":(t,e,s)=>{s.r(e),s.d(e,{RenderendConfig:()=>a});var i=s("./libs/age/src/index.ts"),r=s("./libs/renderend/src/renderend-constants.ts");class a{constructor(t,e,s){this.typeMap=t,this.typeValues=e,this.constants=s}static from(t,e){const s=Object.keys(e),n=i.TypeMap.from(s);return new a(n,new Map(s.map((t=>[n.typeIdFor(t),e[t]]))),new r.RenderendConstants(n.typeIdFor(t.shipType),n.typeIdFor(t.wallType),t.obstacleTypes.map((t=>n.typeIdFor(t)))))}}},"./libs/renderend/src/renderend-constants.ts":(t,e,s)=>{s.r(e),s.d(e,{RenderendConstants:()=>i});class i{constructor(t,e,s,i=.2,r=.1,a=.5){this.shipType=t,this.wallType=e,this.obstacleTypes=s,this.maxVerticalSpeed=i,this.minHorisontalSpeed=r,this.maxHorisontalSpeed=a}}},"./libs/renderend/src/renderend-display.ts":(t,e,s)=>{s.r(e),s.d(e,{RenderendDisplay:()=>n});var i=s("./libs/age/src/index.ts"),r=s("./libs/web-gl-display/src/index.ts"),a=s("./libs/utility/src/index.ts");class n{constructor(t,e,s){this.config=t,this.game=e,this.hostElement=s,this.textElements={},this.gameHeightInTiles=10,this.gamePixelsPerTile=16,this.screenPixelsPerTile=100,this.backgroundWidthInTiles=450/this.gamePixelsPerTile,this.fractionOfTick=0,this.displayEntities=[],this.initialiseCanvas(),this.setupDisplay()}get gameWidthInTiles(){return this.canvas.width/this.screenPixelsPerTile}initialiseCanvas(){this.hostElement.style.position="relative",this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.hostElement.appendChild(this.canvas)}setupDisplay(){this.display=new r.WebGl2Display(this.canvas,this.gamePixelsPerTile,this.gameHeightInTiles*this.gamePixelsPerTile);for(const[t,e]of Object.entries(this.config.sprites))this.display.addSprite(t,this.config.assetFolder+e.url,e.width,e.height,e.centerX,e.centerY);this.setupTextElements(),this.game.deathLogic.listeners.push(this)}setupTextElements(){this.setupDistanceText(),this.setupGameOverText()}setupDistanceText(){const t=this.getTextElement("distance");t.style.backgroundColor="rgba(0,0,0,0.5)",t.style.textAlign="center",t.style.color="white",t.style.left=this.screenPixelsFromTiles(this.gameWidthInTiles/2-1.5)+"px",t.style.top=this.screenPixelsFromTiles(9)+"px",t.style.fontSize=this.screenPixelsFromTiles(.5)+"px",t.style.width=this.screenPixelsFromTiles(3)+"px",t.style.lineHeight=this.screenPixelsFromTiles(1)+"px"}setupGameOverText(){const t=this.getTextElement("game-over");t.style.display="none",t.style.backgroundColor="rgba(0,0,0,0.5)",t.style.textAlign="center",t.style.color="white",t.style.left=this.screenPixelsFromTiles(this.gameWidthInTiles/2-3)+"px",t.style.top=this.screenPixelsFromTiles(4)+"px",t.style.fontSize=this.screenPixelsFromTiles(1)+"px",t.style.width=this.screenPixelsFromTiles(6)+"px",t.style.lineHeight=this.screenPixelsFromTiles(2)+"px",t.innerText="GAME OVER"}getTextElement(t){return this.textElements[t]||(this.textElements[t]=this.createTextElement()),this.textElements[t]}createTextElement(){const t=document.createElement("div");return t.style.position="absolute",t.style.fontFamily=`'${this.config.font}', Courier, monospace`,t.style.fontWeight="bold",this.canvas.parentElement.appendChild(t),t}onDeath(t){"obstacle"===this.game.config.typeMap.typeFor((0,i.typeOf)(t))&&this.displayEntities.push({sprite:"obstacle-explosion",position:this.game.entities.position.get.of(t),velocity:this.game.state.globals.isAlive?this.game.entities.velocity.get.of(t):new a.Vector2(0,0),endTick:this.game.state.globals.tick+20,animationStart:this.game.state.globals.tick,lastUpdate:this.game.state.globals.tick})}screenPixelsFromTiles(t){return this.screenPixelsPerTile*t}setSize(t,e){this.canvas.width=t,this.canvas.height=e,this.screenPixelsPerTile=e/this.gameHeightInTiles,this.setupDisplay()}show(t=0){if(!this.display.isLoading()){this.fractionOfTick=t,this.display.startFrame(),this.drawBackground();for(const t of this.game.entities)this.drawEntity(t);for(const t of this.displayEntities.values())this.drawDisplayEntity(t);this.display.endFrame(),this.writeText()}}drawBackground(){const t=this.backgroundBasePosition()%this.backgroundWidthInTiles;this.drawSprite("background",new a.Vector2(t,0)),this.drawSprite("background",new a.Vector2(t+this.backgroundWidthInTiles,0)),this.drawSprite("background",new a.Vector2(t+2*this.backgroundWidthInTiles,0))}backgroundBasePosition(){return.5*-this.game.state.globals.distanceTravelled-.5*this.game.state.globals.speed*this.fractionOfTick}drawEntity(t){(0,i.typeOf)(t)===this.game.config.constants.shipType?this.drawShip(t):this.drawGeneralEntity(t)}drawGeneralEntity(t){const e=this.currentPositionOf(t),s=this.game.config.typeMap.typeFor((0,i.typeOf)(t));this.drawSprite(s,e)}drawShip(t){const e=this.currentPositionOf(t),s=this.shieldSpriteFor(t);s&&this.drawSprite(s,e),this.drawSprite("ship",e)}shieldSpriteFor(t){switch(this.game.entities.health.get.of(t)){case 3:return"full-shield";case 2:return"half-shield"}}currentPositionOf(t){const e=this.game.entities.position.get.of(t),s=this.game.entities.velocity.get.of(t);return s?e.add(s.multiply(this.fractionOfTick)):e}drawDisplayEntity(t){t.lastUpdate!==this.game.state.globals.tick&&(t.position=t.position.add(t.velocity)),t.lastUpdate=this.game.state.globals.tick,this.game.state.globals.tick<t.endTick?this.drawSprite(t.sprite,t.position,t.animationStart):this.displayEntities.remove(t)}drawSprite(t,e,s=0){var i,r;const a=this.config.sprites[t];if(!a.frameInterval)return this.display.drawSprite(t,e.x,e.y,0,0);const n=null!==(i=a.framesX)&&void 0!==i?i:1,o=null!==(r=a.framesY)&&void 0!==r?r:1,l=n*o,h=this.game.state.globals.tick-s,c=Math.floor(h/a.frameInterval)%l,d=c%n,u=Math.floor(c/n)%o;this.display.drawSprite(t,e.x,e.y,d,u)}writeText(){this.showGameOver(),this.getTextElement("distance").innerText=""+Math.floor(this.game.state.globals.distanceTravelled)}showGameOver(){this.getTextElement("game-over").style.display=this.game.state.globals.isAlive?"none":"block"}}},"./libs/renderend/src/renderend-input.ts":(t,e,s)=>{s.r(e),s.d(e,{RenderendInput:()=>n});var i=s("./libs/age/src/index.ts"),r=s("./libs/utility/src/index.ts"),a=s("./libs/renderend/src/state/renderend-action.ts");class n extends i.BaseInput{constructor(t){super(),this.canvas=t,this.sizeScaling=4}parseInputs(t){return[this.getMoveAction(t),this.getRestartAction(t)]}getMoveAction(t){const e=this.stateFor(t,"Shift","Control","PadB")?.5:1,s=new r.Vector2(this.getVelocityX(t),this.getVelocityY(t)).multiply(e);if(!s.isZero())return new a.MoveShipAction(s)}getVelocityY(t){return this.stateFor(t,"w","ArrowUp","PadUp")?-1:this.stateFor(t,"s","ArrowDown","PadDown")?1:0}getVelocityX(t){return this.stateFor(t,"a","ArrowLeft","PadLeft")?-1:this.stateFor(t,"d","ArrowRight","PadRight")?1:0}getRestartAction(t){if(this.stateFor(t,"Enter","Escape","PadStart"))return new a.StartGameAction}clickCanvas(t){t.preventDefault();const{x:e,y:s}=this.gridPositionFromMousePosition(t);console.log("x: {0}, y: {1}",e,s)}gridPositionFromMousePosition(t){const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,i=t.clientY-e.top;return{x:s/this.sizeScaling,y:i/this.sizeScaling}}restart(){this.nextActions.push(new a.StartGameAction)}}},"./libs/renderend/src/renderend.ts":(t,e,s)=>{s.r(e),s.d(e,{Renderend:()=>w,RenderendRunner:()=>S});var i=s("./libs/age/src/index.ts"),r=s("./libs/renderend/src/defaults.ts"),a=s("./libs/renderend/src/logic/collision-logic.ts"),n=s("./libs/renderend/src/logic/damage-logic.ts"),o=s("./libs/renderend/src/logic/death-logic.ts"),l=s("./libs/renderend/src/logic/difficulty-logic.ts"),h=s("./libs/renderend/src/logic/game-over-logic.ts"),c=s("./libs/renderend/src/logic/move-ship-logic.ts"),d=s("./libs/renderend/src/logic/obstacle-logic.ts"),u=s("./libs/renderend/src/logic/start-logic.ts"),g=s("./libs/renderend/src/logic/update-state-logic.ts"),p=s("./libs/renderend/src/logic/velocity-logic.ts"),f=s("./libs/renderend/src/renderend-config.ts"),y=s("./libs/renderend/src/state/entity-values.ts"),m=s("./libs/renderend/src/state/globals.ts"),b=s("./libs/renderend/src/state/renderend-changes.ts"),v=s("./libs/renderend/src/state/renderend-entities.ts"),x=s("./libs/renderend/src/state/renderend-state.ts");class w extends i.BaseGame{constructor(t=f.RenderendConfig.from(r.defaultConstants,r.defaultValues),e=new x.RenderendState(new m.Globals,new y.EntityValues),s=new b.RenderendChanges(new y.EntityValues),w=new v.RenderendEntities(t.typeValues,e.entityValues,s.updatedEntityValues,e),S=new i.Random((()=>e.globals.seed+e.globals.tick))){super([new l.DifficultyLogic(e.globals),new c.MoveShipLogic(t.constants,e.globals,w,w.position.get,w.velocity.set),new a.CollisionLogic(w,w.position.get,w.rectangularSize.get,[new n.DamageLogic(w.damage.get,w.health.get,w.health.set)]),new d.ObstacleLogic(t.constants,e.globals,w,w.position.get,w.rectangularSize.get,w.position.set,w.velocity.set,S),new p.VelocityLogic(w,w.position.get,w.position.set),new o.DeathLogic(w,w.health.get,[new h.GameOverLogic(e.globals,w.shipBehaviour.get)]),new u.StartLogic(t.constants,s,e.globals,w,w.position.set),new g.UpdateStateLogic(e,w)]),this.config=t,this.state=e,this.changes=s,this.entities=w,this.random=S,this.deathLogic=this.logics[5]}}const S=i.GameRunner},"./libs/renderend/src/state/entity-values.ts":(t,e,s)=>{s.r(e),s.d(e,{EntityValues:()=>r});var i=s("./libs/age/src/index.ts");class r extends i.BaseValues{constructor(t=new Map,e=new Map,s=new Map,i=new Map,r=new Map,a=new Map,n=new Map,o=new Map,l=new Map,h=new Map){super(h),this.damage=t,this.health=e,this.orientation=s,this.position=i,this.rectangularSize=r,this.velocity=a,this.shipBehaviour=n,this.obstacleBehaviour=o,this.dieOnCollisionBehaviour=l,this.register(t),this.register(e),this.register(s),this.register(i),this.register(r),this.register(a),this.register(n),this.register(o),this.register(l)}static from(t){const e=new r;for(const[s,i]of t)e.addValuesFrom(s,i);return e}addValuesFrom(t,e){void 0!==e.damage&&this.damage.set(t,e.damage),void 0!==e.health&&this.health.set(t,e.health),void 0!==e.orientation&&this.orientation.set(t,e.orientation),void 0!==e.position&&this.position.set(t,e.position),void 0!==e.rectangularSize&&this.rectangularSize.set(t,e.rectangularSize),void 0!==e.velocity&&this.velocity.set(t,e.velocity),void 0!==e.shipBehaviour&&this.shipBehaviour.set(t,e.shipBehaviour),void 0!==e.obstacleBehaviour&&this.obstacleBehaviour.set(t,e.obstacleBehaviour),void 0!==e.dieOnCollisionBehaviour&&this.dieOnCollisionBehaviour.set(t,e.dieOnCollisionBehaviour)}groupFor(t){return{health:this.health.get(t),orientation:this.orientation.get(t),position:this.position.get(t),rectangularSize:this.rectangularSize.get(t),velocity:this.velocity.get(t),shipBehaviour:this.shipBehaviour.get(t),obstacleBehaviour:this.obstacleBehaviour.get(t),dieOnCollisionBehaviour:this.dieOnCollisionBehaviour.get(t)}}}},"./libs/renderend/src/state/globals.ts":(t,e,s)=>{s.r(e),s.d(e,{Globals:()=>i});class i{constructor(t=!0,e=.1,s=0,i=-1,r=0,a=1,n=1){this.isAlive=t,this.speed=e,this.distanceTravelled=s,this.lastWall=i,this.tick=r,this.nextId=a,this.seed=n}}},"./libs/renderend/src/state/renderend-action.ts":(t,e,s)=>{s.r(e),s.d(e,{MoveShipAction:()=>a,RenderendAction:()=>i,StartGameAction:()=>r});class i{}class r extends i{}class a extends i{constructor(t){super(),this.velocity=t}}},"./libs/renderend/src/state/renderend-changes.ts":(t,e,s)=>{s.r(e),s.d(e,{RenderendChanges:()=>i});class i{constructor(t){this.updatedEntityValues=t}}},"./libs/renderend/src/state/renderend-entities.ts":(t,e,s)=>{s.r(e),s.d(e,{RenderendEntities:()=>r});var i=s("./libs/age/src/index.ts");class r extends i.EntityManager{constructor(t,e,s,r,a=new i.ValueAccessBuilder(t,e,s),n=a.for((t=>t.damage),(t=>t.damage)),o=a.for((t=>t.health),(t=>t.health)),l=a.for((t=>t.orientation),(t=>t.orientation),0),h=a.for((t=>t.position),(t=>t.position)),c=a.for((t=>t.rectangularSize),(t=>t.rectangularSize)),d=a.for((t=>t.velocity),(t=>t.velocity)),u=a.for((t=>t.shipBehaviour),(t=>t.shipBehaviour)),g=a.for((t=>t.obstacleBehaviour),(t=>t.obstacleBehaviour)),p=a.for((t=>t.dieOnCollisionBehaviour),(t=>t.dieOnCollisionBehaviour))){super(e,s,r),this.damage=n,this.health=o,this.orientation=l,this.position=h,this.rectangularSize=c,this.velocity=d,this.shipBehaviour=u,this.obstacleBehaviour=g,this.dieOnCollisionBehaviour=p,this.valueAccessors.push(n,o,l,h,c,d,u,g,p)}}},"./libs/renderend/src/state/renderend-state.ts":(t,e,s)=>{s.r(e),s.d(e,{RenderendState:()=>i});class i{constructor(t,e){this.globals=t,this.entityValues=e}getNewId(){return this.globals.nextId++}}},"./libs/utility/src/array-extensions.ts":(t,e,s)=>{s.r(e),Object.defineProperty(Array.prototype,"sum",{value:function(){return this.reduce(((t,e)=>t+ +e),0)}}),Object.defineProperty(Array.prototype,"max",{value:function(){if(!this.length)throw new Error("Cannot find the max value in an empty array");return this.reduce(((t,e)=>t>e?t:e))}}),Object.defineProperty(Array.prototype,"min",{value:function(){if(!this.length)throw new Error("Cannot find the min value in an empty array");return this.reduce(((t,e)=>t<e?t:e))}}),Object.defineProperty(Array.prototype,"clear",{value:function(){return this.splice(0,this.length)}}),Object.defineProperty(Array.prototype,"first",{value:function(){return this[0]}}),Object.defineProperty(Array.prototype,"last",{value:function(){return this[this.length-1]}}),Object.defineProperty(Array.prototype,"distinct",{value:function(){return this.filter(((t,e)=>this.indexOf(t)===e))}}),Object.defineProperty(Array.prototype,"distinctBy",{value:function(t){return this.filter(((e,s)=>{const i=t(e);return this.findIndex((e=>t(e)===i))===s}))}}),Object.defineProperty(Array.prototype,"sortBy",{value:function(t,e=!0){return this.sort(((s,i)=>{let r=t(s);"string"==typeof r&&(r=r.toLowerCase());let a=t(i);return"string"==typeof a&&(a=a.toLowerCase()),r>a?e?1:-1:r<a?e?-1:1:0}))}}),Object.defineProperty(Array.prototype,"includesAny",{value:function(t){return this.some((e=>t.includes(e)))}}),Object.defineProperty(Array.prototype,"groupBy",{value:function(t){const e=[];for(const s of this){const i=t(s);let r=e.find((t=>t.group===i));r||(r={group:i,entries:[]},e.push(r)),r.entries.push(s)}return e}}),Object.defineProperty(Array.prototype,"remove",{value:function(t){const e=this.indexOf(t);return e>=0&&(this.splice(e,1),!0)}}),Object.defineProperty(Array.prototype,"findAndRemove",{value:function(t){const e=this.findIndex(t);return e>=0&&(this.splice(e,1),!0)}}),Object.defineProperty(Array.prototype,"removeBy",{value:function(t){const e=[];for(let s=0;s<this.length;s++)t(this[s])&&(e.push(...this.splice(s,1)),s--);return e}})},"./libs/utility/src/index.ts":(t,e,s)=>{s.r(e),s.d(e,{KeyStates:()=>i.KeyStates,Vector2:()=>a.Vector2,clip:()=>r.clip,hexEastOf:()=>r.hexEastOf,hexNorthEastOf:()=>r.hexNorthEastOf,hexNorthWestOf:()=>r.hexNorthWestOf,hexSouthEastOf:()=>r.hexSouthEastOf,hexSouthWestOf:()=>r.hexSouthWestOf,hexWestOf:()=>r.hexWestOf,hexesAdjacentTo:()=>r.hexesAdjacentTo,randomInt:()=>r.randomInt,randomIntBelow:()=>r.randomIntBelow,randomNumber:()=>r.randomNumber,randomNumberBelow:()=>r.randomNumberBelow,range:()=>r.range}),s("./libs/utility/src/array-extensions.ts");var i=s("./libs/utility/src/key-states.ts"),r=s("./libs/utility/src/utility.ts"),a=s("./libs/utility/src/vector2.ts");s("./libs/utility/src/vector3.ts")},"./libs/utility/src/key-states.ts":(t,e,s)=>{s.r(e),s.d(e,{KeyStates:()=>i});class i{constructor(t={},e={},s={},i={},r={}){this.onDown=t,this.onUp=e,this.isPressed=s,this.inputChanges=i,this.pollableState=r,window.addEventListener("keydown",(e=>{var i;s[e.key]||(this.isPressed[e.key]=!0,this.inputChanges[e.key]=!0,this.updateStateFor(e.key,!0),null===(i=t[e.key])||void 0===i||i.call(t,e.key))})),window.addEventListener("keyup",(t=>{var i;s[t.key]&&(this.isPressed[t.key]=!1,this.updateStateFor(t.key,!1),this.wasPressedSinceLastRequest(t.key)||(this.inputChanges[t.key]=!1),null===(i=e[t.key])||void 0===i||i.call(e,t.key))}))}updateStateFor(t,e){if(!this.pollableState[t])return this.pollableState[t]={hasChanged:!0,state:e};this.pollableState[t].hasChanged||(this.pollableState[t].hasChanged=!0,this.pollableState[t].state=e)}wasPressedSinceLastRequest(t){return this.inputChanges[t]}getInputChanges(){const t=this.inputChanges,e={};for(const t in this.inputChanges)this.hasAlreadyBeenUnpressed(t)&&(e[t]=!1);return this.inputChanges=e,t}getInputState(){this.updateGamePadStates();const t=Object.assign({},this.pollableState);for(const t in this.pollableState){const e=this.isPressed[t],s=e!==this.pollableState[t].state;this.pollableState[t]={hasChanged:s,state:e}}return t}hasAlreadyBeenUnpressed(t){return this.inputChanges[t]&&!this.isPressed[t]}updateGamePadStates(){var t;const e=null===(t=navigator.getGamepads())||void 0===t?void 0:t[0];e&&(this.pollableState.PadUp=e.axes[9]<-.7||.8<e.axes[9]&&e.axes[9]<1.1?{hasChanged:!0,state:!0}:{hasChanged:!0,state:!1},this.pollableState.PadRight=-.8<e.axes[9]&&e.axes[9]<0?{hasChanged:!0,state:!0}:{hasChanged:!0,state:!1},this.pollableState.PadDown=-.2<e.axes[9]&&e.axes[9]<.5?{hasChanged:!0,state:!0}:{hasChanged:!0,state:!1},this.pollableState.PadLeft=.4<e.axes[9]&&e.axes[9]<1.1?{hasChanged:!0,state:!0}:{hasChanged:!0,state:!1},this.pollableState.PadStart={hasChanged:!0,state:e.buttons[9].pressed},this.pollableState.PadA={hasChanged:!0,state:e.buttons[1].pressed},this.pollableState.PadB={hasChanged:!0,state:e.buttons[0].pressed},this.pollableState.PadX={hasChanged:!0,state:e.buttons[3].pressed},this.pollableState.PadY={hasChanged:!0,state:e.buttons[2].pressed})}}},"./libs/utility/src/utility.ts":(t,e,s)=>{function*i(t,e){for(let s=t;s<e;s++)yield s}function r(t,e,s,i=!1){if(s<=e)throw"Error";if(!i)return t<e?t=e:s<=t&&(t=s),t;for(;t<e;)t+=s-e;for(;s<=t;)t-=s-e;return t}function a(t,e){return[n(t,e),o(t,e),l(t,e),h(t,e),c(t,e),d(t,e)]}function n(t,e,s=1){const i=(e+s)%2==0?-1:0;return{x:t-Math.floor(s/2)+i,y:e-s}}function o(t,e,s=1){const i=(e+s)%2==0?0:1;return{x:t+Math.floor(s/2)+i,y:e-s}}function l(t,e,s=1){return{x:t-s,y:e}}function h(t,e,s=1){return{x:t+s,y:e}}function c(t,e,s=1){const i=(e+s)%2==0?-1:0;return{x:t-Math.floor(s/2)+i,y:e+s}}function d(t,e,s=1){const i=(e+s)%2==0?0:1;return{x:t+Math.floor(s/2)+i,y:e+s}}function u(t,e){return Math.floor(Math.random()*(e-t)+t)}function g(t){return Math.floor(Math.random()*t)}function p(t,e){return Math.random()*(e-t)+t}function f(t){return Math.random()*t}s.r(e),s.d(e,{clip:()=>r,hexEastOf:()=>h,hexNorthEastOf:()=>o,hexNorthWestOf:()=>n,hexSouthEastOf:()=>d,hexSouthWestOf:()=>c,hexWestOf:()=>l,hexesAdjacentTo:()=>a,randomInt:()=>u,randomIntBelow:()=>g,randomNumber:()=>p,randomNumberBelow:()=>f,range:()=>i})},"./libs/utility/src/vector2.ts":(t,e,s)=>{s.r(e),s.d(e,{Vector2:()=>r});var i=s("./libs/utility/src/utility.ts");class r{constructor(t,e){this.x=t,this.y=e}static fromAngle(t){return new r(1,0).rotate(t)}add(t){return new r(this.x+t.x,this.y+t.y)}subtract(t){return new r(this.x-t.x,this.y-t.y)}multiply(t){return new r(this.x*t,this.y*t)}rotate(t){return new r(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t))}angle(){return Math.atan2(this.y,this.x)}lengthSquared(){return this.x*this.x+this.y*this.y}unitVector(){const t=this.length();return 0===t?new r(0,0):new r(this.x/t,this.y/t)}length(){return 0===this.x||0===this.y?this.x+this.y:Math.sqrt(this.lengthSquared())}copy(){return new r(this.x,this.y)}clip(t,e,s,a,n=!1){return new r((0,i.clip)(this.x,t,s,n),(0,i.clip)(this.y,e,a,n))}set(t,e){this.x=t,this.y=e}isZero(){return 0===this.x&&0===this.y}}},"./libs/utility/src/vector3.ts":(t,e,s)=>{s.r(e)},"./libs/web-gl-display/src/generic-shader.ts":(t,e,s)=>{s.r(e),s.d(e,{GenericShader:()=>i});class i{constructor(t,e,s){this.gl=t;const i=this.getShader(e,t.VERTEX_SHADER),r=this.getShader(s,t.FRAGMENT_SHADER);this.program=this.createProgram(i,r),t.deleteShader(i),t.deleteShader(r)}getShader(t,e){const s=this.gl.createShader(e);if(this.gl.shaderSource(s,t),this.gl.compileShader(s),!this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS))throw new Error("Shader error: "+this.gl.getShaderInfoLog(s));return s}createProgram(t,e){const s=this.gl.createProgram();if(this.gl.attachShader(s,t),this.gl.attachShader(s,e),this.gl.linkProgram(s),!this.gl.getProgramParameter(s,this.gl.LINK_STATUS))throw new Error("Shader program error: "+this.gl.getProgramInfoLog(s));return this.gl.detachShader(s,t),this.gl.detachShader(s,e),this.gl.useProgram(null),s}}},"./libs/web-gl-display/src/index.ts":(t,e,s)=>{s.r(e),s.d(e,{WebGl2Display:()=>i.WebGl2Display});var i=s("./libs/web-gl-display/src/web-gl-display.ts")},"./libs/web-gl-display/src/m3x3.ts":(t,e,s)=>{s.r(e),s.d(e,{M3x3:()=>i});class i{constructor(t=[1,0,0,0,1,0,0,0,1]){this.matrix=t}multiply(t){const e=new i;return e.matrix=[this.matrix[0]*t.matrix[0]+this.matrix[3]*t.matrix[1]+this.matrix[6]*t.matrix[2],this.matrix[1]*t.matrix[0]+this.matrix[4]*t.matrix[1]+this.matrix[7]*t.matrix[2],this.matrix[2]*t.matrix[0]+this.matrix[5]*t.matrix[1]+this.matrix[8]*t.matrix[2],this.matrix[0]*t.matrix[3]+this.matrix[3]*t.matrix[4]+this.matrix[6]*t.matrix[5],this.matrix[1]*t.matrix[3]+this.matrix[4]*t.matrix[4]+this.matrix[7]*t.matrix[5],this.matrix[2]*t.matrix[3]+this.matrix[5]*t.matrix[4]+this.matrix[8]*t.matrix[5],this.matrix[0]*t.matrix[6]+this.matrix[3]*t.matrix[7]+this.matrix[6]*t.matrix[8],this.matrix[1]*t.matrix[6]+this.matrix[4]*t.matrix[7]+this.matrix[7]*t.matrix[8],this.matrix[2]*t.matrix[6]+this.matrix[5]*t.matrix[7]+this.matrix[8]*t.matrix[8]],e}transition(t,e){const s=new i;return s.matrix=[this.matrix[0],this.matrix[1],this.matrix[2],this.matrix[3],this.matrix[4],this.matrix[5],t*this.matrix[0]+e*this.matrix[3]+this.matrix[6],t*this.matrix[1]+e*this.matrix[4]+this.matrix[7],t*this.matrix[2]+e*this.matrix[5]+this.matrix[8]],s}scale(t,e){const s=new i;return s.matrix=[this.matrix[0]*t,this.matrix[1]*t,this.matrix[2]*t,this.matrix[3]*e,this.matrix[4]*e,this.matrix[5]*e,this.matrix[6],this.matrix[7],this.matrix[8]],s}getFloatArray(){return new Float32Array(this.matrix)}}},"./libs/web-gl-display/src/sprite-factory.ts":(t,e,s)=>{s.r(e),s.d(e,{SpriteFactory:()=>a});var i=s("./node_modules/tslib/tslib.es6.js"),r=s("./libs/web-gl-display/src/sprite.ts");class a{constructor(t,e,s,i){this.gl=t,this.shader=e,this.tileSize=s,this.worldSpaceMatrix=i}createSprite(t,e,s,a,n){return(0,i.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.loadImage(t),o=e/i.width,l=s/i.height;this.gl.useProgram(this.shader.program);const h=this.createTexture(i),c=this.createTextureBuffer(o,l),d=this.createGeometryBuffer(e,s);return this.gl.useProgram(null),new r.Sprite(this.gl,this.shader,this.tileSize,this.worldSpaceMatrix,h,c,d,a,n,o,l)}))}loadImage(t){return new Promise((e=>{const s=new Image;s.onload=()=>e(s),s.src=t}))}createTexture(t){const e=this.gl,s=e.createTexture();return e.bindTexture(e.TEXTURE_2D,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.bindTexture(e.TEXTURE_2D,null),s}createTextureBuffer(t,e){const s=this.gl,i=s.createBuffer();return s.bindBuffer(s.ARRAY_BUFFER,i),s.bufferData(s.ARRAY_BUFFER,this.createRectArray(0,0,t,e),s.STATIC_DRAW),i}createGeometryBuffer(t,e){const s=this.gl,i=s.createBuffer();return s.bindBuffer(s.ARRAY_BUFFER,i),s.bufferData(s.ARRAY_BUFFER,this.createRectArray(0,0,t,e),s.STATIC_DRAW),i}createRectArray(t=0,e=0,s=1,i=1){return new Float32Array([t,e,t+s,e,t,e+i,t,e+i,t+s,e,t+s,e+i])}}},"./libs/web-gl-display/src/sprite.ts":(t,e,s)=>{s.r(e),s.d(e,{Sprite:()=>r});var i=s("./libs/web-gl-display/src/m3x3.ts");class r{constructor(t,e,s,i,r,a,n,o,l,h,c){this.gl=t,this.shader=e,this.tileSize=s,this.worldSpaceMatrix=i,this.texture=r,this.textureBuffer=a,this.geometryBuffer=n,this.centerX=o,this.centerY=l,this.uvX=h,this.uvY=c}render(t,e,s=0,r=0){const a=this.gl;a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.texture),a.uniform1i(this.shader.uImageLocation,0),a.bindBuffer(a.ARRAY_BUFFER,this.textureBuffer),a.enableVertexAttribArray(this.shader.aTexCoordLocation),a.vertexAttribPointer(this.shader.aTexCoordLocation,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.geometryBuffer),a.enableVertexAttribArray(this.shader.aPositionLocation),a.vertexAttribPointer(this.shader.aPositionLocation,2,a.FLOAT,!1,0,0);const n=s*this.uvX,o=r*this.uvY,l=(new i.M3x3).transition(t*this.tileSize-this.centerX,e*this.tileSize-this.centerY);a.uniform2f(this.shader.uFrameLocation,n,o),a.uniformMatrix3fv(this.shader.uWorldLocation,!1,this.worldSpaceMatrix.getFloatArray()),a.uniformMatrix3fv(this.shader.uObjectLocation,!1,l.getFloatArray()),a.drawArrays(a.TRIANGLE_STRIP,0,6)}}},"./libs/web-gl-display/src/standard-shader.ts":(t,e,s)=>{s.r(e),s.d(e,{StandardShader:()=>r});var i=s("./libs/web-gl-display/src/generic-shader.ts");class r extends i.GenericShader{constructor(t,e,s,i,r,a,n){super(t,"\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nuniform mat3 uWorld;\nuniform mat3 uObject;\nuniform vec2 uFrame;\nvoid main(void) {\ngl_Position = vec4(uWorld * uObject * vec3(aPosition, 1), 1);\nvTexCoord = aTexCoord + uFrame;\n}","\nprecision mediump float;\nuniform sampler2D uImage;\nvarying vec2 vTexCoord;\nvoid main(void) {\ngl_FragColor = texture2D(uImage, vTexCoord);\n}"),this.aPositionLocation=e,this.aTexCoordLocation=s,this.uImageLocation=i,this.uWorldLocation=r,this.uObjectLocation=a,this.uFrameLocation=n,this.aPositionLocation=t.getAttribLocation(this.program,"aPosition"),this.aTexCoordLocation=t.getAttribLocation(this.program,"aTexCoord"),this.uImageLocation=t.getUniformLocation(this.program,"uImage"),this.uWorldLocation=t.getUniformLocation(this.program,"uWorld"),this.uObjectLocation=t.getUniformLocation(this.program,"uObject"),this.uFrameLocation=t.getUniformLocation(this.program,"uFrame")}}},"./libs/web-gl-display/src/web-gl-display.ts":(t,e,s)=>{s.r(e),s.d(e,{WebGl2Display:()=>o});var i=s("./node_modules/tslib/tslib.es6.js"),r=s("./libs/web-gl-display/src/m3x3.ts"),a=s("./libs/web-gl-display/src/sprite-factory.ts"),n=s("./libs/web-gl-display/src/standard-shader.ts");class o{constructor(t,e,s,i=t.getContext("webgl2"),r=new n.StandardShader(i),o=null,h=l(t.width,t.height,s),c=new a.SpriteFactory(i,r,e,h),d={},u=[]){this.canvas=t,this.tileSize=e,this.virtualScreenHeight=s,this.gl=i,this.standardShader=r,this.previousProgram=o,this.worldSpaceMatrix=h,this.spriteFactory=c,this.sprites=d,this.loadingSprites=u,this.gl.enable(this.gl.BLEND)}startFrame(){this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)}drawSprite(t,e,s,i,r){const a=this.sprites[t];if(!a)return console.warn("Could not load sprite {0}",t);this.previousProgram!=a.shader.program&&(this.gl.useProgram(a.shader.program),this.previousProgram=a.shader.program),a.render(e,s,i,r)}endFrame(){this.previousProgram=null,this.gl.useProgram(null),this.gl.flush()}resize(t,e){this.canvas.width=t,this.canvas.height=e,this.worldSpaceMatrix=l(t,e,this.virtualScreenHeight),this.spriteFactory=new a.SpriteFactory(this.gl,this.standardShader,this.tileSize,this.worldSpaceMatrix)}addSprite(t,e,s=16,r=16,a=s/2,n=r/2){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this.loadingSprites.push(t),this.sprites[t]=yield this.spriteFactory.createSprite(e,s,r,a,n),this.loadingSprites.splice(this.loadingSprites.indexOf(t),1)}))}isLoading(){return this.loadingSprites.length>0}}function l(t,e,s){const i=t/(e/s);return(new r.M3x3).transition(-1,1).scale(2/i,-2/s)}},"./node_modules/tslib/tslib.es6.js":(t,e,s)=>{s.r(e),s.d(e,{__assign:()=>a,__asyncDelegator:()=>w,__asyncGenerator:()=>x,__asyncValues:()=>S,__await:()=>v,__awaiter:()=>c,__classPrivateFieldGet:()=>O,__classPrivateFieldIn:()=>R,__classPrivateFieldSet:()=>V,__createBinding:()=>u,__decorate:()=>o,__exportStar:()=>g,__extends:()=>r,__generator:()=>d,__importDefault:()=>E,__importStar:()=>A,__makeTemplateObject:()=>T,__metadata:()=>h,__param:()=>l,__read:()=>f,__rest:()=>n,__spread:()=>y,__spreadArray:()=>b,__spreadArrays:()=>m,__values:()=>p});var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},i(t,e)};function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function s(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}var a=function(){return a=Object.assign||function(t){for(var e,s=1,i=arguments.length;s<i;s++)for(var r in e=arguments[s])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},a.apply(this,arguments)};function n(t,e){var s={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(s[i[r]]=t[i[r]])}return s}function o(t,e,s,i){var r,a=arguments.length,n=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,s,i);else for(var o=t.length-1;o>=0;o--)(r=t[o])&&(n=(a<3?r(n):a>3?r(e,s,n):r(e,s))||n);return a>3&&n&&Object.defineProperty(e,s,n),n}function l(t,e){return function(s,i){e(s,i,t)}}function h(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,s,i){return new(s||(s=Promise))((function(r,a){function n(t){try{l(i.next(t))}catch(t){a(t)}}function o(t){try{l(i.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(n,o)}l((i=i.apply(t,e||[])).next())}))}function d(t,e){var s,i,r,a,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(s)throw new TypeError("Generator is already executing.");for(;n;)try{if(s=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(!((r=(r=n.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){n=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){n.label=a[1];break}if(6===a[0]&&n.label<r[1]){n.label=r[1],r=a;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(a);break}r[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(t){a=[6,t],i=0}finally{s=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}var u=Object.create?function(t,e,s,i){void 0===i&&(i=s);var r=Object.getOwnPropertyDescriptor(e,s);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,i,r)}:function(t,e,s,i){void 0===i&&(i=s),t[i]=e[s]};function g(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||u(e,t,s)}function p(t){var e="function"==typeof Symbol&&Symbol.iterator,s=e&&t[e],i=0;if(s)return s.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function f(t,e){var s="function"==typeof Symbol&&t[Symbol.iterator];if(!s)return t;var i,r,a=s.call(t),n=[];try{for(;(void 0===e||e-- >0)&&!(i=a.next()).done;)n.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(s=a.return)&&s.call(a)}finally{if(r)throw r.error}}return n}function y(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(f(arguments[e]));return t}function m(){for(var t=0,e=0,s=arguments.length;e<s;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<s;e++)for(var a=arguments[e],n=0,o=a.length;n<o;n++,r++)i[r]=a[n];return i}function b(t,e,s){if(s||2===arguments.length)for(var i,r=0,a=e.length;r<a;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}function v(t){return this instanceof v?(this.v=t,this):new v(t)}function x(t,e,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=s.apply(t,e||[]),a=[];return i={},n("next"),n("throw"),n("return"),i[Symbol.asyncIterator]=function(){return this},i;function n(t){r[t]&&(i[t]=function(e){return new Promise((function(s,i){a.push([t,e,s,i])>1||o(t,e)}))})}function o(t,e){try{(s=r[t](e)).value instanceof v?Promise.resolve(s.value.v).then(l,h):c(a[0][2],s)}catch(t){c(a[0][3],t)}var s}function l(t){o("next",t)}function h(t){o("throw",t)}function c(t,e){t(e),a.shift(),a.length&&o(a[0][0],a[0][1])}}function w(t){var e,s;return e={},i("next"),i("throw",(function(t){throw t})),i("return"),e[Symbol.iterator]=function(){return this},e;function i(i,r){e[i]=t[i]?function(e){return(s=!s)?{value:v(t[i](e)),done:"return"===i}:r?r(e):e}:r}}function S(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,s=t[Symbol.asyncIterator];return s?s.call(t):(t=p(t),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(s){e[s]=t[s]&&function(e){return new Promise((function(i,r){!function(t,e,s,i){Promise.resolve(i).then((function(e){t({value:e,done:s})}),e)}(i,r,(e=t[s](e)).done,e.value)}))}}}function T(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var P=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e};function A(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)"default"!==s&&Object.prototype.hasOwnProperty.call(t,s)&&u(e,t,s);return P(e,t),e}function E(t){return t&&t.__esModule?t:{default:t}}function O(t,e,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(t):i?i.value:e.get(t)}function V(t,e,s,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(t,s):r?r.value=s:e.set(t,s),s}function R(t,e){if(null===e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof t?e===t:t.has(e)}}},e={};function s(i){var r=e[i];if(void 0!==r)return r.exports;var a=e[i]={exports:{}};return t[i](a,a.exports,s),a.exports}s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};return(()=>{s.r(i),s.d(i,{MoveShipAction:()=>n.MoveShipAction,Renderend:()=>e.Renderend,RenderendAction:()=>n.RenderendAction,RenderendDisplay:()=>r.RenderendDisplay,RenderendInput:()=>a.RenderendInput,RenderendRunner:()=>e.RenderendRunner,StartGameAction:()=>n.StartGameAction,defaultConstants:()=>t.defaultConstants,defaultDisplayConfig:()=>t.defaultDisplayConfig,defaultValues:()=>t.defaultValues});var t=s("./libs/renderend/src/defaults.ts"),e=s("./libs/renderend/src/renderend.ts"),r=s("./libs/renderend/src/renderend-display.ts"),a=s("./libs/renderend/src/renderend-input.ts"),n=s("./libs/renderend/src/state/renderend-action.ts")})(),i})()));