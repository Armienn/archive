!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var s=e();for(var i in s)("object"==typeof exports?exports:t)[i]=s[i]}}(self,(()=>(()=>{"use strict";var t={"./libs/age/src/age.ts":(t,e,s)=>{s.r(e),s.d(e,{AgEngine:()=>i});class i{constructor(t,e,s){this.logics=t,this.validators=e,this.state=s}update(...t){return this.validate(t)||(this.performLogic(t),{isValid:!0,problems:[]})}validate(t){for(const e of this.validators){const s=e.validate(t);if(!s.isValid)return s}}performLogic(t){var e,s;this.state.tick++;for(const e of this.logics)e.update(t);null===(s=(e=this.state).finishUpdate)||void 0===s||s.call(e)}}},"./libs/age/src/base-game.ts":(t,e,s)=>{s.r(e),s.d(e,{BaseGame:()=>i});class i{constructor(t,e=[]){this.logics=t,this.validators=e}update(...t){return this.validate(t)||(this.performLogic(t),{isValid:!0,problems:[]})}validate(t){for(const e of this.validators){const s=e.validate(t);if(!s.isValid)return s}}performLogic(t){for(const e of this.logics)e.update(t);this.finishUpdate()}}},"./libs/age/src/index.ts":(t,e,s)=>{s.r(e),s.d(e,{AgEngine:()=>i.AgEngine,BaseChanges:()=>o.BaseChanges,BaseConfig:()=>l.BaseConfig,BaseGame:()=>r.BaseGame,BaseGlobals:()=>c.BaseGlobals,BaseState:()=>h.BaseState,BaseValues:()=>d.BaseValues,BlockChunk:()=>u.BlockChunk,EntityManager:()=>g.EntityManager,GameGrid:()=>p.GameGrid,GameGrid3d:()=>f.GameGrid3d,Random:()=>n.Random,RandomAi:()=>a.RandomAi,TerrainCollection:()=>y.TerrainCollection,TypeMap:()=>b.TypeMap,ValueAccessor:()=>m.ValueAccessor,typeMask:()=>l.typeMask,typeOf:()=>l.typeOf,typeOffset:()=>l.typeOffset});var i=s("./libs/age/src/age.ts"),r=s("./libs/age/src/base-game.ts"),a=s("./libs/age/src/interfaces/game-ai.ts"),n=(s("./libs/age/src/interfaces/game-logic.ts"),s("./libs/age/src/interfaces/game-state.ts"),s("./libs/age/src/interfaces/game-validator.ts"),s("./libs/age/src/services/random.ts")),o=s("./libs/age/src/state/base-changes.ts"),l=s("./libs/age/src/state/base-config.ts"),c=s("./libs/age/src/state/base-globals.ts"),h=s("./libs/age/src/state/base-state.ts"),d=s("./libs/age/src/state/base-values.ts"),u=s("./libs/age/src/state/block-chunk.ts"),g=s("./libs/age/src/state/entity-manager.ts"),p=s("./libs/age/src/state/game-grid.ts"),f=s("./libs/age/src/state/game-grid-3d.ts"),y=s("./libs/age/src/state/terrain-collection.ts"),b=s("./libs/age/src/state/type-map.ts"),m=s("./libs/age/src/state/value-accessor.ts")},"./libs/age/src/interfaces/game-ai.ts":(t,e,s)=>{s.r(e),s.d(e,{RandomAi:()=>i});class i{constructor(t){this.possibleActionsFor=t}requestActions(t){const e=this.possibleActionsFor(t);return[e[Math.floor(Math.random()*e.length)]]}}},"./libs/age/src/interfaces/game-logic.ts":(t,e,s)=>{s.r(e)},"./libs/age/src/interfaces/game-state.ts":(t,e,s)=>{s.r(e)},"./libs/age/src/interfaces/game-validator.ts":(t,e,s)=>{s.r(e)},"./libs/age/src/services/random.ts":(t,e,s)=>{s.r(e),s.d(e,{Random:()=>i});class i{constructor(t,e=-1,s=new r(-1)){this.globals=t,this.previousTick=e,this.generator=s}get get(){return this.previousTick===this.globals.tick||(this.previousTick=this.globals.tick,this.generator=new r(this.globals.seed+this.globals.tick)),this.generator}}class r{constructor(t){this.seed=t}int(t){return Math.floor(Math.random()*t)}float(t){return Math.random()*t}in(t){return t[this.int(t.length)]}}},"./libs/age/src/state/base-changes.ts":(t,e,s)=>{s.r(e),s.d(e,{BaseChanges:()=>i});class i{constructor(t,e=[],s=[]){this.updatedEntityValues=t,this.createdEntities=e,this.removedEntities=s}}},"./libs/age/src/state/base-config.ts":(t,e,s)=>{s.r(e),s.d(e,{BaseConfig:()=>n,typeMask:()=>i,typeOf:()=>a,typeOffset:()=>r});const i=4278190080,r=24;function a(t){return t&i}class n{constructor(t,e){this.typeValues=t,this.typeBehaviours=e}}},"./libs/age/src/state/base-globals.ts":(t,e,s)=>{s.r(e),s.d(e,{BaseGlobals:()=>i});class i{constructor(t=0,e=1,s=1){this.tick=t,this.nextId=e,this.seed=s}}},"./libs/age/src/state/base-state.ts":(t,e,s)=>{s.r(e),s.d(e,{BaseState:()=>i});class i{constructor(t,e,s,i=[]){this.globals=t,this.terrain=e,this.entityValues=s,this.entities=i}}},"./libs/age/src/state/base-values.ts":(t,e,s)=>{s.r(e),s.d(e,{BaseValues:()=>i});class i{constructor(){this.allValueMaps=[]}register(t){return this.allValueMaps.push(t),t}clear(){for(const t of this.allValueMaps)t.clear()}removeValuesFor(t){for(const e of this.allValueMaps)e.delete(t)}addValuesFromOther(t){for(let e=0;e<this.allValueMaps.length;e++)for(const[s,i]of t.allValueMaps[e])this.allValueMaps[e].set(s,i)}}},"./libs/age/src/state/block-chunk.ts":(t,e,s)=>{s.r(e),s.d(e,{BlockChunk:()=>i});class i{constructor(t,e={x:0,y:0,z:0}){this.blocks=t,this.offset=e}get(t,e,s){return this.blocks.get(t-this.offset.x,e-this.offset.y,s-this.offset.z)}}},"./libs/age/src/state/entity-manager.ts":(t,e,s)=>{s.r(e),s.d(e,{EntityManager:()=>r});var i=s("./libs/age/src/state/base-config.ts");class r{constructor(t,e,s,i=new Map){this.config=t,this.state=e,this.changes=s,this.behaviourLists=i,this.setupBehaviours()}setupBehaviours(){for(const t of this.config.typeBehaviours.values())for(const e of t)this.behaviourLists.set(e,[])}with(t){return this.behaviourLists.has(t)?this.behaviourLists.get(t):[]}create(t){const e=this.state.globals.nextId|t;return this.state.globals.nextId++,this.changes.createdEntities.push(e),e}remove(...t){this.changes.removedEntities.push(...t)}applyUpdatedValues(){this.state.entityValues.addValuesFromOther(this.changes.updatedEntityValues),this.changes.updatedEntityValues.clear();for(const t of this.changes.createdEntities)this.add(t);for(const t of this.changes.removedEntities)this.fullyRemove(t);this.changes.createdEntities.clear(),this.changes.removedEntities.clear()}add(t){this.state.entities.push(t);for(const e of this.config.typeBehaviours.get((0,i.typeOf)(t)))this.behaviourLists.get(e).push(t)}fullyRemove(t){this.state.entities.remove(t),this.changes.createdEntities.remove(t),this.state.entityValues.removeValuesFor(t),this.changes.updatedEntityValues.removeValuesFor(t);for(const e of this.config.typeBehaviours.get((0,i.typeOf)(t)))this.behaviourLists.get(e).remove(t)}*[Symbol.iterator](){for(const t of this.state.entities)yield t}}},"./libs/age/src/state/game-grid-3d.ts":(t,e,s)=>{s.r(e),s.d(e,{GameGrid3d:()=>r});var i=s("./libs/utility/src/index.ts");class r{constructor(t,e,s,i=(()=>null)){this.xSize=t,this.ySize=e,this.zSize=s,this.setAll(i)}setAll(t){this.grid=[];for(const{x:e,y:s,z:i}of this.allFields())this.grid.push(t(e,s,i))}*allFields(){for(const t of(0,i.range)(0,this.zSize))for(const e of(0,i.range)(0,this.ySize))for(const s of(0,i.range)(0,this.xSize))yield{x:s,y:e,z:t,field:this.get(s,e,t)}}*fieldsAround(t,e,s,r=1){for(const a of(0,i.range)(t-r,t+r+1))for(const t of(0,i.range)(e-r,e+r+1))for(const e of(0,i.range)(s-r,s+r+1))this.isWithinBounds(a,t,e)&&(yield{i:a,j:t,field:this.get(a,t,e)})}get(t,e,s){return this.grid[this.indexFor(t,e,s)]}set(t,e,s,i){this.grid[this.indexFor(t,e,s)]=i}isWithinBounds(t,e,s){return 0<=t&&t<this.xSize&&0<=e&&e<this.ySize&&0<=s&&s<this.zSize}indexFor(t,e,s){return t+e*this.xSize+s*this.xSize*this.ySize}}},"./libs/age/src/state/game-grid.ts":(t,e,s)=>{s.r(e),s.d(e,{GameGrid:()=>r});var i=s("./libs/utility/src/index.ts");class r{constructor(t,e,s=(()=>null)){this.width=t,this.height=e,this.setAll(s)}setAll(t){this.grid=[];for(const{x:e,y:s}of this.allFields())this.grid.push(t(e,s))}*allFields(){for(const t of(0,i.range)(0,this.height))for(const e of(0,i.range)(0,this.width))yield{x:e,y:t,field:this.get(e,t)}}*fieldsAround(t,e,s=1){for(const r of(0,i.range)(t-s,t+s+1))for(const t of(0,i.range)(e-s,e+s+1))this.isWithinBounds(r,t)&&(yield{i:r,j:t,field:this.get(r,t)})}get(t,e){return this.grid[this.indexFor(t,e)]}set(t,e,s){this.grid[this.indexFor(t,e)]=s}isWithinBounds(t,e){return 0<=t&&t<this.width&&0<=e&&e<this.height}indexFor(t,e){return t+e*this.width}}},"./libs/age/src/state/terrain-collection.ts":(t,e,s)=>{s.r(e),s.d(e,{TerrainCollection:()=>i});class i{constructor(t,e,s={x:10,y:10,z:10},i=new Map){this.defaultBlock=t,this.blockValues=e,this.chunkSize=s,this.chunks=i}getFromPosition(t){return this.get(t.x,t.y,t.z)}get(t,e,s){t=Math.floor(t),e=Math.floor(e),s=Math.floor(s);const i=this.chunkCoord(t,this.chunkSize.x),r=this.chunkCoord(e,this.chunkSize.y),a=this.chunkCoord(s,this.chunkSize.z),n=this.chunks.get({x:i,y:r,z:a});return n?n.get(t,e,s):this.defaultBlock}chunkCoord(t,e){return Math.floor(t/e)}}},"./libs/age/src/state/type-map.ts":(t,e,s)=>{s.r(e),s.d(e,{TypeMap:()=>r});var i=s("./libs/age/src/state/base-config.ts");class r{constructor(t=new Map){this.types=t}static from(t){const e=new r;for(const[s,r]of t.entries())e.types.set(r,s<<i.typeOffset);return e}typeFor(t){for(const[e,s]of this.types.entries())if(t===s)return e}typeIdFor(t){return this.types.get(t)}}},"./libs/age/src/state/value-accessor.ts":(t,e,s)=>{s.r(e),s.d(e,{ValueAccessor:()=>r});var i=s("./libs/age/src/state/base-config.ts");class r{constructor(t,e,s,i,r){this.typeValues=t,this.entityValue=e,this.updatedEntityValue=s,this.getTypeValue=i,this.defaultValue=r}static For(t,e,s,i,a,n){return new r(t.typeValues,i(e.entityValues),i(s.updatedEntityValues),a,n)}currentlyOf(t){var e;return null!==(e=this.updatedEntityValue.get(t))&&void 0!==e?e:this.of(t)}of(t){var e;return null!==(e=this.entityValue.get(t))&&void 0!==e?e:this.defaultOf(t)}defaultOf(t){var e;const s=(0,i.typeOf)(t);return null!==(e=this.getTypeValue(this.typeValues.get(s)))&&void 0!==e?e:this.defaultValue}setFor(t,e){this.updatedEntityValue.set(t,e)}}},"./libs/renderend/src/defaults.ts":(t,e,s)=>{s.r(e),s.d(e,{defaultConstants:()=>a,defaultValues:()=>n});var i=s("./libs/renderend/src/state/entity-values.ts"),r=s("./libs/renderend/src/values/rectangular-size.ts");const a={shipType:"ship",wallType:"wall",obstacleTypes:["obstacle","obstacle","obstacle","obstacle","obstacle","obstacle","big-obstacle"]},n={ship:{behaviours:[i.Behaviour.Ship,i.Behaviour.Velocity,i.Behaviour.DieOnCollision]},wall:{behaviours:[i.Behaviour.Obstacle,i.Behaviour.Velocity,i.Behaviour.HasRectangularSize],rectangularSize:new r.RectangularSize(1,1)},obstacle:{behaviours:[i.Behaviour.Obstacle,i.Behaviour.Velocity,i.Behaviour.HasRectangularSize],rectangularSize:new r.RectangularSize(1,1)},"big-obstacle":{behaviours:[i.Behaviour.Obstacle,i.Behaviour.Velocity,i.Behaviour.HasRectangularSize],rectangularSize:new r.RectangularSize(2,2)}}},"./libs/renderend/src/logic/die-on-collision-logic.ts":(t,e,s)=>{s.r(e),s.d(e,{DieOnCollisionLogic:()=>n});var i=s("./libs/utility/src/index.ts"),r=s("./libs/renderend/src/state/entity-values.ts"),a=s("./libs/renderend/src/values/box.ts");class n{constructor(t,e,s,i,r){this.globals=t,this.entities=e,this.position=s,this.rectangularSize=i,this.velocity=r}update(){for(const t of this.entities.with(r.Behaviour.DieOnCollision))this.updateEntity(t)}updateEntity(t){this.hasCollision(t)&&(this.globals.speed=0,this.globals.isAlive=!1,this.velocity.setFor(t,new i.Vector2(0,0)))}hasCollision(t){for(const e of this.entities.with(r.Behaviour.HasRectangularSize))if(a.Box.from(this.position.of(e),this.rectangularSize.of(e)).contains(this.position.of(t)))return!0;return!1}}},"./libs/renderend/src/logic/difficulty-logic.ts":(t,e,s)=>{s.r(e),s.d(e,{DifficultyLogic:()=>i});class i{constructor(t){this.globals=t}update(){this.globals.isAlive&&(this.globals.speed+=2e-4)}}},"./libs/renderend/src/logic/move-ship-logic.ts":(t,e,s)=>{s.r(e),s.d(e,{MoveShipLogic:()=>n});var i=s("./libs/utility/src/index.ts"),r=s("./libs/renderend/src/state/entity-values.ts"),a=s("./libs/renderend/src/state/renderend-action.ts");class n{constructor(t,e,s,i,r){this.constants=t,this.globals=e,this.entities=s,this.position=i,this.velocity=r}update(t){if(!this.globals.isAlive)return;this.globals.distanceTravelled+=this.globals.speed;const e=t.find((t=>t instanceof a.MoveShipAction));e?this.changeVelocity(e.velocity):this.changeVelocity(new i.Vector2(0,0))}changeVelocity(t){const e=t.lengthSquared()>1?t.unitVector().multiply(this.constants.maxVerticalSpeed):t.multiply(this.constants.maxVerticalSpeed);for(const t of this.entities.with(r.Behaviour.Ship)){const s=this.position.of(t);s.x<1&&e.x<0&&e.set(0,e.y),s.x>10&&e.x>0&&e.set(0,e.y),this.velocity.setFor(t,e)}}}},"./libs/renderend/src/logic/obstacle-logic.ts":(t,e,s)=>{s.r(e),s.d(e,{ObstacleLogic:()=>a});var i=s("./libs/utility/src/index.ts"),r=s("./libs/renderend/src/state/entity-values.ts");class a{constructor(t,e,s,i,r,a,n){this.constants=t,this.globals=e,this.entities=s,this.position=i,this.velocity=r,this.rectangularSize=a,this.random=n}update(){for(const t of this.entities.with(r.Behaviour.Obstacle))this.shouldDespawn(t)?this.despawnObstacle(t):this.updateSpeed(t);for(;this.shouldSpawnWalls();)this.spawnNextWallSegment();this.shouldSpawnObstacle()&&this.spawnObstacle()}shouldDespawn(t){return this.position.of(t).x<-1}despawnObstacle(t){this.entities.remove(t)}updateSpeed(t){this.velocity.setFor(t,new i.Vector2(-this.globals.speed,0))}shouldSpawnWalls(){return this.globals.lastWall<this.globals.distanceTravelled+20}spawnNextWallSegment(){this.globals.lastWall+=1;const t=this.globals.lastWall-this.globals.distanceTravelled;this.spawnWallsAt(t)}spawnWallsAt(t){const e=this.rectangularSize.defaultOf(this.constants.wallType);this.spawnWallAt(t,0,e),this.spawnWallAt(t,9,e),this.random.get.int(2)||(this.random.get.int(2)?this.spawnWallAt(t,1,e):this.spawnWallAt(t,8,e))}spawnWallAt(t,e,s){const r=this.entities.create(this.constants.wallType);this.position.setFor(r,new i.Vector2(t+s.width/2,e+s.height/2)),this.velocity.setFor(r,new i.Vector2(-this.globals.speed,0))}shouldSpawnObstacle(){return!(!this.globals.isAlive||this.globals.lastWall<10||(this.globals.lastWall<100?this.globals.tick%20!=0:this.globals.lastWall<500?this.globals.tick%10!=0:this.globals.tick%7!=0))}spawnObstacle(){const t=this.random.get.in(this.constants.obstacleTypes),e=this.rectangularSize.defaultOf(t).height,s=this.entities.create(t);this.position.setFor(s,new i.Vector2(20+this.random.get.float(2),1+this.random.get.float(7-e)+e)),this.velocity.setFor(s,new i.Vector2(-this.globals.speed,0))}}},"./libs/renderend/src/logic/start-logic.ts":(t,e,s)=>{s.r(e),s.d(e,{StartLogic:()=>a});var i=s("./libs/utility/src/index.ts"),r=s("./libs/renderend/src/state/renderend-action.ts");class a{constructor(t,e,s,i,r){this.constants=t,this.changes=e,this.globals=s,this.entities=i,this.position=r}update(t){t.some((t=>t instanceof r.StartGameAction))&&this.initialiseGame()}initialiseGame(){this.clearMap(),this.resetGlobals(),this.spawnPlayerShip()}clearMap(){this.changes.createdEntities,this.entities.remove(...this.entities,...this.changes.createdEntities)}resetGlobals(){this.globals.isAlive=!0,this.globals.speed=.1,this.globals.distanceTravelled=0,this.globals.lastWall=-1}spawnPlayerShip(){const t=this.entities.create(this.constants.shipType);this.position.setFor(t,new i.Vector2(1,5))}}},"./libs/renderend/src/logic/velocity-logic.ts":(t,e,s)=>{s.r(e),s.d(e,{VelocityLogic:()=>r});var i=s("./libs/renderend/src/state/entity-values.ts");class r{constructor(t,e,s){this.entities=t,this.position=e,this.velocity=s}update(){for(const t of this.entities.with(i.Behaviour.Velocity))this.updateEntity(t)}updateEntity(t){const e=this.velocity.of(t);if(e.isZero())return;const s=this.position.of(t);this.position.setFor(t,s.add(e))}}},"./libs/renderend/src/renderend-config.ts":(t,e,s)=>{s.r(e),s.d(e,{RenderendConfig:()=>a});var i=s("./libs/age/src/index.ts"),r=s("./libs/renderend/src/renderend-constants.ts");class a extends i.BaseConfig{constructor(t,e,s,i){super(e,s),this.typeMap=t,this.typeValues=e,this.typeBehaviours=s,this.constants=i}static from(t,e){const s=Object.keys(e),n=i.TypeMap.from(s);return new a(n,new Map(s.map((t=>[n.typeIdFor(t),e[t]]))),new Map(s.map((t=>[n.typeIdFor(t),e[t].behaviours]))),new r.RenderendConstants(n.typeIdFor(t.shipType),n.typeIdFor(t.wallType),t.obstacleTypes.map((t=>n.typeIdFor(t)))))}}},"./libs/renderend/src/renderend-constants.ts":(t,e,s)=>{s.r(e),s.d(e,{RenderendConstants:()=>i});class i{constructor(t,e,s,i=.2,r=.1,a=.5,n={x:1,y:1,z:1}){this.shipType=t,this.wallType=e,this.obstacleTypes=s,this.maxVerticalSpeed=i,this.minHorisontalSpeed=r,this.maxHorisontalSpeed=a,this.chunkSize=n}}},"./libs/renderend/src/renderend-display.ts":(t,e,s)=>{s.r(e),s.d(e,{RenderendDisplay:()=>a});var i=s("./libs/age/src/index.ts"),r=s("./libs/web-gl-display/src/index.ts");class a{constructor(t,e,s){this.config=t,this.game=e,this.canvas=s,this.textElements={},this.gameHeightInTiles=10,this.gamePixelsPerTile=16,this.screenPixelsPerTile=100,this.backgroundWidthInTiles=220/this.gamePixelsPerTile,this.fractionOfTick=0,this.setupDisplay()}get gameWidthInTiles(){return this.canvas.width/this.screenPixelsPerTile}setupDisplay(){this.display=new r.WebGl2Display(this.canvas,this.gamePixelsPerTile,this.gameHeightInTiles*this.gamePixelsPerTile);for(const[t,e]of Object.entries(this.config.sprites))this.display.addSprite(t,e.url,e.width,e.height,e.centerX,e.centerY);this.setupTextElements()}setupTextElements(){this.setupDistanceText(),this.setupGameOverText()}setupDistanceText(){const t=this.getTextElement("distance");t.style.backgroundColor="rgba(0,0,0,0.5)",t.style.textAlign="center",t.style.color="white",t.style.left=this.screenPixelsFromTiles(this.gameWidthInTiles/2-1.5)+"px",t.style.top=this.screenPixelsFromTiles(9)+"px",t.style.fontSize=this.screenPixelsFromTiles(.5)+"px",t.style.width=this.screenPixelsFromTiles(3)+"px",t.style.lineHeight=this.screenPixelsFromTiles(1)+"px"}setupGameOverText(){const t=this.getTextElement("game-over");t.style.display="none",t.style.backgroundColor="rgba(0,0,0,0.5)",t.style.textAlign="center",t.style.color="white",t.style.left=this.screenPixelsFromTiles(this.gameWidthInTiles/2-3)+"px",t.style.top=this.screenPixelsFromTiles(4)+"px",t.style.fontSize=this.screenPixelsFromTiles(1)+"px",t.style.width=this.screenPixelsFromTiles(6)+"px",t.style.lineHeight=this.screenPixelsFromTiles(2)+"px",t.innerText="GAME OVER"}getTextElement(t){return this.textElements[t]||(this.textElements[t]=this.createTextElement()),this.textElements[t]}createTextElement(){const t=document.createElement("div");return t.style.position="absolute",t.style.fontFamily=`'${this.config.font}', Courier, monospace`,t.style.fontWeight="bold",this.canvas.parentElement.appendChild(t),t}screenPixelsFromTiles(t){return this.screenPixelsPerTile*t}setSize(t,e){this.canvas.width=t,this.canvas.height=e,this.screenPixelsPerTile=e/this.gameHeightInTiles,this.setupDisplay()}show(t=0){this.fractionOfTick=t,this.display.startFrame(),this.drawBackground();for(const t of this.game.entities)this.drawEntity(t);this.display.endFrame(),this.writeText()}drawBackground(){const t=this.backgroundBasePosition()%this.backgroundWidthInTiles;this.display.drawSprite("background",t,0,0,0),this.display.drawSprite("background",t+this.backgroundWidthInTiles,0,0,0),this.display.drawSprite("background",t+2*this.backgroundWidthInTiles,0,0,0)}backgroundBasePosition(){return.5*-this.game.state.globals.distanceTravelled-.5*this.game.state.globals.speed*this.fractionOfTick}drawEntity(t){const e=this.currentPositionOf(t),s=this.game.config.typeMap.typeFor((0,i.typeOf)(t));this.display.drawSprite(s,e.x,e.y,0,0)}currentPositionOf(t){const e=this.game.access.position.of(t),s=this.game.access.velocity.of(t);return s?e.add(s.multiply(this.fractionOfTick)):e}writeText(){this.showGameOver(),this.getTextElement("distance").innerText=""+Math.floor(this.game.state.globals.distanceTravelled)}showGameOver(){this.getTextElement("game-over").style.display=this.game.state.globals.isAlive?"none":"block"}}},"./libs/renderend/src/renderend-input.ts":(t,e,s)=>{s.r(e),s.d(e,{RenderendInput:()=>a});var i=s("./libs/utility/src/index.ts"),r=s("./libs/renderend/src/state/renderend-action.ts");class a{constructor(t){this.canvas=t,this.sizeScaling=4,this.nextActions=[new r.StartGameAction],this.keyStates=new i.KeyStates}getNewActions(){const t=[...this.nextActions,...this.parseInputs(this.keyStates.getInputState())];return this.nextActions=[],t}parseInputs(t){return[this.getMoveAction(t),this.getRestartAction(t)]}getMoveAction(t){const e=new i.Vector2(this.getVelocityX(t),this.getVelocityY(t));if(!e.isZero())return new r.MoveShipAction(e)}getVelocityY(t){return this.stateFor(t,"w","ArrowUp")?-1:this.stateFor(t,"s","ArrowDown")?1:0}getVelocityX(t){return this.stateFor(t,"a","ArrowLeft")?-1:this.stateFor(t,"d","ArrowRight")?1:0}getRestartAction(t){if(this.stateFor(t,"Enter","Escape"))return new r.StartGameAction}stateFor(t,...e){var s;for(const i of e)if(null===(s=t[i])||void 0===s?void 0:s.state)return!0;return!1}clickCanvas(t){t.preventDefault();const{x:e,y:s}=this.gridPositionFromMousePosition(t);console.log("x: {0}, y: {1}",e,s)}gridPositionFromMousePosition(t){const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,i=t.clientY-e.top;return{x:s/this.sizeScaling,y:i/this.sizeScaling}}restart(){this.nextActions.push(new r.StartGameAction)}}},"./libs/renderend/src/renderend.ts":(t,e,s)=>{s.r(e),s.d(e,{Renderend:()=>f});var i=s("./libs/age/src/index.ts"),r=s("./libs/utility/src/index.ts"),a=s("./libs/renderend/src/defaults.ts"),n=s("./libs/renderend/src/logic/die-on-collision-logic.ts"),o=s("./libs/renderend/src/logic/difficulty-logic.ts"),l=s("./libs/renderend/src/logic/move-ship-logic.ts"),c=s("./libs/renderend/src/logic/obstacle-logic.ts"),h=s("./libs/renderend/src/logic/start-logic.ts"),d=s("./libs/renderend/src/logic/velocity-logic.ts"),u=s("./libs/renderend/src/renderend-config.ts"),g=s("./libs/renderend/src/state/renderend-changes.ts"),p=s("./libs/renderend/src/state/renderend-state.ts");class f extends i.BaseGame{constructor(t=u.RenderendConfig.from(a.defaultConstants,a.defaultValues),e=p.RenderendState.fromConfig(t),s=new g.RenderendChanges,r=new i.EntityManager(t,e,s),f=new y(t,e,s),b=new i.Random(e.globals)){super([new o.DifficultyLogic(e.globals),new l.MoveShipLogic(t.constants,e.globals,r,f.position,f.velocity),new n.DieOnCollisionLogic(e.globals,r,f.position,f.rectangularSize,f.velocity),new c.ObstacleLogic(t.constants,e.globals,r,f.position,f.velocity,f.rectangularSize,b),new d.VelocityLogic(r,f.position,f.velocity),new h.StartLogic(t.constants,s,e.globals,r,f.position)]),this.config=t,this.state=e,this.changes=s,this.entities=r,this.access=f,this.random=b}finishUpdate(){this.state.globals.tick++,this.entities.applyUpdatedValues()}}class y{constructor(t,e,s,a=i.ValueAccessor.For(t,e,s,(t=>t.rectangularSize),(t=>t.rectangularSize)),n=i.ValueAccessor.For(t,e,s,(t=>t.health),(t=>t.health)),o=i.ValueAccessor.For(t,e,s,(t=>t.orientation),(t=>t.orientation),0),l=i.ValueAccessor.For(t,e,s,(t=>t.position),(t=>t.position)),c=i.ValueAccessor.For(t,e,s,(t=>t.velocity),(t=>t.velocity),new r.Vector2(0,0))){this.rectangularSize=a,this.health=n,this.orientation=o,this.position=l,this.velocity=c}}},"./libs/renderend/src/state/entity-values.ts":(t,e,s)=>{s.r(e),s.d(e,{Behaviour:()=>i,EntityValues:()=>a});var i,r=s("./libs/age/src/index.ts");class a extends r.BaseValues{constructor(t=new Map,e=new Map,s=new Map,i=new Map,r=new Map){super(),this.rectangularSize=t,this.health=e,this.orientation=s,this.position=i,this.velocity=r,this.register(t),this.register(e),this.register(s),this.register(i),this.register(r)}static from(t){const e=new a;for(const[s,i]of t)e.addValuesFrom(s,i);return e}addValuesFrom(t,e){void 0!==e.rectangularSize&&this.rectangularSize.set(t,e.rectangularSize),void 0!==e.health&&this.health.set(t,e.health),void 0!==e.orientation&&this.orientation.set(t,e.orientation),void 0!==e.position&&this.position.set(t,e.position),void 0!==e.velocity&&this.velocity.set(t,e.velocity)}groupFor(t){return{rectangularSize:this.rectangularSize.get(t),health:this.health.get(t),orientation:this.orientation.get(t),position:this.position.get(t),velocity:this.velocity.get(t)}}}!function(t){t[t.Velocity=0]="Velocity",t[t.Obstacle=1]="Obstacle",t[t.Ship=2]="Ship",t[t.DieOnCollision=3]="DieOnCollision",t[t.HasRectangularSize=4]="HasRectangularSize"}(i||(i={}))},"./libs/renderend/src/state/globals.ts":(t,e,s)=>{s.r(e),s.d(e,{Globals:()=>r});var i=s("./libs/age/src/index.ts");class r extends i.BaseGlobals{constructor(t=!0,e=.1,s=0,i=-1,r=0,a=1,n=1){super(r,a,n),this.isAlive=t,this.speed=e,this.distanceTravelled=s,this.lastWall=i,this.tick=r,this.nextId=a,this.seed=n}}},"./libs/renderend/src/state/renderend-action.ts":(t,e,s)=>{s.r(e),s.d(e,{MoveShipAction:()=>a,RenderendAction:()=>i,StartGameAction:()=>r});class i{}class r extends i{}class a extends i{constructor(t){super(),this.velocity=t}}},"./libs/renderend/src/state/renderend-changes.ts":(t,e,s)=>{s.r(e),s.d(e,{RenderendChanges:()=>a});var i=s("./libs/age/src/index.ts"),r=s("./libs/renderend/src/state/entity-values.ts");class a extends i.BaseChanges{constructor(){super(new r.EntityValues)}}},"./libs/renderend/src/state/renderend-state.ts":(t,e,s)=>{s.r(e),s.d(e,{Block:()=>o,BlockValues:()=>l,RenderendState:()=>n});var i=s("./libs/age/src/index.ts"),r=s("./libs/renderend/src/state/entity-values.ts"),a=s("./libs/renderend/src/state/globals.ts");class n extends i.BaseState{static fromConfig(t){return new n(new a.Globals,this.terrainCollectionFor(t),new r.EntityValues)}static terrainCollectionFor(t){return new i.TerrainCollection(new o,new l,t.constants.chunkSize)}}class o{}class l extends i.BaseValues{}},"./libs/renderend/src/values/box.ts":(t,e,s)=>{s.r(e),s.d(e,{Box:()=>i});class i{constructor(t,e,s,i){this.minX=t,this.maxX=e,this.minY=s,this.maxY=i}static from(t,e){return new i(t.x-e.width/2,t.x+e.width/2,t.y-e.height/2,t.y+e.height/2)}translateBy(t){return new i(this.minX+t.x,this.maxX+t.x,this.minY+t.y,this.maxY+t.y)}contains(t){return this.minX<=t.x&&t.x<=this.maxX&&this.minY<=t.y&&t.y<=this.maxY}}},"./libs/renderend/src/values/rectangular-size.ts":(t,e,s)=>{s.r(e),s.d(e,{RectangularSize:()=>i});class i{constructor(t,e){this.width=t,this.height=e}}},"./libs/utility/src/array-extensions.ts":(t,e,s)=>{s.r(e),Object.defineProperty(Array.prototype,"sum",{value:function(){return this.reduce(((t,e)=>t+ +e),0)}}),Object.defineProperty(Array.prototype,"max",{value:function(){if(!this.length)throw new Error("Cannot find the max value in an empty array");return this.reduce(((t,e)=>t>e?t:e))}}),Object.defineProperty(Array.prototype,"min",{value:function(){if(!this.length)throw new Error("Cannot find the min value in an empty array");return this.reduce(((t,e)=>t<e?t:e))}}),Object.defineProperty(Array.prototype,"clear",{value:function(){return this.splice(0,this.length)}}),Object.defineProperty(Array.prototype,"first",{value:function(){return this[0]}}),Object.defineProperty(Array.prototype,"last",{value:function(){return this[this.length-1]}}),Object.defineProperty(Array.prototype,"distinct",{value:function(){return this.filter(((t,e)=>this.indexOf(t)===e))}}),Object.defineProperty(Array.prototype,"distinctBy",{value:function(t){return this.filter(((e,s)=>{const i=t(e);return this.findIndex((e=>t(e)===i))===s}))}}),Object.defineProperty(Array.prototype,"sortBy",{value:function(t,e=!0){return this.sort(((s,i)=>{let r=t(s);"string"==typeof r&&(r=r.toLowerCase());let a=t(i);return"string"==typeof a&&(a=a.toLowerCase()),r>a?e?1:-1:r<a?e?-1:1:0}))}}),Object.defineProperty(Array.prototype,"includesAny",{value:function(t){return this.some((e=>t.includes(e)))}}),Object.defineProperty(Array.prototype,"groupBy",{value:function(t){const e=[];for(const s of this){const i=t(s);let r=e.find((t=>t.group===i));r||(r={group:i,entries:[]},e.push(r)),r.entries.push(s)}return e}}),Object.defineProperty(Array.prototype,"remove",{value:function(t){const e=this.indexOf(t);return e>=0&&(this.splice(e,1),!0)}}),Object.defineProperty(Array.prototype,"findAndRemove",{value:function(t){const e=this.findIndex(t);return e>=0&&(this.splice(e,1),!0)}}),Object.defineProperty(Array.prototype,"removeBy",{value:function(t){const e=[];for(let s=0;s<this.length;s++)t(this[s])&&(e.push(...this.splice(s,1)),s--);return e}})},"./libs/utility/src/index.ts":(t,e,s)=>{s.r(e),s.d(e,{KeyStates:()=>i.KeyStates,Vector2:()=>r.Vector2,hexEastOf:()=>r.hexEastOf,hexNorthEastOf:()=>r.hexNorthEastOf,hexNorthWestOf:()=>r.hexNorthWestOf,hexSouthEastOf:()=>r.hexSouthEastOf,hexSouthWestOf:()=>r.hexSouthWestOf,hexWestOf:()=>r.hexWestOf,hexesAdjacentTo:()=>r.hexesAdjacentTo,randomInt:()=>r.randomInt,randomIntBelow:()=>r.randomIntBelow,randomNumber:()=>r.randomNumber,randomNumberBelow:()=>r.randomNumberBelow,range:()=>r.range}),s("./libs/utility/src/array-extensions.ts");var i=s("./libs/utility/src/key-states.ts"),r=s("./libs/utility/src/utility.ts")},"./libs/utility/src/key-states.ts":(t,e,s)=>{s.r(e),s.d(e,{KeyStates:()=>i});class i{constructor(t={},e={},s={},i={},r={}){this.onDown=t,this.onUp=e,this.isPressed=s,this.inputChanges=i,this.pollableState=r,window.addEventListener("keydown",(e=>{var i;s[e.key]||(this.isPressed[e.key]=!0,this.inputChanges[e.key]=!0,this.updateStateFor(e.key,!0),null===(i=t[e.key])||void 0===i||i.call(t,e.key))})),window.addEventListener("keyup",(t=>{var i;s[t.key]&&(this.isPressed[t.key]=!1,this.updateStateFor(t.key,!1),this.wasPressedSinceLastRequest(t.key)||(this.inputChanges[t.key]=!1),null===(i=e[t.key])||void 0===i||i.call(e,t.key))}))}updateStateFor(t,e){if(!this.pollableState[t])return this.pollableState[t]={hasChanged:!0,state:e};this.pollableState[t].hasChanged||(this.pollableState[t].hasChanged=!0,this.pollableState[t].state=e)}wasPressedSinceLastRequest(t){return this.inputChanges[t]}getInputChanges(){const t=this.inputChanges,e={};for(const t in this.inputChanges)this.hasAlreadyBeenUnpressed(t)&&(e[t]=!1);return this.inputChanges=e,t}getInputState(){const t=Object.assign({},this.pollableState);for(const t in this.pollableState){const e=this.isPressed[t],s=e!==this.pollableState[t].state;this.pollableState[t]={hasChanged:s,state:e}}return t}hasAlreadyBeenUnpressed(t){return this.inputChanges[t]&&!this.isPressed[t]}}},"./libs/utility/src/utility.ts":(t,e,s)=>{function*i(t,e){for(let s=t;s<e;s++)yield s}s.r(e),s.d(e,{Vector2:()=>r,hexEastOf:()=>h,hexNorthEastOf:()=>l,hexNorthWestOf:()=>o,hexSouthEastOf:()=>u,hexSouthWestOf:()=>d,hexWestOf:()=>c,hexesAdjacentTo:()=>n,randomInt:()=>g,randomIntBelow:()=>p,randomNumber:()=>f,randomNumberBelow:()=>y,range:()=>i});class r{constructor(t,e){this.x=t,this.y=e}static fromAngle(t){return new r(1,0).rotate(t)}add(t){return new r(this.x+t.x,this.y+t.y)}subtract(t){return new r(this.x-t.x,this.y-t.y)}multiply(t){return new r(this.x*t,this.y*t)}rotate(t){return new r(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t))}angle(){return Math.atan2(this.y,this.x)}lengthSquared(){return this.x*this.x+this.y*this.y}unitVector(){const t=this.length();return 0===t?new r(0,0):new r(this.x/t,this.y/t)}length(){return 0===this.x||0===this.y?this.x+this.y:Math.sqrt(this.lengthSquared())}copy(){return new r(this.x,this.y)}clip(t,e,s,i,n=!1){return new r(a(this.x,t,s,n),a(this.y,e,i,n))}set(t,e){this.x=t,this.y=e}isZero(){return 0===this.x&&0===this.y}}function a(t,e,s,i=!1){if(s<=e)throw"Error";if(!i)return t<e?t=e:s<=t&&(t=s),t;for(;t<e;)t+=s-e;for(;s<=t;)t-=s-e;return t}function n(t,e){return[o(t,e),l(t,e),c(t,e),h(t,e),d(t,e),u(t,e)]}function o(t,e,s=1){const i=(e+s)%2==0?-1:0;return{x:t-Math.floor(s/2)+i,y:e-s}}function l(t,e,s=1){const i=(e+s)%2==0?0:1;return{x:t+Math.floor(s/2)+i,y:e-s}}function c(t,e,s=1){return{x:t-s,y:e}}function h(t,e,s=1){return{x:t+s,y:e}}function d(t,e,s=1){const i=(e+s)%2==0?-1:0;return{x:t-Math.floor(s/2)+i,y:e+s}}function u(t,e,s=1){const i=(e+s)%2==0?0:1;return{x:t+Math.floor(s/2)+i,y:e+s}}function g(t,e){return Math.floor(Math.random()*(e-t)+t)}function p(t){return Math.floor(Math.random()*t)}function f(t,e){return Math.random()*(e-t)+t}function y(t){return Math.random()*t}},"./libs/web-gl-display/src/generic-shader.ts":(t,e,s)=>{s.r(e),s.d(e,{GenericShader:()=>i});class i{constructor(t,e,s){this.gl=t;const i=this.getShader(e,t.VERTEX_SHADER),r=this.getShader(s,t.FRAGMENT_SHADER);this.program=this.createProgram(i,r),t.deleteShader(i),t.deleteShader(r)}getShader(t,e){const s=this.gl.createShader(e);if(this.gl.shaderSource(s,t),this.gl.compileShader(s),!this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS))throw new Error("Shader error: "+this.gl.getShaderInfoLog(s));return s}createProgram(t,e){const s=this.gl.createProgram();if(this.gl.attachShader(s,t),this.gl.attachShader(s,e),this.gl.linkProgram(s),!this.gl.getProgramParameter(s,this.gl.LINK_STATUS))throw new Error("Shader program error: "+this.gl.getProgramInfoLog(s));return this.gl.detachShader(s,t),this.gl.detachShader(s,e),this.gl.useProgram(null),s}}},"./libs/web-gl-display/src/index.ts":(t,e,s)=>{s.r(e),s.d(e,{WebGl2Display:()=>i.WebGl2Display});var i=s("./libs/web-gl-display/src/web-gl-display.ts")},"./libs/web-gl-display/src/m3x3.ts":(t,e,s)=>{s.r(e),s.d(e,{M3x3:()=>i});class i{constructor(t=[1,0,0,0,1,0,0,0,1]){this.matrix=t}multiply(t){const e=new i;return e.matrix=[this.matrix[0]*t.matrix[0]+this.matrix[3]*t.matrix[1]+this.matrix[6]*t.matrix[2],this.matrix[1]*t.matrix[0]+this.matrix[4]*t.matrix[1]+this.matrix[7]*t.matrix[2],this.matrix[2]*t.matrix[0]+this.matrix[5]*t.matrix[1]+this.matrix[8]*t.matrix[2],this.matrix[0]*t.matrix[3]+this.matrix[3]*t.matrix[4]+this.matrix[6]*t.matrix[5],this.matrix[1]*t.matrix[3]+this.matrix[4]*t.matrix[4]+this.matrix[7]*t.matrix[5],this.matrix[2]*t.matrix[3]+this.matrix[5]*t.matrix[4]+this.matrix[8]*t.matrix[5],this.matrix[0]*t.matrix[6]+this.matrix[3]*t.matrix[7]+this.matrix[6]*t.matrix[8],this.matrix[1]*t.matrix[6]+this.matrix[4]*t.matrix[7]+this.matrix[7]*t.matrix[8],this.matrix[2]*t.matrix[6]+this.matrix[5]*t.matrix[7]+this.matrix[8]*t.matrix[8]],e}transition(t,e){const s=new i;return s.matrix=[this.matrix[0],this.matrix[1],this.matrix[2],this.matrix[3],this.matrix[4],this.matrix[5],t*this.matrix[0]+e*this.matrix[3]+this.matrix[6],t*this.matrix[1]+e*this.matrix[4]+this.matrix[7],t*this.matrix[2]+e*this.matrix[5]+this.matrix[8]],s}scale(t,e){const s=new i;return s.matrix=[this.matrix[0]*t,this.matrix[1]*t,this.matrix[2]*t,this.matrix[3]*e,this.matrix[4]*e,this.matrix[5]*e,this.matrix[6],this.matrix[7],this.matrix[8]],s}getFloatArray(){return new Float32Array(this.matrix)}}},"./libs/web-gl-display/src/sprite-factory.ts":(t,e,s)=>{s.r(e),s.d(e,{SpriteFactory:()=>a});var i=s("./node_modules/tslib/tslib.es6.js"),r=s("./libs/web-gl-display/src/sprite.ts");class a{constructor(t,e,s,i){this.gl=t,this.shader=e,this.tileSize=s,this.worldSpaceMatrix=i}createSprite(t,e,s,a,n){return(0,i.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.loadImage(t),o=e/i.width,l=s/i.height;this.gl.useProgram(this.shader.program);const c=this.createTexture(i),h=this.createTextureBuffer(o,l),d=this.createGeometryBuffer(e,s);return this.gl.useProgram(null),new r.Sprite(this.gl,this.shader,this.tileSize,this.worldSpaceMatrix,c,h,d,a,n,o,l)}))}loadImage(t){return new Promise((e=>{const s=new Image;s.onload=()=>e(s),s.src=t}))}createTexture(t){const e=this.gl,s=e.createTexture();return e.bindTexture(e.TEXTURE_2D,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.bindTexture(e.TEXTURE_2D,null),s}createTextureBuffer(t,e){const s=this.gl,i=s.createBuffer();return s.bindBuffer(s.ARRAY_BUFFER,i),s.bufferData(s.ARRAY_BUFFER,this.createRectArray(0,0,t,e),s.STATIC_DRAW),i}createGeometryBuffer(t,e){const s=this.gl,i=s.createBuffer();return s.bindBuffer(s.ARRAY_BUFFER,i),s.bufferData(s.ARRAY_BUFFER,this.createRectArray(0,0,t,e),s.STATIC_DRAW),i}createRectArray(t=0,e=0,s=1,i=1){return new Float32Array([t,e,t+s,e,t,e+i,t,e+i,t+s,e,t+s,e+i])}}},"./libs/web-gl-display/src/sprite.ts":(t,e,s)=>{s.r(e),s.d(e,{Sprite:()=>r});var i=s("./libs/web-gl-display/src/m3x3.ts");class r{constructor(t,e,s,i,r,a,n,o,l,c,h){this.gl=t,this.shader=e,this.tileSize=s,this.worldSpaceMatrix=i,this.texture=r,this.textureBuffer=a,this.geometryBuffer=n,this.centerX=o,this.centerY=l,this.uvX=c,this.uvY=h}render(t,e,s=0,r=0){const a=this.gl;a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.texture),a.uniform1i(this.shader.uImageLocation,0),a.bindBuffer(a.ARRAY_BUFFER,this.textureBuffer),a.enableVertexAttribArray(this.shader.aTexCoordLocation),a.vertexAttribPointer(this.shader.aTexCoordLocation,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.geometryBuffer),a.enableVertexAttribArray(this.shader.aPositionLocation),a.vertexAttribPointer(this.shader.aPositionLocation,2,a.FLOAT,!1,0,0);const n=s*this.uvX,o=r*this.uvY,l=(new i.M3x3).transition(t*this.tileSize-this.centerX,e*this.tileSize-this.centerY);a.uniform2f(this.shader.uFrameLocation,n,o),a.uniformMatrix3fv(this.shader.uWorldLocation,!1,this.worldSpaceMatrix.getFloatArray()),a.uniformMatrix3fv(this.shader.uObjectLocation,!1,l.getFloatArray()),a.drawArrays(a.TRIANGLE_STRIP,0,6)}}},"./libs/web-gl-display/src/standard-shader.ts":(t,e,s)=>{s.r(e),s.d(e,{StandardShader:()=>r});var i=s("./libs/web-gl-display/src/generic-shader.ts");class r extends i.GenericShader{constructor(t,e,s,i,r,a,n){super(t,"\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nuniform mat3 uWorld;\nuniform mat3 uObject;\nuniform vec2 uFrame;\nvoid main(void) {\ngl_Position = vec4(uWorld * uObject * vec3(aPosition, 1), 1);\nvTexCoord = aTexCoord + uFrame;\n}","\nprecision mediump float;\nuniform sampler2D uImage;\nvarying vec2 vTexCoord;\nvoid main(void) {\ngl_FragColor = texture2D(uImage, vTexCoord);\n}"),this.aPositionLocation=e,this.aTexCoordLocation=s,this.uImageLocation=i,this.uWorldLocation=r,this.uObjectLocation=a,this.uFrameLocation=n,this.aPositionLocation=t.getAttribLocation(this.program,"aPosition"),this.aTexCoordLocation=t.getAttribLocation(this.program,"aTexCoord"),this.uImageLocation=t.getUniformLocation(this.program,"uImage"),this.uWorldLocation=t.getUniformLocation(this.program,"uWorld"),this.uObjectLocation=t.getUniformLocation(this.program,"uObject"),this.uFrameLocation=t.getUniformLocation(this.program,"uFrame")}}},"./libs/web-gl-display/src/web-gl-display.ts":(t,e,s)=>{s.r(e),s.d(e,{WebGl2Display:()=>o});var i=s("./node_modules/tslib/tslib.es6.js"),r=s("./libs/web-gl-display/src/m3x3.ts"),a=s("./libs/web-gl-display/src/sprite-factory.ts"),n=s("./libs/web-gl-display/src/standard-shader.ts");class o{constructor(t,e,s,i=t.getContext("webgl2"),r=new n.StandardShader(i),o=null,c=l(t.width,t.height,s),h=new a.SpriteFactory(i,r,e,c),d={}){this.canvas=t,this.tileSize=e,this.virtualScreenHeight=s,this.gl=i,this.standardShader=r,this.previousProgram=o,this.worldSpaceMatrix=c,this.spriteFactory=h,this.sprites=d,this.gl.enable(this.gl.BLEND)}startFrame(){this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)}drawSprite(t,e,s,i,r){const a=this.sprites[t];if(!a)return console.warn("Could not load sprite {0}",t);this.previousProgram!=a.shader.program&&(this.gl.useProgram(a.shader.program),this.previousProgram=a.shader.program),a.render(e,s,i,r)}endFrame(){this.previousProgram=null,this.gl.useProgram(null),this.gl.flush()}resize(t,e){this.canvas.width=t,this.canvas.height=e,this.worldSpaceMatrix=l(t,e,this.virtualScreenHeight),this.spriteFactory=new a.SpriteFactory(this.gl,this.standardShader,this.tileSize,this.worldSpaceMatrix)}addSprite(t,e,s=16,r=16,a=s/2,n=r/2){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this.sprites[t]=yield this.spriteFactory.createSprite(e,s,r,a,n)}))}}function l(t,e,s){const i=t/(e/s);return(new r.M3x3).transition(-1,1).scale(2/i,-2/s)}},"./node_modules/tslib/tslib.es6.js":(t,e,s)=>{s.r(e),s.d(e,{__assign:()=>a,__asyncDelegator:()=>w,__asyncGenerator:()=>v,__asyncValues:()=>S,__await:()=>x,__awaiter:()=>h,__classPrivateFieldGet:()=>P,__classPrivateFieldIn:()=>F,__classPrivateFieldSet:()=>R,__createBinding:()=>u,__decorate:()=>o,__exportStar:()=>g,__extends:()=>r,__generator:()=>d,__importDefault:()=>E,__importStar:()=>O,__makeTemplateObject:()=>T,__metadata:()=>c,__param:()=>l,__read:()=>f,__rest:()=>n,__spread:()=>y,__spreadArray:()=>m,__spreadArrays:()=>b,__values:()=>p});var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},i(t,e)};function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function s(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}var a=function(){return a=Object.assign||function(t){for(var e,s=1,i=arguments.length;s<i;s++)for(var r in e=arguments[s])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},a.apply(this,arguments)};function n(t,e){var s={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(s[i[r]]=t[i[r]])}return s}function o(t,e,s,i){var r,a=arguments.length,n=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,s,i);else for(var o=t.length-1;o>=0;o--)(r=t[o])&&(n=(a<3?r(n):a>3?r(e,s,n):r(e,s))||n);return a>3&&n&&Object.defineProperty(e,s,n),n}function l(t,e){return function(s,i){e(s,i,t)}}function c(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function h(t,e,s,i){return new(s||(s=Promise))((function(r,a){function n(t){try{l(i.next(t))}catch(t){a(t)}}function o(t){try{l(i.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(n,o)}l((i=i.apply(t,e||[])).next())}))}function d(t,e){var s,i,r,a,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(s)throw new TypeError("Generator is already executing.");for(;n;)try{if(s=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(!((r=(r=n.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){n=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){n.label=a[1];break}if(6===a[0]&&n.label<r[1]){n.label=r[1],r=a;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(a);break}r[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(t){a=[6,t],i=0}finally{s=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}var u=Object.create?function(t,e,s,i){void 0===i&&(i=s);var r=Object.getOwnPropertyDescriptor(e,s);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,i,r)}:function(t,e,s,i){void 0===i&&(i=s),t[i]=e[s]};function g(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||u(e,t,s)}function p(t){var e="function"==typeof Symbol&&Symbol.iterator,s=e&&t[e],i=0;if(s)return s.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function f(t,e){var s="function"==typeof Symbol&&t[Symbol.iterator];if(!s)return t;var i,r,a=s.call(t),n=[];try{for(;(void 0===e||e-- >0)&&!(i=a.next()).done;)n.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(s=a.return)&&s.call(a)}finally{if(r)throw r.error}}return n}function y(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(f(arguments[e]));return t}function b(){for(var t=0,e=0,s=arguments.length;e<s;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<s;e++)for(var a=arguments[e],n=0,o=a.length;n<o;n++,r++)i[r]=a[n];return i}function m(t,e,s){if(s||2===arguments.length)for(var i,r=0,a=e.length;r<a;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}function x(t){return this instanceof x?(this.v=t,this):new x(t)}function v(t,e,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=s.apply(t,e||[]),a=[];return i={},n("next"),n("throw"),n("return"),i[Symbol.asyncIterator]=function(){return this},i;function n(t){r[t]&&(i[t]=function(e){return new Promise((function(s,i){a.push([t,e,s,i])>1||o(t,e)}))})}function o(t,e){try{(s=r[t](e)).value instanceof x?Promise.resolve(s.value.v).then(l,c):h(a[0][2],s)}catch(t){h(a[0][3],t)}var s}function l(t){o("next",t)}function c(t){o("throw",t)}function h(t,e){t(e),a.shift(),a.length&&o(a[0][0],a[0][1])}}function w(t){var e,s;return e={},i("next"),i("throw",(function(t){throw t})),i("return"),e[Symbol.iterator]=function(){return this},e;function i(i,r){e[i]=t[i]?function(e){return(s=!s)?{value:x(t[i](e)),done:"return"===i}:r?r(e):e}:r}}function S(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,s=t[Symbol.asyncIterator];return s?s.call(t):(t=p(t),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(s){e[s]=t[s]&&function(e){return new Promise((function(i,r){!function(t,e,s,i){Promise.resolve(i).then((function(e){t({value:e,done:s})}),e)}(i,r,(e=t[s](e)).done,e.value)}))}}}function T(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var A=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e};function O(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)"default"!==s&&Object.prototype.hasOwnProperty.call(t,s)&&u(e,t,s);return A(e,t),e}function E(t){return t&&t.__esModule?t:{default:t}}function P(t,e,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(t):i?i.value:e.get(t)}function R(t,e,s,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(t,s):r?r.value=s:e.set(t,s),s}function F(t,e){if(null===e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof t?e===t:t.has(e)}}},e={};function s(i){var r=e[i];if(void 0!==r)return r.exports;var a=e[i]={exports:{}};return t[i](a,a.exports,s),a.exports}s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};return(()=>{s.r(i),s.d(i,{Box:()=>n.Box,MoveShipAction:()=>a.MoveShipAction,RectangularSize:()=>o.RectangularSize,Renderend:()=>t.Renderend,RenderendAction:()=>a.RenderendAction,RenderendDisplay:()=>e.RenderendDisplay,RenderendInput:()=>r.RenderendInput,StartGameAction:()=>a.StartGameAction});var t=s("./libs/renderend/src/renderend.ts"),e=s("./libs/renderend/src/renderend-display.ts"),r=s("./libs/renderend/src/renderend-input.ts"),a=s("./libs/renderend/src/state/renderend-action.ts"),n=s("./libs/renderend/src/values/box.ts"),o=s("./libs/renderend/src/values/rectangular-size.ts")})(),i})()));