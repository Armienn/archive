!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var s in i)("object"==typeof exports?exports:t)[s]=i[s]}}(self,(()=>(()=>{"use strict";var t,e,i={"./libs/age/src/age.ts":(t,e,i)=>{i.r(e),i.d(e,{AgEngine:()=>s});class s{constructor(t,e,i){this.logics=t,this.validators=e,this.state=i}update(...t){return this.validate(t)||(this.performLogic(t),null)}validate(t){for(const e of this.validators){const i=e.validate(t);if(i)return i}}performLogic(t){this.state.tick++;for(const e of this.logics)e.Update(t);this.state.finishUpdate?.()}}},"./libs/age/src/base-display.ts":(t,e,i)=>{i.r(e)},"./libs/age/src/base-game.ts":(t,e,i)=>{i.r(e),i.d(e,{BaseGame:()=>s});class s{constructor(t=[],e=[]){this.Logics=t,this.Validators=e}Update(...t){const e=this.Validate(t);if(e)return e;for(const e of this.Logics)e.Update(t);return null}Validate(t){for(const e of this.Validators){const i=e.validate(t);if(i)return i}}}},"./libs/age/src/display/base-input-parser.ts":(t,e,i)=>{i.r(e),i.d(e,{BaseInputParser:()=>s,ControllerType:()=>a});class s{constructor(t,e,i=new Map,s=new Map,l=a.Controller){this.DisplayProvider=t,this.Inputs=e,this.ActionStates=i,this.PreviousStates=s,this.CurrentControllerType=l}UpdateActionStates(){this.PreviousStates=this.ActionStates,this.ActionStates=new Map;for(const[t,e]of this.Inputs)this.ActionStates.set(t,this.StateFor(...e))}StateFor(...t){let e=0;for(const i of t){const t=this.DisplayProvider.GetInputState(i);t>e&&(e=t),t>0&&this.UpdateCurrentControllerType(i)}return e}UpdateCurrentControllerType(t){(function(t){switch(t){case"MouseX":case"MouseY":return!0;default:return!1}})(t)||(this.CurrentControllerType=t.startsWith("Pad")?a.Controller:a.KeyboardAndMouse)}FloatStateFor(t){return this.ActionStates.get(t)}BoolStateFor(t){return this.ActionStates.get(t)>.5}HasJustBeenPressed(t){return this.ActionStates.get(t)>.5&&this.PreviousStates.get(t)<=.5}HasJustBeenReleased(t){return this.ActionStates.get(t)<=.5&&this.PreviousStates.get(t)>.5}}var a;!function(t){t[t.KeyboardAndMouse=0]="KeyboardAndMouse",t[t.Controller=1]="Controller"}(a||(a={}))},"./libs/age/src/display/html-display-provider.ts":(t,e,i)=>{i.r(e),i.d(e,{HtmlDisplayProvider:()=>o});var s=i("./libs/utility/src/index.ts"),a=i("./libs/web-gl-display/src/index.ts"),l=i("./libs/age/src/display/screen-size.ts");class o{constructor(t,e){this.hostElement=t,this.config=e,this.textElements={},this.keyStates=new s.KeyStates,this.size=new l.ScreenSize(e.RenderToVirtualSize,e.VirtualPixelsPerTile,100,100,e.VirtualHeight,e.VirtualHeight),this.initialiseCanvas(),this.initialiseDisplay()}get SortByDepth(){return this.display.sortByDepth}set SortByDepth(t){this.display.sortByDepth=t}initialiseCanvas(){this.hostElement.style.position="relative",this.hostElement.style.backgroundColor="black",this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.config.RenderToVirtualSize&&(this.canvas.style.width="100%",this.canvas.style.imageRendering="pixelated"),this.hostElement.appendChild(this.canvas)}initialiseDisplay(){const t=this.display?.sortByDepth??!1;this.display=new a.WebGl2Display(this.canvas,this.config.VirtualPixelsPerTile,this.config.VirtualHeight,this.config.RenderToVirtualSize),this.display.sortByDepth=t;for(const[t,e]of Object.entries(this.config.Sprites))this.display.addSprite(t,this.config.AssetFolder+e.path+".png",e.width,e.height,e.centerX,e.centerY)}StartNewFrame(){this.display.startFrame(),this.updateTextElements()}updateTextElements(){for(const t in this.textElements)"none"===this.textElements[t].style.display?this.removeElement(t):this.textElements[t].style.display="none"}removeElement(t){const e=this.textElements[t];this.hostElement.removeChild(e),delete this.textElements[t]}Draw(t,e,i,s,a,l=1,o,r,n){this.display.isLoading()||this.display.draw(t,e,i,s,a,l,o,r,n)}FinishFrame(){this.display.endFrame()}DrawString(t,e,i,s,a,l="white"){const o=this.getTextElement(e,i,s,l,a);o.innerText=t,o.style.display="block"}getTextElement(t,e,i,s,a){const l=t+","+e+i+s+a;return this.textElements[l]||(this.textElements[l]=this.createTextElement(t,e,i,s,a)),this.textElements[l]}createTextElement(t,e,i,s,a){const l=document.createElement("div");return l.style.position="absolute",l.style.fontFamily=`'${i}', Courier, monospace`,l.style.fontWeight="bold",l.style.display="none",l.style.backgroundColor="rgba(0,0,0,0.5)",l.style.textAlign="center",l.style.color=s,l.style.left=this.size.HostPixelsPerTile*(t-3)+"px",l.style.top=this.size.HostPixelsPerTile*e+"px",l.style.fontSize=this.size.HostPixelsPerTile*a+"px",l.style.width=6*this.size.HostPixelsPerTile+"px",l.style.lineHeight=this.size.HostPixelsPerTile*a*2+"px",this.hostElement.appendChild(l),l}GetInputState(t){const e=this.keyStates.getInputState(t);switch(t){case"MouseX":return this.modifyMouseX(e);case"MouseY":return this.modifyMouseY(e);default:return e}}endInputFrame(){this.keyStates.endInputFrame()}modifyMouseX(t){const e=this.hostElement.getBoundingClientRect();return(t-e.x)/e.width}modifyMouseY(t){const e=this.hostElement.getBoundingClientRect();return(t-e.y)/e.height}setSize(t,e){this.size.UpdateHostSize(t,e),this.canvas.width=this.size.CanvasWidth,this.canvas.height=this.size.CanvasHeight,this.initialiseDisplay()}}},"./libs/age/src/display/screen-size.ts":(t,e,i)=>{i.r(e),i.d(e,{ScreenSize:()=>s});class s{constructor(t,e,i,s,a,l){this.RenderToVirtualSize=t,this.VirtualPixelsPerTile=e,this.HostWidth=i,this.HostHeight=s,this.VirtualWidth=a,this.VirtualHeight=l}get HostPixelsPerTile(){return this.HostHeight/this.VirtualHeight*this.VirtualPixelsPerTile}get CanvasWidth(){return this.RenderToVirtualSize?this.VirtualWidth:this.HostWidth}get CanvasHeight(){return this.RenderToVirtualSize?this.VirtualHeight:this.HostHeight}get WidthInTiles(){return this.VirtualWidth/this.VirtualPixelsPerTile}get HeightInTiles(){return this.VirtualHeight/this.VirtualPixelsPerTile}UpdateHostSize(t,e){this.HostWidth=t,this.HostHeight=e,this.VirtualWidth=this.HostWidth*(this.VirtualHeight/this.HostHeight)}}},"./libs/age/src/game-runner.ts":(t,e,i)=>{i.r(e),i.d(e,{GameRunner:()=>a});var s=i("./libs/age/src/services/performance.ts");class a{constructor(t,e,i=30){this.display=t,this.game=e,this.updatesPerSecond=i,this.lastUpdate=Date.now(),this.stop=!1,this.actions=[],this.updateGame=()=>{(0,s.startTiming)("gameUpdate"),this.game.Update(...this.actions.splice(0),...this.display.getNewActions()),this.afterGameUpdate(),(0,s.finishTiming)("gameUpdate"),this.lastUpdate=Date.now()},this.afterGameUpdate=()=>{},this.startDisplayLoop=()=>{this.updateDisplay(),this.stop||requestAnimationFrame(this.startDisplayLoop)}}startGameLoop(){this.stopInterval(),this.timerId=window.setInterval(this.updateGame,1e3/this.updatesPerSecond)}stopInterval(){this.timerId&&window.clearInterval(this.timerId),this.timerId=null}updateDisplay(){(0,s.startTiming)("displayUpdate");const t=Date.now(),e=1e3/this.updatesPerSecond,i=(t-this.lastUpdate)/e;this.display.show(i),(0,s.finishTiming)("displayUpdate")}onDestroy(){this.stop=!0,window.clearInterval(this.timerId),this.display.onDestroy?.()}}},"./libs/age/src/index.ts":(t,e,i)=>{i.r(e),i.d(e,{AgEngine:()=>s.AgEngine,BaseGame:()=>a.BaseGame,BaseInputParser:()=>o.BaseInputParser,BaseValues:()=>p.BaseValues,BlockChunk:()=>g.BlockChunk,Box:()=>k.Box,Box2d:()=>b.Box2d,CircularSize:()=>B.CircularSize,ControllerType:()=>o.ControllerType,EntityIdMask:()=>u.EntityIdMask,EntityIdOf:()=>u.EntityIdOf,EntityManager:()=>m.EntityManager,EntityTypeMask:()=>u.EntityTypeMask,EntityTypeOf:()=>u.EntityTypeOf,EntityTypeOffset:()=>u.EntityTypeOffset,FieldRegion:()=>y.FieldRegion,GameGrid:()=>f.GameGrid,GameRunner:()=>l.GameRunner,HtmlDisplayProvider:()=>r.HtmlDisplayProvider,Random:()=>d.Random,RandomAi:()=>h.RandomAi,RectangularSize:()=>C.RectangularSize,RegionCoordsFor:()=>y.RegionCoordsFor,ScreenSize:()=>n.ScreenSize,StandardValueGetter:()=>T.StandardValueGetter,TerrainManager:()=>S.TerrainManager,TypeMap:()=>w.TypeMap,ValueAccessBuilder:()=>T.ValueAccessBuilder,ValueAccessor:()=>T.ValueAccessor,ValueSetter:()=>T.ValueSetter,finishTiming:()=>c.finishTiming,startTiming:()=>c.startTiming});var s=i("./libs/age/src/age.ts"),a=(i("./libs/age/src/base-display.ts"),i("./libs/age/src/base-game.ts")),l=i("./libs/age/src/game-runner.ts"),o=i("./libs/age/src/display/base-input-parser.ts"),r=i("./libs/age/src/display/html-display-provider.ts"),n=i("./libs/age/src/display/screen-size.ts"),h=i("./libs/age/src/interfaces/game-ai.ts"),c=(i("./libs/age/src/interfaces/game-logic.ts"),i("./libs/age/src/interfaces/game-state.ts"),i("./libs/age/src/interfaces/game-validator.ts"),i("./libs/age/src/services/performance.ts")),d=i("./libs/age/src/services/random.ts"),u=i("./libs/age/src/values/entity.ts"),p=i("./libs/age/src/state/base-values.ts"),g=i("./libs/age/src/state/block-chunk.ts"),m=i("./libs/age/src/state/entity-manager.ts"),y=i("./libs/age/src/state/field-region.ts"),f=i("./libs/age/src/state/game-grid.ts"),S=i("./libs/age/src/state/terrain-manager.ts"),w=i("./libs/age/src/state/type-map.ts"),T=i("./libs/age/src/state/value-accessor.ts"),k=i("./libs/age/src/values/box.ts"),b=i("./libs/age/src/values/box2d.ts"),C=i("./libs/age/src/values/rectangular-size.ts"),B=i("./libs/age/src/values/circular-size.ts")},"./libs/age/src/interfaces/game-ai.ts":(t,e,i)=>{i.r(e),i.d(e,{RandomAi:()=>s});class s{constructor(t){this.possibleActionsFor=t}requestActions(t){const e=this.possibleActionsFor(t);return[e[Math.floor(Math.random()*e.length)]]}}},"./libs/age/src/interfaces/game-logic.ts":(t,e,i)=>{i.r(e)},"./libs/age/src/interfaces/game-state.ts":(t,e,i)=>{i.r(e)},"./libs/age/src/interfaces/game-validator.ts":(t,e,i)=>{i.r(e)},"./libs/age/src/services/performance.ts":(t,e,i)=>{i.r(e),i.d(e,{finishTiming:()=>o,startTiming:()=>l});class s{constructor(t,e,i){this.lastStarted=t,this.lastTime=e,this.recentTimes=i}average(){return this.recentTimes.sum()/this.recentTimes.length}max(){return this.recentTimes.max()}}const a=new class{constructor(){this.intervalId=0,this.element=null,this.timings={}}showPerformance(t){this.element=document.createElement("div"),this.element.style.position="absolute",this.element.style.top="0",this.element.style.whiteSpace="pre",this.element.style.fontFamily="monospace",this.element.style.color="white",this.element.style.backgroundColor="rgba(0,0,0,0.5)",this.element.style.pointerEvents="none",document.body.appendChild(this.element),this.intervalId=setInterval((()=>{let t="";for(const e in this.timings)t+=e+`:\n  average: ${this.timings[e].average().toFixed(2)}\n  max:     ${this.timings[e].max().toFixed(2)}\n`;this.element.innerText=t}),1e3*t)}hidePerformance(){clearInterval(this.intervalId),document.body.removeChild(this.element),this.element=null}};function l(t){a.timings[t]||(a.timings[t]=new s(0,0,[])),a.timings[t].lastStarted=performance.now()}function o(t){a.timings[t].lastTime=performance.now()-a.timings[t].lastStarted,a.timings[t].recentTimes.push(a.timings[t].lastTime),a.timings[t].recentTimes.length>100&&a.timings[t].recentTimes.shift()}window.agePerformance=a},"./libs/age/src/services/random.ts":(t,e,i)=>{i.r(e),i.d(e,{Random:()=>s});class s{constructor(t){this.seed=t}SetSeed(t){this.seed=t}Generate(){}Int(t){return Math.floor(Math.random()*t)}Float(t=1){return Math.random()*t}In(t){return t[this.Int(t.length)]}}},"./libs/age/src/state/base-values.ts":(t,e,i)=>{i.r(e),i.d(e,{BaseValues:()=>s});class s{constructor(t=new Map){this.Entities=t,this.AllValueMaps=[]}Register(t){return this.AllValueMaps.push(t),t}ClearValues(){for(const t of this.AllValueMaps)t.clear()}RemoveValuesFor(t){for(const e of this.AllValueMaps)e.delete(t)}AddValuesFromOther(t){for(let e=0;e<this.AllValueMaps.length;e++)for(const[i,s]of t.AllValueMaps[e])this.AllValueMaps[e].set(i,s)}}},"./libs/age/src/state/block-chunk.ts":(t,e,i)=>{i.r(e),i.d(e,{BlockChunk:()=>a});var s=i("./libs/utility/src/index.ts");class a{constructor(t,e=new s.Vector3(10,10,1),i=new s.Vector3(0,0,0)){this.Blocks=t,this.ChunkSize=e,this.Offset=i}Get(t,e,i){return this.Blocks[this.chunkIndexFor(t-this.Offset.x,e-this.Offset.y,i-this.Offset.z)]}GetWithoutOffset(t,e,i){return this.Blocks[this.chunkIndexFor(t,e,i)]}GetAt(t){return this.Blocks[this.chunkIndexFor(t.x-this.Offset.x,t.y-this.Offset.y,t.z-this.Offset.z)]}Set(t,e,i,s){return this.Blocks[this.chunkIndexFor(t-this.Offset.x,e-this.Offset.y,i-this.Offset.z)]=s}SetWithoutOffset(t,e,i,s){return this.Blocks[this.chunkIndexFor(t,e,i)]=s}SetAt(t,e){return this.Blocks[this.chunkIndexFor(t.x-this.Offset.x,t.y-this.Offset.y,t.z-this.Offset.z)]=e}chunkIndexFor(t,e,i){return t+e*this.ChunkSize.x+i*this.ChunkSize.x*this.ChunkSize.y}}},"./libs/age/src/state/entity-manager.ts":(t,e,i)=>{i.r(e),i.d(e,{EntityManager:()=>s});class s{constructor(t,e,i){this.entityValues=t,this.updatedEntityValues=e,this.idProvider=i,this.Accessors=[]}get With(){return this.entityValues}get All(){return this.entityValues.Entities.keys()}Create(t){const e=this.idProvider.GetNewId()|t;this.updatedEntityValues.Entities.set(e,!0);for(const t of this.Accessors)t.InitialiseValueFor(e);return e}Remove(...t){for(const e of t)this.updatedEntityValues.Entities.set(e,!1)}ApplyUpdatedValues(){this.entityValues.AddValuesFromOther(this.updatedEntityValues),this.updatedEntityValues.ClearValues();for(const[t,e]of this.updatedEntityValues.Entities)e?this.Add(t):this.FullyRemove(t);this.updatedEntityValues.Entities.clear()}Add(t){this.entityValues.Entities.set(t,!0)}FullyRemove(t){this.entityValues.Entities.delete(t),this.updatedEntityValues.Entities.delete(t),this.entityValues.RemoveValuesFor(t),this.updatedEntityValues.RemoveValuesFor(t)}Exists(t){return this.entityValues.Entities.has(t)}*[Symbol.iterator](){for(const[t]of this.entityValues.Entities)yield t}}},"./libs/age/src/state/field-region.ts":(t,e,i)=>{i.r(e),i.d(e,{FieldRegion:()=>l,RegionCoordsFor:()=>a});var s=i("./libs/utility/src/index.ts");function a(t,e,i,a){const l=t+a.X/2,o=e+a.Y/2,r=i+a.Z/2;return new s.Vector3(Math.floor(l/a.X),Math.floor(o/a.Y),Math.floor(r/a.Z))}class l{constructor(t,e,i,s){this.Size=t,this.ChunkSize=e,this.Offset=i,this.Chunks=s}Get(t,e,i){return this.Chunks[this.IndexFor(t,e,i)].Get(t,e,i)}Set(t,e,i,s){this.Chunks[this.IndexFor(t,e,i)].Set(t,e,i,s)}GetByVector(t){return this.Get(t.X,t.Y,t.Z)}SetByVector(t,e){this.Set(t.X,t.Y,t.Z,e)}IndexFor(t,e,i){const s=Math.floor(this.Size.X/this.ChunkSize.X),a=Math.floor(this.Size.Y/this.ChunkSize.Y);return Math.floor((t-this.Offset.X)/this.ChunkSize.X)+Math.floor((e-this.Offset.Y)/this.ChunkSize.Y)*s+Math.floor((i-this.Offset.Z)/this.ChunkSize.Z)*s*a}}},"./libs/age/src/state/game-grid.ts":(t,e,i)=>{i.r(e),i.d(e,{GameGrid:()=>a});var s=i("./libs/utility/src/index.ts");class a{constructor(t,e,i=(()=>null)){this.width=t,this.height=e,this.setAll(i)}setAll(t){this.grid=[];for(const{x:e,y:i}of this.allFields())this.grid.push(t(e,i))}*allFields(){for(const t of(0,s.range)(0,this.height))for(const e of(0,s.range)(0,this.width))yield{x:e,y:t,field:this.get(e,t)}}*fieldsAround(t,e,i=1){for(const a of(0,s.range)(t-i,t+i+1))for(const t of(0,s.range)(e-i,e+i+1))this.isWithinBounds(a,t)&&(yield{i:a,j:t,field:this.get(a,t)})}get(t,e){return this.grid[this.indexFor(t,e)]}set(t,e,i){this.grid[this.indexFor(t,e)]=i}isWithinBounds(t,e){return 0<=t&&t<this.width&&0<=e&&e<this.height}indexFor(t,e){return t+e*this.width}}},"./libs/age/src/state/terrain-manager.ts":(t,e,i)=>{i.r(e),i.d(e,{TerrainManager:()=>l});var s=i("./libs/utility/src/index.ts"),a=i("./libs/age/src/state/field-region.ts");class l{constructor(t,e,i,s=new Map,a=null){this.RegionSize=t,this.DefaultBlock=e,this.Regions=i,this.UpdatedBlocks=s,this.WorldBounds=a}GetAt(t){return this.Get(t.x,t.y,t.z)}SetAt(t,e){this.Set(e,t.x,t.y,t.z)}Get(t,e,i=0){if(t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),this.WorldBounds&&!this.WorldBounds.ContainsPoint(t,e,i)){const a=this.WorldBounds.Contain(new s.Vector3(t,e,i));t=a.x,e=a.y,i=a.z}return this.Regions.get((0,a.RegionCoordsFor)(t,e,i,this.RegionSize).stringify())?.Get(t,e,i)??this.DefaultBlock}Set(t,e,i,a=0){if(e=Math.floor(e),i=Math.floor(i),a=Math.floor(a),this.WorldBounds&&!this.WorldBounds.ContainsPoint(e,i,a)){const t=this.WorldBounds.Contain(new s.Vector3(e,i,a));e=t.x,i=t.y,a=t.z}this.UpdatedBlocks.set(s.Vector3.stringify(e,i,a),t)}ApplyUpdatedValues(){for(const[t,e]of this.UpdatedBlocks)this.SetField(s.Vector3.parse(t),e);this.UpdatedBlocks.clear()}SetField(t,e){const i=(0,a.RegionCoordsFor)(t.x,t.y,t.z,this.RegionSize).stringify(),s=this.Regions.get(i);s?s.Set(t.x,t.y,t.z,e):console.error(`Can't set field outside chunks at (${t.x}, ${t.y}, ${t.z})`)}GetCurrent(t,e,i=0){return t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),this.UpdatedBlocks.get(s.Vector3.stringify(t,e,i))??this.Get(t,e,i)}*AllFields(){for(const[t,e]of this.Regions){const[i,a,l]=t.split(",").map((t=>+t));for(const t of(0,s.range)(0,this.RegionSize.z))for(const o of(0,s.range)(0,this.RegionSize.y))for(const r of(0,s.range)(0,this.RegionSize.x))yield{position:this.getGlobalPosition(r,o,t,i,a,l),field:e[this.chunkIndexFor(r,o,t)]}}}chunkIndexFor(t,e,i){return t+e*this.RegionSize.x+i*this.RegionSize.x*this.RegionSize.y}FieldsAround(t,e,i=0){return this.FieldsWithinRadius(t,e,i,1,1,0)}*FieldsWithinRadius(t,e,i,a=1,l=1,o=1){for(const r of(0,s.range)(t-a,t+a+1))for(const t of(0,s.range)(e-l,e+l+1))for(const e of(0,s.range)(i-o,i+o+1))yield{i:r,j:t,k:e,field:this.Get(r,t,e)}}getGlobalPosition(t,e,i,a,l,o=0){return new s.Vector3(t+a*this.RegionSize.x,e+l*this.RegionSize.y,i+o*this.RegionSize.z)}}},"./libs/age/src/state/type-map.ts":(t,e,i)=>{i.r(e),i.d(e,{TypeMap:()=>s});class s{constructor(t=new Map){this.Types=t}static From(t,e){const i=new s;for(const[s,a]of e.entries())i.Add(a,s<<t);return i}TypeFor(t){for(const[e,i]of this.Types.entries())if(t===i)return e}TypeIdFor(t){return this.Types.get(t)}Add(t,e){this.Types.set(t,e)}get Count(){return this.Types.size}}},"./libs/age/src/state/value-accessor.ts":(t,e,i)=>{i.r(e),i.d(e,{StandardValueGetter:()=>l,ValueAccessBuilder:()=>r,ValueAccessor:()=>a,ValueSetter:()=>o});var s=i("./libs/age/src/values/entity.ts");class a{constructor(t,e){this.Get=t,this.Set=e}InitialiseValueFor(t){const e=this.Get.DefaultOf(t);null!=e&&this.Set.For(t,e)}}class l{constructor(t,e,i,s,a){this.typeValues=t,this.entityValue=e,this.updatedEntityValue=i,this.getTypeValue=s,this.defaultValue=a}CurrentlyOf(t){return this.updatedEntityValue.get(t)??this.Of(t)}Of(t){return this.entityValue.get(t)}DefaultOf(t){const e=(0,s.EntityTypeOf)(t);return this.getTypeValue(this.typeValues.get(e))??this.defaultValue}}class o{constructor(t){this.updatedEntityValue=t}For(t,e){this.updatedEntityValue.set(t,e)}}class r{constructor(t,e,i){this.typeValues=t,this.entityValues=e,this.updatedEntityValues=i}For(t,e,i){return new a(new l(this.typeValues,t(this.entityValues),t(this.updatedEntityValues),e,i),new o(t(this.updatedEntityValues)))}}},"./libs/age/src/values/box.ts":(t,e,i)=>{i.r(e),i.d(e,{Box:()=>a});var s=i("./libs/utility/src/index.ts");class a{constructor(t,e,i,s,a,l){this.MinX=t,this.MaxX=e,this.MinY=i,this.MaxY=s,this.MinZ=a,this.MaxZ=l}static From(t){return new a(t.x,t.x,t.y,t.y,t.z,t.z)}TranslateBy(t){return new a(this.MinX+t.x,this.MaxX+t.x,this.MinY+t.y,this.MaxY+t.y,this.MinZ+t.z,this.MaxZ+t.z)}static OccupiedArea(t,e){return new a(t.x-e.Radius,t.x+e.Radius,t.y-e.Radius,t.y+e.Radius,t.z,t.z+e.Height)}ContainsPoint(t,e,i){return this.MinX<=t&&t<this.MaxX&&this.MinY<=e&&e<this.MaxY&&this.MinZ<=i&&i<this.MaxZ}Contains(t){return this.MinX<=t.x&&t.x<this.MaxX&&this.MinY<=t.y&&t.y<this.MaxY&&this.MinZ<=t.z&&t.z<this.MaxZ}Contain(t){let e=t.x;e<this.MinX?e+=this.MaxX-this.MinX:e>=this.MaxX&&(e-=this.MaxX-this.MinX);let i=t.y;i<this.MinY?i+=this.MaxY-this.MinY:i>=this.MaxY&&(i-=this.MaxY-this.MinY);let a=t.z;return a<this.MinZ?a+=this.MaxZ-this.MinZ:a>=this.MaxZ&&(a-=this.MaxZ-this.MinZ),new s.Vector3(e,i,a)}}},"./libs/age/src/values/box2d.ts":(t,e,i)=>{i.r(e),i.d(e,{Box2d:()=>s});class s{constructor(t,e,i,s){this.minX=t,this.maxX=e,this.minY=i,this.maxY=s}static from(t,e){return new s(t.x-e.Width/2,t.x+e.Width/2,t.y-e.Height/2,t.y+e.Height/2)}translateBy(t){return new s(this.minX+t.x,this.maxX+t.x,this.minY+t.y,this.maxY+t.y)}contains(t){return this.minX<=t.x&&t.x<=this.maxX&&this.minY<=t.y&&t.y<=this.maxY}}},"./libs/age/src/values/circular-size.ts":(t,e,i)=>{i.r(e),i.d(e,{CircularSize:()=>s});class s{constructor(t,e){this.radius=t,this.height=e}get Radius(){return this.radius}set Radius(t){this.radius=t}get Height(){return this.height}set Height(t){this.height=t}}},"./libs/age/src/values/entity.ts":(t,e,i)=>{i.r(e),i.d(e,{EntityIdMask:()=>l,EntityIdOf:()=>r,EntityTypeMask:()=>s,EntityTypeOf:()=>o,EntityTypeOffset:()=>a});const s=4278190080,a=24,l=16777215;function o(t){return t&s}function r(t){return t&l}},"./libs/age/src/values/rectangular-size.ts":(t,e,i)=>{i.r(e),i.d(e,{RectangularSize:()=>s});class s{constructor(t,e){this.width=t,this.height=e}get Width(){return this.width}get Height(){return this.height}}},"./libs/meld/src/config/constants.ts":(t,e,i)=>{i.r(e),i.d(e,{Constants:()=>a});var s=i("./libs/utility/src/index.ts");class a{constructor(t,e,i,s,a,l,o,r,n,h,c,d,u,p,g,m,y,f,S,w,T,k){this.PlayerType=t,this.SolidItemType=e,this.DefaultBlock=i,this.RegionSizeInChunks=s,this.ChunkSize=a,this.DefaultWorldBounds=l,this.ChunkLoadingRadius=o,this.CollisionAreaWidth=r,this.GravityAcceleration=n,this.TerminalVerticalVelocity=h,this.MaxMoveSpeed=c,this.Acceleration=d,this.InitialDashCharge=u,this.MaxDashCharge=p,this.DashChargeSpeed=g,this.DashDuration=m,this.DashCooldown=y,this.QuickDashWindowStart=f,this.QuickDashWindowEnd=S,this.QuickDashMinimumAngle=w,this.MiningStartup=T,this.MiningRecovery=k}RegionSize(){return new s.Vector3(this.RegionSizeInChunks.X*this.ChunkSize.X,this.RegionSizeInChunks.Y*this.ChunkSize.Y,this.RegionSizeInChunks.Z*this.ChunkSize.Z)}}},"./libs/meld/src/config/game-config.ts":(t,e,i)=>{i.r(e),i.d(e,{GameConfig:()=>s});class s{constructor(t,e,i,s,a,l,o,r,n,h){this.Constants=t,this.Lists=e,this.EntityTypeMap=i,this.EntityTypeValues=s,this.SolidTypeMap=a,this.SolidTypeValues=l,this.NonSolidTypeMap=o,this.NonSolidTypeValues=r,this.ItemTypeMap=n,this.ItemValues=h,this.UpdatesPerSecond=60}}},"./libs/meld/src/config/lists.ts":(t,e,i)=>{i.r(e),i.d(e,{Lists:()=>s});class s{constructor(t){this.RandomlySpawningMonsters=t}}},"./libs/meld/src/config/version.ts":(t,e,i)=>{i.r(e),i.d(e,{Version:()=>s});class s{constructor(t,e,i,s){this.EntityTypeMap=t,this.SolidTypeMap=e,this.NonSolidTypeMap=i,this.ItemTypeMap=s,this.GetEntityMapping=t=>a(this.EntityTypeMap,t.EntityTypeMap),this.GetSolidMapping=t=>a(this.SolidTypeMap,t.SolidTypeMap),this.GetNonSolidMapping=t=>a(this.NonSolidTypeMap,t.NonSolidTypeMap),this.GetItemMapping=t=>a(this.ItemTypeMap,t.ItemTypeMap)}SimilarTo(t){if(this.EntityTypeMap.Count!=t.EntityTypeMap.Count)return!1;if(this.SolidTypeMap.Count!=t.SolidTypeMap.Count)return!1;if(this.NonSolidTypeMap.Count!=t.NonSolidTypeMap.Count)return!1;if(this.ItemTypeMap.Count!=t.ItemTypeMap.Count)return!1;for(const[e,i]of this.EntityTypeMap.Types)if(!t.EntityTypeMap.Types.has(e)||t.EntityTypeMap.Types.get(e)!=i)return!1;for(const[e,i]of this.SolidTypeMap.Types)if(!t.SolidTypeMap.Types.has(e)||t.SolidTypeMap.Types.get(e)!=i)return!1;for(const[e,i]of this.NonSolidTypeMap.Types)if(!t.NonSolidTypeMap.Types.has(e)||t.NonSolidTypeMap.Types.get(e)!=i)return!1;for(const[e,i]of this.ItemTypeMap.Types)if(!t.ItemTypeMap.Types.has(e)||t.ItemTypeMap.Types.get(e)!=i)return!1;return!0}}function a(t,e){const i=new Map;for(const[s,a]of t.Types)e.Types.has(s)?i.set(a,e[s]):i.set(a,a);return i}},"./libs/meld/src/display/display-entity-drawer.ts":(t,e,i)=>{i.r(e),i.d(e,{DisplayEntityDrawer:()=>o});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/display/services/camera.ts"),l=i("./libs/meld/src/display/state/display-config.ts");class o{constructor(t,e,i,s,a=t.State.Globals.Tick){this.Game=t,this.Config=e,this.State=i,this.Camera=s,this.UpdatedToTick=a}DrawDisplayEntities(){this.UpdateDisplayEntities();for(const t of this.State.DisplayEntities.values())this.DrawDisplayEntity(t)}UpdateDisplayEntities(){for(;this.UpdatedToTick<this.Game.State.Globals.Tick;){this.UpdatedToTick++;for(const t of this.State.DisplayEntities.values())this.UpdateDisplayEntity(t)}}UpdateDisplayEntity(t){t.Position.addFrom(t.Velocity),t.EndTick<=this.Game.State.Globals.Tick&&this.State.DisplayEntities.remove(t)}DrawDisplayEntity(t){if(t.ParentEntity){const e=this.Game.Entities.Position.Get.Of(t.ParentEntity)??s.Vector3.Zero,i=this.Game.Entities.Velocity.Get.Of(t.ParentEntity)??s.Vector3.Zero;this.Camera.DrawAnimated(t.Sprite,a.Layer.Middle,e.add(t.Position),i.add(t.Velocity),t.AnimationStart,t.Rotation)}else this.Camera.DrawAnimated(t.Sprite,a.Layer.Middle,t.Position,t.Velocity,t.AnimationStart,t.Rotation)}Add(t,e,i,s=0){const a=this.Config.Sprites[t];this.State.DisplayEntities.push({Sprite:t,Position:e,Velocity:i,EndTick:this.Game.State.Globals.Tick+(0,l.DurationOf)(a),AnimationStart:this.Game.State.Globals.Tick,LastUpdate:this.Game.State.Globals.Tick,Rotation:s})}AddRelative(t,e,i=null,a=null,o=0){const r=this.Config.Sprites[t];this.State.DisplayEntities.push({Sprite:t,ParentEntity:e,Position:i??s.Vector3.Zero,Velocity:a??s.Vector3.Zero,EndTick:this.Game.State.Globals.Tick+(0,l.DurationOf)(r),AnimationStart:this.Game.State.Globals.Tick,LastUpdate:this.Game.State.Globals.Tick,Rotation:o})}}},"./libs/meld/src/display/entity/dash-drawer.ts":(t,e,i)=>{i.r(e),i.d(e,{DashDrawer:()=>n});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/display/services/camera.ts"),l=i("./libs/meld/src/display/state/display-config.ts"),o=i("./libs/meld/src/display/state/display-state.ts"),r=i("./libs/meld/src/display/entity/entity-context.ts");class n{constructor(t,e,i,s,a){this.Game=t,this.Config=e,this.State=i,this.Camera=s,this.DisplayEntityDrawer=a,this.EntityContext=new r.EntityContext}Draw(t){this.EntityContext=t;const e=this.Game.Entities.DashState.Get.Of(t.Entity);if(!e)return;const i=this.Game.Entities.Position.Get.Of(t.Entity)??s.Vector3.Zero,l=this.Game.Entities.Velocity.Get.Of(t.Entity)??s.Vector3.Zero;this.ShouldShowRecharge(e)&&this.Camera.DrawAnimated(this.Config.GameplaySprites.DashRecharge,a.Layer.Middle-a.Layer.ZFightingAdjustment,i,l,e.TimeOfLastDash+this.Game.Config.Constants.DashCooldown),e.IsCharging&&this.Camera.DrawAnimated(this.Config.GameplaySprites.DashTarget,a.Layer.Middle,this.TargetPosition(e).addFrom(i),l,0,e.Angle-(0,o.AngleFromNorth)(this.State.ViewDirection)),this.IsInQuickDashWindow(e)&&this.ShowQuickDashAngle(e,i,l)}ShouldShowRecharge(t){const e=this.Game.State.Globals.Tick-t.TimeOfLastDash-this.Game.Config.Constants.DashCooldown,i=(0,l.DurationOf)(this.Config.Sprites[this.Config.GameplaySprites.DashRecharge]);return 0<e&&e<i}IsInQuickDashWindow(t){return t.IsInInterval(this.Game.State.Globals.Tick,this.Game.Config.Constants.QuickDashWindowStart,this.Game.Config.Constants.QuickDashWindowEnd)}ShowQuickDashAngle(t,e,i){const l=t.TimeOfLastDash+this.Game.Config.Constants.QuickDashWindowStart,o=this.Game.Config.Constants.QuickDashMinimumAngle,r=new s.Vector3(1,0,0).rotate(t.Angle+o),n=new s.Vector3(1,0,0).rotate(t.Angle-o),h=t.HasFailedQuickDash?this.Config.GameplaySprites.DashFailMarker:this.Config.GameplaySprites.DashMarker;this.Camera.DrawAnimated(h,a.Layer.Middle,r.addFrom(e),i,l),this.Camera.DrawAnimated(h,a.Layer.Middle,n.addFrom(e),i,l)}TargetPosition(t){const e=20*Math.min(this.Game.Config.Constants.MaxDashCharge-this.Game.Config.Constants.InitialDashCharge,t.Charge);return new s.Vector3(e,0,0).rotate(t.Angle)}OnDash(t,e,i){const a=this.Game.Entities.Position.Get.Of(t)??s.Vector3.Zero;e?(this.DisplayEntityDrawer.Add(this.Config.GameplaySprites.DashCloud,a,s.Vector3.Zero),i.IsCharging&&this.DisplayEntityDrawer.Add(this.Config.GameplaySprites.DashTargetFade,this.TargetPosition(i).addFrom(a),s.Vector3.Zero,i.Angle-(0,o.AngleFromNorth)(this.State.ViewDirection))):this.DisplayEntityDrawer.AddRelative(this.Config.GameplaySprites.DashFail,t,new s.Vector3(1,0,0).rotate(i.Angle))}}},"./libs/meld/src/display/entity/entities-drawer.ts":(t,e,i)=>{i.r(e),i.d(e,{EntitiesDrawer:()=>r});var s=i("./libs/age/src/index.ts"),a=i("./libs/utility/src/index.ts"),l=i("./libs/meld/src/display/state/display-state.ts"),o=i("./libs/meld/src/display/entity/entity-context.ts");class r{constructor(t,e,i,s){this.Game=t,this.Config=e,this.State=i,this.EntityDrawers=s,this.EntityContext=new o.EntityContext}Draw(){for(const{layer:t,area:e}of this.State.ShownLayers)for(const i of this.entitiesInArea(t,e))this.DrawEntity(i)}entitiesInArea(t,e){return[...this.Game.Entities.With.Position].filter((([,i])=>this.isInArea(t,e,i))).map((t=>t[0]))}isInArea(t,e,i){return e.Left<=i.x&&i.x<e.Right&&e.Top<=i.y&&i.y<e.Bottom&&Math.floor(i.z)==t}DrawEntity(t){if(this.Config.EntitySprites.has((0,s.EntityTypeOf)(t))){this.UpdateEntityContext(t,this.Config.EntitySprites.get((0,s.EntityTypeOf)(t)));for(const t of this.EntityDrawers)t.Draw(this.EntityContext)}}UpdateEntityContext(t,e){this.EntityContext.Entity=t,this.EntityContext.EntitySprites=e;const i=this.Game.Entities.Orientation.Get.Of(t)??0;this.EntityContext.Orientation=(0,a.Rotate)(i,-(0,l.AngleFromNorth)(this.State.ViewDirection)),this.EntityContext.Position=this.Game.Entities.Position.Get.Of(t)??a.Vector3.Zero,this.EntityContext.Velocity=this.Game.Entities.Velocity.Get.Of(t)??a.Vector3.Zero,this.EntityContext.ToolState=this.Game.Entities.ToolState.Get.Of(t)}}},"./libs/meld/src/display/entity/entity-context.ts":(t,e,i)=>{i.r(e),i.d(e,{EntityContext:()=>l});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/display/state/entity-sprites.ts");class l{constructor(){this.EntitySprites=new a.EntitySprites([]),this.Orientation=0,this.Position=new s.Vector3(0,0,0),this.Velocity=new s.Vector3(0,0,0),this.ToolState=null}}},"./libs/meld/src/display/entity/entity-shadow-drawer.ts":(t,e,i)=>{i.r(e),i.d(e,{EntityShadowDrawer:()=>r});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/state/block.ts"),l=i("./libs/meld/src/display/services/camera.ts"),o=i("./libs/meld/src/display/entity/entity-context.ts");class r{constructor(t,e,i){this.Game=t,this.Config=e,this.Camera=i,this.EntityContext=new o.EntityContext}Draw(t){this.EntityContext=t;const e=this.GetFloorHeight(t.Position);null!=e&&this.Camera.DrawAnimated(this.GetShadow(),l.Layer.Middle-l.Layer.ZFightingAdjustment,t.Position.withZ(e),t.Velocity)}GetFloorHeight(t){const e=s.Vector3.copy(t);let i=this.Game.Terrain.GetAt(t);for(;a.Blocks.TypeOf(i)===a.BlockType.Empty;)if(e.z=e.z-1,i=this.Game.Terrain.GetAt(e),e.z<t.z-10)return null;return l.Camera.HeightOf(a.Blocks.TypeOf(i)).z+Math.floor(e.z)+l.Layer.ZFightingAdjustment}GetShadow(){const t=this.Game.Entities.CircularSize.Get.Of(this.EntityContext.Entity);return t?t.Radius<1?this.Config.GameplaySprites.ShadowMedium:this.Config.GameplaySprites.ShadowBig:this.Config.GameplaySprites.ShadowSmall}}},"./libs/meld/src/display/entity/standard-entity-drawer.ts":(t,e,i)=>{i.r(e),i.d(e,{StandardEntityDrawer:()=>n});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/display/services/camera.ts"),l=i("./libs/meld/src/display/state/display-state.ts"),o=i("./libs/meld/src/display/state/entity-sprites.ts"),r=i("./libs/meld/src/display/entity/entity-context.ts");class n{constructor(t,e,i){this.Game=t,this.Config=e,this.Camera=i,this.EntityContext=new r.EntityContext}Draw(t){this.EntityContext=t,this.IsPerformingToolAction()&&this.DrawTool(),this.Camera.DrawAnimated((0,o.SpriteFor)(this.GetCurrentSprite(),t.Orientation),a.Layer.Middle,t.Position,t.Velocity)}GetCurrentSprite(){const t=this.EntityContext.Velocity.Length();return t>1.01*this.Game.Config.Constants.MaxMoveSpeed?this.EntityContext.EntitySprites.Dash??this.EntityContext.EntitySprites.Idle:t>.75*this.Game.Config.Constants.MaxMoveSpeed?this.EntityContext.EntitySprites.Run??this.EntityContext.EntitySprites.Idle:t>.01*this.Game.Config.Constants.MaxMoveSpeed?this.EntityContext.EntitySprites.Walk??this.EntityContext.EntitySprites.Idle:this.EntityContext.EntitySprites.Idle}IsPerformingToolAction(){return this.Game.State.Globals.Tick<(this.EntityContext.ToolState?.EndTime??0)}DrawTool(){const t=this.EntityContext.ToolState,e=this.Game.Config.Constants.MiningStartup,i=this.Game.Config.Constants.MiningRecovery,o=(this.Game.State.Globals.Tick-t.StartTime)%(e+i),r=o<e?this.StartupRotation(o/e):this.RecoveryRotation((o-e)/i),n=new s.Vector3(s.MathF.Floor(t.Target.X),s.MathF.Floor(t.Target.Y),s.MathF.Floor(t.Target.Z)),h=new s.Vector2(0,-1.25).rotateFrom(r).addFromNumbers(-1.75,.625),c=this.Config.ItemSprites.has(t.SourceItem.Type)?this.Config.ItemSprites.get(t.SourceItem.Type):this.Config.BlockSprites.get(t.SourceItem.Content)[0].TileFor(l.ViewDirection.North);this.Camera.Draw(c,a.Layer.Middle,n.addFrom(new s.Vector3(.5,.5,.5)).addFrom(this.Camera.BottomTile.multiply(.5)),this.EntityContext.Velocity,0,r,null,1,!1,h)}StartupRotation(t){return s.MathF.Pow(t,4)*(s.MathF.Tau/4)}RecoveryRotation(t){return(1-.25*s.MathF.Min(t,1-t))*(s.MathF.Tau/4)}}},"./libs/meld/src/display/hud/hud-drawer.ts":(t,e,i)=>{i.r(e),i.d(e,{HudDrawer:()=>s});class s{constructor(t,e,i,s){this.Game=t,this.Config=e,this.State=i,this.DisplayProvider=s}Draw(){const t=this.Game.State.Players.get(this.State.PlayerName);t>-1&&(this.DrawHud(),this.DrawItems(t),this.DrawToolSection(t))}DrawHud(){this.DisplayProvider.Draw(this.Config.GameplaySprites.HudLeft,0,0,0,0,s.BottomLayer),this.DisplayProvider.Draw(this.Config.GameplaySprites.HudRight,this.State.Size.WidthInTiles,0,0,0,s.BottomLayer)}DrawItems(t){const e=this.Game.Entities.SelectableItems.Get.Of(t);if(!e)return;const i=e.ItemInCurrentSet(0);i&&this.DrawItem(i,3,1.5);const a=e.ItemInCurrentSet(1);a&&this.DrawItem(a,4.5,3);const l=e.ItemInCurrentSet(2);l&&this.DrawItem(l,3,4.5);const o=e.ItemInCurrentSet(3);o&&this.DrawItem(o,1.5,3);let r=0,n=0;switch(e.CurrentItemInSet){case 0:r=3,n=2.5;break;case 1:r=3.5,n=3;break;case 2:r=3,n=3.5;break;case 3:r=2.5,n=3}this.DisplayProvider.Draw("button-y",r,n,0,0,s.TopLayer)}DrawToolSection(t){const e=this.Game.Entities.SelectableTools.Get.Of(t)?.CurrentTool();e&&(this.DrawItem(e,this.State.Size.WidthInTiles-3,4.5),this.DisplayProvider.Draw("button-a",this.State.Size.WidthInTiles-2.25,5,0,0,s.TopLayer),this.DisplayProvider.Draw("button-x",this.State.Size.WidthInTiles-3.75,5,0,0,s.TopLayer),this.DisplayProvider.Draw(this.Config.GameplaySprites.DashTarget,this.State.Size.WidthInTiles-1.5,3,0,0,s.TopLayer),this.DisplayProvider.Draw("button-b",this.State.Size.WidthInTiles-.75,3.5,0,0,s.TopLayer))}DrawItem(t,e,i){const a=this.Config.ItemSprites.has(t.Type)?this.Config.ItemSprites.get(t.Type):this.Config.BlockSprites.get(t.Content)[0].TileFor(this.State.ViewDirection);this.DisplayProvider.Draw(a,e,i,0,0,s.TopLayer)}}s.BottomLayer=.9998,s.TopLayer=.9999},"./libs/meld/src/display/meld-display.ts":(t,e,i)=>{i.r(e),i.d(e,{MeldDisplay:()=>w});var s=i("./libs/age/src/index.ts"),a=i("./libs/meld/src/display/services/camera.ts"),l=i("./libs/meld/src/display/display-entity-drawer.ts"),o=i("./libs/meld/src/display/state/display-state.ts"),r=i("./libs/meld/src/display/entity/dash-drawer.ts"),n=i("./libs/meld/src/display/entity/standard-entity-drawer.ts"),h=i("./libs/meld/src/display/hud/hud-drawer.ts"),c=i("./libs/meld/src/display/services/input-parser.ts"),d=i("./libs/meld/src/display/terrain/terrain-drawer.ts"),u=i("./libs/meld/src/display/entity/entities-drawer.ts"),p=i("./libs/meld/src/display/services/visibility.ts"),g=i("./libs/meld/src/display/terrain/tile-drawer.ts"),m=i("./libs/meld/src/display/terrain/wall-drawer.ts"),y=i("./libs/meld/src/display/terrain/border-drawer.ts"),f=i("./libs/meld/src/display/terrain/block-shadow-drawer.ts"),S=i("./libs/meld/src/display/entity/entity-shadow-drawer.ts");class w{constructor(t,e,i,s,w,T=o.DisplayState.from(t,w),k=new a.Camera(i,s,t,T),b=new p.Visibility(i,t,T,k),C=new c.InputParser(i,T,k,b,s,e.Inputs),B=new l.DisplayEntityDrawer(i,t,T,k),D=new h.HudDrawer(i,t,T,s),M=new g.TileDrawer(t,T,k,i),F=new m.WallDrawer(t,T,k),v=new y.BorderDrawer(t,k),I=new f.BlockShadowDrawer(t,k,i),x=new d.TerrainDrawer(i,t,T,k,[M,F,v,I]),V=new n.StandardEntityDrawer(i,t,k),E=new S.EntityShadowDrawer(i,t,k),A=new r.DashDrawer(i,t,T,k,B),P=new u.EntitiesDrawer(i,t,T,[V,E,A])){this.Config=t,this.Settings=e,this.Game=i,this.Display=s,this.State=T,this.camera=k,this.visibility=b,this.inputParser=C,this.displayEntityDrawer=B,this.hudDrawer=D,this.tileDrawer=M,this.wallDrawer=F,this.borderDrawer=v,this.blockShadowDrawer=I,this.terrainDrawer=x,this.entityDrawer=V,this.entityShadowDrawer=E,this.dashDrawer=A,this.entitiesDrawer=P,i.dashLogic.Listeners.push(A),s.SortByDepth=!0}setSize(t,e){this.State.Size.UpdateHostSize(t,e),this.visibility.UpdateSize()}show(t=0){this.Display.StartNewFrame(),(0,s.startTiming)("displayUpdate"),this.State.FractionOfTick=t;const e=[...this.Game.Entities.With.Position.keys()][0];null!=e&&(this.camera.FocusOn(e),this.visibility.Update()),this.entitiesDrawer.Draw(),this.terrainDrawer.Draw(),this.displayEntityDrawer.DrawDisplayEntities(),this.hudDrawer.Draw(),(0,s.finishTiming)("displayUpdate"),this.Display.FinishFrame()}getNewActions(){return this.inputParser.GetNewActions()}}},"./libs/meld/src/display/services/camera.ts":(t,e,i)=>{i.r(e),i.d(e,{Camera:()=>r,DisplayArea:()=>n,Layer:()=>h});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/state/block.ts"),l=i("./libs/meld/src/display/state/display-state.ts"),o=i("./libs/meld/src/display/services/visibility.ts");class r{constructor(t,e,i,a){this.Game=t,this.DisplayProvider=e,this.Config=i,this.State=a,this.TopTile=new s.Vector3(0,-1,0),this.TopRightTile=new s.Vector3(1,-1,0),this.RightTile=new s.Vector3(1,0,0),this.BottomRightTile=new s.Vector3(1,1,0),this.BottomTile=new s.Vector3(0,1,0),this.BottomLeftTile=new s.Vector3(-1,1,0),this.LeftTile=new s.Vector3(-1,0,0),this.TopLeftTile=new s.Vector3(-1,-1,0),this.Adjustable=new s.Vector3(0,0,0),this._adjustableCurrentPosition=new s.Vector3(0,0,0),this._adjustableIsInFrontOfPlayer=new s.Vector3(0,0,0),this._adjustableIsWithinScreen=new s.Vector3(0,0,0),r.FloorHeight.z=1/(i.WallDisplayHeight*i.VirtualPixelsPerTile)}FocusOn(t){this.SetCurrentPositionWith(this.State.FocusPoint,this.Game.Entities.Position.Get.Of(t)??s.Vector3.Zero,this.Game.Entities.Velocity.Get.Of(t))}SetCurrentPositionWith(t,e,i=null){return i?t.setFrom(e).addFrom(this._adjustableCurrentPosition.setFrom(i).multiplyFrom(this.State.FractionOfTick)):t.setFrom(e)}DrawAnimated(t,e,i,s=null,a=0,l=0,o=null,r=1,n=!1,h=null){const c=this.Config.Sprites[t],d=this.AnimationFrame(c.frameInterval,c.framesX,c.framesY,a);this.Draw(t,e,i,s,d,l,o,r,n,h)}AnimationFrame(t,e,i,s){if(!t)return 0;const a=e*i,l=this.Game.State.Globals.Tick-s;return Math.floor(l/t)%a}Draw(t,e,i,a=null,l=0,o=0,r=null,n=1,h=!1,c=null){const d=this.SetCurrentPositionWith(this.Adjustable,i,a);this.AdjustForFocusAndCamera(d);const u=this.ScreenXFor(d)+(c?.X??0),p=this.ScreenYFor(d)+(c?.Y??0);h&&this.State.PlayerIsBlocked&&this.IsInFrontOfPlayer(i,u,p)&&(n=this.Config.BlockingTransparencyAlpha),d.z<0&&(r=this.DarkenByDepth(r??new s.Vector3(1,1,1),d.z)),d.z=i.z;const g=this.Config.Sprites[t],m=l%g.framesX,y=Math.floor(l/g.framesX)%g.framesY;this.DisplayProvider.Draw(t,u,p,m,y,this.sortingNumberFor(d,e),o,r,n)}IsInFrontOfPlayer(t,e,i){return!(Math.floor(t.z)-Math.floor(this.State.FocusPoint.z)<=0)&&this._adjustableIsInFrontOfPlayer.set(e-this.State.Size.WidthInTiles/2,i-this.State.Size.HeightInTiles/2,0).lengthSquared()<this.Config.BlockingTransparencyRadius*this.Config.BlockingTransparencyRadius}DarkenByDepth(t,e){return e<0?t.multiplyFrom(1+e/10):t}AdjustForFocusAndCamera(t){const e=.75,i=t.subtractFrom(this.State.FocusPoint);switch(this.State.ViewDirection){case l.ViewDirection.NorthEast:return t.set((i.x+i.y)*e,(-i.x+i.y)*e,i.z);case l.ViewDirection.East:return t.set(i.y,-i.x,i.z);case l.ViewDirection.SouthEast:return t.set((-i.x+i.y)*e,(-i.x-i.y)*e,i.z);case l.ViewDirection.South:return t.set(-i.x,-i.y,i.z);case l.ViewDirection.SouthWest:return t.set((-i.x-i.y)*e,(i.x-i.y)*e,i.z);case l.ViewDirection.West:return t.set(-i.y,i.x,i.z);case l.ViewDirection.NorthWest:return t.set((i.x-i.y)*e,(i.x+i.y)*e,i.z);default:return i}}RevertFocusAndCameraAdjustment(t){return this.RevertBla(t,1.33333).addFrom(this.State.FocusPoint)}RevertBla(t,e){switch(this.State.ViewDirection){case l.ViewDirection.NorthWest:return t.set((t.x+t.y)*e,(-t.x+t.y)*e,t.z);case l.ViewDirection.West:return t.set(t.y,-t.x,t.z);case l.ViewDirection.SouthWest:return t.set((-t.x+t.y)*e,(-t.x-t.y)*e,t.z);case l.ViewDirection.South:return t.set(-t.x,-t.y,t.z);case l.ViewDirection.SouthEast:return t.set((-t.x-t.y)*e,(t.x-t.y)*e,t.z);case l.ViewDirection.East:return t.set(-t.y,t.x,t.z);case l.ViewDirection.NorthEast:return t.set((t.x-t.y)*e,(t.x+t.y)*e,t.z);default:return t}}ScreenPositionFor(t){return new s.Vector2(t.x+this.State.Size.WidthInTiles/2,t.y+this.State.Size.HeightInTiles/2-this.Config.WallDisplayHeight*t.z)}ScreenXFor(t){return t.x+this.State.Size.WidthInTiles/2}ScreenYFor(t){return t.y+this.State.Size.HeightInTiles/2-this.Config.WallDisplayHeight*t.z}sortingNumberFor(t,e){const i=Math.floor(t.z)+e,s=2*(this.Config.DisplayDepth+2)+1,a=(i-(this.State.FocusPoint.z-s/2))/s,l=this.State.Size.HeightInTiles+(2*this.Config.DisplayDepth+1)*this.Config.WallDisplayHeight,o=-l/2;return a+(t.y-o)/l/h.NumberOfLayers/s}TilePositionFor(t,e){let i=new s.Vector3(t*this.State.Size.WidthInTiles-this.State.Size.WidthInTiles/2,e*this.State.Size.HeightInTiles-this.State.Size.HeightInTiles/2,0);return this.IsDiagonalView()&&(i=i.multiply(.5)),this.RevertFocusAndCameraAdjustment(i)}RotateCamera(t){this.State.ViewDirection+=t,this.State.ViewDirection>l.ViewDirection.NorthEast&&(this.State.ViewDirection=l.ViewDirection.East),this.State.ViewDirection<l.ViewDirection.East&&(this.State.ViewDirection=l.ViewDirection.NorthEast),this.UpdateDirections()}UpdateDirections(){this.RotateAndRound(this.TopTile,r.North),this.RotateAndRound(this.TopRightTile,r.NorthEast),this.RotateAndRound(this.RightTile,r.East),this.RotateAndRound(this.BottomRightTile,r.SouthEast),this.RotateAndRound(this.BottomTile,r.South),this.RotateAndRound(this.BottomLeftTile,r.SouthWest),this.RotateAndRound(this.LeftTile,r.West),this.RotateAndRound(this.TopLeftTile,r.NorthWest)}RotateAndRound(t,e){return t.setFrom(e).rotateFrom((0,l.AngleFromNorth)(this.State.ViewDirection)),t.x=Math.round(t.x),t.y=Math.round(t.y),t.z=Math.round(t.z),t}IsDiagonalView(){return this.State.ViewDirection%2==1}IsWithinScreen(t){const e=this._adjustableIsWithinScreen.setFrom(t);this.AdjustForFocusAndCamera(e);const i=this.ScreenXFor(e),s=this.ScreenYFor(e);return 0-o.Visibility.ScreenMargin<i&&i<this.State.Size.WidthInTiles+o.Visibility.ScreenMargin&&0-o.Visibility.ScreenMargin<s&&s<this.State.Size.HeightInTiles+o.Visibility.ScreenMargin}static HeightOf(t){switch(t){case a.BlockType.Floor:return r.FloorHeight;case a.BlockType.Half:return r.HalfHeight;case a.BlockType.Full:return r.FullHeight;default:return r.NoHeight}}}r.BlockCenter=new s.Vector3(.5,.5,0),r.NoHeight=new s.Vector3(0,0,0),r.FloorHeight=new s.Vector3(0,0,1/40),r.HalfHeight=new s.Vector3(0,0,.5),r.FullHeight=new s.Vector3(0,0,.99999),r.North=new s.Vector3(0,-1,0),r.NorthEast=new s.Vector3(1,-1,0),r.East=new s.Vector3(1,0,0),r.SouthEast=new s.Vector3(1,1,0),r.South=new s.Vector3(0,1,0),r.SouthWest=new s.Vector3(-1,1,0),r.West=new s.Vector3(-1,0,0),r.NorthWest=new s.Vector3(-1,-1,0),r.Above=new s.Vector3(0,0,1),r.Below=new s.Vector3(0,0,-1);class n{constructor(t,e,i,s){this.Top=t,this.Bottom=e,this.Left=i,this.Right=s}}class h{}h.NumberOfLayers=4,h.Bottom=0,h.Floor=1/h.NumberOfLayers,h.Middle=2/h.NumberOfLayers,h.Top=3/h.NumberOfLayers,h.ZFightingAdjustment=1e-4,h.OverlayNorthAdjustment=1*h.ZFightingAdjustment,h.OverlayEastAdjustment=2*h.ZFightingAdjustment,h.OverlayWestAdjustment=3*h.ZFightingAdjustment,h.OverlaySouthAdjustment=4*h.ZFightingAdjustment},"./libs/meld/src/display/services/display-variation-provider.ts":(t,e,i)=>{i.r(e),i.d(e,{DisplayVariationProvider:()=>a});var s=i("./libs/meld/src/state/block.ts");class a{constructor(t){this.Config=t}HasVariation(t){return!!this.Config.BlockSprites.has(t)&&this.Config.BlockSprites.get(t).length>1}GetVariationFor(t,e){const i=s.Blocks.SolidOf(t.Block),a=this.Config.BlockSprites.get(i);let l=0;const o=a.map((t=>t.Weight)).sum()*e;for(let t=0;t<a.length;t++)if(l+=a[t].Weight,o<l)return t;return 0}}},"./libs/meld/src/display/services/input-parser.ts":(t,e,i)=>{i.r(e),i.d(e,{InputParser:()=>c});var s=i("./libs/age/src/index.ts"),a=i("./libs/utility/src/index.ts"),l=i("./libs/meld/src/state/game-update.ts"),o=i("./libs/meld/src/display/state/display-state.ts"),r=i("./libs/meld/src/display/services/camera.ts"),n=i("./libs/meld/src/display/services/input.ts"),h=i("./libs/meld/src/state/block.ts");class c extends s.BaseInputParser{constructor(t,e,i,s,l,o){super(l,o),this.Game=t,this.State=e,this.Camera=i,this.Visibility=s,this.CurrentTarget=a.Vector3.Zero,this.PreviousTarget=a.Vector3.Zero,this.CurrentVector=a.Vector2.Zero,this.PreviousVector=a.Vector2.Zero,this.PreviousMovement=a.Vector2.Zero}GetNewActions(){const t=this.Game.State.Players.get(this.State.PlayerName);return t?(this.Player=t,this.UpdateMode(),this.UpdatePointer(),this.UpdateCamera(),this.UpdateActionStates(),this.ParseActions()):[]}UpdateMode(){this.BoolStateFor(n.Input.HoldCamera)?this.State.InputMode=o.InputMode.Camera:this.BoolStateFor(n.Input.HoldSelection)?this.State.InputMode=o.InputMode.Selection:this.State.InputMode=o.InputMode.Normal}UpdatePointer(){this.PreviousTarget=this.CurrentTarget,this.CurrentTarget=this.CurrentControllerType==s.ControllerType.KeyboardAndMouse?this.GetMouseTarget():this.GetRightStickTarget(),this.PreviousVector=this.CurrentVector,this.CurrentVector=this.CurrentControllerType==s.ControllerType.KeyboardAndMouse?this.GetVectorToMouse():this.GetVectorToRightStick()}ParseActions(){return[this.ParseAction(),this.ParseMovement(),this.ParseUseItem(),this.ParseUseTool(),this.ParseSelectItem(),this.ParseSelectTool()].filter((t=>t))}GetMouseTarget(){return this.Camera.TilePositionFor(this.DisplayProvider.GetInputState("MouseX"),this.DisplayProvider.GetInputState("MouseY"))}GetRightStickTarget(){return new a.Vector3(this.DisplayProvider.GetInputState("PadRightStickRight")-this.DisplayProvider.GetInputState("PadRightStickLeft"),this.DisplayProvider.GetInputState("PadRightStickDown")-this.DisplayProvider.GetInputState("PadRightStickUp"),0).addFrom(this.Game.Entities.Position.Get.Of(this.Player)??a.Vector3.Zero)}GetVectorToMouse(){const t=this.Camera.TilePositionFor(this.DisplayProvider.GetInputState("MouseX"),this.DisplayProvider.GetInputState("MouseY")).subtract(this.Game.Entities.Position.Get.Of(this.Player)??a.Vector3.Zero);return new a.Vector2(t.x,t.y)}GetVectorToRightStick(){return new a.Vector2(this.DisplayProvider.GetInputState("PadRightStickRight")-this.DisplayProvider.GetInputState("PadRightStickLeft"),this.DisplayProvider.GetInputState("PadRightStickDown")-this.DisplayProvider.GetInputState("PadRightStickUp"))}UpdateCamera(){this.HasJustBeenPressed(this.RotateRightInput())&&(this.Camera.RotateCamera(1),this.Visibility.UpdateSize()),this.HasJustBeenPressed(this.RotateLeftInput())&&(this.Camera.RotateCamera(-1),this.Visibility.UpdateSize())}RotateRightInput(){return this.State.InputMode==o.InputMode.Camera?n.Input.CameraModeRotateCameraRight:n.Input.RotateCameraRight}RotateLeftInput(){return this.State.InputMode==o.InputMode.Camera?n.Input.CameraModeRotateCameraLeft:n.Input.RotateCameraLeft}ParseMovement(){const t=this.BoolStateFor(n.Input.HoldWalk)?.5:1,e=this.FloatStateFor(this.MoveUpInput())??0,i=this.FloatStateFor(this.MoveDownInput())??0,s=this.FloatStateFor(this.MoveLeftInput())??0,r=this.FloatStateFor(this.MoveRightInput())??0,h=new a.Vector2(r-s,i-e).rotate((0,o.AngleFromNorth)(this.State.ViewDirection)),c=h.lengthSquared()>1?h.unitVector().multiply(t):h.multiply(t);return c.x===this.PreviousMovement.x&&c.y===this.PreviousMovement.y?null:(this.PreviousMovement=c,new l.MovementAction(this.Player,c))}ParseAction(){const t=this.CurrentVector.isZero()?this.Game.Entities.Orientation.Get.Of(this.Player)??0:this.CurrentVector.getAngle(),e=this.NearestBlockAt(t);return h.Blocks.TypeOf(e)==h.BlockType.Full?this.ParseJump():this.ParseDash(t)}ParseJump(){return this.HasJustBeenReleased(this.ActionInput())?new l.JumpAction(this.Player):null}ParseDash(t){return this.HasJustBeenReleased(this.ActionInput())?new l.ReleaseDashAction(this.Player,t):this.BoolStateFor(this.ActionInput())?new l.ChargeDashAction(this.Player,t):null}NearestBlockAt(t){const e=this.Game.Entities.Position.Get.Of(this.Player)??a.Vector3.Zero;switch((0,o.ViewDirectionFromAngle)(t)){case o.ViewDirection.North:return this.Game.Terrain.Get(e.X+r.Camera.North.X,e.Y+r.Camera.North.Y,e.Z+r.Camera.North.Z);case o.ViewDirection.NorthEast:return this.Game.Terrain.Get(e.X+r.Camera.NorthEast.X,e.Y+r.Camera.NorthEast.Y,e.Z+r.Camera.NorthEast.Z);case o.ViewDirection.East:return this.Game.Terrain.Get(e.X+r.Camera.East.X,e.Y+r.Camera.East.Y,e.Z+r.Camera.East.Z);case o.ViewDirection.SouthEast:return this.Game.Terrain.Get(e.X+r.Camera.SouthEast.X,e.Y+r.Camera.SouthEast.Y,e.Z+r.Camera.SouthEast.Z);case o.ViewDirection.South:return this.Game.Terrain.Get(e.X+r.Camera.South.X,e.Y+r.Camera.South.Y,e.Z+r.Camera.South.Z);case o.ViewDirection.SouthWest:return this.Game.Terrain.Get(e.X+r.Camera.SouthWest.X,e.Y+r.Camera.SouthWest.Y,e.Z+r.Camera.SouthWest.Z);case o.ViewDirection.West:return this.Game.Terrain.Get(e.X+r.Camera.West.X,e.Y+r.Camera.West.Y,e.Z+r.Camera.West.Z);case o.ViewDirection.NorthWest:default:return this.Game.Terrain.Get(e.X+r.Camera.NorthWest.X,e.Y+r.Camera.NorthWest.Y,e.Z+r.Camera.NorthWest.Z)}}ParseUseItem(){const t=this.CurrentTarget,e=!this.PreviousTarget.equals(t);return this.HasJustBeenPressed(this.UseItemInput())?new l.UseItemAction(this.Player,l.ActionState.Start,t):this.HasJustBeenReleased(this.UseItemInput())?new l.UseItemAction(this.Player,l.ActionState.End,t):this.BoolStateFor(this.UseItemInput())&&e?new l.UseItemAction(this.Player,l.ActionState.Unchanged,t):null}ParseUseTool(){const t=this.CurrentTarget,e=!this.PreviousTarget.equals(t),i=this.ActionStateFor(this.ToolPrimaryInput()),s=this.ActionStateFor(this.ToolSecondaryInput());return i!==l.ActionState.Unchanged||s!==l.ActionState.Unchanged||this.ShouldUpdateToolTarget(e)?new l.UseToolAction(this.Player,i,s,t):null}ActionStateFor(t){return this.HasJustBeenPressed(t)?l.ActionState.Start:this.HasJustBeenReleased(t)?l.ActionState.End:l.ActionState.Unchanged}ShouldUpdateToolTarget(t){return t&&(this.BoolStateFor(this.ToolPrimaryInput())||this.BoolStateFor(this.ToolSecondaryInput()))}ActionInput(){return this.State.InputMode==o.InputMode.Normal?n.Input.NormalModeAction:n.Input.Action}UseItemInput(){return this.State.InputMode==o.InputMode.Normal?n.Input.NormalModeUseItem:n.Input.UseItem}ToolPrimaryInput(){return this.State.InputMode==o.InputMode.Normal?n.Input.NormalModeToolPrimary:n.Input.ToolPrimary}ToolSecondaryInput(){return this.State.InputMode==o.InputMode.Normal?n.Input.NormalModeToolSecondary:n.Input.ToolSecondary}MoveUpInput(){return this.State.InputMode==o.InputMode.Normal?n.Input.NormalModeMoveUp:n.Input.MoveUp}MoveDownInput(){return this.State.InputMode==o.InputMode.Normal?n.Input.NormalModeMoveDown:n.Input.MoveDown}MoveLeftInput(){return this.State.InputMode==o.InputMode.Normal?n.Input.NormalModeMoveLeft:n.Input.MoveLeft}MoveRightInput(){return this.State.InputMode==o.InputMode.Normal?n.Input.NormalModeMoveRight:n.Input.MoveRight}ParseSelectItem(){const t=this.Game.Entities.SelectableItems.Get.Of(this.Player);if(!t)return null;const e=t.CurrentItemInSet;return this.HasJustBeenPressed(n.Input.SelectNextItem)?new l.SelectItemAction(this.Player,e+1):this.HasJustBeenPressed(n.Input.SelectPreviousItem)?new l.SelectItemAction(this.Player,e-1):this.HasJustBeenPressed(this.SelectTopItemInput())?this.State.InputMode==o.InputMode.Selection&&0===e?new l.SelectItemSetAction(this.Player,0):new l.SelectItemAction(this.Player,0):this.HasJustBeenPressed(this.SelectRightItemInput())?this.State.InputMode==o.InputMode.Selection&&1===e?new l.SelectItemSetAction(this.Player,1):new l.SelectItemAction(this.Player,1):this.HasJustBeenPressed(this.SelectBottomItemInput())?this.State.InputMode==o.InputMode.Selection&&2===e?new l.SelectItemSetAction(this.Player,2):new l.SelectItemAction(this.Player,2):this.HasJustBeenPressed(this.SelectLeftItemInput())?this.State.InputMode==o.InputMode.Selection&&3===e?new l.SelectItemSetAction(this.Player,3):new l.SelectItemAction(this.Player,3):void 0}ParseSelectTool(){return this.HasJustBeenPressed(this.SelectTopToolInput())?new l.SelectToolAction(this.Player,0):this.HasJustBeenPressed(this.SelectRightToolInput())?new l.SelectToolAction(this.Player,1):this.HasJustBeenPressed(this.SelectBottomToolInput())?new l.SelectToolAction(this.Player,2):this.HasJustBeenPressed(this.SelectLeftToolInput())?new l.SelectToolAction(this.Player,3):void 0}SelectTopItemInput(){return this.State.InputMode==o.InputMode.Selection?n.Input.SelectionModeSelectTopItem:n.Input.SelectTopItem}SelectRightItemInput(){return this.State.InputMode==o.InputMode.Selection?n.Input.SelectionModeSelectRightItem:n.Input.SelectRightItem}SelectBottomItemInput(){return this.State.InputMode==o.InputMode.Selection?n.Input.SelectionModeSelectBottomItem:n.Input.SelectBottomItem}SelectLeftItemInput(){return this.State.InputMode==o.InputMode.Selection?n.Input.SelectionModeSelectLeftItem:n.Input.SelectLeftItem}SelectTopToolInput(){return this.State.InputMode==o.InputMode.Selection?n.Input.SelectionModeSelectTopTool:n.Input.SelectTopTool}SelectRightToolInput(){return this.State.InputMode==o.InputMode.Selection?n.Input.SelectionModeSelectRightTool:n.Input.SelectRightTool}SelectBottomToolInput(){return this.State.InputMode==o.InputMode.Selection?n.Input.SelectionModeSelectBottomTool:n.Input.SelectBottomTool}SelectLeftToolInput(){return this.State.InputMode==o.InputMode.Selection?n.Input.SelectionModeSelectLeftTool:n.Input.SelectLeftTool}}},"./libs/meld/src/display/services/input.ts":(t,e,i)=>{var s;i.r(e),i.d(e,{Input:()=>s}),function(t){t[t.NormalModeMoveUp=0]="NormalModeMoveUp",t[t.NormalModeMoveDown=1]="NormalModeMoveDown",t[t.NormalModeMoveLeft=2]="NormalModeMoveLeft",t[t.NormalModeMoveRight=3]="NormalModeMoveRight",t[t.NormalModeUseItem=4]="NormalModeUseItem",t[t.NormalModeToolPrimary=5]="NormalModeToolPrimary",t[t.NormalModeToolSecondary=6]="NormalModeToolSecondary",t[t.NormalModeAction=7]="NormalModeAction",t[t.MoveUp=8]="MoveUp",t[t.MoveDown=9]="MoveDown",t[t.MoveLeft=10]="MoveLeft",t[t.MoveRight=11]="MoveRight",t[t.UseItem=12]="UseItem",t[t.ToolPrimary=13]="ToolPrimary",t[t.ToolSecondary=14]="ToolSecondary",t[t.Action=15]="Action",t[t.ToggleSelection=16]="ToggleSelection",t[t.HoldSelection=17]="HoldSelection",t[t.SelectionModeSelectTopItem=18]="SelectionModeSelectTopItem",t[t.SelectionModeSelectBottomItem=19]="SelectionModeSelectBottomItem",t[t.SelectionModeSelectLeftItem=20]="SelectionModeSelectLeftItem",t[t.SelectionModeSelectRightItem=21]="SelectionModeSelectRightItem",t[t.SelectionModeSelectTopTool=22]="SelectionModeSelectTopTool",t[t.SelectionModeSelectBottomTool=23]="SelectionModeSelectBottomTool",t[t.SelectionModeSelectLeftTool=24]="SelectionModeSelectLeftTool",t[t.SelectionModeSelectRightTool=25]="SelectionModeSelectRightTool",t[t.SelectTopItem=26]="SelectTopItem",t[t.SelectBottomItem=27]="SelectBottomItem",t[t.SelectLeftItem=28]="SelectLeftItem",t[t.SelectRightItem=29]="SelectRightItem",t[t.SelectTopTool=30]="SelectTopTool",t[t.SelectBottomTool=31]="SelectBottomTool",t[t.SelectLeftTool=32]="SelectLeftTool",t[t.SelectRightTool=33]="SelectRightTool",t[t.ToggleCamera=34]="ToggleCamera",t[t.HoldCamera=35]="HoldCamera",t[t.CameraModeMoveCameraUp=36]="CameraModeMoveCameraUp",t[t.CameraModeMoveCameraDown=37]="CameraModeMoveCameraDown",t[t.CameraModeMoveCameraLeft=38]="CameraModeMoveCameraLeft",t[t.CameraModeMoveCameraRight=39]="CameraModeMoveCameraRight",t[t.CameraModeLookUp=40]="CameraModeLookUp",t[t.CameraModeLookDown=41]="CameraModeLookDown",t[t.CameraModeRotateCameraLeft=42]="CameraModeRotateCameraLeft",t[t.CameraModeRotateCameraRight=43]="CameraModeRotateCameraRight",t[t.MoveCameraUp=44]="MoveCameraUp",t[t.MoveCameraDown=45]="MoveCameraDown",t[t.MoveCameraLeft=46]="MoveCameraLeft",t[t.MoveCameraRight=47]="MoveCameraRight",t[t.LookUp=48]="LookUp",t[t.LookDown=49]="LookDown",t[t.RotateCameraLeft=50]="RotateCameraLeft",t[t.RotateCameraRight=51]="RotateCameraRight",t[t.ToggleInventory=52]="ToggleInventory",t[t.ToggleMenu=53]="ToggleMenu",t[t.ToggleChat=54]="ToggleChat",t[t.SelectTopItemSet=55]="SelectTopItemSet",t[t.SelectBottomItemSet=56]="SelectBottomItemSet",t[t.SelectLeftItemSet=57]="SelectLeftItemSet",t[t.SelectRightItemSet=58]="SelectRightItemSet",t[t.SelectNextItem=59]="SelectNextItem",t[t.SelectPreviousItem=60]="SelectPreviousItem",t[t.HoldWalk=61]="HoldWalk",t[t.ToggleWalk=62]="ToggleWalk"}(s||(s={}))},"./libs/meld/src/display/services/visibility.ts":(t,e,i)=>{i.r(e),i.d(e,{Visibility:()=>r});var s=i("./libs/age/src/index.ts"),a=i("./libs/utility/src/index.ts"),l=i("./libs/meld/src/state/block.ts"),o=i("./libs/meld/src/display/services/camera.ts");class r{constructor(t,e,i,s){this.Game=t,this.Config=e,this.State=i,this.Camera=s,this._adjustableCheckAtPlayerLayer=new a.Vector3(0,0,0),this._adjustableIsBlocked=new a.Vector3(0,0,0),this._adjustableAddToVisibleBelow=new a.Vector3(0,0,0),this._adjustableCheckLowerLayers=new a.Vector3(0,0,0),this._adjustableRevealNextLayer=new a.Vector3(0,0,0),this._adjustableDistanceToCeiling=new a.Vector3(0,0,0),this._adjustableDoTheShowShow=new a.Vector3(0,0,0),this._adjustableIsBlockingPlayer=new a.Vector3(0,0,0)}UpdateSize(){const t=this.DisplayAreaFor(this.Config.DisplayDepth),e=this.DisplayAreaFor(-this.Config.DisplayDepth),i=(t.Right>e.Right?t.Right:e.Right)-(t.Left<e.Left?t.Left:e.Left)+6,l=(t.Bottom>e.Bottom?t.Bottom:e.Bottom)-(t.Top<e.Top?t.Top:e.Top)+6,o=2*this.Config.DisplayDepth+2;this.State.VisibleBlocks=new s.BlockChunk([],new a.Vector3(Math.floor(i),Math.floor(l),o))}Update(){this.Reset(),this.UpdateShownLayers(),this.FindVisibleBlocks()}Reset(){for(let t=0;t<this.State.VisibleBlocks.ChunkSize.x;t++)for(let e=0;e<this.State.VisibleBlocks.ChunkSize.y;e++)for(let i=0;i<this.State.VisibleBlocks.ChunkSize.z;i++)this.State.VisibleBlocks.SetWithoutOffset(t,e,i,!1);this.State.VisibleBlocks.Offset.set(Math.floor(this.State.FocusPoint.x-this.State.VisibleBlocks.ChunkSize.x/2),Math.floor(this.State.FocusPoint.y-this.State.VisibleBlocks.ChunkSize.y/2),Math.floor(this.State.FocusPoint.z-this.State.VisibleBlocks.ChunkSize.z/2))}UpdateShownLayers(){this.State.ShownLayers.clear();for(let t=-this.Config.DisplayDepth;t<=this.Config.DisplayDepth;t++)this.State.ShownLayers.push({layer:t+Math.floor(this.State.FocusPoint.z),area:this.DisplayAreaFor(t)})}DisplayAreaFor(t){const e=[this.Camera.TilePositionFor(0,0),this.Camera.TilePositionFor(1,0),this.Camera.TilePositionFor(0,1),this.Camera.TilePositionFor(1,1)];let i=Number.MAX_VALUE,s=Number.MIN_VALUE,a=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const t of e)t.y<i&&(i=t.y),t.y>s&&(s=t.y),t.x<a&&(a=t.x),t.x>l&&(l=t.x);const n=this.Camera.BottomTile.multiply(t*this.Config.WallDisplayHeight);return new o.DisplayArea(i+n.y-r.ScreenMargin,s+n.y+r.ScreenMargin,a+n.x-r.ScreenMargin,l+n.x+r.ScreenMargin)}FindVisibleBlocks(){this.State.PlayerIsBlocked=!1,this.CheckPlayerLayer(),this.CheckLowerLayers(),this.CheckUpperLayers()}CheckPlayerLayer(){const{layer:t,area:e}=this.State.ShownLayers[this.Config.DisplayDepth];for(let i=Math.floor(e.Top);i<=Math.floor(e.Bottom);i++)for(let s=Math.floor(e.Left);s<=Math.floor(e.Right);s++)this.CheckAtPlayerLayer(s,i,t)}CheckAtPlayerLayer(t,e,i){const s=this._adjustableCheckAtPlayerLayer.set(t,e,i);if(!this.Camera.IsWithinScreen(s))return;const a=l.Blocks.TypeOf(this.Game.Terrain.Get(t,e,i))??l.BlockType.Empty;a!=l.BlockType.Full&&this.State.VisibleBlocks.Set(t,e,i,!0),a!=l.BlockType.Full||this.IsBlocked(s)||this.State.VisibleBlocks.Set(t,e,i,!0),a==l.BlockType.Empty&&this.AddToVisibleBelow(s)}IsBlocked(t){const e=this._adjustableIsBlocked;return(l.Blocks.TypeOf(this.Game.Terrain.GetAt(e.setFrom(t).addFrom(o.Camera.Above)))??l.BlockType.Empty)!=l.BlockType.Empty&&l.Blocks.TypeOf(this.Game.Terrain.GetAt(e.setFrom(t).addFrom(o.Camera.North)))==l.BlockType.Full&&l.Blocks.TypeOf(this.Game.Terrain.GetAt(e.setFrom(t).addFrom(o.Camera.East)))==l.BlockType.Full&&l.Blocks.TypeOf(this.Game.Terrain.GetAt(e.setFrom(t).addFrom(o.Camera.South)))==l.BlockType.Full&&l.Blocks.TypeOf(this.Game.Terrain.GetAt(e.setFrom(t).addFrom(o.Camera.West)))==l.BlockType.Full}AddToVisibleBelow(t){const e=this._adjustableAddToVisibleBelow.setFrom(t),i=e.addFrom(o.Camera.Below);if(this.State.VisibleBlocks.SetAt(i,!0),l.Blocks.TypeOf(this.Game.Terrain.GetAt(i))==l.BlockType.Full)return;const s=Math.ceil(this.Config.WallDisplayHeight);for(let i=1;i<=s;i++)this.State.VisibleBlocks.SetAt(e.setFrom(this.Camera.TopTile).multiplyFrom(i).addFrom(t).addFrom(o.Camera.Below),!0);if(this.Camera.IsDiagonalView())for(let i=0;i<s;i++)this.State.VisibleBlocks.SetAt(e.setFrom(this.Camera.TopTile).multiplyFrom(i).addFrom(t).addFrom(o.Camera.Below).addFrom(this.Camera.TopLeftTile),!0),this.State.VisibleBlocks.SetAt(e.setFrom(this.Camera.TopTile).multiplyFrom(i).addFrom(t).addFrom(o.Camera.Below).addFrom(this.Camera.TopRightTile),!0)}CheckLowerLayers(){for(let t=this.Config.DisplayDepth-1;t>0;t--){const{layer:e,area:i}=this.State.ShownLayers[t];for(let t=Math.floor(i.Top);t<=Math.floor(i.Bottom);t++)for(let s=Math.floor(i.Left);s<=Math.floor(i.Right);s++)this.State.VisibleBlocks.Get(s,t,e)&&this.Camera.IsWithinScreen(this._adjustableCheckLowerLayers.set(s,t,e))&&this.RevealNextLayer(s,t,e)}}RevealNextLayer(t,e,i){(l.Blocks.TypeOf(this.Game.Terrain.Get(t,e,i))??l.BlockType.Empty)==l.BlockType.Empty&&this.AddToVisibleBelow(this._adjustableRevealNextLayer.set(t,e,i))}CheckUpperLayers(){const t=this.Config.DisplayDepth+this.DistanceToCeiling();for(let e=this.Config.DisplayDepth+1;e<=t;e++){const{layer:t,area:i}=this.State.ShownLayers[e];for(let e=Math.floor(i.Top);e<=Math.floor(i.Bottom);e++)for(let s=Math.floor(i.Left);s<=Math.floor(i.Right);s++)this.DoTheShowShow(s,e,t,i)}}DistanceToCeiling(){for(let t=1;t<=this.Config.DisplayDepth;t++)if(l.Blocks.TypeOf(this.Game.Terrain.GetAt(this._adjustableDistanceToCeiling.setFrom(o.Camera.Above).multiplyFrom(t).addFrom(this.State.FocusPoint)))!=l.BlockType.Empty)return t-1;return this.Config.DisplayDepth}DoTheShowShow(t,e,i,s){const a=this._adjustableDoTheShowShow.set(t,e,i);if(!this.Camera.IsWithinScreen(a))return;const o=l.Blocks.TypeOf(this.Game.Terrain.Get(t,e,i))??l.BlockType.Empty;this.State.PlayerIsBlocked||o==l.BlockType.Empty||(this.State.PlayerIsBlocked=this.IsBlockingPlayer(a,s)),o!=l.BlockType.Full&&this.State.VisibleBlocks.Set(t,e,i,!0),o!=l.BlockType.Full||this.IsBlocked(a)||this.State.VisibleBlocks.Set(t,e,i,!0)}IsBlockingPlayer(t,e){const i=new a.Vector3((e.Left+e.Right-1)/2,(e.Top+e.Bottom-1)/2,t.z);return this._adjustableIsBlockingPlayer.setFrom(t).subtract(i).lengthSquared()<1}}r.ScreenMargin=3},"./libs/meld/src/display/state/block-sprites.ts":(t,e,i)=>{i.r(e),i.d(e,{BlockSprites:()=>a,BlockTileOverlays:()=>l,BlockWallOverlays:()=>o});var s=i("./libs/meld/src/display/state/display-state.ts");class a{constructor(t,e,i,s,a,l,o,r,n,h,c,d,u,p,g,m,y,f,S,w,T,k,b,C,B){this.Weight=t,this.TileNorth=e,this.TileNorthEast=i,this.TileEast=s,this.TileSouthEast=a,this.TileSouth=l,this.TileSouthWest=o,this.TileWest=r,this.TileNorthWest=n,this.FullWallNorth=h,this.FullWallNorthEast=c,this.FullWallEast=d,this.FullWallSouthEast=u,this.FullWallSouth=p,this.FullWallSouthWest=g,this.FullWallWest=m,this.FullWallNorthWest=y,this.HalfWallNorth=f,this.HalfWallNorthEast=S,this.HalfWallEast=w,this.HalfWallSouthEast=T,this.HalfWallSouth=k,this.HalfWallSouthWest=b,this.HalfWallWest=C,this.HalfWallNorthWest=B}TileFor(t){switch(t){case s.ViewDirection.North:return this.TileNorth;case s.ViewDirection.NorthEast:return this.TileNorthEast;case s.ViewDirection.East:return this.TileEast;case s.ViewDirection.SouthEast:return this.TileSouthEast;case s.ViewDirection.South:return this.TileSouth;case s.ViewDirection.SouthWest:return this.TileSouthWest;case s.ViewDirection.West:return this.TileWest;case s.ViewDirection.NorthWest:return this.TileNorthWest}}FullWallFor(t){switch(t){case s.ViewDirection.North:return this.FullWallNorth;case s.ViewDirection.NorthEast:return this.FullWallNorthEast;case s.ViewDirection.East:return this.FullWallEast;case s.ViewDirection.SouthEast:return this.FullWallSouthEast;case s.ViewDirection.South:return this.FullWallSouth;case s.ViewDirection.SouthWest:return this.FullWallSouthWest;case s.ViewDirection.West:return this.FullWallWest;case s.ViewDirection.NorthWest:return this.FullWallNorthWest}}HalfWallFor(t){switch(t){case s.ViewDirection.North:return this.HalfWallNorth;case s.ViewDirection.NorthEast:return this.HalfWallNorthEast;case s.ViewDirection.East:return this.HalfWallEast;case s.ViewDirection.SouthEast:return this.HalfWallSouthEast;case s.ViewDirection.South:return this.HalfWallSouth;case s.ViewDirection.SouthWest:return this.HalfWallSouthWest;case s.ViewDirection.West:return this.HalfWallWest;case s.ViewDirection.NorthWest:return this.HalfWallNorthWest}}}class l{constructor(t="default-tile-top",e="default-tile-bottom",i="default-tile-left",s="default-tile-right",a="default-tile-top-left",l="default-tile-top-right",o="default-tile-bottom-left",r="default-tile-bottom-right"){this.TileOverlayTop=t,this.TileOverlayBottom=e,this.TileOverlayLeft=i,this.TileOverlayRight=s,this.TileOverlayTopLeft=a,this.TileOverlayTopRight=l,this.TileOverlayBottomLeft=o,this.TileOverlayBottomRight=r}}class o{constructor(t="default-straight-half-wall-left",e="default-straight-half-wall-right",i="default-diagonal-half-wall-left",s="default-diagonal-half-wall-right",a="default-straight-full-wall-left",l="default-straight-full-wall-right",o="default-diagonal-full-wall-left",r="default-diagonal-full-wall-right"){this.StraightHalfWallOverlayLeft=t,this.StraightHalfWallOverlayRight=e,this.DiagonalHalfWallOverlayLeft=i,this.DiagonalHalfWallOverlayRight=s,this.StraightFullWallOverlayLeft=a,this.StraightFullWallOverlayRight=l,this.DiagonalFullWallOverlayLeft=o,this.DiagonalFullWallOverlayRight=r}}},"./libs/meld/src/display/state/display-config.ts":(t,e,i)=>{i.r(e),i.d(e,{DurationOf:()=>a,GameplaySprites:()=>s});class s{constructor(t="missing-sprite",e="missing-sprite",i="missing-sprite",s="missing-sprite",a="missing-sprite",l="missing-sprite",o="missing-sprite",r="missing-sprite",n="missing-sprite",h="missing-sprite",c="missing-sprite",d="missing-sprite",u="missing-sprite",p="missing-sprite",g="missing-sprite",m="missing-sprite",y="missing-sprite",f="missing-sprite"){this.ShadowSmall=t,this.ShadowMedium=e,this.ShadowBig=i,this.WallShadowFullLeft=s,this.WallShadowFullRight=a,this.WallShadowFullDiagonal=l,this.WallShadowHalfLeft=o,this.WallShadowHalfRight=r,this.WallShadowHalfDiagonal=n,this.DashCloud=h,this.DashRecharge=c,this.DashTarget=d,this.DashTargetFade=u,this.DashFail=p,this.DashMarker=g,this.DashFailMarker=m,this.HudLeft=y,this.HudRight=f}}function a(t){return t.framesX*t.framesY*t.frameInterval}},"./libs/meld/src/display/state/display-state.ts":(t,e,i)=>{i.r(e),i.d(e,{AngleFromNorth:()=>n,DisplayState:()=>o,InputMode:()=>c,ViewDirection:()=>s,ViewDirectionFromAngle:()=>h});var s,a=i("./libs/age/src/index.ts"),l=i("./libs/utility/src/index.ts");class o{constructor(t,e="",i=0,s=new l.Vector3(0,0,0),o=6,r=[],n=[],h=new a.BlockChunk([!1]),c=!1,d=0){this.Size=t,this.PlayerName=e,this.FractionOfTick=i,this.FocusPoint=s,this.ViewDirection=o,this.DisplayEntities=r,this.ShownLayers=n,this.VisibleBlocks=h,this.PlayerIsBlocked=c,this.InputMode=d}static from(t,e){return new o(new a.ScreenSize(t.RenderToVirtualSize,t.VirtualPixelsPerTile,100,100,t.VirtualHeight,t.VirtualHeight),e)}}!function(t){t[t.North=6]="North",t[t.NorthEast=7]="NorthEast",t[t.East=0]="East",t[t.SouthEast=1]="SouthEast",t[t.South=2]="South",t[t.SouthWest=3]="SouthWest",t[t.West=4]="West",t[t.NorthWest=5]="NorthWest"}(s||(s={}));const r=2*Math.PI;function n(t){const e=.125*r;return(0,l.Rotate)(e*t,r/4)}function h(t){return t=(0,l.Rotate)(t,.0625*r),Math.floor(8*t/r)}var c;!function(t){t[t.Normal=0]="Normal",t[t.Selection=1]="Selection",t[t.Camera=2]="Camera"}(c||(c={}))},"./libs/meld/src/display/state/entity-sprites.ts":(t,e,i)=>{i.r(e),i.d(e,{EntitySprites:()=>s,RotationSprite:()=>a,SpriteFor:()=>l});class s{constructor(t,e,i,s){this.Idle=t,this.Walk=e,this.Run=i,this.Dash=s}}class a{constructor(t=1,e="missing-sprite"){this.EndAngle=t,this.Sprite=e}}function l(t,e){if(0==t.length)return"missing-sprite";const i=e/(2*Math.PI);for(const e of t)if(i<e.EndAngle)return e.Sprite;return t[0].Sprite}},"./libs/meld/src/display/terrain/block-context.ts":(t,e,i)=>{i.r(e),i.d(e,{BlockContext:()=>a});var s=i("./libs/utility/src/index.ts");class a{constructor(){this.CurrentAlpha=1,this.AnimationStart=0,this.Position=new s.Vector3(0,0,0)}}},"./libs/meld/src/display/terrain/block-shadow-drawer.ts":(t,e,i)=>{i.r(e),i.d(e,{BlockShadowDrawer:()=>o});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/state/block.ts"),l=i("./libs/meld/src/display/services/camera.ts");class o{constructor(t,e,i){this.Config=t,this.Camera=e,this.Game=i,this._adjustableDrawDiagonalShadows=new s.Vector3(0,0,0),this._adjustableDrawStraightShadows=new s.Vector3(0,0,0),this._adjustable=new s.Vector3(0,0,0)}Draw(t){this.BlockContext=t,this.BlockContext.BlockType!==a.BlockType.Floor&&(this.Camera.IsDiagonalView()?this.DrawDiagonalShadows():this.DrawStraightShadows())}DrawDiagonalShadows(){const t=this._adjustableDrawDiagonalShadows.setFrom(this.BlockContext.Position).addFrom(this.Camera.BottomRightTile).addFrom(l.Camera.BlockCenter);this.DrawStraightShadowsBy(this.Config.GameplaySprites.WallShadowHalfDiagonal,this.Config.GameplaySprites.WallShadowFullDiagonal,t,this.BlockContext.BottomRightBlock)}DrawStraightShadows(){let t=this._adjustableDrawStraightShadows.setFrom(this.BlockContext.Position).addFrom(this.Camera.LeftTile).addFrom(l.Camera.BlockCenter);this.DrawStraightShadowsBy(this.Config.GameplaySprites.WallShadowHalfLeft,this.Config.GameplaySprites.WallShadowFullLeft,t,this.BlockContext.LeftBlock),t=this._adjustableDrawStraightShadows.setFrom(this.BlockContext.Position).addFrom(this.Camera.RightTile).addFrom(l.Camera.BlockCenter),this.DrawStraightShadowsBy(this.Config.GameplaySprites.WallShadowHalfRight,this.Config.GameplaySprites.WallShadowFullRight,t,this.BlockContext.RightBlock)}DrawStraightShadowsBy(t,e,i,s){this.BlockContext.BlockType==a.BlockType.Half?a.Blocks.TypeOf(s)==a.BlockType.Empty&&a.Blocks.TypeOf(this.Game.Terrain.GetAt(this._adjustable.setFrom(i).addFrom(l.Camera.Below)))==a.BlockType.Full?this.Camera.Draw(t,l.Layer.Bottom+l.Layer.OverlayWestAdjustment,i):a.Blocks.TypeOf(s)==a.BlockType.Floor&&this.Camera.Draw(t,l.Layer.Floor+l.Layer.OverlayWestAdjustment,this._adjustable.setFrom(i).addFrom(l.Camera.FloorHeight)):this.BlockContext.BlockType==a.BlockType.Full&&(a.Blocks.TypeOf(s)==a.BlockType.Empty&&a.Blocks.TypeOf(this.Game.Terrain.GetAt(this._adjustable.setFrom(i).addFrom(l.Camera.Below)))==a.BlockType.Full?this.Camera.Draw(e,l.Layer.Bottom+l.Layer.OverlayWestAdjustment,i):a.Blocks.TypeOf(s)==a.BlockType.Floor?this.Camera.Draw(e,l.Layer.Floor+l.Layer.OverlayWestAdjustment,this._adjustable.setFrom(i).addFrom(l.Camera.FloorHeight)):a.Blocks.TypeOf(s)==a.BlockType.Half&&this.Camera.Draw(t,l.Layer.Middle+l.Layer.OverlayWestAdjustment,this._adjustable.setFrom(i).addFrom(l.Camera.HalfHeight)))}}},"./libs/meld/src/display/terrain/border-drawer.ts":(t,e,i)=>{i.r(e),i.d(e,{BorderDrawer:()=>r});var s,a=i("./libs/utility/src/index.ts"),l=i("./libs/meld/src/state/block.ts"),o=i("./libs/meld/src/display/services/camera.ts");class r{constructor(t,e){this.Config=t,this.Camera=e,this._adjustableDrawTileOverlay=new a.Vector3(0,0,0),this._adjustableDrawWallOverlaysFor=new a.Vector3(0,0,0)}Draw(t){this.BlockContext=t,this.Camera.IsDiagonalView()?this.DrawDiagonalTileOverlays():this.DrawTileOverlays(),this.BlockContext.BlockType!=l.BlockType.Floor&&this.DrawWallOverlays()}DrawDiagonalTileOverlays(){this.DrawNeighbourTileOverlay(this.BlockContext.BottomRightBlock,s.BottomRight),this.DrawNeighbourTileOverlay(this.BlockContext.BottomLeftBlock,s.BottomLeft),this.DrawNeighbourTileOverlay(this.BlockContext.TopRightBlock,s.TopRight),this.DrawNeighbourTileOverlay(this.BlockContext.TopLeftBlock,s.TopLeft)}DrawTileOverlays(){this.DrawNeighbourTileOverlay(this.BlockContext.RightBlock,s.Right),this.DrawNeighbourTileOverlay(this.BlockContext.LeftBlock,s.Left),this.DrawNeighbourTileOverlay(this.BlockContext.BottomBlock,s.Bottom),this.DrawNeighbourTileOverlay(this.BlockContext.TopBlock,s.Top)}DrawNeighbourTileOverlay(t,e){this.BlockContext.BlockType>l.Blocks.TypeOf(t)&&!this.ShouldSkipOverlay(e,this.BlockContext.BlockType)&&this.DrawTileOverlay(e)}ShouldSkipOverlay(t,e){return e!==l.BlockType.Floor&&(t===s.BottomRight||t===s.Bottom||t===s.BottomLeft)}DrawTileOverlay(t){const e=this.TileLayerFor(this.BlockContext.BlockType),i=this.LayerForSide(t),s=this.TileOverlayFor(t),a=this._adjustableDrawTileOverlay.setFrom(this.BlockContext.Position).addFrom(o.Camera.HeightOf(this.BlockContext.BlockType)).addFrom(o.Camera.BlockCenter);this.Camera.Draw(s,e+i,a,null,0,0,null,this.BlockContext.CurrentAlpha,!0)}TileLayerFor(t){switch(t){case l.BlockType.Floor:return o.Layer.Floor;case l.BlockType.Half:return o.Layer.Middle;case l.BlockType.Full:return o.Layer.Top;default:return o.Layer.Bottom}}LayerForSide(t){switch(t){case s.Bottom:case s.BottomLeft:return o.Layer.OverlayNorthAdjustment;case s.Top:case s.TopRight:return o.Layer.OverlaySouthAdjustment;case s.Left:case s.TopLeft:return o.Layer.OverlayEastAdjustment;default:return o.Layer.OverlayWestAdjustment}}DrawWallOverlays(){const t=this.Camera.IsDiagonalView()?this.HighestBlockAmong(this.BlockContext.TopRightBlock,this.BlockContext.RightBlock,this.BlockContext.BottomRightBlock):l.Blocks.TypeOf(this.BlockContext.RightBlock);t!==l.BlockType.Full&&this.DrawWallOverlaysFor(t,s.Right);const e=this.Camera.IsDiagonalView()?this.HighestBlockAmong(this.BlockContext.TopLeftBlock,this.BlockContext.LeftBlock,this.BlockContext.BottomLeftBlock):l.Blocks.TypeOf(this.BlockContext.LeftBlock);e!==l.BlockType.Full&&this.DrawWallOverlaysFor(e,s.Left)}DrawWallOverlaysFor(t,e){const i=this._adjustableDrawWallOverlaysFor.setFrom(this.BlockContext.Position).addFrom(o.Camera.BlockCenter);this.BlockContext.BlockType!==l.BlockType.Full||t!==l.BlockType.Empty&&t!==l.BlockType.Floor?this.BlockContext.BlockType===l.BlockType.Full&&t===l.BlockType.Half?this.Camera.Draw(this.HalfWallOverlayFor(e),o.Layer.Middle+o.Layer.OverlayWestAdjustment,i.addFrom(o.Camera.HalfHeight),null,0,0,null,this.BlockContext.CurrentAlpha,!0):this.BlockContext.BlockType!==l.BlockType.Half||t!==l.BlockType.Empty&&t!==l.BlockType.Floor||this.Camera.Draw(this.HalfWallOverlayFor(e),o.Layer.Middle+o.Layer.OverlayWestAdjustment,i,null,0,0,null,this.BlockContext.CurrentAlpha,!0):this.Camera.Draw(this.FullWallOverlayFor(e),o.Layer.Middle+o.Layer.OverlayWestAdjustment,i,null,0,0,null,this.BlockContext.CurrentAlpha,!0)}HighestBlockAmong(t,e,i){let s=l.Blocks.TypeOf(t);return l.Blocks.TypeOf(e)>s&&(s=l.Blocks.TypeOf(e)),l.Blocks.TypeOf(i)>s&&(s=l.Blocks.TypeOf(i)),s}TileOverlayFor(t){const e=l.Blocks.SolidOf(this.BlockContext.Block),i=this.Config.BlockTileOverlays.has(e)?this.Config.BlockTileOverlays.get(e):this.Config.DefaultTileOverlays;switch(t){case s.Bottom:return i.TileOverlayBottom;case s.Top:return i.TileOverlayTop;case s.Left:return i.TileOverlayLeft;case s.Right:return i.TileOverlayRight;case s.TopLeft:return i.TileOverlayTopLeft;case s.TopRight:return i.TileOverlayTopRight;case s.BottomLeft:return i.TileOverlayBottomLeft;case s.BottomRight:return i.TileOverlayBottomRight}}HalfWallOverlayFor(t){const e=l.Blocks.SolidOf(this.BlockContext.Block),i=this.Config.BlockWallOverlays.has(e)?this.Config.BlockWallOverlays.get(e):this.Config.DefaultWallOverlays;switch(t){case s.Left:return this.Camera.IsDiagonalView()?i.DiagonalHalfWallOverlayLeft:i.StraightHalfWallOverlayLeft;case s.Right:return this.Camera.IsDiagonalView()?i.DiagonalHalfWallOverlayRight:i.StraightHalfWallOverlayRight}}FullWallOverlayFor(t){const e=l.Blocks.SolidOf(this.BlockContext.Block),i=this.Config.BlockWallOverlays.has(e)?this.Config.BlockWallOverlays.get(e):this.Config.DefaultWallOverlays;switch(t){case s.Left:return this.Camera.IsDiagonalView()?i.DiagonalFullWallOverlayLeft:i.StraightFullWallOverlayLeft;case s.Right:return this.Camera.IsDiagonalView()?i.DiagonalFullWallOverlayRight:i.StraightFullWallOverlayRight}}}!function(t){t[t.Bottom=0]="Bottom",t[t.Top=1]="Top",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.TopLeft=4]="TopLeft",t[t.TopRight=5]="TopRight",t[t.BottomLeft=6]="BottomLeft",t[t.BottomRight=7]="BottomRight"}(s||(s={}))},"./libs/meld/src/display/terrain/terrain-drawer.ts":(t,e,i)=>{i.r(e),i.d(e,{TerrainDrawer:()=>o});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/state/block.ts"),l=i("./libs/meld/src/display/terrain/block-context.ts");class o{constructor(t,e,i,a,o){this.Game=t,this.Config=e,this.State=i,this.Camera=a,this.BlockDrawers=o,this.BlockContext=new l.BlockContext,this.Position=new s.Vector3(0,0,0),this._adjustableUpdateContext=new s.Vector3(0,0,0),this._adjustableShouldBeTransparentAtPlayerLayer=new s.Vector3(0,0,0),this._adjustableShouldBeTransparentDueToDirection=new s.Vector3(0,0,0),this._adjustableIsInBottomHalf=new s.Vector3(0,0,0),this._adjustableIsInQuadrant=new s.Vector3(0,0,0)}Draw(){for(let t=0;t<this.State.VisibleBlocks.ChunkSize.x;t++)for(let e=0;e<this.State.VisibleBlocks.ChunkSize.y;e++)for(let i=0;i<this.State.VisibleBlocks.ChunkSize.z;i++)this.State.VisibleBlocks.GetWithoutOffset(t,e,i)&&this.DrawBlock(this.State.VisibleBlocks.Offset.x+t,this.State.VisibleBlocks.Offset.y+e,this.State.VisibleBlocks.Offset.z+i)}DrawBlock(t,e,i){const s=this.Game.Terrain.Get(t,e,i);if(a.Blocks.TypeOf(s)!=a.BlockType.Empty){this.Position.set(t,e,i),this.UpdateContext(s,t,e,i);for(const t of this.BlockDrawers)t.Draw(this.BlockContext)}}UpdateContext(t,e,i,s){const l=this._adjustableUpdateContext.set(e,i,s);this.BlockContext.CurrentAlpha=this.GetTransparency(t,l),this.BlockContext.AnimationStart=this.AnimationStartFor(l),this.BlockContext.Block=t,this.BlockContext.BlockType=a.Blocks.TypeOf(t),this.BlockContext.Position.set(e,i,s),this.BlockContext.TopBlock=this.Game.Terrain.GetAt(l.set(e,i,s).addFrom(this.Camera.TopTile)),this.BlockContext.TopRightBlock=this.Game.Terrain.GetAt(l.set(e,i,s).addFrom(this.Camera.TopRightTile)),this.BlockContext.RightBlock=this.Game.Terrain.GetAt(l.set(e,i,s).addFrom(this.Camera.RightTile)),this.BlockContext.BottomRightBlock=this.Game.Terrain.GetAt(l.set(e,i,s).addFrom(this.Camera.BottomRightTile)),this.BlockContext.BottomBlock=this.Game.Terrain.GetAt(l.set(e,i,s).addFrom(this.Camera.BottomTile)),this.BlockContext.BottomLeftBlock=this.Game.Terrain.GetAt(l.set(e,i,s).addFrom(this.Camera.BottomLeftTile)),this.BlockContext.LeftBlock=this.Game.Terrain.GetAt(l.set(e,i,s).addFrom(this.Camera.LeftTile)),this.BlockContext.TopLeftBlock=this.Game.Terrain.GetAt(l.set(e,i,s).addFrom(this.Camera.TopLeftTile))}GetTransparency(t,e){return 0==Math.floor(e.z)-Math.floor(this.State.FocusPoint.z)&&this.ShouldBeTransparentAtPlayerLayer(t,e)?this.Config.TransparencyAlpha:1}ShouldBeTransparentAtPlayerLayer(t,e){const i=this._adjustableShouldBeTransparentAtPlayerLayer,s=a.Blocks.TypeOf(t);return s!=a.BlockType.Empty&&s!=a.BlockType.Floor&&!(i.setFrom(e).subtractFrom(this.State.FocusPoint).lengthSquared()>this.Config.TransparencyRadius*this.Config.TransparencyRadius)&&(this.Camera.IsDiagonalView()?this.DiagonalShouldBeTransparent(s,e):this.StraightShouldBeTransparent(s,e))}DiagonalShouldBeTransparent(t,e){return this.IsInQuadrant(e,this.Camera.LeftTile)?this.ShouldBeTransparentDueToDirection(t,e,this.Camera.TopTile)&&this.ShouldBeTransparentDueToDirection(t,e,this.Camera.TopRightTile):this.IsInQuadrant(e,this.Camera.RightTile)?this.ShouldBeTransparentDueToDirection(t,e,this.Camera.TopTile)&&this.ShouldBeTransparentDueToDirection(t,e,this.Camera.TopLeftTile):!!this.IsInQuadrant(e,this.Camera.BottomTile)&&this.ShouldBeTransparentDueToDirection(t,e,this.Camera.TopTile)}ShouldBeTransparentDueToDirection(t,e,i){const s=this._adjustableShouldBeTransparentDueToDirection;if(!this.State.VisibleBlocks.GetAt(s.setFrom(e).addFrom(i)))return!1;const l=a.Blocks.TypeOf(this.Game.Terrain.GetAt(s.setFrom(e).addFrom(i)));if(t==a.BlockType.Half||this.Camera.IsDiagonalView())return l<t;const o=a.Blocks.TypeOf(this.Game.Terrain.GetAt(s.setFrom(e).addFrom(i).addFrom(i)));return l<t||o<t}StraightShouldBeTransparent(t,e){return this.IsInBottomHalf(e)&&this.ShouldBeTransparentDueToDirection(t,e,this.Camera.TopTile)}IsInBottomHalf(t){const e=this._adjustableIsInBottomHalf.setFrom(t).subtract(this.State.FocusPoint),i=e.x*this.Camera.BottomTile.x,s=e.y*this.Camera.BottomTile.y;return i>=0&&s>=0}IsInQuadrant(t,e){const i=this._adjustableIsInQuadrant.setFrom(t).subtract(this.State.FocusPoint);i.x+=1;const s=i.x*e.x,a=i.y*e.y;return s>0&&a>0}AnimationStartFor(t){let e=t.x,i=t.y,s=t.z;0==e&&(e=1234),0==i&&(i=1234),0==s&&(s=1234);const a=345*(e/13+i/31+s/71);return Math.floor(1e4*(a-Math.floor(a)))}}},"./libs/meld/src/display/terrain/tile-drawer.ts":(t,e,i)=>{i.r(e),i.d(e,{TileDrawer:()=>o});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/state/block.ts"),l=i("./libs/meld/src/display/services/camera.ts");class o{constructor(t,e,i,a){this.Config=t,this.State=e,this.Camera=i,this.Game=a,this._adjustableDrawBlockTile=new s.Vector3(0,0,0),this._adjustableHasBlockAbove=new s.Vector3(0,0,0),this._adjustableDrawTileBelowTransparent=new s.Vector3(0,0,0)}Draw(t){this.BlockContext=t,this.DrawTileBelowTransparent(),this.DrawBlockTile()}DrawBlockTile(){const t=this.layerFor(this.BlockContext.BlockType),e=l.Camera.HeightOf(this.BlockContext.BlockType),i=this.HasBlockAbove()?new s.Vector3(.7,.7,.7):null,a=this._adjustableDrawBlockTile.setFrom(this.BlockContext.Position).addFrom(e).addFrom(l.Camera.BlockCenter);this.Camera.DrawAnimated(this.TileSprite(),t,a,null,this.BlockContext.AnimationStart,0,i,this.BlockContext.CurrentAlpha,!0)}layerFor(t){switch(t){case a.BlockType.Floor:return l.Layer.Floor;case a.BlockType.Half:return l.Layer.Middle;case a.BlockType.Full:return l.Layer.Top;default:throw new Error("Invalid argument: No layer for empty blocks")}}HasBlockAbove(){return!!a.Blocks.HasSolid(this.Game.Terrain.GetAt(this._adjustableHasBlockAbove.setFrom(this.BlockContext.Position).addFrom(l.Camera.Above)))||this.BlockContext.BlockType==a.BlockType.Full&&a.Blocks.HasSolid(this.Game.Terrain.GetAt(this._adjustableHasBlockAbove.setFrom(this.BlockContext.Position).addFrom(l.Camera.Above).addFrom(l.Camera.Above)))}DrawTileBelowTransparent(){if(1==this.BlockContext.CurrentAlpha)return;const t=this._adjustableDrawTileBelowTransparent.setFrom(this.BlockContext.Position);this.Camera.DrawAnimated(this.TileSprite(),l.Layer.Bottom,t.addFrom(l.Camera.BlockCenter),null,this.BlockContext.AnimationStart,0,null,this.BlockContext.CurrentAlpha,!0)}TileSprite(){const t=this.BlockContext.Block;return this.Config.BlockSprites.get(a.Blocks.SolidOf(t))[a.Blocks.VariantOf(t)].TileFor(this.State.ViewDirection)}}},"./libs/meld/src/display/terrain/wall-drawer.ts":(t,e,i)=>{i.r(e),i.d(e,{WallDrawer:()=>o});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/state/block.ts"),l=i("./libs/meld/src/display/services/camera.ts");class o{constructor(t,e,i){this.Config=t,this.State=e,this.Camera=i,this._adjustableDraw=new s.Vector3(0,0,0),this._adjustableShouldSkipFullWall=new s.Vector3(0,0,0)}Draw(t){this.BlockContext=t;const e=this.SmallestBlockInFront(),i=this._adjustableDraw.setFrom(this.BlockContext.Position).addFrom(l.Camera.BlockCenter);this.BlockContext.BlockType!==a.BlockType.Half||this.ShouldSkipHalfWall(e)||this.Camera.DrawAnimated(this.HalfWallSprite(),l.Layer.Middle-l.Layer.ZFightingAdjustment,i,null,this.BlockContext.AnimationStart,0,null,this.BlockContext.CurrentAlpha,!0),this.BlockContext.BlockType!==a.BlockType.Full||this.ShouldSkipFullWall(e)||this.Camera.DrawAnimated(this.FullWallSprite(),l.Layer.Middle,i,null,this.BlockContext.AnimationStart,0,null,this.BlockContext.CurrentAlpha,!0)}SmallestBlockInFront(){if(!this.Camera.IsDiagonalView())return a.Blocks.TypeOf(this.BlockContext.BottomBlock);const t=a.Blocks.TypeOf(this.BlockContext.BottomLeftBlock),e=a.Blocks.TypeOf(this.BlockContext.BottomRightBlock);return t<e?t:e}ShouldSkipHalfWall(t){return a.BlockType.Half<=t}ShouldSkipFullWall(t){const e=this.BlockContext.Position,i=this._adjustableShouldSkipFullWall,s=this.Camera.IsDiagonalView(),l=s?this.State.VisibleBlocks.GetAt(i.setFrom(e).addFrom(this.Camera.TopLeftTile))&&a.Blocks.TypeOf(this.BlockContext.TopLeftBlock)!==a.BlockType.Full:this.State.VisibleBlocks.GetAt(i.setFrom(e).addFrom(this.Camera.TopTile))&&a.Blocks.TypeOf(this.BlockContext.TopBlock)!==a.BlockType.Full,o=s?this.State.VisibleBlocks.GetAt(i.setFrom(e).addFrom(this.Camera.TopRightTile))&&a.Blocks.TypeOf(this.BlockContext.TopRightBlock)!==a.BlockType.Full:this.State.VisibleBlocks.GetAt(i.setFrom(e).addFrom(this.Camera.RightTile))&&a.Blocks.TypeOf(this.BlockContext.RightBlock)!==a.BlockType.Full,r=s?this.State.VisibleBlocks.GetAt(i.setFrom(e).addFrom(this.Camera.BottomRightTile))&&a.Blocks.TypeOf(this.BlockContext.BottomRightBlock)!==a.BlockType.Full:this.State.VisibleBlocks.GetAt(i.setFrom(e).addFrom(this.Camera.BottomTile))&&a.Blocks.TypeOf(this.BlockContext.BottomBlock)!==a.BlockType.Full,n=s?this.State.VisibleBlocks.GetAt(i.setFrom(e).addFrom(this.Camera.BottomLeftTile))&&a.Blocks.TypeOf(this.BlockContext.BottomLeftBlock)!==a.BlockType.Full:this.State.VisibleBlocks.GetAt(i.setFrom(e).addFrom(this.Camera.LeftTile))&&a.Blocks.TypeOf(this.BlockContext.LeftBlock)!==a.BlockType.Full;return!(t!==a.BlockType.Full||l||o||r||n)}FullWallSprite(){const t=this.BlockContext.Block;return this.Config.BlockSprites.get(a.Blocks.SolidOf(t))[a.Blocks.VariantOf(t)].FullWallFor(this.State.ViewDirection)}HalfWallSprite(){const t=this.BlockContext.Block;return this.Config.BlockSprites.get(a.Blocks.SolidOf(t))[a.Blocks.VariantOf(t)].HalfWallFor(this.State.ViewDirection)}}},"./libs/meld/src/generation/region-generator.ts":(t,e,i)=>{i.r(e),i.d(e,{RegionGenerator:()=>r});var s=i("./libs/age/src/index.ts"),a=i("./libs/meld/src/state/block.ts"),l=i("./libs/meld/src/state/region.ts"),o=i("./libs/meld/src/variation-provider.ts");class r{constructor(t,e,i,a,r,n=l.Region.New(i,t.Constants.RegionSizeInChunks,t.Constants.ChunkSize),h=new o.BlockSurroundings(0,0,0,0,0),c=new s.Random(a)){this.Config=t,this.VariationProvider=e,this.RegionCoords=i,this.WorldSeed=a,this.TimelineSeed=r,this.Region=n,this.Surroundings=h,this.random=c}Generate(){return this.GenerateBlocks(),this.SetVariations(),this.Region}GenerateBlocks(){const t=this.Region;for(let e=t.Offset.X;e<t.Offset.X+t.Size.X;e++)for(let i=t.Offset.Y;i<t.Offset.Y+t.Size.Y;i++)for(let s=t.Offset.Z;s<t.Offset.Z+t.Size.Z;s++)this.Region.Set(e,i,s,this.BlockFor(e,i,s))}BlockFor(t,e,i){const s=this.Config;return this.IsRegionBorder(t,e,i)?a.Blocks.NewFull(s.SolidTypeMap.TypeIdFor("stone-block")):this.IsHole(t,e)?a.Blocks.NewEmpty(s.NonSolidTypeMap.TypeIdFor("air")):this.IsTower(t,e)?a.Blocks.NewFull(s.SolidTypeMap.TypeIdFor("stone-flagstone")):this.BaseLayerBlockFor(i)}IsRegionBorder(t,e,i){const s=(t+256)%512,a=(e+256)%512;return 0==i&&(0==s||511==s||0==a||511==a)}IsHole(t,e){return 10<t&&t<=30&&10<e&&e<=30}IsTower(t,e){return 0<t&&t<=50&&-50<=e&&e<-1}BaseLayerBlockFor(t){const e=this.Config;return t<-3?a.Blocks.NewFull(e.SolidTypeMap.TypeIdFor("darkstone")):t<-2?a.Blocks.NewFull(e.SolidTypeMap.TypeIdFor("soil-poor")):t<-1?a.Blocks.NewFull(e.SolidTypeMap.TypeIdFor("soil-rich")):t<0?a.Blocks.NewFull(e.SolidTypeMap.TypeIdFor("grass-rich")):a.Blocks.NewEmpty(e.NonSolidTypeMap.TypeIdFor("air"))}SetVariations(){const t=this.Region;for(let e=t.Offset.X;e<t.Offset.X+t.Size.X;e++)for(let i=t.Offset.Y;i<t.Offset.Y+t.Size.Y;i++)for(let s=t.Offset.Z;s<t.Offset.Z+t.Size.Z;s++)this.Region.Set(e,i,s,this.GetVariationFor(e,i,s))}GetVariationFor(t,e,i){const s=this.Region.Get(t,e,i);if(!this.VariationProvider.HasVariation(a.Blocks.SolidOf(s)))return s;this.Surroundings.Block=s;const l=this.VariationProvider.GetVariationFor(this.Surroundings,this.random.Float());return a.Blocks.WithVariation(s,l)}}},"./libs/meld/src/logic/block-collision-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{BlockCollisionLogic:()=>o});var s=i("./libs/age/src/index.ts"),a=i("./libs/utility/src/index.ts"),l=i("./libs/meld/src/state/block.ts");class o{constructor(t,e,i,s,a,l,o){this.Constants=t,this.Entities=e,this.Terrain=i,this.CircularSize=s,this.Position=a,this.Velocity=l,this.SetVelocity=o}Update(){for(const[t]of this.Entities.With.BlockCollisionBehaviour)this.UpdateEntity(t)}UpdateEntity(t){const e=this.Velocity.CurrentlyOf(t);if(e?.isZero()??1)return;const i=this.CollisionVelocityChange(t,e);i&&this.SetVelocity.For(t,i)}CollisionVelocityChange(t,e){const i=this.Position.CurrentlyOf(t)??a.Vector3.Zero,l=this.CircularSize.CurrentlyOf(t),o=l?s.Box.OccupiedArea(i,l):s.Box.From(i),r=this.RelativeDistanceToCollisionX(o,e.x),n=this.RelativeDistanceToCollisionY(o,e.y),h=this.RelativeDistanceToCollisionZ(o,e.z);return r>=1&&n>=1&&h>=1||(e=this.UpdateVelocitiesInOrder(r,n,h,o,e))==this.Velocity.CurrentlyOf(t)?null:e}RelativeDistanceToCollisionX(t,e){const i=e>0?t.MaxX:t.MinX;return this.RelativeDistanceToCollision(i,e,1)}RelativeDistanceToCollisionY(t,e){const i=e>0?t.MaxY:t.MinY;return this.RelativeDistanceToCollision(i,e,1)}RelativeDistanceToCollisionZ(t,e){const i=e>0?t.MaxZ:t.MinZ;return this.RelativeDistanceToCollision(i,e,.5)}RelativeDistanceToCollision(t,e,i){const s=t<0?i+t%i:t%i;return(e<0?s:i-s)/Math.abs(e)}UpdateVelocitiesInOrder(t,e,i,s,a){return t<=e&&t<=i?(a=this.UpdateVelocityX(t,s,a),e<=i?(a=this.UpdateVelocityY(e,s,a),a=this.UpdateVelocityZ(i,s,a)):(a=this.UpdateVelocityZ(i,s,a),a=this.UpdateVelocityY(e,s,a))):e<=t&&e<=i?(a=this.UpdateVelocityY(e,s,a),t<=i?(a=this.UpdateVelocityX(t,s,a),a=this.UpdateVelocityZ(i,s,a)):(a=this.UpdateVelocityZ(i,s,a),a=this.UpdateVelocityX(t,s,a))):(a=this.UpdateVelocityZ(i,s,a),t<=e?(a=this.UpdateVelocityX(t,s,a),a=this.UpdateVelocityY(e,s,a)):(a=this.UpdateVelocityY(e,s,a),a=this.UpdateVelocityX(t,s,a))),a}UpdateVelocityX(t,e,i){if(t>=1)return i;const s=e.TranslateBy(i.multiply(t));return this.CollisionAtX(s,i.x)?i.withX(this.TruncatedDistance(i.x*t)):i}UpdateVelocityY(t,e,i){if(t>=1)return i;const s=e.TranslateBy(i.multiply(t));return this.CollisionAtY(s,i.y)?i.withY(this.TruncatedDistance(i.y*t)):i}UpdateVelocityZ(t,e,i){if(t>=1)return i;const s=e.TranslateBy(i.multiply(t));return this.CollisionAtZ(s,i.z)?i.withZ(this.TruncatedDistance(i.z*t)):i}TruncatedDistance(t){return t>this.Constants.CollisionAreaWidth?t-this.Constants.CollisionAreaWidth/8:t>-this.Constants.CollisionAreaWidth?0:t+this.Constants.CollisionAreaWidth/8}CollisionAtX(t,e){const i=e>0?t.MaxX+.5:t.MinX-.5;for(const e of this.BlockPositionsY(t)){if(this.IsSolidAtPoint(i,e,t.MinZ))return!0;for(const s of this.BlockPositionAboveBottom(t))if(this.IsSolidInBlock(i,e,s))return!0}return!1}CollisionAtY(t,e){const i=e>0?t.MaxY+.5:t.MinY-.5;for(const e of this.BlockPositionsX(t)){if(this.IsSolidAtPoint(e,i,t.MinZ))return!0;for(const s of this.BlockPositionAboveBottom(t))if(this.IsSolidInBlock(e,i,s))return!0}return!1}CollisionAtZ(t,e){const i=e>0?t.MaxZ+.5:t.MinZ+this.Constants.CollisionAreaWidth/8;for(const s of this.BlockPositionsX(t))for(const a of this.BlockPositionsY(t))if(e>0?this.IsSolidInBlock(s,a,i):this.IsSolidGoingDown(s,a,i))return!0;return!1}IsSolidGoingDown(t,e,i){const s=l.Blocks.TypeOf(this.Terrain.Get(t,e,i)),a=i<0?1+i%1:i%1;return.5<a&&a<.5+this.Constants.CollisionAreaWidth?s==l.BlockType.Half:0<a&&a<this.Constants.CollisionAreaWidth&&(s==l.BlockType.Floor||l.Blocks.TypeOf(this.Terrain.Get(t,e,i-1))==l.BlockType.Full)}*BlockPositionsX(t){for(let e=t.MinX;e<t.MaxX;e++)yield e;yield t.MaxX}*BlockPositionsY(t){for(let e=t.MinY;e<t.MaxY;e++)yield e;yield t.MaxY}*BlockPositionAboveBottom(t){for(let e=t.MinZ+1;e<t.MaxZ;e++)yield e;t.MinZ<Math.floor(t.MaxZ)&&(yield t.MaxZ)}IsSolidAtPoint(t,e,i){const s=i<0?1-i%1:i%1;switch(l.Blocks.TypeOf(this.Terrain.Get(t,e,i))){case l.BlockType.Empty:case l.BlockType.Floor:return!1;case l.BlockType.Half:return s<.5;case l.BlockType.Full:return!0}}IsSolidInBlock(t,e,i){return l.Blocks.HasSolid(this.Terrain.Get(t,e,i))}}},"./libs/meld/src/logic/dash-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{DashLogic:()=>o});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/state/game-update.ts"),l=i("./libs/meld/src/values/dash-state.ts");class o{constructor(t,e,i,s,a,l,o,r,n,h=[]){this.Constants=t,this.Globals=e,this.Entities=i,this.DashState=s,this.SetDashState=a,this.GravityBehaviour=l,this.SetGravityBehaviour=o,this.Velocity=r,this.SetVelocity=n,this.Listeners=h}Update(t){for(const[t,e]of this.Entities.With.DashState)e.IsCharging?this.ChargeDash(t,e):this.DashEffectShouldEnd(e)&&this.EndDashEffect(t);for(const e of t)e instanceof a.ChargeDashAction?this.UpdateCharge(e.Entity,e.Angle):e instanceof a.ReleaseDashAction&&this.ReleaseDash(e.Entity,e.Angle)}ChargeDash(t,e){this.SetDashState.For(t,new l.DashState(e.TimeOfLastDash,e.IsCharging,e.HasFailedQuickDash,e.Charge+this.Constants.DashChargeSpeed,e.Angle))}DashEffectShouldEnd(t){return this.Globals.Tick-t.TimeOfLastDash==this.Constants.DashDuration}EndDashEffect(t){this.SetGravityBehaviour.For(t,this.GravityBehaviour.DefaultOf(t)??!0)}UpdateCharge(t,e){const i=this.DashState.CurrentlyOf(t)??new l.DashState;this.CooldownHasPassed(i)&&this.SetDashState.For(t,new l.DashState(i.TimeOfLastDash,!0,!1,i.Charge+this.Constants.DashChargeSpeed,e))}CooldownHasPassed(t){return this.Globals.Tick-t.TimeOfLastDash>this.Constants.DashCooldown}ReleaseDash(t,e){const i=this.DashState.CurrentlyOf(t)??new l.DashState;if(!this.CanQuickDash(i,e)&&!i.IsCharging)return this.SetDashState.For(t,new l.DashState(i.TimeOfLastDash,i.IsCharging,!0,i.Charge,i.Angle)),void this.Notify(t,!1,new l.DashState(i.TimeOfLastDash,i.IsCharging,i.HasFailedQuickDash,i.Charge,e));const a=Math.min(i.Charge+this.Constants.InitialDashCharge,this.Constants.MaxDashCharge);this.SetDashState.For(t,new l.DashState(this.Globals.Tick,!1,i.HasFailedQuickDash,0,e));const o=this.Velocity.Of(t)?.z??0,r=new s.Vector3(a,0,0).rotate(e);r.z=o,this.SetVelocity.For(t,r),this.SetGravityBehaviour.For(t,!1),this.Notify(t,!0,new l.DashState(i.TimeOfLastDash,i.IsCharging,i.HasFailedQuickDash,i.Charge,e))}CanQuickDash(t,e){return!t.HasFailedQuickDash&&t.IsInInterval(this.Globals.Tick,this.Constants.QuickDashWindowStart,this.Constants.QuickDashWindowEnd)&&t.IsWithinAngle(e,this.Constants.QuickDashMinimumAngle)}Notify(t,e,i){for(const s of this.Listeners)s.OnDash(t,e,i)}}},"./libs/meld/src/logic/despawn-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{DespawnLogic:()=>s});class s{constructor(t,e){this.Globals=t,this.Entities=e}Update(){for(const[t,e]of this.Entities.With.DespawnTime)e<=this.Globals.Tick&&this.Despawn(t)}Despawn(t){this.Entities.Remove(t)}}},"./libs/meld/src/logic/gravity-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{GravityLogic:()=>l});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/state/block.ts");class l{constructor(t,e,i,s,a,l){this.Constants=t,this.Entities=e,this.Terrain=i,this.Position=s,this.Velocity=a,this.SetVelocity=l}Update(){for(const[t]of this.Entities.With.GravityBehaviour)this.updateEntity(t)}updateEntity(t){const e=this.Position.CurrentlyOf(t)??s.Vector3.Zero;if(this.hasGroundAt(e))return;const i=this.Velocity.CurrentlyOf(t)??s.Vector3.Zero,a=i.withZ(i.z-this.Constants.GravityAcceleration);this.SetVelocity.For(t,a)}hasGroundAt(t){return t.z<Math.floor(t.z)+this.Constants.CollisionAreaWidth?this.isInOrAboveSolidBlock(t):t.z<Math.floor(t.z)+.5+this.Constants.CollisionAreaWidth?this.isInHalfOrFullBlock(t):a.Blocks.TypeOf(this.Terrain.GetAt(t))==a.BlockType.Full}isInOrAboveSolidBlock(t){return a.Blocks.TypeOf(this.Terrain.GetAt(t))!=a.BlockType.Empty||a.Blocks.TypeOf(this.Terrain.Get(t.x,t.y,t.z-1))==a.BlockType.Full}isInHalfOrFullBlock(t){switch(a.Blocks.TypeOf(this.Terrain.GetAt(t))){case a.BlockType.Half:case a.BlockType.Full:return!0;default:return!1}}}},"./libs/meld/src/logic/jump-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{JumpLogic:()=>l});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/state/game-update.ts");class l{constructor(t,e,i,s=[]){this.Constants=t,this.Velocity=e,this.SetVelocity=i,this.Listeners=s}Update(t){for(const e of t)e instanceof a.JumpAction&&this.Jump(e.Entity)}Jump(t){const e=(this.Velocity.Of(t)??s.Vector3.Zero).withZ(1);this.SetVelocity.For(t,e),this.Notify(t)}Notify(t){for(const e of this.Listeners)e.OnJump(t)}}},"./libs/meld/src/logic/load-player-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{LoadPlayerLogic:()=>n});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/state/game-update.ts"),l=i("./libs/meld/src/state/item.ts"),o=i("./libs/meld/src/values/selectable-items.ts"),r=i("./libs/meld/src/values/selectable-tools.ts");class n{constructor(t,e,i,s){this.Config=t,this.State=e,this.Changes=i,this.Entities=s}Update(t){for(const e of t)e instanceof a.LoadPlayer?this.LoadPlayer(e.Player):e instanceof a.UnloadPlayer&&this.UnloadPlayer(e.Player)}LoadPlayer(t){this.State.LoadPlayer(t)||this.SpawnPlayer(t)}UnloadPlayer(t){const e=this.State.Players.get(t);e&&(this.State.UnloadPlayer(t),this.Changes.EntityValues.RemoveValuesFor(e),this.Changes.EntityValues.Entities.delete(e))}SpawnPlayer(t){const e=this.Config,i=this.Entities.Create(e.Constants.PlayerType);this.Entities.Position.Set.For(i,new s.Vector3(0,0,0));const a=[new l.Item(e.Constants.SolidItemType,e.SolidTypeMap.TypeIdFor("grass-rich"),0),new l.Item(e.Constants.SolidItemType,e.SolidTypeMap.TypeIdFor("darkstone"),0),new l.Item(e.Constants.SolidItemType,e.SolidTypeMap.TypeIdFor("stone-block"),0),new l.Item(e.Constants.SolidItemType,e.SolidTypeMap.TypeIdFor("stone-flagstone"),0),new l.Item(e.Constants.SolidItemType,e.SolidTypeMap.TypeIdFor("soil-rich"),0),new l.Item(e.Constants.SolidItemType,e.SolidTypeMap.TypeIdFor("soil-poor"),0),new l.Item(e.Constants.SolidItemType,e.SolidTypeMap.TypeIdFor("darkstone-block"),0),new l.Item(e.Constants.SolidItemType,e.SolidTypeMap.TypeIdFor("darkstone-flagstone"),0),new l.Item(e.Constants.SolidItemType,e.SolidTypeMap.TypeIdFor("darkwood"),0),new l.Item(e.Constants.SolidItemType,e.SolidTypeMap.TypeIdFor("darkwood-beam"),0),new l.Item(e.Constants.SolidItemType,e.SolidTypeMap.TypeIdFor("darkwood-planks"),0),new l.Item(e.Constants.SolidItemType,e.SolidTypeMap.TypeIdFor("darkwood-planks-weathered"),0),new l.Item(e.Constants.SolidItemType,e.SolidTypeMap.TypeIdFor("wood"),0),new l.Item(e.Constants.SolidItemType,e.SolidTypeMap.TypeIdFor("wood-beam"),0),new l.Item(e.Constants.SolidItemType,e.SolidTypeMap.TypeIdFor("wood-planks"),0),new l.Item(e.Constants.SolidItemType,e.SolidTypeMap.TypeIdFor("wood-planks-weathered"),0)];this.Entities.SelectableItems.Set.For(i,new o.SelectableItems(a));const n=[new l.Item(e.ItemTypeMap.TypeIdFor("basic-hammer"),0,0),null,null,null];this.Entities.SelectableTools.Set.For(i,new r.SelectableTools(n)),this.State.Players.set(t,i)}}},"./libs/meld/src/logic/load-state-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{LoadStateLogic:()=>a});var s=i("./libs/meld/src/state/game-update.ts");class a{constructor(t,e){this.State=t,this.Terrain=e}Update(t){for(const e of t)if(e instanceof s.LoadState)this.State.LoadFrom(e.State),this.Terrain.WorldBounds=this.State.Globals.WorldBounds;else if(e instanceof s.LoadRegion){const t=e.Region.RegionCoords().stringify();this.State.Regions.set(t,e.Region)}}}},"./libs/meld/src/logic/loading-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{LoadingLogic:()=>s});class s{constructor(t,e,i,s,a,l){this.Config=t,this.Constants=e,this.State=i,this.Entities=s,this.PersistenceProvider=a,this.VariationProvider=l}Update(){this.State.Globals.Tick}GetRegionsThatAreLoaded(){return[]}GetRegionsThatShouldBeLoaded(){return[]}RemoveRegion(t){this.State.Regions.delete(t.stringify())}}},"./libs/meld/src/logic/movement-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{MovementLogic:()=>l});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/state/game-update.ts");class l{constructor(t,e,i,s,a,l,o){this.Constants=t,this.Entities=e,this.SetOrientation=i,this.TargetVelocity=s,this.SetTargetVelocity=a,this.Velocity=l,this.SetVelocity=o}Update(t){for(const e of t)e instanceof a.MovementAction&&this.HandleMovement(e.Entity,e.Velocity);for(const[t]of this.Entities.With.TargetVelocity)this.UpdateVelocity(t)}HandleMovement(t,e){const i=this.GetMovementVelocity(e),a=new s.Vector3(i.x,i.y,0);this.SetTargetVelocity.For(t,a),0==a.x&&0==a.y||this.SetOrientation.For(t,a.getAngle())}GetMovementVelocity(t){return t.lengthSquared()>1?t.unitVector().multiply(this.Constants.MaxMoveSpeed):t.multiply(this.Constants.MaxMoveSpeed)}UpdateVelocity(t){const e=this.TargetVelocity.CurrentlyOf(t)??s.Vector3.Zero,i=this.Velocity.Of(t)??s.Vector3.Zero;if(e.x===i.x&&e.y===i.y)return;const a=e.subtract(i.withZ(0)),l=a.lengthSquared()<this.Constants.Acceleration*this.Constants.Acceleration?a:a.unitVector().multiply(this.Constants.Acceleration);this.SetVelocity.For(t,i.add(l))}}},"./libs/meld/src/logic/out-of-bounds-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{OutOfBoundsLogic:()=>s});class s{constructor(t,e,i,s){this.Globals=t,this.Entities=e,this.Position=i,this.SetPosition=s}Update(){if(this.Globals.WorldBounds)for(const[t,e]of this.Entities.With.Velocity)this.UpdateEntity(t)}UpdateEntity(t){const e=this.Position.CurrentlyOf(t);e&&(this.Globals.WorldBounds.Contains(e)||this.SetPosition.For(t,this.Globals.WorldBounds.Contain(e)))}}},"./libs/meld/src/logic/selected-item-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{SelectedItemLogic:()=>a});var s=i("./libs/meld/src/state/game-update.ts");class a{constructor(t,e){this.SelectableItems=t,this.SetSelectableItems=e}Update(t){for(const e of t)e instanceof s.SelectItemAction?this.UpdateSelectedItemFor(e.Entity,e.ItemIndex):e instanceof s.SelectItemSetAction&&this.UpdateSelectedItemSetFor(e.Entity,e.ItemSetIndex)}UpdateSelectedItemFor(t,e){const i=this.SelectableItems.Of(t);i&&this.SetSelectableItems.For(t,i.SelectItem(e))}UpdateSelectedItemSetFor(t,e){const i=this.SelectableItems.Of(t);i&&this.SetSelectableItems.For(t,i.SelectItemSet(e))}}},"./libs/meld/src/logic/selected-tool-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{SelectedToolLogic:()=>a});var s=i("./libs/meld/src/state/game-update.ts");class a{constructor(t,e){this.SelectableTools=t,this.SetSelectableTools=e}Update(t){for(const e of t)e instanceof s.SelectToolAction&&this.UpdateSelectedItemFor(e.Entity,e.ToolIndex)}UpdateSelectedItemFor(t,e){const i=this.SelectableTools.Of(t);i&&this.SetSelectableTools.For(t,i.SelectTool(e))}}},"./libs/meld/src/logic/spawn-monster-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{SpawnMonsterLogic:()=>l});var s=i("./libs/age/src/index.ts"),a=i("./libs/utility/src/index.ts");class l{constructor(t,e,i,s,a,l,o){this.Config=t,this.State=e,this.Globals=i,this.Entities=s,this.Position=a,this.SetPosition=l,this.Random=o}Update(){if(this.Globals.Tick%200==0)for(const t of this.ActiveRegions())this.SpawnMonsterIn(t)}SpawnMonsterIn(t){const e=this.Config.Lists.RandomlySpawningMonsters.first(),i=this.Entities.Create(e),s=this.Config.Constants.RegionSize(),l=new a.Vector3(t.Offset.X+s.X*this.Random.Float(),t.Offset.Y+s.Y*this.Random.Float(),0);this.SetPosition.For(i,l),this.Entities.DespawnTime.Set.For(i,this.Globals.Tick+1e4)}*ActiveRegions(){for(const t of this.State.Players.values()){const e=this.Position.Of(t)??a.Vector3.Zero,i=(0,s.RegionCoordsFor)(Math.floor(e.X),Math.floor(e.Y),Math.floor(e.Z),this.Config.Constants.RegionSize());this.State.Regions.has(i.stringify())&&(yield this.State.Regions.get(i.stringify()))}}}},"./libs/meld/src/logic/update-state-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{UpdateStateLogic:()=>s});class s{constructor(t,e,i,s){this.State=t,this.Entities=e,this.Terrain=i,this.Random=s}Update(){this.State.Globals.Tick++,this.Entities.ApplyUpdatedValues(),this.Terrain.ApplyUpdatedValues(),this.Random.SetSeed(this.State.Globals.Seed+this.State.Globals.Tick)}}},"./libs/meld/src/logic/use-item-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{UseItemLogic:()=>o});var s=i("./libs/meld/src/state/block.ts"),a=i("./libs/meld/src/state/game-update.ts"),l=i("./libs/meld/src/state/item.ts");class o{constructor(t,e,i){this.Config=t,this.Terrain=e,this.SelectableItems=i}Update(t){for(const e of t)e instanceof a.UseItemAction&&this.UseItem(e.Entity,e.ActionState,e.Target)}UseItem(t,e,i){const s=this.SelectableItems.Of(t)?.CurrentItem();s&&this.Config.ItemValues.get(s.Type)?.Kind===l.ItemKind.Solid&&this.PlaceBlock(s,e,i)}PlaceBlock(t,e,i){if(e!=a.ActionState.Start)return;const l=t.Content,o=this.Terrain.GetAt(i)??s.Blocks.NewEmpty(0);s.Blocks.TypeOf(o)===s.BlockType.Empty?this.Terrain.SetAt(i,s.Blocks.NewFloor(l,s.Blocks.NonSolidOf(o))):s.Blocks.SolidOf(o)!==l?this.Terrain.SetAt(i,s.Blocks.New(s.Blocks.TypeOf(o),l,s.Blocks.NonSolidOf(o))):s.Blocks.TypeOf(o)===s.BlockType.Floor?this.Terrain.SetAt(i,s.Blocks.NewHalf(l,s.Blocks.NonSolidOf(o))):s.Blocks.TypeOf(o)===s.BlockType.Half&&this.Terrain.SetAt(i,s.Blocks.NewFull(l))}}},"./libs/meld/src/logic/use-tool-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{UseToolLogic:()=>n});var s=i("./libs/utility/src/index.ts"),a=i("./libs/meld/src/state/block.ts"),l=i("./libs/meld/src/state/game-update.ts"),o=i("./libs/meld/src/state/item.ts"),r=i("./libs/meld/src/values/tool-state.ts");class n{constructor(t,e,i,s,a,l,o,r,n,h,c,d){this.Config=t,this.Globals=e,this.Entities=i,this.Terrain=s,this.SetDespawnTime=a,this.Position=l,this.SetPosition=o,this.SelectableTools=r,this.ToolState=n,this.SetToolState=h,this.Velocity=c,this.SetVelocity=d}Update(t){for(const[t,e]of this.Entities.With.ToolState)this.UpdateState(t,e);for(const e of t)e instanceof l.UseToolAction&&this.UseTool(e)}UseTool(t){const e=this.SelectableTools.Of(t.Entity);if(!e)return;const i=e.CurrentTool();i&&this.Config.ItemValues.get(i.Type)?.Kind==o.ItemKind.Hammer&&this.HandleHammer(t,i)}HandleHammer(t,e){t.PrimaryActionState===l.ActionState.Start?this.HandleHammerStartPrimary(t,e):t.PrimaryActionState===l.ActionState.Unchanged?this.HandleHammerUpdatePrimary(t):t.PrimaryActionState===l.ActionState.End&&this.HandleHammerEndPrimary(t,e)}HandleHammerStartPrimary(t,e){const i=this.ToolState.Of(t.Entity)??new r.ToolState(r.ToolAction.HammerStrike,e,[],t.Target);this.Globals.Tick<i.EndTime||this.SetToolState.For(t.Entity,r.ToolState.From({...i,Action:r.ToolAction.HammerStrike,StartTime:this.Globals.Tick,EndTime:Number.MAX_SAFE_INTEGER,Target:t.Target}))}HandleHammerUpdatePrimary(t){const e=this.ToolState.Of(t.Entity);e&&(e.EndTime<=this.Globals.Tick||this.SetToolState.For(t.Entity,r.ToolState.From({...e,Target:t.Target})))}HandleHammerEndPrimary(t,e){const i=this.ToolState.Of(t.Entity)??new r.ToolState(r.ToolAction.HammerStrike,e,[],t.Target);this.SetToolState.For(t.Entity,r.ToolState.From({...i,EndTime:0}))}UpdateState(t,e){if(e.EndTime<=this.Globals.Tick)return;const i=this.Position.CurrentlyOf(t)??s.Vector3.Zero,a=this.Velocity.CurrentlyOf(t)??s.Vector3.Zero,l=this.UpdateSubEntities(e.SubEntities,a);if((this.Globals.Tick-e.StartTime)%30==20){const s=this.HammerStrikeHit(e,i,a);l.push(s),this.SetToolState.For(t,r.ToolState.From({...e,SubEntities:l}))}else l.length!==e.SubEntities.length&&this.SetToolState.For(t,r.ToolState.From({...e,SubEntities:l}))}UpdateSubEntities(t,e){const i=[];for(const s of t)this.Entities.Exists(s)&&(this.SetVelocity.For(s,e),i.push(s));return i}HammerStrikeHit(t,e,i){return this.MineBlockAt(t.Target),this.CreateHitFor(e,i)}CreateHitFor(t,e){const i=this.Entities.Create(this.Config.EntityTypeMap.TypeIdFor("despawning"));return this.SetPosition.For(i,new s.Vector3(0,1,.5).addFrom(t).addFrom(e)),this.SetDespawnTime.For(i,this.Globals.Tick+3),i}MineBlockAt(t){const e=this.Terrain.GetAt(t);a.Blocks.TypeOf(e)==a.BlockType.Floor?this.Terrain.SetAt(t,a.Blocks.NewEmpty(a.Blocks.NonSolidOf(e))):a.Blocks.TypeOf(e)==a.BlockType.Half?this.Terrain.SetAt(t,a.Blocks.NewFloor(a.Blocks.SolidOf(e),a.Blocks.NonSolidOf(e))):a.Blocks.TypeOf(e)==a.BlockType.Full&&this.Terrain.SetAt(t,a.Blocks.NewHalf(a.Blocks.SolidOf(e),a.Blocks.NonSolidOf(e)))}}},"./libs/meld/src/logic/velocity-logic.ts":(t,e,i)=>{i.r(e),i.d(e,{VelocityLogic:()=>a});var s=i("./libs/utility/src/index.ts");class a{constructor(t,e,i,s,a,l){this.Constants=t,this.Entities=e,this.Position=i,this.SetPosition=s,this.Velocity=a,this.SetVelocity=l}Update(){for(const[t,e]of this.Entities.With.Velocity)this.UpdateEntity(t)}UpdateEntity(t){const e=this.Velocity.CurrentlyOf(t);if(!e||e.isZero())return;const i=this.CappedVelocity(e),s=this.Position.CurrentlyOf(t);this.SetPosition.For(t,s.add(i)),this.SetVelocity.For(t,i)}CappedVelocity(t){return this.Constants.TerminalVerticalVelocity<Math.abs(t.z)?new s.Vector3(t.x,t.y,t.z=Math.sign(t.z)*this.Constants.TerminalVerticalVelocity):t}}},"./libs/meld/src/meld-game.ts":(t,e,i)=>{var s,a,l;i.r(e),i.d(e,{MeldGame:()=>k,updatesPerSecond:()=>T});var o=i("./libs/age/src/index.ts"),r=i("./libs/utility/src/index.ts"),n=i("./libs/meld/src/display-config.json"),h=i("./libs/meld/src/display-settings.json"),c=i("./libs/meld/src/display/meld-display.ts"),d=i("./libs/meld/src/display/services/display-variation-provider.ts"),u=i("./libs/meld/src/game-config.json"),p=i("./libs/meld/src/generation/region-generator.ts"),g=i("./libs/meld/src/meld.ts"),m=i("./libs/meld/src/serialisation/serialisation-display-config.ts"),y=i("./libs/meld/src/serialisation/serialisation-display-settings.ts"),f=i("./libs/meld/src/serialisation/serialisation-game-config.ts"),S=i("./libs/meld/src/serialisation/serialisation-game-state.ts"),w=i("./libs/meld/src/state/game-update.ts");const T=60;class k extends o.GameRunner{constructor(t,e,i,s,a=new ResizeObserver((()=>this.setSize(t.clientWidth,t.clientHeight)))){super(e,s,T),this.meldDisplay=e,this.displayProvider=i,this.meld=s,this.resizeObserver=a,this.onUnload=()=>{this.saveGame()},this.resizeObserver.observe(t);const l=localStorage["meld-save-0.4"];l?this.actions.push(new w.LoadState((0,S.readGameState)(s.Config,JSON.parse(l)))):this.actions.push(new w.LoadRegion(new p.RegionGenerator(s.Config,new d.DisplayVariationProvider(e.Config),new r.Vector3(0,0,0),0,0).Generate()),new w.LoadPlayer("insertPlayerName")),window.addEventListener("unload",this.onUnload),this.afterGameUpdate=()=>this.displayProvider.endInputFrame()}saveGame(){const t=(0,S.createGameState)(this.meld.Config,this.meld.State);localStorage["meld-save-0.4"]=JSON.stringify(t)}static createAt(t,e){const r=(0,f.readGameConfig)(s||(s=i.t(u,2)));e={...(0,m.readDisplayConfig)(r,a||(a=i.t(n,2))),...e};const p=new g.Meld(new d.DisplayVariationProvider(e),r),S=(0,y.readDisplaySettings)(l||(l=i.t(h,2))),w=new o.HtmlDisplayProvider(t,e),T=new c.MeldDisplay(e,S,p,w,"insertPlayerName");return new k(t,T,w,p)}setSize(t,e){this.meldDisplay.setSize(t,e),this.displayProvider.setSize(t,e)}onDestroy(){super.onDestroy(),this.resizeObserver.disconnect(),window.removeEventListener("visibilitychanged",this.onUnload),this.saveGame()}}},"./libs/meld/src/meld.ts":(t,e,i)=>{i.r(e),i.d(e,{Meld:()=>M});var s=i("./libs/age/src/index.ts"),a=i("./libs/meld/src/logic/movement-logic.ts"),l=i("./libs/meld/src/logic/use-item-logic.ts"),o=i("./libs/meld/src/logic/selected-item-logic.ts"),r=i("./libs/meld/src/logic/update-state-logic.ts"),n=i("./libs/meld/src/logic/velocity-logic.ts"),h=i("./libs/meld/src/state/entity-values.ts"),c=i("./libs/meld/src/state/globals.ts"),d=i("./libs/meld/src/state/changes.ts"),u=i("./libs/meld/src/state/meld-entities.ts"),p=i("./libs/meld/src/state/game-state.ts"),g=i("./libs/meld/src/logic/load-state-logic.ts"),m=i("./libs/meld/src/logic/block-collision-logic.ts"),y=i("./libs/meld/src/logic/gravity-logic.ts"),f=i("./libs/meld/src/logic/dash-logic.ts"),S=i("./libs/meld/src/logic/out-of-bounds-logic.ts"),w=i("./libs/meld/src/logic/selected-tool-logic.ts"),T=i("./libs/meld/src/logic/use-tool-logic.ts"),k=i("./libs/meld/src/logic/despawn-logic.ts"),b=i("./libs/meld/src/logic/load-player-logic.ts"),C=i("./libs/meld/src/logic/loading-logic.ts"),B=i("./libs/meld/src/logic/jump-logic.ts"),D=i("./libs/meld/src/logic/spawn-monster-logic.ts");class M extends s.BaseGame{constructor(t,e,i=new p.GameState(new c.Globals,new h.EntityValues),M=new d.Changes(new h.EntityValues),F=new s.TerrainManager(e.Constants.RegionSize(),e.Constants.DefaultBlock,i.Regions,M.UpdatedBlocks,i.Globals.WorldBounds),v=new u.MeldEntities(e.EntityTypeValues,i.EntityValues,M.EntityValues,i),I=new s.Random(i.Globals.Tick+i.Globals.Seed),x=new m.BlockCollisionLogic(e.Constants,v,F,v.CircularSize.Get,v.Position.Get,v.Velocity.Get,v.Velocity.Set),V=new f.DashLogic(e.Constants,i.Globals,v,v.DashState.Get,v.DashState.Set,v.GravityBehaviour.Get,v.GravityBehaviour.Set,v.Velocity.Get,v.Velocity.Set),E=new k.DespawnLogic(i.Globals,v),A=new y.GravityLogic(e.Constants,v,F,v.Position.Get,v.Velocity.Get,v.Velocity.Set),P=new B.JumpLogic(e.Constants,v.Velocity.Get,v.Velocity.Set),W=new C.LoadingLogic(e,e.Constants,i,v,null,t),O=new b.LoadPlayerLogic(e,i,M,v),R=new g.LoadStateLogic(i,F),L=new a.MovementLogic(e.Constants,v,v.Orientation.Set,v.TargetVelocity.Get,v.TargetVelocity.Set,v.Velocity.Get,v.Velocity.Set),G=new S.OutOfBoundsLogic(i.Globals,v,v.Position.Get,v.Position.Set),H=new o.SelectedItemLogic(v.SelectableItems.Get,v.SelectableItems.Set),z=new w.SelectedToolLogic(v.SelectableTools.Get,v.SelectableTools.Set),N=new D.SpawnMonsterLogic(e,i,i.Globals,v,v.Position.Get,v.Position.Set,I),U=new r.UpdateStateLogic(i,v,F,I),X=new l.UseItemLogic(e,F,v.SelectableItems.Get),Y=new T.UseToolLogic(e,i.Globals,v,F,v.DespawnTime.Set,v.Position.Get,v.Position.Set,v.SelectableTools.Get,v.ToolState.Get,v.ToolState.Set,v.Velocity.Get,v.Velocity.Set),j=new n.VelocityLogic(e.Constants,v,v.Position.Get,v.Position.Set,v.Velocity.Get,v.Velocity.Set)){super([W,L,V,A,P,x,j,G,X,Y,H,z,N,E,O,U,R]),this.variationProvider=t,this.Config=e,this.State=i,this.changes=M,this.Terrain=F,this.Entities=v,this.random=I,this.blockCollisionLogic=x,this.dashLogic=V,this.despawnLogic=E,this.gravityLogic=A,this.jumpLogic=P,this.loadingLogic=W,this.loadPlayerLogic=O,this.loadStateLogic=R,this.movementLogic=L,this.outOfBoundsLogic=G,this.selectedItemLogic=H,this.selectedToolLogic=z,this.spawnMonsterLogic=N,this.updateStateLogic=U,this.useItemLogic=X,this.useToolLogic=Y,this.velocityLogic=j}}},"./libs/meld/src/serialisation/serialisation-display-config.ts":(t,e,i)=>{i.r(e),i.d(e,{readDisplayConfig:()=>r});var s=i("./libs/meld/src/display/state/block-sprites.ts"),a=i("./libs/meld/src/display/state/display-config.ts"),l=i("./libs/meld/src/display/state/entity-sprites.ts"),o=i("./libs/meld/src/meld-game.ts");function r(t,e){const i=new Map;for(const s in e.BlockSprites)i.set(t.SolidTypeMap.TypeIdFor(s),e.BlockSprites[s].map((t=>h(t))));const o=new Map;for(const i in e.BlockTileOverlays)o.set(t.SolidTypeMap.TypeIdFor(i),Object.assign(new s.BlockTileOverlays,e.BlockTileOverlays[i]));const r=new Map;for(const i in e.BlockWallOverlays)r.set(t.SolidTypeMap.TypeIdFor(i),Object.assign(new s.BlockWallOverlays,e.BlockWallOverlays[i]));const c=new Map;for(const i in e.EntitySprites){const s=e.EntitySprites[i],a=new l.EntitySprites(s.Idle.map((t=>Object.assign(new l.RotationSprite,t))),s.Walk?.map((t=>Object.assign(new l.RotationSprite,t))),s.Run?.map((t=>Object.assign(new l.RotationSprite,t))),s.Dash?.map((t=>Object.assign(new l.RotationSprite,t))));c.set(t.EntityTypeMap.TypeIdFor(i),a)}const d=new Map;for(const i in e.ItemSprites)d.set(t.ItemTypeMap.TypeIdFor(i),e.ItemSprites[i]);const u=e.DefaultSpriteTypes??{},p={};for(const t in e.Sprites)p[t]=n(t,e.Sprites[t],u);return{RenderToVirtualSize:e.RenderToVirtualSize??!0,VirtualPixelsPerTile:e.VirtualPixelsPerTile??16,VirtualHeight:e.VirtualHeight??360,WallDisplayHeight:e.WallDisplayHeight??2,DisplayDepth:e.DisplayDepth??4,TransparencyRadius:e.TransparencyRadius??5,TransparencyAlpha:e.TransparencyAlpha??.4,BlockingTransparencyRadius:e.BlockingTransparencyRadius??10,BlockingTransparencyAlpha:e.BlockingTransparencyAlpha??.2,AssetFolder:e.AssetFolder??"assets/",DefaultTileOverlays:Object.assign(new s.BlockTileOverlays,e.DefaultTileOverlays??{}),DefaultWallOverlays:Object.assign(new s.BlockWallOverlays,e.DefaultWallOverlays??{}),BlockSprites:i,BlockTileOverlays:o,BlockWallOverlays:r,EntitySprites:c,ItemSprites:d,GameplaySprites:Object.assign(new a.GameplaySprites,e.GameplaySprites??{}),Sprites:p}}function n(t,e,i){const s=i[e.type],a=e.frameInterval??s?.frameInterval??0;return{path:e.path??t,width:e.width??s?.width??16,height:e.height??s?.height??16,centerX:e.centerX??s?.centerX??0,centerY:e.centerY??s?.centerY??0,framesX:e.framesX??s?.framesX??1,framesY:e.framesY??s?.framesY??1,frameInterval:Math.floor(a*o.updatesPerSecond)}}function h(t){return new s.BlockSprites(t.Weight??t.Weight??1,t.TileNorth??t.StraightTile??"missing-sprite",t.TileNorthEast??t.DiagonalTile??"missing-sprite",t.TileEast??t.StraightTile??"missing-sprite",t.TileSouthEast??t.DiagonalTile??"missing-sprite",t.TileSouth??t.StraightTile??"missing-sprite",t.TileSouthWest??t.DiagonalTile??"missing-sprite",t.TileWest??t.StraightTile??"missing-sprite",t.TileNorthWest??t.DiagonalTile??"missing-sprite",t.FullWallNorth??t.StraightFullWall??"missing-sprite",t.FullWallNorthEast??t.DiagonalFullWall??"missing-sprite",t.FullWallEast??t.StraightFullWall??"missing-sprite",t.FullWallSouthEast??t.DiagonalFullWall??"missing-sprite",t.FullWallSouth??t.StraightFullWall??"missing-sprite",t.FullWallSouthWest??t.DiagonalFullWall??"missing-sprite",t.FullWallWest??t.StraightFullWall??"missing-sprite",t.FullWallNorthWest??t.DiagonalFullWall??"missing-sprite",t.HalfWallNorth??t.StraightHalfWall??t.StraightFullWall??"missing-sprite",t.HalfWallNorthEast??t.DiagonalHalfWall??t.DiagonalFullWall??"missing-sprite",t.HalfWallEast??t.StraightHalfWall??t.StraightFullWall??"missing-sprite",t.HalfWallSouthEast??t.DiagonalHalfWall??t.DiagonalFullWall??"missing-sprite",t.HalfWallSouth??t.StraightHalfWall??t.StraightFullWall??"missing-sprite",t.HalfWallSouthWest??t.DiagonalHalfWall??t.DiagonalFullWall??"missing-sprite",t.HalfWallWest??t.StraightHalfWall??t.StraightFullWall??"missing-sprite",t.HalfWallNorthWest??t.DiagonalHalfWall??t.DiagonalFullWall??"missing-sprite")}},"./libs/meld/src/serialisation/serialisation-display-settings.ts":(t,e,i)=>{i.r(e),i.d(e,{readDisplaySettings:()=>a});var s=i("./libs/meld/src/display/services/input.ts");function a(t){const e=new Map;for(const i in t.Inputs)e.set(s.Input[i],t.Inputs[i]);return{Inputs:e}}},"./libs/meld/src/serialisation/serialisation-game-config.ts":(t,e,i)=>{i.r(e),i.d(e,{readGameConfig:()=>g});var s=i("./libs/age/src/index.ts"),a=i("./libs/utility/src/index.ts"),l=i("./libs/meld/src/config/constants.ts"),o=i("./libs/meld/src/config/game-config.ts"),r=i("./libs/meld/src/meld-game.ts"),n=i("./libs/meld/src/state/block.ts"),h=i("./libs/meld/src/state/item.ts"),c=i("./libs/meld/src/values/dash-state.ts"),d=i("./libs/meld/src/values/selectable-items.ts"),u=i("./libs/meld/src/values/selectable-tools.ts"),p=i("./libs/meld/src/config/lists.ts");function g(t){const e=Object.keys(t.EntityTypes),i=s.TypeMap.From(s.EntityTypeOffset,e),g=Object.keys(t.SolidTypes),m=s.TypeMap.From(n.SolidOffset,g),y=Object.keys(t.NonSolidTypes),f=s.TypeMap.From(n.NonSolidOffset,y),S=Object.keys(t.ItemTypes),w=s.TypeMap.From(n.NonSolidOffset,S);return new o.GameConfig(function(t,e,i,o,h){return new l.Constants(e.TypeIdFor(t.PlayerType),i.TypeIdFor(t.SolidItemType),n.Blocks.New(n.BlockType[t.DefaultBlock.BlockType],o.TypeIdFor(t.DefaultBlock.Solid),h.TypeIdFor(t.DefaultBlock.NonSolid)),Object.assign(new a.Vector3(2,2,2),t.RegionSizeInChunks),Object.assign(new a.Vector3(50,50,5),t.ChunkSize),t.DefaultWorldBounds?Object.assign(new s.Box(-50,50,-50,50,-50,50),t.DefaultWorldBounds):null,t.ChunkLoadingRadius??1,t.CollisionAreaWidth??1/1024,(t.GravityAcceleration??.5)/r.updatesPerSecond,(t.TerminalVerticalVelocity??10)/r.updatesPerSecond,(t.MaxMoveSpeed??8)/r.updatesPerSecond,(t.Acceleration??3)/r.updatesPerSecond,(t.InitialDashCharge??30)/r.updatesPerSecond,(t.MaxDashCharge??50)/r.updatesPerSecond,(t.DashChargeSpeed??1)/r.updatesPerSecond,Math.floor((t.DashDuration??.2)*r.updatesPerSecond),Math.floor((t.DashCooldown??1)*r.updatesPerSecond),Math.floor((t.QuickDashWindowStart??.1)*r.updatesPerSecond),Math.floor((t.QuickDashWindowEnd??1)*r.updatesPerSecond),t.QuickDashMinimumAngle*a.Tau??a.Tau/8,Math.floor((t.MiningStartup??20/60)*r.updatesPerSecond),Math.floor((t.MiningRecovery??10/60)*r.updatesPerSecond))}(t.Constants,i,w,m,f),function(t,e){return new p.Lists(t.RandomlySpawningMonsters?.map((t=>e.TypeIdFor(t)))??[])}(t.Lists,i),i,new Map(e.map((e=>{return[i.TypeIdFor(e),(l=t.EntityTypes[e],{CircularSize:l.CircularSize?Object.assign(new s.CircularSize(0,0),l.CircularSize):null,DashState:l.DashState?Object.assign(new c.DashState,l.DashState):null,DespawnTime:l.DespawnTime,Health:l.Health,Orientation:l.Orientation,Position:l.Position?Object.assign(new a.Vector3(0,0,0),l.Position):null,SelectableItems:l.SelectableItems?new d.SelectableItems([null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]):null,SelectableTools:l.SelectableTools?new u.SelectableTools([null,null,null,null]):null,TargetVelocity:l.TargetVelocity?Object.assign(new a.Vector3(0,0,0),l.TargetVelocity):null,Velocity:l.Velocity?Object.assign(new a.Vector3(0,0,0),l.Velocity):null,BlockCollisionBehaviour:l.BlockCollisionBehaviour,GravityBehaviour:l.GravityBehaviour,PlayerBehaviour:l.PlayerBehaviour})];var l}))),m,new Map(g.map((t=>[m.TypeIdFor(t),{Hardness:0}]))),f,new Map(y.map((t=>[f.TypeIdFor(t),{Hardness:0}]))),w,new Map(S.map((e=>{return[w.TypeIdFor(e),(i=t.ItemTypes[e],{Kind:h.ItemKind[i.Kind]})];var i}))))}},"./libs/meld/src/serialisation/serialisation-game-state.ts":(t,e,i)=>{i.r(e),i.d(e,{createGameState:()=>p,readGameState:()=>g});var s=i("./libs/age/src/index.ts"),a=i("./libs/utility/src/index.ts"),l=i("./libs/meld/src/config/version.ts"),o=i("./libs/meld/src/state/entity-values.ts"),r=i("./libs/meld/src/state/game-state.ts"),n=i("./libs/meld/src/state/region.ts"),h=i("./libs/meld/src/values/dash-state.ts"),c=i("./libs/meld/src/values/selectable-items.ts"),d=i("./libs/meld/src/values/selectable-tools.ts"),u=i("./libs/meld/src/values/tool-state.ts");function p(t,e){return function(t,e=null){const i={};for(const[e]of t.EntityValues.Entities)i[e]=t.EntityValues.GroupFor(e);return{Version:{EntityTypeMap:[...e?.EntityTypeMap.Types.entries()??[]],SolidTypeMap:[...e?.SolidTypeMap.Types.entries()??[]],NonSolidTypeMap:[...e?.NonSolidTypeMap.Types.entries()??[]],ItemTypeMap:[...e?.ItemTypeMap.Types.entries()??[]]},Globals:t.Globals,EntityValues:i,Regions:Array.from(t.Regions,(([,t])=>n.SerialisableRegion.From(t,e))),Players:Object.fromEntries(t.Players.entries())}}(e,t)}function g(t,e){return e.EntityValues,function(t,e){e.Regions=e.Regions.map((t=>Object.assign(new n.SerialisableRegion(null,null,null,null,null,null),t)));for(const t of e.Regions){t.Chunks=t.Chunks.map((t=>Object.assign(new n.SerialisableBlockChunk(null,null,null),t)));for(const e of t.Chunks)e.Offset=Object.assign(new a.Vector3(0,0,0),e.Offset),e.Size=Object.assign(new a.Vector3(0,0,0),e.Size);t.ChunkSize=Object.assign(new a.Vector3(0,0,0),t.ChunkSize),t.Offset=Object.assign(new a.Vector3(0,0,0),t.Offset),t.Size=Object.assign(new a.Vector3(0,0,0),t.Size),t.EntityValues=new Map(Object.entries(t.EntityValues).map((([t,e])=>[+t,e])))}const i=new l.Version(new s.TypeMap(new Map(e.Version.EntityTypeMap)),new s.TypeMap(new Map(e.Version.SolidTypeMap)),new s.TypeMap(new Map(e.Version.NonSolidTypeMap)),new s.TypeMap(new Map(e.Version.ItemTypeMap)));if(i.SimilarTo(t))return function(t){const e=new Map;for(const i of t.Regions)e.set(i.RegionCoords().stringify(),i.ToRegion());return new r.GameState(y(t.Globals),o.SerialisableEntities.ToEntityValues(m(t.EntityValues)),e,f(t.Players,(t=>t),(t=>t)))}(e);const h=i.GetEntityMapping(t),c=i.GetSolidMapping(t),d=i.GetItemMapping(t),u=new Map;for(const i of e.Regions)u.set(i.RegionCoords().stringify(),i.ToRegionWithConfig(t));const p=new Map;for(const t in e.Players)p.set(t,o.SerialisableEntities.MapEntity(e.Players[t],h));return new r.GameState(y(e.Globals),o.SerialisableEntities.ToEntityValuesWithMapping(m(e.EntityValues),h,c,d),u,p)}(t,e)}function m(t){return f(t,(t=>+t),(t=>function(t){const e={...t};return t.CircularSize&&(e.CircularSize=Object.assign(new s.CircularSize(0,0),t.CircularSize)),t.DashState&&(e.DashState=Object.assign(new h.DashState,t.DashState)),t.Position&&(e.Position=Object.assign(new a.Vector3(0,0,0),t.Position)),t.SelectableItems&&(e.SelectableItems=Object.assign(new c.SelectableItems([]),t.SelectableItems)),t.SelectableTools&&(e.SelectableTools=Object.assign(new d.SelectableTools([]),t.SelectableTools)),t.TargetVelocity&&(e.TargetVelocity=Object.assign(new a.Vector3(0,0,0),t.TargetVelocity)),t.ToolState&&(e.ToolState=u.ToolState.From(t.ToolState)),t.Velocity&&(e.Velocity=Object.assign(new a.Vector3(0,0,0),t.Velocity)),e}(t)))}function y(t){const e={...t};return e.WorldBounds&&(e.WorldBounds=Object.assign(new s.Box(0,0,0,0,0,0),e.WorldBounds)),e}function f(t,e,i){const s=new Map;for(const a in t)s.set(e(a),i(t[a]));return s}},"./libs/meld/src/state/block.ts":(t,e,i)=>{i.r(e),i.d(e,{BlockType:()=>c,Blocks:()=>h,NonSolidMask:()=>r,NonSolidOffset:()=>n,SolidMask:()=>l,SolidOffset:()=>o,VariantMask:()=>s,VariantOffset:()=>a});const s=252,a=2,l=16776960,o=8,r=4278190080,n=24;class h{static New(t,e,i,s=0){return i|e|s<<a|t}static NewEmpty(t,e=0){return h.New(c.Empty,0,t,e)}static NewFloor(t,e,i=0){return h.New(c.Floor,t,e,i)}static NewHalf(t,e,i=0){return h.New(c.Half,t,e,i)}static NewFull(t,e=0){return h.New(c.Full,t,0,e)}static WithVariation(t,e){return h.New(this.TypeOf(t),this.SolidOf(t),this.NonSolidOf(t),e)}static TypeOf(t){return 3&t}static VariantOf(t){return(t&s)>>a}static SolidOf(t){return t&l}static NonSolidOf(t){return t&r}static HasSolid(t){return h.TypeOf(t)!=c.Empty}static HasNonSolid(t){return h.TypeOf(t)!=c.Full}}var c;!function(t){t[t.Empty=0]="Empty",t[t.Floor=1]="Floor",t[t.Half=2]="Half",t[t.Full=3]="Full"}(c||(c={}))},"./libs/meld/src/state/changes.ts":(t,e,i)=>{i.r(e),i.d(e,{Changes:()=>s});class s{constructor(t,e=new Map){this.EntityValues=t,this.UpdatedBlocks=e}}},"./libs/meld/src/state/entity-values.ts":(t,e,i)=>{i.r(e),i.d(e,{EntityValues:()=>n,SerialisableEntities:()=>h});var s=i("./libs/age/src/index.ts"),a=i("./libs/meld/src/values/selectable-items.ts"),l=i("./libs/meld/src/values/selectable-tools.ts"),o=i("./libs/meld/src/values/tool-state.ts"),r=i("./libs/meld/src/state/item.ts");class n extends s.BaseValues{constructor(t=new Map,e=new Map,i=new Map,s=new Map,a=new Map,l=new Map,o=new Map,r=new Map,n=new Map,h=new Map,c=new Map,d=new Map,u=new Map,p=new Map,g=new Map){super(g),this.CircularSize=t,this.DashState=e,this.DespawnTime=i,this.Health=s,this.Orientation=a,this.Position=l,this.SelectableItems=o,this.SelectableTools=r,this.TargetVelocity=n,this.ToolState=h,this.Velocity=c,this.BlockCollisionBehaviour=d,this.GravityBehaviour=u,this.PlayerBehaviour=p,this.Register(t),this.Register(e),this.Register(i),this.Register(s),this.Register(a),this.Register(l),this.Register(o),this.Register(r),this.Register(n),this.Register(h),this.Register(c),this.Register(d),this.Register(u),this.Register(p)}static From(t){const e=new n;for(const[i,s]of t)e.AddValuesFrom(i,s);return e}AddValuesFrom(t,e){this.Entities.set(t,!0),void 0!==e.CircularSize&&this.CircularSize.set(t,e.CircularSize),void 0!==e.DashState&&this.DashState.set(t,e.DashState),void 0!==e.DespawnTime&&this.DespawnTime.set(t,e.DespawnTime),void 0!==e.Health&&this.Health.set(t,e.Health),void 0!==e.Orientation&&this.Orientation.set(t,e.Orientation),void 0!==e.Position&&this.Position.set(t,e.Position),void 0!==e.SelectableItems&&this.SelectableItems.set(t,e.SelectableItems),void 0!==e.SelectableTools&&this.SelectableTools.set(t,e.SelectableTools),void 0!==e.TargetVelocity&&this.TargetVelocity.set(t,e.TargetVelocity),void 0!==e.ToolState&&this.ToolState.set(t,e.ToolState),void 0!==e.Velocity&&this.Velocity.set(t,e.Velocity),void 0!==e.BlockCollisionBehaviour&&this.BlockCollisionBehaviour.set(t,e.BlockCollisionBehaviour),void 0!==e.GravityBehaviour&&this.GravityBehaviour.set(t,e.GravityBehaviour),void 0!==e.PlayerBehaviour&&this.PlayerBehaviour.set(t,e.PlayerBehaviour)}GroupFor(t){return{CircularSize:this.CircularSize.get(t),DashState:this.DashState.get(t),DespawnTime:this.DespawnTime.get(t),Health:this.Health.get(t),Orientation:this.Orientation.get(t),Position:this.Position.get(t),SelectableItems:this.SelectableItems.get(t),SelectableTools:this.SelectableTools.get(t),TargetVelocity:this.TargetVelocity.get(t),ToolState:this.ToolState.get(t),Velocity:this.Velocity.get(t),BlockCollisionBehaviour:this.BlockCollisionBehaviour.get(t),GravityBehaviour:this.GravityBehaviour.get(t),PlayerBehaviour:this.PlayerBehaviour.get(t)}}}class h{static From(t){const e=new Map;for(const[i]of t.Entities)e.set(i,t.GroupFor(i));return e}static ToEntityValuesWithMapping(t,e,i,s){const a=new n;for(const[l,o]of t)a.AddValuesFrom(this.MapEntity(l,e),this.MapValues(o,i,s));return a}static ToEntityValues(t){const e=new n;for(const[i,s]of t.entries())e.AddValuesFrom(i,s);return e}static MapEntity(t,e){return e.get((0,s.EntityTypeOf)(t))|(0,s.EntityIdOf)(t)}static MapValues(t,e,i){return{...t,SelectableItems:this.MapSelectableItems(t.SelectableItems,e,i),SelectableTools:this.MapSelectableTools(t.SelectableTools,e,i),ToolState:this.MapToolState(t.ToolState,e,i)}}static MapSelectableItems(t,e,i){return t?new a.SelectableItems(t.Items.map((t=>this.MapItem(t,e,i))),t.CurrentSet,t.CurrentItemInSet):null}static MapSelectableTools(t,e,i){return t?new l.SelectableTools(t.Items.map((t=>this.MapItem(t,e,i))),t.CurrentToolIndex):null}static MapToolState(t,e,i){return t?new o.ToolState(t.Action,this.MapItem(t.SourceItem,e,i),t.SubEntities,t.Target,t.StartTime,t.EndTime,t.LockOrientation,t.BlockMovement):null}static MapItem(t,e,i){return t?new r.Item(i.get(t.Type),e.get(t.Content),t.Amount):null}}},"./libs/meld/src/state/game-state.ts":(t,e,i)=>{i.r(e),i.d(e,{GameState:()=>s});class s{constructor(t,e,i=new Map,s=new Map){this.Globals=t,this.EntityValues=e,this.Regions=i,this.Players=s}GetNewId(){return this.Globals.NextId++}LoadFrom(t){this.Globals.Tick=t.Globals.Tick,this.Globals.Seed=t.Globals.Seed,this.Globals.NextId=t.Globals.NextId,this.Globals.WorldBounds=t.Globals.WorldBounds,this.EntityValues.ClearValues(),this.EntityValues.Entities.clear();for(const[e,i]of t.EntityValues.Entities)this.EntityValues.Entities.set(e,i);this.EntityValues.AddValuesFromOther(t.EntityValues),this.Regions.clear();for(const[e,i]of t.Regions)this.Regions.set(e,i);this.Players.clear();for(const[e,i]of t.Players)this.Players.set(e,i)}LoadPlayer(t){return!!this.Players.has(t)}UnloadPlayer(t){console.log("trying to unload"+t)}}},"./libs/meld/src/state/game-update.ts":(t,e,i)=>{i.r(e),i.d(e,{ActionState:()=>p,ChargeDashAction:()=>a,GameUpdate:()=>s,JumpAction:()=>o,LoadPlayer:()=>r,LoadRegion:()=>c,LoadState:()=>h,MovementAction:()=>d,ReleaseDashAction:()=>l,SelectItemAction:()=>g,SelectItemSetAction:()=>m,SelectToolAction:()=>f,UnloadPlayer:()=>n,UseItemAction:()=>u,UseToolAction:()=>y});class s{}class a extends s{constructor(t,e){super(),this.Entity=t,this.Angle=e}}class l extends s{constructor(t,e){super(),this.Entity=t,this.Angle=e}}class o extends s{constructor(t){super(),this.Entity=t}}class r extends s{constructor(t){super(),this.Player=t}}class n extends s{constructor(t){super(),this.Player=t}}class h extends s{constructor(t){super(),this.State=t}}class c extends s{constructor(t){super(),this.Region=t}}class d extends s{constructor(t,e){super(),this.Entity=t,this.Velocity=e}}class u extends s{constructor(t,e,i){super(),this.Entity=t,this.ActionState=e,this.Target=i}}var p;!function(t){t[t.Start=0]="Start",t[t.Unchanged=1]="Unchanged",t[t.End=2]="End"}(p||(p={}));class g extends s{constructor(t,e){super(),this.Entity=t,this.ItemIndex=e}}class m extends s{constructor(t,e){super(),this.Entity=t,this.ItemSetIndex=e}}class y extends s{constructor(t,e,i,s){super(),this.Entity=t,this.PrimaryActionState=e,this.SecondaryActionState=i,this.Target=s}}class f extends s{constructor(t,e){super(),this.Entity=t,this.ToolIndex=e}}},"./libs/meld/src/state/globals.ts":(t,e,i)=>{i.r(e),i.d(e,{Globals:()=>s});class s{constructor(t=0,e=1,i=1,s=null){this.Tick=t,this.NextId=e,this.Seed=i,this.WorldBounds=s}}},"./libs/meld/src/state/item.ts":(t,e,i)=>{i.r(e),i.d(e,{Item:()=>s,ItemKind:()=>a});class s{constructor(t,e,i){this.Type=t,this.Content=e,this.Amount=i}static From(t){return Object.assign(new s(0,0,0),t)}}var a;s.TypeOffset=0,function(t){t[t.Solid=0]="Solid",t[t.Hammer=1]="Hammer",t[t.Sword=2]="Sword",t[t.Bow=3]="Bow"}(a||(a={}))},"./libs/meld/src/state/meld-entities.ts":(t,e,i)=>{i.r(e),i.d(e,{MeldEntities:()=>a});var s=i("./libs/age/src/index.ts");class a extends s.EntityManager{constructor(t,e,i,a,l=new s.ValueAccessBuilder(t,e,i),o=l.For((t=>t.CircularSize),(t=>t.CircularSize)),r=l.For((t=>t.DashState),(t=>t.DashState)),n=l.For((t=>t.DespawnTime),(t=>t.DespawnTime)),h=l.For((t=>t.Health),(t=>t.Health)),c=l.For((t=>t.Orientation),(t=>t.Orientation),0),d=l.For((t=>t.Position),(t=>t.Position)),u=l.For((t=>t.SelectableItems),(t=>t.SelectableItems)),p=l.For((t=>t.SelectableTools),(t=>t.SelectableTools)),g=l.For((t=>t.TargetVelocity),(t=>t.TargetVelocity)),m=l.For((t=>t.ToolState),(t=>t.ToolState)),y=l.For((t=>t.Velocity),(t=>t.Velocity)),f=l.For((t=>t.BlockCollisionBehaviour),(t=>t.BlockCollisionBehaviour)),S=l.For((t=>t.GravityBehaviour),(t=>t.GravityBehaviour)),w=l.For((t=>t.PlayerBehaviour),(t=>t.PlayerBehaviour))){super(e,i,a),this.CircularSize=o,this.DashState=r,this.DespawnTime=n,this.Health=h,this.Orientation=c,this.Position=d,this.SelectableItems=u,this.SelectableTools=p,this.TargetVelocity=g,this.ToolState=m,this.Velocity=y,this.BlockCollisionBehaviour=f,this.GravityBehaviour=S,this.PlayerBehaviour=w,this.Accessors.push(o,r,n,h,c,d,u,p,g,m,y,f,S,w)}}},"./libs/meld/src/state/region.ts":(t,e,i)=>{i.r(e),i.d(e,{Region:()=>n,SerialisableBlockChunk:()=>c,SerialisableRegion:()=>h});var s=i("./libs/age/src/index.ts"),a=i("./libs/utility/src/index.ts"),l=i("./libs/meld/src/config/version.ts"),o=i("./libs/meld/src/state/block.ts"),r=i("./libs/meld/src/state/entity-values.ts");class n extends s.FieldRegion{constructor(t,e,i,a,l){super(t,e,i,a),this.Size=t,this.ChunkSize=e,this.Offset=i,this.Chunks=a,this.EntityValues=l,this.RegionCoords=()=>(0,s.RegionCoordsFor)(this.Offset.X,this.Offset.Y,this.Offset.Z,this.Size)}static New(t,e,i){const l=new a.Vector3(e.X*i.X,e.Y*i.Y,e.Z*i.Z),o=new a.Vector3(t.X*l.X-l.X/2,t.Y*l.Y-l.Y/2,t.Z*l.Z-l.Z/2),h=new Array(e.X*e.Y*e.Z);for(let t=0;t<e.X;t++)for(let a=0;a<e.Y;a++)for(let l=0;l<e.Z;l++)h[this.IndexFor(t,a,l,e)]=new s.BlockChunk(new Array(i.X*i.Y*i.Z),i,this.ChunkOffset(t,a,l,i,o));return new n(l,i,o,h,new r.EntityValues)}static IndexFor(t,e,i,s){return t+e*s.X+i*s.X*s.Y}static ChunkOffset(t,e,i,s,l){return new a.Vector3(l.X+t*s.X,l.Y+e*s.Y,l.Z+i*s.Z)}}class h{constructor(t,e,i,a,l,o){this.Version=t,this.Size=e,this.ChunkSize=i,this.Offset=a,this.Chunks=l,this.EntityValues=o,this.RegionCoords=()=>(0,s.RegionCoordsFor)(this.Offset.X,this.Offset.Y,this.Offset.Z,this.Size)}static fromDeserialised(t){return new h(new l.Version(new s.TypeMap,new s.TypeMap,new s.TypeMap,new s.TypeMap),new a.Vector3(0,0,0),new a.Vector3(0,0,0),new a.Vector3(0,0,0),t.Chunks.map((t=>c.From(t))),r.SerialisableEntities.From(t.EntityValues))}static From(t,e=null){return new h(new l.Version(e?.EntityTypeMap??new s.TypeMap,e?.SolidTypeMap??new s.TypeMap,e?.NonSolidTypeMap??new s.TypeMap,e?.ItemTypeMap??new s.TypeMap),t.Size,t.ChunkSize,t.Offset,t.Chunks.map((t=>c.From(t))),r.SerialisableEntities.From(t.EntityValues))}ToRegionWithConfig(t){if(this.Version.SimilarTo(t))return this.ToRegion();const e=this.Version.GetEntityMapping(t),i=this.Version.GetSolidMapping(t),s=this.Version.GetNonSolidMapping(t),a=this.Chunks.map((t=>t.ToBlockChunkWithMapping(i,s)));return new n(this.Size,this.ChunkSize,this.Offset,a,r.SerialisableEntities.ToEntityValuesWithMapping(this.EntityValues,e,i,s))}ToRegion(){const t=this.Chunks.map((t=>t.ToBlockChunk()));return new n(this.Size,this.ChunkSize,this.Offset,t,r.SerialisableEntities.ToEntityValues(this.EntityValues))}}class c{constructor(t,e,i){this.Size=t,this.Offset=e,this.Blocks=i}ToBlockChunk(){return new s.BlockChunk([...this.Blocks],this.Size,this.Offset)}ToBlockChunkWithMapping(t,e){return new s.BlockChunk(this.Blocks.map((i=>this.MapBlock(i,t,e))),this.Offset)}MapBlock(t,e,i){return o.Blocks.New(o.Blocks.TypeOf(t),e.get(o.Blocks.SolidOf(t)),i.get(o.Blocks.NonSolidOf(t)),o.Blocks.VariantOf(t))}static From(t){const e=new a.Vector3(t.ChunkSize.X,t.ChunkSize.Y,t.ChunkSize.Z);return new c(e,t.Offset,t.Blocks.slice())}}},"./libs/meld/src/values/dash-state.ts":(t,e,i)=>{i.r(e),i.d(e,{DashState:()=>s});class s{constructor(t=0,e=!1,i=!1,s=0,a=0){this.TimeOfLastDash=t,this.IsCharging=e,this.HasFailedQuickDash=i,this.Charge=s,this.Angle=a}AbsoluteAngularDifferenceTo(t){t>=2*Math.PI?t-=2*Math.PI:t<0&&(t+=2*Math.PI);const e=t<this.Angle?this.Angle-t:t-this.Angle;return e>Math.PI?2*Math.PI-e:e}IsInInterval(t,e,i){const s=t-this.TimeOfLastDash;return e<=s&&s<i}IsWithinAngle(t,e){return this.AbsoluteAngularDifferenceTo(t)>e}}},"./libs/meld/src/values/selectable-items.ts":(t,e,i)=>{i.r(e),i.d(e,{SelectableItems:()=>s});class s{constructor(t,e=0,i=0){this.Items=t,this.CurrentSet=e,this.CurrentItemInSet=i}CurrentItem(){return this.Items[4*this.CurrentSet+this.CurrentItemInSet]}ItemInCurrentSet(t){return this.Items[4*this.CurrentSet+t]}SelectItem(t){return t>3&&(t=0),t<0&&(t=3),new s(this.Items,this.CurrentSet,t)}SelectItemSet(t){return t>3&&(t=0),t<0&&(t=3),new s(this.Items,t,this.CurrentItemInSet)}}},"./libs/meld/src/values/selectable-tools.ts":(t,e,i)=>{i.r(e),i.d(e,{SelectableTools:()=>s});class s{constructor(t,e=0){this.Items=t,this.CurrentToolIndex=e}CurrentTool(){return this.Items[this.CurrentToolIndex]}SelectTool(t){return t>3&&(t=0),t<0&&(t=3),new s(this.Items,t)}}},"./libs/meld/src/values/tool-state.ts":(t,e,i)=>{i.r(e),i.d(e,{ToolAction:()=>s,ToolState:()=>o});var s,a=i("./libs/utility/src/index.ts"),l=i("./libs/meld/src/state/item.ts");class o{constructor(t,e,i,s,a=0,l=0,o=!1,r=!1){this.Action=t,this.SourceItem=e,this.SubEntities=i,this.Target=s,this.StartTime=a,this.EndTime=l,this.LockOrientation=o,this.BlockMovement=r}static From(t){return new o(t?.Action??s.HammerStrike,l.Item.From(t?.SourceItem),t?.SubEntities??[],a.Vector3.From(t?.Target),t?.StartTime??0,t?.EndTime??0,t?.LockOrientation??!1,t?.BlockMovement??!1)}}!function(t){t[t.HammerStrike=0]="HammerStrike"}(s||(s={}))},"./libs/meld/src/variation-provider.ts":(t,e,i)=>{i.r(e),i.d(e,{BlockSurroundings:()=>s});class s{constructor(t,e,i,s,a){this.Block=t,this.NorthBlock=e,this.EastBlock=i,this.SouthBlock=s,this.WestBlock=a}}},"./libs/utility/src/array-extensions.ts":(t,e,i)=>{i.r(e),Object.defineProperty(Array.prototype,"sum",{value:function(){return this.reduce(((t,e)=>t+ +e),0)}}),Object.defineProperty(Array.prototype,"max",{value:function(){if(!this.length)throw new Error("Cannot find the max value in an empty array");return this.reduce(((t,e)=>t>e?t:e))}}),Object.defineProperty(Array.prototype,"min",{value:function(){if(!this.length)throw new Error("Cannot find the min value in an empty array");return this.reduce(((t,e)=>t<e?t:e))}}),Object.defineProperty(Array.prototype,"clear",{value:function(){return this.splice(0,this.length)}}),Object.defineProperty(Array.prototype,"first",{value:function(){return this[0]}}),Object.defineProperty(Array.prototype,"last",{value:function(){return this[this.length-1]}}),Object.defineProperty(Array.prototype,"distinct",{value:function(){return this.filter(((t,e)=>this.indexOf(t)===e))}}),Object.defineProperty(Array.prototype,"distinctBy",{value:function(t){return this.filter(((e,i)=>{const s=t(e);return this.findIndex((e=>t(e)===s))===i}))}}),Object.defineProperty(Array.prototype,"sortBy",{value:function(t,e=!0){return this.sort(((i,s)=>{let a=t(i);"string"==typeof a&&(a=a.toLowerCase());let l=t(s);return"string"==typeof l&&(l=l.toLowerCase()),a>l?e?1:-1:a<l?e?-1:1:0}))}}),Object.defineProperty(Array.prototype,"includesAny",{value:function(t){return this.some((e=>t.includes(e)))}}),Object.defineProperty(Array.prototype,"groupBy",{value:function(t){const e=[];for(const i of this){const s=t(i);let a=e.find((t=>t.group===s));a||(a={group:s,entries:[]},e.push(a)),a.entries.push(i)}return e}}),Object.defineProperty(Array.prototype,"remove",{value:function(t){const e=this.indexOf(t);return e>=0&&(this.splice(e,1),!0)}}),Object.defineProperty(Array.prototype,"findAndRemove",{value:function(t){const e=this.findIndex(t);return e>=0&&(this.splice(e,1),!0)}}),Object.defineProperty(Array.prototype,"removeBy",{value:function(t){const e=[];for(let i=0;i<this.length;i++)t(this[i])&&(e.push(...this.splice(i,1)),i--);return e}})},"./libs/utility/src/index.ts":(t,e,i)=>{i.r(e),i.d(e,{KeyStates:()=>s.KeyStates,MathF:()=>a.MathF,Rotate:()=>a.Rotate,Tau:()=>a.Tau,Vector2:()=>l.Vector2,Vector3:()=>o.Vector3,clip:()=>a.clip,hexEastOf:()=>a.hexEastOf,hexNorthEastOf:()=>a.hexNorthEastOf,hexNorthWestOf:()=>a.hexNorthWestOf,hexSouthEastOf:()=>a.hexSouthEastOf,hexSouthWestOf:()=>a.hexSouthWestOf,hexWestOf:()=>a.hexWestOf,hexesAdjacentTo:()=>a.hexesAdjacentTo,randomInt:()=>a.randomInt,randomIntBelow:()=>a.randomIntBelow,randomNumber:()=>a.randomNumber,randomNumberBelow:()=>a.randomNumberBelow,range:()=>a.range}),i("./libs/utility/src/array-extensions.ts");var s=i("./libs/utility/src/key-states.ts"),a=i("./libs/utility/src/utility.ts"),l=i("./libs/utility/src/vector2.ts"),o=i("./libs/utility/src/vector3.ts")},"./libs/utility/src/key-states.ts":(t,e,i)=>{i.r(e),i.d(e,{KeyStates:()=>s});class s{constructor(t={},e={},i={},s={}){this.onDown=t,this.onUp=e,this.states=i,this.eventStates=s,this.preventDefault=t=>{t.preventDefault()},this.onKeyDown=t=>{const e=this.getKeyboardCode(t);this.states[e]||(this.states[e]=1,this.eventStates[e]=a.JustPressed,this.onDown[e]?.(e))},this.onKeyUp=t=>{const e=this.getKeyboardCode(t);this.states[e]&&(this.onUp[e]?.(e),this.eventStates[e]===a.JustPressed?this.eventStates[e]=a.ShouldBeReset:this.states[e]=0)},this.onMouseMove=t=>{this.states.MouseX=t.clientX,this.states.MouseY=t.clientY},this.onMouseDown=t=>{const e=this.getMouseButtonCode(t);this.states[e]||(this.states[e]=1,this.eventStates[e]=a.JustPressed,this.onDown[e]?.(e))},this.onMouseUp=t=>{const e=this.getMouseButtonCode(t);this.states[e]&&(this.onUp[e]?.(e),this.eventStates[e]===a.JustPressed?this.eventStates[e]=a.ShouldBeReset:this.states[e]=0)},this.onScroll=t=>{t.deltaY>0?(this.states.MouseScrollDown=1,this.eventStates.MouseScrollDown=a.ShouldBeReset):t.deltaY<0&&(this.states.MouseScrollUp=1,this.eventStates.MouseScrollUp=a.ShouldBeReset)},window.addEventListener("keydown",this.onKeyDown,{capture:!0}),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("wheel",this.onScroll),window.addEventListener("contextmenu",this.preventDefault)}onDestroy(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("wheel",this.onScroll),window.removeEventListener("contextmenu",this.preventDefault)}getKeyboardCode(t){return t.code.startsWith("Arrow")?t.code.substring(5):t.code.startsWith("Digit")?t.code[5]:t.code.startsWith("Key")?t.code[3]:"ShiftLeft"===t.code?"LeftShift":t.code}getMouseButtonCode(t){switch(t.button){case 0:return"MouseLeft";case 1:return"MouseMiddle";case 2:return"MouseRight"}}endInputFrame(){for(const t in this.eventStates)this.eventStates[t]===a.ShouldBeReset&&(this.states[t]=0);this.eventStates={}}getInputState(t){return this.states[t]??this.getFirstGamepadState(t)}getFirstGamepadState(t){const e=(navigator.getGamepads?.()??[]).filter((t=>t));if(0===e.length)return 0;const i=e.first();return"standard"===i?.mapping?this.getStandardGamepadState(t,i):this.getNonStandardGamepadState(t,i)}getStandardGamepadState(t,e){return this.getStandardButtonState(t,e)??this.getStandardAnalogStickState(t,e)}getStandardButtonState(t,e){switch(t){case"PadA":return e.buttons[0].pressed?1:0;case"PadB":return e.buttons[1].pressed?1:0;case"PadX":return e.buttons[2].pressed?1:0;case"PadY":return e.buttons[3].pressed?1:0;case"PadLeftShoulder":return e.buttons[4].pressed?1:0;case"PadRightShoulder":return e.buttons[5].pressed?1:0;case"PadSelect":return e.buttons[8].pressed?1:0;case"PadStart":return e.buttons[9].pressed?1:0;case"PadUp":return e.buttons[12].pressed?1:0;case"PadDown":return e.buttons[13].pressed?1:0;case"PadLeft":return e.buttons[14].pressed?1:0;case"PadRight":return e.buttons[15].pressed?1:0}}getStandardAnalogStickState(t,e){switch(t){case"PadLeftStickUp":return 1.2*Math.max(0,-e.axes[1])-.2;case"PadLeftStickDown":return 1.2*Math.max(0,e.axes[1])-.2;case"PadLeftStickLeft":return 1.2*Math.max(0,-e.axes[0])-.2;case"PadLeftStickRight":return 1.2*Math.max(0,e.axes[0])-.2}}getNonStandardGamepadState(t,e){return this.getNonStandardDpadState(t,e)??this.getStandardButtonState(t,e)??this.getNonStandardEmulatedLeftAnalogState(t,e)}getNonStandardDpadState(t,e){switch(t){case"PadUp":return e.axes[9]<-.7||.8<e.axes[9]&&e.axes[9]<1.1?1:0;case"PadDown":return-.2<e.axes[9]&&e.axes[9]<.5?1:0;case"PadLeft":return.4<e.axes[9]&&e.axes[9]<1.1?1:0;case"PadRight":return-.8<e.axes[9]&&e.axes[9]<0?1:0}}getNonStandardEmulatedLeftAnalogState(t,e){switch(t){case"PadLeftStickUp":return e.axes[9]<-.7||.8<e.axes[9]&&e.axes[9]<1.1?1:0;case"PadLeftStickDown":return-.2<e.axes[9]&&e.axes[9]<.5?1:0;case"PadLeftStickLeft":return.4<e.axes[9]&&e.axes[9]<1.1?1:0;case"PadLeftStickRight":return-.8<e.axes[9]&&e.axes[9]<0?1:0}}}var a;!function(t){t[t.JustPressed=0]="JustPressed",t[t.ShouldBeReset=1]="ShouldBeReset"}(a||(a={}))},"./libs/utility/src/utility.ts":(t,e,i)=>{function*s(t,e){for(let i=t;i<e;i++)yield i}function a(t,e,i,s=!1){if(i<=e)throw"Error";if(!s)return t<e?t=e:i<=t&&(t=i),t;for(;t<e;)t+=i-e;for(;i<=t;)t-=i-e;return t}function l(t,e){return[o(t,e),r(t,e),n(t,e),h(t,e),c(t,e),d(t,e)]}function o(t,e,i=1){const s=(e+i)%2==0?-1:0;return{x:t-Math.floor(i/2)+s,y:e-i}}function r(t,e,i=1){const s=(e+i)%2==0?0:1;return{x:t+Math.floor(i/2)+s,y:e-i}}function n(t,e,i=1){return{x:t-i,y:e}}function h(t,e,i=1){return{x:t+i,y:e}}function c(t,e,i=1){const s=(e+i)%2==0?-1:0;return{x:t-Math.floor(i/2)+s,y:e+i}}function d(t,e,i=1){const s=(e+i)%2==0?0:1;return{x:t+Math.floor(i/2)+s,y:e+i}}function u(t,e){return Math.floor(Math.random()*(e-t)+t)}function p(t){return Math.floor(Math.random()*t)}function g(t,e){return Math.random()*(e-t)+t}function m(t){return Math.random()*t}i.r(e),i.d(e,{MathF:()=>S,Rotate:()=>f,Tau:()=>y,clip:()=>a,hexEastOf:()=>h,hexNorthEastOf:()=>r,hexNorthWestOf:()=>o,hexSouthEastOf:()=>d,hexSouthWestOf:()=>c,hexWestOf:()=>n,hexesAdjacentTo:()=>l,randomInt:()=>u,randomIntBelow:()=>p,randomNumber:()=>g,randomNumberBelow:()=>m,range:()=>s});const y=2*Math.PI;function f(t,e){for(t+=e;t<0;)t+=y;for(;t>=y;)t-=y;return t}const S={Floor:Math.floor,Tau:2*Math.PI,Min:Math.min,Pow:Math.pow}},"./libs/utility/src/vector2.ts":(t,e,i)=>{i.r(e),i.d(e,{Vector2:()=>a});var s=i("./libs/utility/src/utility.ts");class a{constructor(t,e){this.x=t,this.y=e}get X(){return this.x}set X(t){this.x=t}get Y(){return this.y}set Y(t){this.y=t}static fromAngle(t){return new a(1,0).rotate(t)}add(t){return new a(this.x+t.x,this.y+t.y)}addFrom(t){return this.set(this.x+t.x,this.y+t.y)}addFromNumbers(t,e){return this.set(this.x+t,this.y+e)}subtract(t){return new a(this.x-t.x,this.y-t.y)}multiply(t){return new a(this.x*t,this.y*t)}rotate(t){return new a(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t))}rotateFrom(t){return this.set(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t))}getAngle(){const t=Math.atan2(this.y,this.x);return t<0?t+2*Math.PI:t}angle(){return Math.atan2(this.y,this.x)}lengthSquared(){return this.x*this.x+this.y*this.y}unitVector(){const t=this.length();return 0===t?new a(0,0):new a(this.x/t,this.y/t)}length(){return 0===this.x||0===this.y?Math.abs(this.x)+Math.abs(this.y):Math.sqrt(this.lengthSquared())}copy(){return new a(this.x,this.y)}clip(t,e,i,l,o=!1){return new a((0,s.clip)(this.x,t,i,o),(0,s.clip)(this.y,e,l,o))}set(t,e){return this.x=t,this.y=e,this}isZero(){return 0===this.x&&0===this.y}}a.Zero=new a(0,0),a.Zero.set=()=>{throw new Error("Can't override zero vector")}},"./libs/utility/src/vector3.ts":(t,e,i)=>{i.r(e),i.d(e,{Vector3:()=>s});class s{constructor(t,e,i){this.x=t,this.y=e,this.z=i,this.Length=this.length}get X(){return this.x}set X(t){this.x=t}get Y(){return this.y}set Y(t){this.y=t}get Z(){return this.z}set Z(t){this.z=t}add(t){return new s(this.x+t.x,this.y+t.y,this.z+t.z)}subtract(t){return new s(this.x-t.x,this.y-t.y,this.z-t.z)}multiply(t){return new s(this.x*t,this.y*t,this.z*t)}rotate(t){return new s(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t),0)}getAngle(){const t=Math.atan2(this.y,this.x);return t<0?t+2*Math.PI:t}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}unitVector(){const t=this.length();return 0===t?new s(0,0,0):new s(this.x/t,this.y/t,this.z/t)}length(){return Math.sqrt(this.lengthSquared())}isZero(){return 0===this.x&&0===this.y&&0===this.z}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}static copy(t){return new s(t.x,t.y,t.z)}stringify(){return this.x+","+this.y+","+this.z}static parse(t){const[e,i,a]=t.split(",");return new s(+e,+i,+a)}static stringify(t,e,i){return t+","+e+","+i}static From(t){return Object.assign(new s(0,0,0),t)}withX(t){return new s(t,this.y,this.z)}withY(t){return new s(this.x,t,this.z)}withZ(t){return new s(this.x,this.y,t)}set(t,e,i){return this.x=t,this.y=e,this.z=i,this}setFrom(t){return this.set(t.x,t.y,t.z),this}addFrom(t){return this.set(this.x+t.x,this.y+t.y,this.z+t.z)}subtractFrom(t){return this.set(this.x-t.x,this.y-t.y,this.z-t.z)}multiplyFrom(t){return this.set(this.x*t,this.y*t,this.z*t)}rotateFrom(t){return this.set(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t),0)}}s.Zero=new s(0,0,0),s.Zero.set=()=>{throw new Error("Can't override zero vector")}},"./libs/web-gl-display/src/generic-shader.ts":(t,e,i)=>{i.r(e),i.d(e,{GenericShader:()=>s});class s{constructor(t,e,i){this.gl=t;const s=this.getShader(e,t.VERTEX_SHADER),a=this.getShader(i,t.FRAGMENT_SHADER);this.program=this.createProgram(s,a),t.deleteShader(s),t.deleteShader(a)}getShader(t,e){const i=this.gl.createShader(e);if(this.gl.shaderSource(i,t),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))throw new Error("Shader error: "+this.gl.getShaderInfoLog(i));return i}createProgram(t,e){const i=this.gl.createProgram();if(this.gl.attachShader(i,t),this.gl.attachShader(i,e),this.gl.linkProgram(i),!this.gl.getProgramParameter(i,this.gl.LINK_STATUS))throw new Error("Shader program error: "+this.gl.getProgramInfoLog(i));return this.gl.detachShader(i,t),this.gl.detachShader(i,e),this.gl.useProgram(null),i}}},"./libs/web-gl-display/src/index.ts":(t,e,i)=>{i.r(e),i.d(e,{WebGl2Display:()=>s.WebGl2Display});var s=i("./libs/web-gl-display/src/web-gl-display.ts")},"./libs/web-gl-display/src/m3x3.ts":(t,e,i)=>{i.r(e),i.d(e,{M3x3:()=>s});class s{constructor(t=new Float32Array([1,0,0,0,1,0,0,0,1])){this.matrix=t}multiply(t){const e=new s;return e.matrix=new Float32Array([this.matrix[0]*t.matrix[0]+this.matrix[3]*t.matrix[1]+this.matrix[6]*t.matrix[2],this.matrix[1]*t.matrix[0]+this.matrix[4]*t.matrix[1]+this.matrix[7]*t.matrix[2],this.matrix[2]*t.matrix[0]+this.matrix[5]*t.matrix[1]+this.matrix[8]*t.matrix[2],this.matrix[0]*t.matrix[3]+this.matrix[3]*t.matrix[4]+this.matrix[6]*t.matrix[5],this.matrix[1]*t.matrix[3]+this.matrix[4]*t.matrix[4]+this.matrix[7]*t.matrix[5],this.matrix[2]*t.matrix[3]+this.matrix[5]*t.matrix[4]+this.matrix[8]*t.matrix[5],this.matrix[0]*t.matrix[6]+this.matrix[3]*t.matrix[7]+this.matrix[6]*t.matrix[8],this.matrix[1]*t.matrix[6]+this.matrix[4]*t.matrix[7]+this.matrix[7]*t.matrix[8],this.matrix[2]*t.matrix[6]+this.matrix[5]*t.matrix[7]+this.matrix[8]*t.matrix[8]]),e}transition(t,e){const i=new s;return i.matrix=new Float32Array([this.matrix[0],this.matrix[1],this.matrix[2],this.matrix[3],this.matrix[4],this.matrix[5],t*this.matrix[0]+e*this.matrix[3]+this.matrix[6],t*this.matrix[1]+e*this.matrix[4]+this.matrix[7],t*this.matrix[2]+e*this.matrix[5]+this.matrix[8]]),i}scale(t,e){const i=new s;return i.matrix=new Float32Array([this.matrix[0]*t,this.matrix[1]*t,this.matrix[2]*t,this.matrix[3]*e,this.matrix[4]*e,this.matrix[5]*e,this.matrix[6],this.matrix[7],this.matrix[8]]),i}static transformation(t,e,i,a,l){const o=new s,r=Math.sin(i),n=Math.cos(i);return o.matrix=new Float32Array([n*a,-r*l,0,r*a,n*l,0,t,e,1]),o}setToTransformation(t,e,i,s,a){const l=Math.sin(i),o=Math.cos(i);return this.matrix[0]=o*s,this.matrix[1]=-l*a,this.matrix[2]=0,this.matrix[3]=l*s,this.matrix[4]=o*a,this.matrix[5]=0,this.matrix[6]=t,this.matrix[7]=e,this.matrix[8]=1,this}transformFrom(t,e,i,s,a){const l=Math.sin(i),o=Math.cos(i),r=this.matrix[0],n=this.matrix[1],h=this.matrix[2],c=this.matrix[3],d=this.matrix[4],u=this.matrix[5],p=this.matrix[6],g=this.matrix[7],m=this.matrix[8];return this.matrix[0]=r*o*s-c*l*a,this.matrix[1]=n*o*s-d*l*a,this.matrix[2]=h*o*s-u*l*a,this.matrix[3]=r*l*s+c*o*a,this.matrix[4]=n*l*s+d*o*a,this.matrix[5]=h*l*s+u*o*a,this.matrix[6]=r*t+c*e+p,this.matrix[7]=n*t+d*e+g,this.matrix[8]=h*t+u*e+m,this}reset(){return this.matrix[0]=1,this.matrix[1]=0,this.matrix[2]=0,this.matrix[3]=0,this.matrix[4]=1,this.matrix[5]=0,this.matrix[6]=0,this.matrix[7]=0,this.matrix[8]=1,this}getFloatArray(){return this.matrix}}},"./libs/web-gl-display/src/sprite-factory.ts":(t,e,i)=>{i.r(e),i.d(e,{SpriteFactory:()=>a});var s=i("./libs/web-gl-display/src/sprite.ts");class a{constructor(t,e,i,s){this.gl=t,this.shader=e,this.tileSize=i,this.worldSpaceMatrix=s}async createSprite(t,e,i,a,l){const o=await this.loadImage(t),r=e/o.width,n=i/o.height;this.gl.useProgram(this.shader.program);const h=this.createTexture(o),c=this.createTextureBuffer(r,n),d=this.createGeometryBuffer(e,i);return this.gl.useProgram(null),new s.Sprite(this.gl,this.shader,this.tileSize,this.worldSpaceMatrix,h,c,d,a,l,r,n)}loadImage(t){return new Promise((e=>{const i=new Image;i.onload=()=>e(i),i.src=t}))}createTexture(t){const e=this.gl,i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.bindTexture(e.TEXTURE_2D,null),i}createTextureBuffer(t,e){const i=this.gl,s=i.createBuffer();return i.bindBuffer(i.ARRAY_BUFFER,s),i.bufferData(i.ARRAY_BUFFER,this.createRectArray(0,0,t,e),i.STATIC_DRAW),s}createGeometryBuffer(t,e){const i=this.gl,s=i.createBuffer();return i.bindBuffer(i.ARRAY_BUFFER,s),i.bufferData(i.ARRAY_BUFFER,this.createRectArray(0,0,t,e),i.STATIC_DRAW),s}createRectArray(t=0,e=0,i=1,s=1){return new Float32Array([t,e,t+i,e,t,e+s,t,e+s,t+i,e,t+i,e+s])}}},"./libs/web-gl-display/src/sprite.ts":(t,e,i)=>{i.r(e),i.d(e,{Sprite:()=>a});var s=i("./libs/web-gl-display/src/m3x3.ts");class a{constructor(t,e,i,a,l,o,r,n,h,c,d,u=new Float32Array([1,1,1,1]),p=new s.M3x3){this.gl=t,this.shader=e,this.tileSize=i,this.worldSpaceMatrix=a,this.texture=l,this.textureBuffer=o,this.geometryBuffer=r,this.centerX=n,this.centerY=h,this.uvX=c,this.uvY=d,this.color=u,this.transformation=p}render(t,e,i=0,s=0,a=0,l=null,o=1,r=1,n=1){const h=this.gl;h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,this.texture),h.uniform1i(this.shader.uImageLocation,0),this.color[0]=l?.x??1,this.color[1]=l?.y??1,this.color[2]=l?.z??1,this.color[3]=o,h.uniform4fv(this.shader.uColorLocation,this.color),h.bindBuffer(h.ARRAY_BUFFER,this.textureBuffer),h.enableVertexAttribArray(this.shader.aTexCoordLocation),h.vertexAttribPointer(this.shader.aTexCoordLocation,2,h.FLOAT,!1,0,0),h.bindBuffer(h.ARRAY_BUFFER,this.geometryBuffer),h.enableVertexAttribArray(this.shader.aPositionLocation),h.vertexAttribPointer(this.shader.aPositionLocation,2,h.FLOAT,!1,0,0);const c=i*this.uvX,d=s*this.uvY;this.transformation.reset(),this.transformation.transformFrom(t*this.tileSize,e*this.tileSize,-a,r,n),this.transformation.transformFrom(-this.centerX,-this.centerY,0,1,1),h.uniform2f(this.shader.uFrameLocation,c,d),h.uniformMatrix3fv(this.shader.uWorldLocation,!1,this.worldSpaceMatrix.getFloatArray()),h.uniformMatrix3fv(this.shader.uObjectLocation,!1,this.transformation.getFloatArray()),h.drawArrays(h.TRIANGLE_STRIP,0,6)}}},"./libs/web-gl-display/src/standard-shader.ts":(t,e,i)=>{i.r(e),i.d(e,{StandardShader:()=>a});var s=i("./libs/web-gl-display/src/generic-shader.ts");class a extends s.GenericShader{constructor(t,e,i,s,a,l,o,r){super(t,"\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nuniform mat3 uWorld;\nuniform mat3 uObject;\nuniform vec2 uFrame;\nvoid main(void) {\ngl_Position = vec4(uWorld * uObject * vec3(aPosition, 1), 1);\nvTexCoord = aTexCoord + uFrame;\n}","\nprecision mediump float;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main(void) {\ngl_FragColor = texture2D(uImage, vTexCoord) * uColor;\n}"),this.aPositionLocation=e,this.aTexCoordLocation=i,this.uImageLocation=s,this.uColorLocation=a,this.uWorldLocation=l,this.uObjectLocation=o,this.uFrameLocation=r,this.aPositionLocation=t.getAttribLocation(this.program,"aPosition"),this.aTexCoordLocation=t.getAttribLocation(this.program,"aTexCoord"),this.uImageLocation=t.getUniformLocation(this.program,"uImage"),this.uColorLocation=t.getUniformLocation(this.program,"uColor"),this.uWorldLocation=t.getUniformLocation(this.program,"uWorld"),this.uObjectLocation=t.getUniformLocation(this.program,"uObject"),this.uFrameLocation=t.getUniformLocation(this.program,"uFrame")}}},"./libs/web-gl-display/src/web-gl-display.ts":(t,e,i)=>{i.r(e),i.d(e,{WebGl2Display:()=>o});var s=i("./libs/web-gl-display/src/m3x3.ts"),a=i("./libs/web-gl-display/src/sprite-factory.ts"),l=i("./libs/web-gl-display/src/standard-shader.ts");class o{constructor(t,e,i,s=!1,o=t.getContext("webgl2"),h=new l.StandardShader(o),c=null,d=r(t.width,t.height,i),u=new a.SpriteFactory(o,h,e,d),p={},g=[],m=!1,y=new n){this.canvas=t,this.tileSize=e,this.virtualScreenHeight=i,this.alignToPixelGrid=s,this.gl=o,this.standardShader=h,this.previousProgram=c,this.worldSpaceMatrix=d,this.spriteFactory=u,this.sprites=p,this.loadingSprites=g,this.sortByDepth=m,this.sortedSprites=y,this.gl.enable(this.gl.BLEND)}startFrame(){this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)}draw(t,e,i,s,a,l=1,o=0,r=null,n=1){this.sortByDepth?this.sortedSprites.add(t,e,i,s,a,l,o,r,n):this.drawSprite(t,e,i,s,a,o,r,n)}endFrame(){if(this.sortByDepth){this.sortedSprites.sort();for(let t=0;t<this.sortedSprites.numberOfSprites;t++){const e=this.sortedSprites.spritesToDraw[t];this.drawSprite(e.sprite,e.x,e.y,e.frameX,e.frameY,e.rotation,e.color,e.alpha)}this.sortedSprites.reset()}this.previousProgram=null,this.gl.useProgram(null),this.gl.flush()}drawSprite(t,e,i,s,a,l=0,o=null,r=1){const n=this.sprites[t];if(!n)return console.warn("Could not load sprite {0}",t);this.previousProgram!=n.shader.program&&(this.gl.useProgram(n.shader.program),this.previousProgram=n.shader.program),this.alignToPixelGrid&&(e=Math.floor(e*this.tileSize)/this.tileSize,i=Math.floor(i*this.tileSize)/this.tileSize),n.render(e,i,s,a,l,o,r)}resize(t,e){this.canvas.width=t,this.canvas.height=e,this.worldSpaceMatrix=r(t,e,this.virtualScreenHeight),this.spriteFactory=new a.SpriteFactory(this.gl,this.standardShader,this.tileSize,this.worldSpaceMatrix)}async addSprite(t,e,i=16,s=16,a=0,l=0){this.loadingSprites.push(t),this.sprites[t]=await this.spriteFactory.createSprite(e,i,s,a,l),this.loadingSprites.splice(this.loadingSprites.indexOf(t),1)}isLoading(){return this.loadingSprites.length>0}}function r(t,e,i){const a=t/(e/i);return(new s.M3x3).transition(-1,1).scale(2/a,-2/i)}class n{constructor(t=[],e=0){this.spritesToDraw=t,this.numberOfSprites=e}reset(){this.numberOfSprites=0}sort(){for(let t=this.numberOfSprites;t<this.spritesToDraw.length;t++)this.spritesToDraw[t].disabled=!0;this.spritesToDraw.sort(((t,e)=>t.disabled?1:e.disabled?-1:t.depth-e.depth))}add(t,e,i,s,a,l,o=0,r=null,n=1){if(!this.spritesToDraw[this.numberOfSprites])return this.spritesToDraw[this.numberOfSprites]=new h(!1,t,e,i,s,a,l,o,r,n),void this.numberOfSprites++;const c=this.spritesToDraw[this.numberOfSprites];c.disabled=!1,c.sprite=t,c.x=e,c.y=i,c.frameX=s,c.frameY=a,c.depth=l,c.rotation=o,c.color=r,c.alpha=n,this.numberOfSprites++}}class h{constructor(t,e,i,s,a,l,o,r=0,n=null,h=1){this.disabled=t,this.sprite=e,this.x=i,this.y=s,this.frameX=a,this.frameY=l,this.depth=o,this.rotation=r,this.color=n,this.alpha=h}}},"./libs/meld/src/display-config.json":t=>{t.exports=JSON.parse('{"RenderToVirtualSize":true,"VirtualPixelsPerTile":16,"VirtualHeight":240,"WallDisplayHeight":2.5,"DisplayDepth":4,"TransparencyRadius":5,"TransparencyAlpha":0.4,"BlockingTransparencyRadius":10,"BlockingTransparencyAlpha":0.2,"AssetFolder":"assets/","BlockSprites":{"grass-rich":[{"Weight":50,"StraightTile":"grass-rich-tile-straight","StraightHalfWall":"grass-rich-half-wall-straight","StraightFullWall":"grass-rich-full-wall-straight","DiagonalTile":"grass-rich-tile-diagonal","DiagonalHalfWall":"grass-rich-half-wall-diagonal","DiagonalFullWall":"grass-rich-full-wall-diagonal"},{"StraightTile":"grass-rich-tile-straight-2","StraightHalfWall":"grass-rich-half-wall-straight","StraightFullWall":"grass-rich-full-wall-straight","DiagonalTile":"grass-rich-tile-diagonal-2","DiagonalHalfWall":"grass-rich-half-wall-diagonal","DiagonalFullWall":"grass-rich-full-wall-diagonal"},{"StraightTile":"grass-rich-tile-straight-3","StraightHalfWall":"grass-rich-half-wall-straight","StraightFullWall":"grass-rich-full-wall-straight","DiagonalTile":"grass-rich-tile-diagonal-3","DiagonalHalfWall":"grass-rich-half-wall-diagonal","DiagonalFullWall":"grass-rich-full-wall-diagonal"},{"StraightTile":"grass-rich-tile-straight-4","StraightHalfWall":"grass-rich-half-wall-straight","StraightFullWall":"grass-rich-full-wall-straight","DiagonalTile":"grass-rich-tile-diagonal-4","DiagonalHalfWall":"grass-rich-half-wall-diagonal","DiagonalFullWall":"grass-rich-full-wall-diagonal"},{"StraightTile":"grass-rich-tile-straight-5","StraightHalfWall":"grass-rich-half-wall-straight","StraightFullWall":"grass-rich-full-wall-straight","DiagonalTile":"grass-rich-tile-diagonal-5","DiagonalHalfWall":"grass-rich-half-wall-diagonal","DiagonalFullWall":"grass-rich-full-wall-diagonal"},{"StraightTile":"grass-rich-tile-straight-6","StraightHalfWall":"grass-rich-half-wall-straight","StraightFullWall":"grass-rich-full-wall-straight","DiagonalTile":"grass-rich-tile-diagonal-6","DiagonalHalfWall":"grass-rich-half-wall-diagonal","DiagonalFullWall":"grass-rich-full-wall-diagonal"}],"darkstone":[{"StraightTile":"darkstone-tile-straight","StraightHalfWall":"darkstone-half-wall-straight","StraightFullWall":"darkstone-full-wall-straight","DiagonalTile":"darkstone-tile-diagonal","DiagonalHalfWall":"darkstone-half-wall-diagonal","DiagonalFullWall":"darkstone-full-wall-diagonal"}],"darkstone-block":[{"StraightTile":"darkstone-block-tile-straight","StraightHalfWall":"darkstone-block-half-wall-straight","StraightFullWall":"darkstone-block-full-wall-straight","DiagonalTile":"darkstone-block-tile-diagonal","DiagonalHalfWall":"darkstone-block-half-wall-diagonal","DiagonalFullWall":"darkstone-block-full-wall-diagonal"}],"darkstone-flagstone":[{"StraightTile":"darkstone-flagstone-tile-straight","StraightHalfWall":"darkstone-flagstone-half-wall-straight","StraightFullWall":"darkstone-flagstone-full-wall-straight","DiagonalTile":"darkstone-flagstone-tile-diagonal","DiagonalHalfWall":"darkstone-flagstone-half-wall-diagonal","DiagonalFullWall":"darkstone-flagstone-full-wall-diagonal"}],"darkwood":[{"StraightTile":"darkwood-tile","StraightHalfWall":"darkwood-half","StraightFullWall":"darkwood-full","DiagonalTile":"darkwood-tile","DiagonalHalfWall":"darkwood-half","DiagonalFullWall":"darkwood-full"}],"darkwood-beam":[{"StraightTile":"darkwood-beam-tile-straight","StraightHalfWall":"darkwood-beam-half-wall-straight","StraightFullWall":"darkwood-beam-full-wall-straight","DiagonalTile":"darkwood-beam-tile-diagonal","DiagonalHalfWall":"darkwood-beam-half-wall-diagonal","DiagonalFullWall":"darkwood-beam-full-wall-diagonal"}],"darkwood-planks":[{"StraightTile":"darkwood-planks-tile-straight","StraightHalfWall":"darkwood-planks-half-wall-straight","StraightFullWall":"darkwood-planks-full-wall-straight","DiagonalTile":"darkwood-planks-tile-diagonal","DiagonalHalfWall":"darkwood-planks-half-wall-diagonal","DiagonalFullWall":"darkwood-planks-full-wall-diagonal"}],"darkwood-planks-weathered":[{"StraightTile":"darkwood-planks-weathered-tile-straight","StraightHalfWall":"darkwood-planks-weathered-half-wall-straight","StraightFullWall":"darkwood-planks-weathered-full-wall-straight","DiagonalTile":"darkwood-planks-weathered-tile-diagonal","DiagonalHalfWall":"darkwood-planks-weathered-half-wall-diagonal","DiagonalFullWall":"darkwood-planks-weathered-full-wall-diagonal"}],"lightwood":[{"StraightTile":"lightwood-tile","StraightHalfWall":"lightwood-half","StraightFullWall":"lightwood-full","DiagonalTile":"lightwood-tile","DiagonalHalfWall":"lightwood-half","DiagonalFullWall":"lightwood-full"}],"lightwood-beam":[{"StraightTile":"lightwood-beam-tile-straight","StraightHalfWall":"lightwood-beam-half-wall-straight","StraightFullWall":"lightwood-beam-full-wall-straight","DiagonalTile":"lightwood-beam-tile-diagonal","DiagonalHalfWall":"lightwood-beam-half-wall-diagonal","DiagonalFullWall":"lightwood-beam-full-wall-diagonal"}],"lightwood-planks":[{"StraightTile":"lightwood-planks-tile-straight","StraightHalfWall":"lightwood-planks-half-wall-straight","StraightFullWall":"lightwood-planks-full-wall-straight","DiagonalTile":"lightwood-planks-tile-diagonal","DiagonalHalfWall":"lightwood-planks-half-wall-diagonal","DiagonalFullWall":"lightwood-planks-full-wall-diagonal"}],"lightwood-planks-weathered":[{"StraightTile":"lightwood-planks-weathered-tile-straight","StraightHalfWall":"lightwood-planks-weathered-half-wall-straight","StraightFullWall":"lightwood-planks-weathered-full-wall-straight","DiagonalTile":"lightwood-planks-weathered-tile-diagonal","DiagonalHalfWall":"lightwood-planks-weathered-half-wall-diagonal","DiagonalFullWall":"lightwood-planks-weathered-full-wall-diagonal"}],"soil-poor":[{"StraightTile":"soil-poor-tile-straight","StraightHalfWall":"soil-poor-half-wall-straight","StraightFullWall":"soil-poor-full-wall-straight","DiagonalTile":"soil-poor-tile-diagonal","DiagonalHalfWall":"soil-poor-half-wall-diagonal","DiagonalFullWall":"soil-poor-full-wall-diagonal"}],"soil-rich":[{"StraightTile":"soil-rich-tile-straight","StraightHalfWall":"soil-rich-half-wall-straight","StraightFullWall":"soil-rich-full-wall-straight","DiagonalTile":"soil-rich-tile-diagonal","DiagonalHalfWall":"soil-rich-half-wall-diagonal","DiagonalFullWall":"soil-rich-full-wall-diagonal"}],"stone-block":[{"StraightTile":"stone-block-tile-straight","StraightHalfWall":"stone-block-half-wall-straight","StraightFullWall":"stone-block-full-wall-straight","DiagonalTile":"stone-block-tile-diagonal","DiagonalHalfWall":"stone-block-half-wall-diagonal","DiagonalFullWall":"stone-block-full-wall-diagonal"}],"stone-flagstone":[{"StraightTile":"stone-flagstone-tile-straight","StraightHalfWall":"stone-flagstone-half-wall-straight","StraightFullWall":"stone-flagstone-full-wall-straight","DiagonalTile":"stone-flagstone-tile-diagonal","DiagonalHalfWall":"stone-flagstone-half-wall-diagonal","DiagonalFullWall":"stone-flagstone-full-wall-diagonal"}],"wood":[{"StraightTile":"wood-tile","StraightHalfWall":"wood-half","StraightFullWall":"wood-full","DiagonalTile":"wood-tile","DiagonalHalfWall":"wood-half","DiagonalFullWall":"wood-full"}],"wood-beam":[{"StraightTile":"wood-beam-tile-straight","StraightHalfWall":"wood-beam-half-wall-straight","StraightFullWall":"wood-beam-full-wall-straight","DiagonalTile":"wood-beam-tile-diagonal","DiagonalHalfWall":"wood-beam-half-wall-diagonal","DiagonalFullWall":"wood-beam-full-wall-diagonal"}],"wood-planks":[{"StraightTile":"wood-planks-tile-straight","StraightHalfWall":"wood-planks-half-wall-straight","StraightFullWall":"wood-planks-full-wall-straight","DiagonalTile":"wood-planks-tile-diagonal","DiagonalHalfWall":"wood-planks-half-wall-diagonal","DiagonalFullWall":"wood-planks-full-wall-diagonal"}],"wood-planks-weathered":[{"StraightTile":"wood-planks-weathered-tile-straight","StraightHalfWall":"wood-planks-weathered-half-wall-straight","StraightFullWall":"wood-planks-weathered-full-wall-straight","DiagonalTile":"wood-planks-weathered-tile-diagonal","DiagonalHalfWall":"wood-planks-weathered-half-wall-diagonal","DiagonalFullWall":"wood-planks-weathered-full-wall-diagonal"}]},"BlockTileOverlays":{"grass-rich":{"TileOverlayTop":"grass-rich-tile-top","TileOverlayBottom":"grass-rich-tile-bottom","TileOverlayLeft":"grass-rich-tile-left","TileOverlayRight":"grass-rich-tile-right","TileOverlayTopLeft":"grass-rich-tile-left","TileOverlayTopRight":"grass-rich-tile-top","TileOverlayBottomLeft":"grass-rich-tile-bottom","TileOverlayBottomRight":"grass-rich-tile-right"}},"EntitySprites":{"player":{"Idle":[{"EndAngle":0.0625,"Sprite":"character-idle-right"},{"EndAngle":0.1875,"Sprite":"character-idle-bottom-right"},{"EndAngle":0.3125,"Sprite":"character-idle-bottom"},{"EndAngle":0.4375,"Sprite":"character-idle-bottom-left"},{"EndAngle":0.5625,"Sprite":"character-idle-left"},{"EndAngle":0.6875,"Sprite":"character-idle-top-left"},{"EndAngle":0.8125,"Sprite":"character-idle-top"},{"EndAngle":0.9375,"Sprite":"character-idle-top-right"}],"Walk":[{"EndAngle":0.0625,"Sprite":"character-walk-right"},{"EndAngle":0.1875,"Sprite":"character-walk-bottom-right"},{"EndAngle":0.3125,"Sprite":"character-walk-bottom"},{"EndAngle":0.4375,"Sprite":"character-walk-bottom-left"},{"EndAngle":0.5625,"Sprite":"character-walk-left"},{"EndAngle":0.6875,"Sprite":"character-walk-top-left"},{"EndAngle":0.8125,"Sprite":"character-walk-top"},{"EndAngle":0.9375,"Sprite":"character-walk-top-right"}],"Run":[{"EndAngle":0.0625,"Sprite":"character-run-right"},{"EndAngle":0.1875,"Sprite":"character-run-bottom-right"},{"EndAngle":0.3125,"Sprite":"character-run-bottom"},{"EndAngle":0.4375,"Sprite":"character-run-bottom-left"},{"EndAngle":0.5625,"Sprite":"character-run-left"},{"EndAngle":0.6875,"Sprite":"character-run-top-left"},{"EndAngle":0.8125,"Sprite":"character-run-top"},{"EndAngle":0.9375,"Sprite":"character-run-top-right"}],"Dash":[{"EndAngle":0.0625,"Sprite":"character-dash-right"},{"EndAngle":0.1875,"Sprite":"character-dash-bottom-right"},{"EndAngle":0.3125,"Sprite":"character-dash-bottom"},{"EndAngle":0.4375,"Sprite":"character-dash-bottom-left"},{"EndAngle":0.5625,"Sprite":"character-dash-left"},{"EndAngle":0.6875,"Sprite":"character-dash-top-left"},{"EndAngle":0.8125,"Sprite":"character-dash-top"},{"EndAngle":0.9375,"Sprite":"character-dash-top-right"}]},"slime":{"Idle":[{"EndAngle":1,"Sprite":"slime"}]}},"ItemSprites":{"basic-hammer":"hammer"},"GameplaySprites":{"ShadowSmall":"shadow-medium","ShadowMedium":"shadow-medium","ShadowBig":"shadow-medium","WallShadowFullLeft":"default-wall-shadow-full-left","WallShadowFullRight":"default-wall-shadow-full-right","WallShadowFullDiagonal":"default-wall-shadow-full-diagonal","WallShadowHalfLeft":"default-wall-shadow-half-left","WallShadowHalfRight":"default-wall-shadow-half-right","WallShadowHalfDiagonal":"default-wall-shadow-half-diagonal","DashCloud":"dash-cloud","DashRecharge":"dash-recharge","DashTarget":"dash-target","DashTargetFade":"dash-target-fade","DashFail":"dash-fail","DashMarker":"dash-marker","DashFailMarker":"dash-fail-marker","HudLeft":"hud-items","HudRight":"hud-tools"},"DefaultSpriteTypes":{"defaultTile":{"width":16,"height":16,"centerX":8,"centerY":8},"defaultDiagonalTile":{"width":24,"height":24,"centerX":12,"centerY":12},"defaultHalfWall":{"width":16,"height":20,"centerX":8,"centerY":12},"defaultFullWall":{"width":16,"height":40,"centerX":8,"centerY":32},"defaultDiagonalHalfWall":{"width":24,"height":32,"centerX":12,"centerY":20},"defaultDiagonalFullWall":{"width":24,"height":52,"centerX":12,"centerY":40},"tileSize":{"width":16,"height":16,"centerX":8,"centerY":8},"defaultCharacter":{"width":32,"height":48,"centerX":16,"centerY":40}},"Sprites":{"missing-sprite":{"type":"tileSize"},"character-idle-top-left":{"type":"defaultCharacter"},"character-idle-top":{"type":"defaultCharacter"},"character-idle-top-right":{"type":"defaultCharacter"},"character-idle-right":{"type":"defaultCharacter"},"character-idle-bottom-right":{"type":"defaultCharacter"},"character-idle-bottom":{"type":"defaultCharacter"},"character-idle-bottom-left":{"type":"defaultCharacter"},"character-idle-left":{"type":"defaultCharacter"},"character-walk-top-left":{"type":"defaultCharacter"},"character-walk-top":{"type":"defaultCharacter"},"character-walk-top-right":{"type":"defaultCharacter"},"character-walk-right":{"type":"defaultCharacter"},"character-walk-bottom-right":{"type":"defaultCharacter"},"character-walk-bottom":{"type":"defaultCharacter"},"character-walk-bottom-left":{"type":"defaultCharacter"},"character-walk-left":{"type":"defaultCharacter"},"character-run-top-left":{"type":"defaultCharacter"},"character-run-top":{"type":"defaultCharacter"},"character-run-top-right":{"type":"defaultCharacter"},"character-run-right":{"type":"defaultCharacter"},"character-run-bottom-right":{"type":"defaultCharacter"},"character-run-bottom":{"type":"defaultCharacter"},"character-run-bottom-left":{"type":"defaultCharacter"},"character-run-left":{"type":"defaultCharacter"},"character-dash-top-left":{"type":"defaultCharacter"},"character-dash-top":{"type":"defaultCharacter"},"character-dash-top-right":{"type":"defaultCharacter"},"character-dash-right":{"type":"defaultCharacter"},"character-dash-bottom-right":{"type":"defaultCharacter"},"character-dash-bottom":{"type":"defaultCharacter"},"character-dash-bottom-left":{"type":"defaultCharacter"},"character-dash-left":{"type":"defaultCharacter"},"slime":{"width":32,"height":32,"centerX":16,"centerY":16,"framesX":4,"frameInterval":0.2},"default-tile-left":{"width":16,"height":16,"centerX":24,"centerY":8},"default-tile-right":{"width":16,"height":16,"centerX":-8,"centerY":8},"default-tile-top":{"width":16,"height":16,"centerX":8,"centerY":24},"default-tile-bottom":{"width":16,"height":16,"centerX":8,"centerY":-8},"default-tile-top-left":{"width":24,"height":24,"centerX":24,"centerY":24},"default-tile-top-right":{"width":24,"height":24,"centerX":0,"centerY":24},"default-tile-bottom-left":{"width":24,"height":24,"centerX":24,"centerY":0},"default-tile-bottom-right":{"width":24,"height":24,"centerX":0,"centerY":0},"default-straight-full-wall-left":{"path":"default-wall-full-left","width":16,"height":40,"centerX":24,"centerY":32},"default-straight-full-wall-right":{"path":"default-wall-full-right","width":16,"height":40,"centerX":-8,"centerY":32},"default-straight-half-wall-left":{"path":"default-wall-half-left","width":16,"height":20,"centerX":24,"centerY":12},"default-straight-half-wall-right":{"path":"default-wall-half-right","width":16,"height":20,"centerX":-8,"centerY":12},"default-diagonal-full-wall-left":{"path":"default-wall-full-left","width":16,"height":40,"centerX":28,"centerY":40},"default-diagonal-full-wall-right":{"path":"default-wall-full-right","width":16,"height":40,"centerX":-12,"centerY":40},"default-diagonal-half-wall-left":{"path":"default-wall-half-left","width":16,"height":20,"centerX":28,"centerY":20},"default-diagonal-half-wall-right":{"path":"default-wall-half-right","width":16,"height":20,"centerX":-12,"centerY":20},"default-wall-shadow-full-left":{"type":"defaultTile"},"default-wall-shadow-full-right":{"type":"defaultTile"},"default-wall-shadow-full-diagonal":{"type":"defaultDiagonalTile"},"default-wall-shadow-half-left":{"type":"defaultTile"},"default-wall-shadow-half-right":{"type":"defaultTile"},"default-wall-shadow-half-diagonal":{"type":"defaultDiagonalTile"},"grass-rich-tile-straight":{"type":"defaultTile"},"grass-rich-tile-diagonal":{"type":"defaultDiagonalTile"},"grass-rich-half-wall-straight":{"type":"defaultHalfWall"},"grass-rich-full-wall-straight":{"type":"defaultFullWall"},"grass-rich-half-wall-diagonal":{"type":"defaultDiagonalHalfWall"},"grass-rich-full-wall-diagonal":{"type":"defaultDiagonalFullWall"},"grass-rich-tile-straight-2":{"type":"defaultTile"},"grass-rich-tile-diagonal-2":{"type":"defaultDiagonalTile"},"grass-rich-tile-straight-3":{"type":"defaultTile"},"grass-rich-tile-diagonal-3":{"type":"defaultDiagonalTile"},"grass-rich-tile-straight-4":{"type":"defaultTile"},"grass-rich-tile-diagonal-4":{"type":"defaultDiagonalTile"},"grass-rich-tile-straight-5":{"type":"defaultTile"},"grass-rich-tile-diagonal-5":{"type":"defaultDiagonalTile"},"grass-rich-tile-straight-6":{"type":"defaultTile"},"grass-rich-tile-diagonal-6":{"type":"defaultDiagonalTile"},"grass-rich-tile-left":{"width":16,"height":16,"centerX":24,"centerY":8},"grass-rich-tile-right":{"width":16,"height":16,"centerX":-8,"centerY":8},"grass-rich-tile-top":{"width":16,"height":16,"centerX":8,"centerY":24},"grass-rich-tile-bottom":{"width":16,"height":16,"centerX":8,"centerY":-8},"darkstone-tile-straight":{"type":"defaultTile"},"darkstone-tile-diagonal":{"type":"defaultDiagonalTile"},"darkstone-half-wall-straight":{"type":"defaultHalfWall"},"darkstone-full-wall-straight":{"type":"defaultFullWall"},"darkstone-half-wall-diagonal":{"type":"defaultDiagonalHalfWall"},"darkstone-full-wall-diagonal":{"type":"defaultDiagonalFullWall"},"darkstone-block-tile-straight":{"type":"defaultTile"},"darkstone-block-tile-diagonal":{"type":"defaultDiagonalTile"},"darkstone-block-half-wall-straight":{"type":"defaultHalfWall"},"darkstone-block-full-wall-straight":{"type":"defaultFullWall"},"darkstone-block-half-wall-diagonal":{"type":"defaultDiagonalHalfWall"},"darkstone-block-full-wall-diagonal":{"type":"defaultDiagonalFullWall"},"darkstone-flagstone-tile-straight":{"type":"defaultTile"},"darkstone-flagstone-tile-diagonal":{"type":"defaultDiagonalTile"},"darkstone-flagstone-half-wall-straight":{"type":"defaultHalfWall"},"darkstone-flagstone-full-wall-straight":{"type":"defaultFullWall"},"darkstone-flagstone-half-wall-diagonal":{"type":"defaultDiagonalHalfWall"},"darkstone-flagstone-full-wall-diagonal":{"type":"defaultDiagonalFullWall"},"darkwood-tile":{"type":"defaultTile"},"darkwood-half":{"width":16,"height":32,"centerX":8,"centerY":24},"darkwood-full":{"width":16,"height":48,"centerX":8,"centerY":40},"darkwood-beam-tile-straight":{"type":"defaultTile"},"darkwood-beam-tile-diagonal":{"type":"defaultDiagonalTile"},"darkwood-beam-half-wall-straight":{"type":"defaultHalfWall"},"darkwood-beam-full-wall-straight":{"type":"defaultFullWall"},"darkwood-beam-half-wall-diagonal":{"type":"defaultDiagonalHalfWall"},"darkwood-beam-full-wall-diagonal":{"type":"defaultDiagonalFullWall"},"darkwood-planks-tile-straight":{"type":"defaultTile"},"darkwood-planks-tile-diagonal":{"type":"defaultDiagonalTile"},"darkwood-planks-half-wall-straight":{"type":"defaultHalfWall"},"darkwood-planks-full-wall-straight":{"type":"defaultFullWall"},"darkwood-planks-half-wall-diagonal":{"type":"defaultDiagonalHalfWall"},"darkwood-planks-full-wall-diagonal":{"type":"defaultDiagonalFullWall"},"darkwood-planks-weathered-tile-straight":{"type":"defaultTile"},"darkwood-planks-weathered-tile-diagonal":{"type":"defaultDiagonalTile"},"darkwood-planks-weathered-half-wall-straight":{"type":"defaultHalfWall"},"darkwood-planks-weathered-full-wall-straight":{"type":"defaultFullWall"},"darkwood-planks-weathered-half-wall-diagonal":{"type":"defaultDiagonalHalfWall"},"darkwood-planks-weathered-full-wall-diagonal":{"type":"defaultDiagonalFullWall"},"lightwood-tile":{"type":"defaultTile"},"lightwood-half":{"width":16,"height":32,"centerX":8,"centerY":24},"lightwood-full":{"width":16,"height":48,"centerX":8,"centerY":40},"lightwood-beam-tile-straight":{"type":"defaultTile"},"lightwood-beam-tile-diagonal":{"type":"defaultDiagonalTile"},"lightwood-beam-half-wall-straight":{"type":"defaultHalfWall"},"lightwood-beam-full-wall-straight":{"type":"defaultFullWall"},"lightwood-beam-half-wall-diagonal":{"type":"defaultDiagonalHalfWall"},"lightwood-beam-full-wall-diagonal":{"type":"defaultDiagonalFullWall"},"lightwood-planks-tile-straight":{"type":"defaultTile"},"lightwood-planks-tile-diagonal":{"type":"defaultDiagonalTile"},"lightwood-planks-half-wall-straight":{"type":"defaultHalfWall"},"lightwood-planks-full-wall-straight":{"type":"defaultFullWall"},"lightwood-planks-half-wall-diagonal":{"type":"defaultDiagonalHalfWall"},"lightwood-planks-full-wall-diagonal":{"type":"defaultDiagonalFullWall"},"lightwood-planks-weathered-tile-straight":{"type":"defaultTile"},"lightwood-planks-weathered-tile-diagonal":{"type":"defaultDiagonalTile"},"lightwood-planks-weathered-half-wall-straight":{"type":"defaultHalfWall"},"lightwood-planks-weathered-full-wall-straight":{"type":"defaultFullWall"},"lightwood-planks-weathered-half-wall-diagonal":{"type":"defaultDiagonalHalfWall"},"lightwood-planks-weathered-full-wall-diagonal":{"type":"defaultDiagonalFullWall"},"soil-poor-tile-straight":{"type":"defaultTile"},"soil-poor-tile-diagonal":{"type":"defaultDiagonalTile"},"soil-poor-half-wall-straight":{"type":"defaultHalfWall"},"soil-poor-full-wall-straight":{"type":"defaultFullWall"},"soil-poor-half-wall-diagonal":{"type":"defaultDiagonalHalfWall"},"soil-poor-full-wall-diagonal":{"type":"defaultDiagonalFullWall"},"soil-rich-tile-straight":{"type":"defaultTile"},"soil-rich-tile-diagonal":{"type":"defaultDiagonalTile"},"soil-rich-half-wall-straight":{"type":"defaultHalfWall"},"soil-rich-full-wall-straight":{"type":"defaultFullWall"},"soil-rich-half-wall-diagonal":{"type":"defaultDiagonalHalfWall"},"soil-rich-full-wall-diagonal":{"type":"defaultDiagonalFullWall"},"stone-block-tile-straight":{"type":"defaultTile"},"stone-block-tile-diagonal":{"type":"defaultDiagonalTile"},"stone-block-half-wall-straight":{"type":"defaultHalfWall"},"stone-block-full-wall-straight":{"type":"defaultFullWall"},"stone-block-half-wall-diagonal":{"type":"defaultDiagonalHalfWall"},"stone-block-full-wall-diagonal":{"type":"defaultDiagonalFullWall"},"stone-flagstone-tile-straight":{"type":"defaultTile"},"stone-flagstone-tile-diagonal":{"type":"defaultDiagonalTile"},"stone-flagstone-half-wall-straight":{"type":"defaultHalfWall"},"stone-flagstone-full-wall-straight":{"type":"defaultFullWall"},"stone-flagstone-half-wall-diagonal":{"type":"defaultDiagonalHalfWall"},"stone-flagstone-full-wall-diagonal":{"type":"defaultDiagonalFullWall"},"wood-tile":{"type":"defaultTile"},"wood-half":{"width":16,"height":32,"centerX":8,"centerY":24},"wood-full":{"width":16,"height":48,"centerX":8,"centerY":40},"wood-beam-tile-straight":{"type":"defaultTile"},"wood-beam-tile-diagonal":{"type":"defaultDiagonalTile"},"wood-beam-half-wall-straight":{"type":"defaultHalfWall"},"wood-beam-full-wall-straight":{"type":"defaultFullWall"},"wood-beam-half-wall-diagonal":{"type":"defaultDiagonalHalfWall"},"wood-beam-full-wall-diagonal":{"type":"defaultDiagonalFullWall"},"wood-planks-tile-straight":{"type":"defaultTile"},"wood-planks-tile-diagonal":{"type":"defaultDiagonalTile"},"wood-planks-half-wall-straight":{"type":"defaultHalfWall"},"wood-planks-full-wall-straight":{"type":"defaultFullWall"},"wood-planks-half-wall-diagonal":{"type":"defaultDiagonalHalfWall"},"wood-planks-full-wall-diagonal":{"type":"defaultDiagonalFullWall"},"wood-planks-weathered-tile-straight":{"type":"defaultTile"},"wood-planks-weathered-tile-diagonal":{"type":"defaultDiagonalTile"},"wood-planks-weathered-half-wall-straight":{"type":"defaultHalfWall"},"wood-planks-weathered-full-wall-straight":{"type":"defaultFullWall"},"wood-planks-weathered-half-wall-diagonal":{"type":"defaultDiagonalHalfWall"},"wood-planks-weathered-full-wall-diagonal":{"type":"defaultDiagonalFullWall"},"hud-items":{"width":96,"height":96},"hud-tools":{"path":"hud-items","width":96,"height":96,"centerX":96},"dash-cloud":{"width":48,"height":48,"centerX":24,"centerY":24,"framesX":3,"framesY":3,"frameInterval":0.1},"dash-recharge":{"width":48,"height":48,"centerX":24,"centerY":24,"framesX":3,"framesY":3,"frameInterval":0.05},"dash-target":{"type":"tileSize","framesX":2,"framesY":2,"frameInterval":0.085},"dash-target-fade":{"type":"tileSize","framesX":2,"framesY":2,"frameInterval":0.085},"dash-fail":{"type":"tileSize","framesX":2,"framesY":2,"frameInterval":0.1},"dash-marker":{"type":"tileSize","framesX":4,"framesY":3,"frameInterval":0.085},"dash-fail-marker":{"type":"tileSize","framesX":4,"framesY":3,"frameInterval":0.085},"shadow-medium":{"width":20,"height":20,"centerX":10,"centerY":10},"hammer":{"width":24,"height":24,"centerX":12,"centerY":12},"button-a":{"type":"tileSize"},"button-b":{"type":"tileSize"},"button-x":{"type":"tileSize"},"button-y":{"type":"tileSize"}}}')},"./libs/meld/src/display-settings.json":t=>{t.exports=JSON.parse('{"Inputs":{"NormalModeMoveUp":["W","Up","PadLeftStickUp"],"NormalModeMoveDown":["S","Down","PadLeftStickDown"],"NormalModeMoveLeft":["A","Left","PadLeftStickLeft"],"NormalModeMoveRight":["D","Right","PadLeftStickRight"],"NormalModeUseItem":["MouseRight","PadY","PadRightTrigger"],"NormalModeToolPrimary":["MouseLeft","PadA","PadLeftTrigger"],"NormalModeToolSecondary":["F","PadX"],"NormalModeAction":["Space","PadB","PadRightStickPress"],"MoveUp":["Up"],"MoveDown":["Down"],"MoveLeft":["Left"],"MoveRight":["Right"],"UseItem":["MouseRight","PadRightTrigger"],"ToolPrimary":["MouseLeft","PadLeftTrigger"],"ToolSecondary":["F"],"Action":["Space","PadRightStickPress"],"ToggleSelection":[],"HoldSelection":["PadLeftShoulder","LeftShift"],"SelectionModeSelectTopItem":["1","PadUp","PadLeftStickUp"],"SelectionModeSelectBottomItem":["3","PadDown","PadLeftStickDown"],"SelectionModeSelectLeftItem":["4","PadLeft","PadLeftStickLeft"],"SelectionModeSelectRightItem":["2","PadRight","PadLeftStickRight"],"SelectionModeSelectTopTool":["PadY","W"],"SelectionModeSelectBottomTool":["PadA","S"],"SelectionModeSelectLeftTool":["PadX","A"],"SelectionModeSelectRightTool":["PadB","D"],"SelectTopItem":["1","PadUp"],"SelectBottomItem":["3","PadDown"],"SelectLeftItem":["4","PadLeft"],"SelectRightItem":["2","PadRight"],"SelectTopTool":[],"SelectBottomTool":[],"SelectLeftTool":[],"SelectRightTool":[],"ToggleCamera":[],"HoldCamera":["PadRightShoulder"],"CameraModeMoveCameraUp":["PadLeftStickUp"],"CameraModeMoveCameraDown":["PadLeftStickDown"],"CameraModeMoveCameraLeft":["PadLeftStickLeft"],"CameraModeMoveCameraRight":["PadLeftStickRight"],"CameraModeLookUp":["PadY"],"CameraModeLookDown":["PadA"],"CameraModeRotateCameraLeft":["PadX"],"CameraModeRotateCameraRight":["PadB"],"MoveCameraUp":[],"MoveCameraDown":[],"MoveCameraLeft":[],"MoveCameraRight":[],"LookUp":[],"LookDown":[],"RotateCameraLeft":["Q"],"RotateCameraRight":["E"],"ToggleInventory":["Tab","Start"],"ToggleMenu":["Escape","Select"],"ToggleChat":["Enter"],"SelectTopItemSet":[],"SelectBottomItemSet":[],"SelectLeftItemSet":[],"SelectRightItemSet":[],"SelectNextItem":["MouseScrollUp"],"SelectPreviousItem":["MouseScrollDown"],"HoldWalk":["LeftControl"],"ToggleWalk":[]}}')},"./libs/meld/src/game-config.json":t=>{t.exports=JSON.parse('{"Constants":{"PlayerType":"player","SolidItemType":"solid","DefaultBlock":{"BlockType":"Full","Solid":"darkstone","NonSolid":"air"},"ChunkSize":{"X":32,"Y":32,"Z":4},"RegionSizeInChunks":{"X":8,"Y":8,"Z":4},"DefaultWorldBounds":{"MinX":-768,"MaxX":768,"MinY":-768,"MaxY":768,"MinZ":-8,"MaxZ":8},"ChunkLoadingRadius":1,"CollisionAreaWidth":0.0001,"GravityAcceleration":0.5,"TerminalVerticalVelocity":10,"MaxMoveSpeed":8,"Acceleration":3,"InitialDashCharge":30,"MaxDashCharge":50,"DashChargeSpeed":1,"DashDuration":0.2,"DashCooldown":1,"QuickDashWindowStart":0.1,"QuickDashWindowEnd":1,"QuickDashMinimumAngle":0.125,"MiningStartup":0.333,"MiningRecovery":0.166},"Lists":{"RandomlySpawningMonsters":["slime"]},"EntityTypes":{"player":{"BlockCollisionBehaviour":true,"CircularSize":{"Radius":0.625,"Height":0.875},"GravityBehaviour":true,"PlayerBehaviour":true,"SelectableItems":true,"SelectableTools":true},"slime":{"BlockCollisionBehaviour":true,"CircularSize":{"Radius":0.75,"Height":1},"GravityBehaviour":true},"despawning":{"DespawnTime":0}},"SolidTypes":{"darkstone":{},"darkstone-block":{},"darkstone-flagstone":{},"darkwood":{},"darkwood-beam":{},"darkwood-planks":{},"darkwood-planks-weathered":{},"grass-rich":{},"lightwood":{},"lightwood-beam":{},"lightwood-planks":{},"lightwood-planks-weathered":{},"soil-poor":{},"soil-rich":{},"stone-block":{},"stone-flagstone":{},"wood":{},"wood-beam":{},"wood-planks":{},"wood-planks-weathered":{}},"NonSolidTypes":{"air":{}},"ItemTypes":{"solid":{"Kind":"Solid"},"basic-hammer":{"Kind":"Hammer"}}}')}},s={};function a(t){var e=s[t];if(void 0!==e)return e.exports;var l=s[t]={exports:{}};return i[t](l,l.exports,a),l.exports}e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,a.t=function(i,s){if(1&s&&(i=this(i)),8&s)return i;if("object"==typeof i&&i){if(4&s&&i.__esModule)return i;if(16&s&&"function"==typeof i.then)return i}var l=Object.create(null);a.r(l);var o={};t=t||[null,e({}),e([]),e(e)];for(var r=2&s&&i;"object"==typeof r&&!~t.indexOf(r);r=e(r))Object.getOwnPropertyNames(r).forEach((t=>o[t]=()=>i[t]));return o.default=()=>i,a.d(l,o),l},a.d=(t,e)=>{for(var i in e)a.o(e,i)&&!a.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var l={};return(()=>{a.r(l),a.d(l,{ActionState:()=>s.ActionState,ChargeDashAction:()=>s.ChargeDashAction,GameUpdate:()=>s.GameUpdate,JumpAction:()=>s.JumpAction,LoadPlayer:()=>s.LoadPlayer,LoadRegion:()=>s.LoadRegion,LoadState:()=>s.LoadState,Meld:()=>t.Meld,MeldDisplay:()=>e.MeldDisplay,MeldGame:()=>i.MeldGame,MovementAction:()=>s.MovementAction,ReleaseDashAction:()=>s.ReleaseDashAction,SelectItemAction:()=>s.SelectItemAction,SelectItemSetAction:()=>s.SelectItemSetAction,SelectToolAction:()=>s.SelectToolAction,UnloadPlayer:()=>s.UnloadPlayer,UseItemAction:()=>s.UseItemAction,UseToolAction:()=>s.UseToolAction,updatesPerSecond:()=>i.updatesPerSecond});var t=a("./libs/meld/src/meld.ts"),e=a("./libs/meld/src/display/meld-display.ts"),i=a("./libs/meld/src/meld-game.ts"),s=a("./libs/meld/src/state/game-update.ts")})(),l})()));